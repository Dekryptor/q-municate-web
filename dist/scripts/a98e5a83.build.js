/* q-municate - v1.1.0 - 2015-12-28 */
function ProgressBar(a,b){var c=ProgressBar.OPTION_NAME,d=ProgressBar.OPTION_VALUE,e=ProgressBar.DEFAULT_VALUE,f=ProgressBar.EVENT,g=a,h=document.getElementById(g),i=[],j=[],k="",l="",m="",n="",o=100,p=1,q={},r=this,s=function(){b=b||{},a&&(r.setWidth(b.width||e.WIDTH),r.setHeight(b.height||e.HEIGHT),h.innerHTML="",h.setAttribute("class","progressbar-control"))},t=function(){if(1==i.length){var a=t,b=0,d=i[b],e=r.getOptionValue(c.SPACE),f=0==e?100-r.getOptionValue(c.PERCENT):0;r.setOptionValue(c.SPACE,f,d[c.ITEM_ID]),_initialModeTimer=setTimeout(function(){a()},700)}},u=function(a){if(a&&a==m)return n;var b=0;if(1!=i.length)if(0==i.length)r.createItem({itemID:a});else if(i.length>1){if(!a)return 0;for(var d=0,e=i.length;e>d;d++)if(i[d][c.ITEM_ID]==a)return m=a,n=d,d}return b},v=function(a,b){if(0>a)return 0;var e=i[b],g=0,j=0;switch(e[c.POSITION]){case d.POSITION.RELATIVE:for(var k=0,l=i.length;l>k;k++)k!=b&&i[k][c.POSITION]==d.POSITION.RELATIVE&&(g+=i[k][c.PERCENT]);j=100-g,a>=j&&setTimeout(function(){h.dispatchEvent(new CustomEvent(f.COMPLETED,{detail:{itemID:e.itemID,me:r}}))},500);break;case d.POSITION.ABSOLUTE:j=100-e[c.SPACE]}return j>=a?a:j};this.getElement=function(){return h},this.getWidth=function(){return k},this.setWidth=function(a){return k=h.style.width=a,!0},this.getHeight=function(){return l},this.setHeight=function(a){return l=h.style.height=a,!0},this.createItem=function(a){if("string"==typeof a){var b=a;a={},a[c.ITEM_ID]=b}a=a||{};var f=h.appendChild(document.createElement("div")),b=a[c.ITEM_ID]=a[c.ITEM_ID]||"";if(i.length>0&&""==b)return!1;switch(a[c.TYPE]=a[c.TYPE]||e.TYPE,a[c.PERCENT]=a[c.PERCENT]||e.PERCENT,a[c.ALIGN]=a[c.ALIGN]||e.ALIGN,a[c.SPACE]?a[c.POSITION]=d.POSITION.ABSOLUTE:(a[c.SPACE]=e.SPACE,a[c.POSITION]=a[c.POSITION]||d.POSITION.RELATIVE),a[c.TYPE]){case d.TYPE.BAR:a[c.COLOR_ID]=a[c.COLOR_ID]||e.COLOR_ID,a[c.OPACITY]=a[c.OPACITY]||e.OPACITY;break;case d.TYPE.LINE:a[c.COLOR_ID]=a[c.COLOR_ID]||e.LINE_COLOR_ID,a[c.OPACITY]=a[c.OPACITY]||e.LINE_OPACITY,a[c.POSITION]=d.POSITION.ABSOLUTE,a[c.SPACE]=a[c.PERCENT]}return i.push(a),j.push(f),f.style.opacity=0,f.classList.add("item-"+a[c.TYPE]),this.setOptionValue(c.COLOR_ID,a[c.COLOR_ID],b),this.setOptionValue(c.ALIGN,a[c.ALIGN],b),this.setOptionValue(c.POSITION,a[c.POSITION],b),this.setOptionValue(c.PERCENT,a[c.PERCENT],b),!0},this.removeItem=function(a){var b=u(a),c=j[b];return null!=c?(c.parentNode.removeChild(c),i.splice(b,1),j.splice(b,1),!0):!1},this.removeAll=function(){return h?(h.innerHTML="",i=[],j=[],!0):!1},this.getMaxValue=function(){return o},this.setMaxValue=function(a){return o!=a&&a&&(p=100/a,o=a),p},this.getExValue=function(a){a=a||"first";var b=q[a]||0;return b},this.getPercentByValue=function(a,b,c){c&&c!=this.getMaxValue()&&this.setMaxValue(c),0>a&&(a=0),a>this.getMaxValue()&&(a=this.getMaxValue()),b=b||"first",q[b]=a;var d=c?a*this.getMaxValue(c):a*p;return parseInt(d)},this.getOptionValue=function(a,b){var c=u(b);return i[c][a]},this.setOptionValue=function(a,b,e){var g=u(e),k=j[g],l=i[g];switch(a){case c.ITEM_ID:return!1;case c.TYPE:return!1;case c.PERCENT:var m=this;setTimeout(function(){switch(b=parseInt(b)||0,l[c.TYPE]){case d.TYPE.BAR:b=v(b,g),k.style.width=b+"%",l[c.PERCENT]=b;break;case d.TYPE.LINE:m.setOptionValue(c.SPACE,b,e)}var a=0==b?0:l[c.OPACITY];k.style.opacity=a,setTimeout(function(){switch(h.dispatchEvent(new CustomEvent(f.CHANGED,{detail:{itemID:e,me:m}})),b){case 0:h.dispatchEvent(new CustomEvent(f.STARTING,{detail:{itemID:e,me:m}}));break;case 100:h.dispatchEvent(new CustomEvent(f.COMPLETED,{detail:{itemID:e,me:m}}))}},240)},10);break;case c.COLOR_ID:k.classList.remove(l[c.COLOR_ID]),k.classList.add(b),l[c.COLOR_ID]=b;break;case c.OPACITY:l[c.PERCENT]&&(k.style.opacity=b),l[c.OPACITY]=b;break;case c.ALIGN:k.style.cssFloat=b,l[c.ALIGN]=b,l[c.POSITION]==d.POSITION.ABSOLUTE&&this.setOptionValue(c.SPACE,l[c.SPACE],e);break;case c.SPACE:l[c.TYPE]==d.TYPE.LINE&&(0>b&&(b=0),b>100&&(b=100),l[c.PERCENT]=b),l[c.POSITION]!=d.POSITION.ABSOLUTE&&this.setOptionValue(c.POSITION,d.POSITION.ABSOLUTE,e),k.style.left="",k.style.right="",k.style[l[c.ALIGN]]=b+"%",l[c.SPACE]=b,l[c.TYPE]==d.TYPE.BAR&&this.setOptionValue(c.PERCENT,l[c.PERCENT],e);break;case c.POSITION:switch(l[c.TYPE]){case d.TYPE.BAR:b==d.POSITION.RELATIVE&&(k.style.left="",k.style.right="",l[c.SPACE]=0),k.style.position=b,l[c.POSITION]=b;break;case d.TYPE.LINE:b=d.POSITION.ABSOLUTE,k.style.position=b,l[c.POSITION]=b}}return!0},this.getPercent=function(a){return this.getOptionValue(c.PERCENT,a)},this.setPercent=function(a,b){return this.setOptionValue(c.PERCENT,a,b)},this.initialMode=function(a){if(a){this.removeAll(),this.setPercent(25),this.setOptionValue(c.COLOR_ID,d.COLOR_ID.WHITE);setTimeout(function(){t()},50)}else clearTimeout(_initialModeTimer),this.removeAll()},s()}function openPopup(a){a.add(".popups").addClass("is-overlay")}function closePopup(){$(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay"),$(".temp-box").remove(),$(".attach-video video")[0]&&$(".attach-video video")[0].pause()}function setDuration(a){var b=a||0;$(".mediacall-info-duration, .mediacall-remote-duration").text(getTimer(b)),win&&$(win.document.body).find(".mediacall-info-duration, .mediacall-remote-duration").text(getTimer(b)),callTimer=setTimeout(function(){b++,setDuration(b)},1e3)}function getTimer(a){var b,c,d;return b=Math.floor(a/3600),b=b>=10?b:"0"+b,c=Math.floor(a/60),c=c>=10?c:"0"+c,d=Math.floor(a%60),d=d>=10?d:"0"+d,b+":"+c+":"+d}function showError(a){var b;b='<article class="message message_service l-flexbox l-flexbox_alignstretch">',b+='<span class="message-avatar contact-avatar_message request-button_pending"></span>',b+='<div class="message-container-wrap">',b+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',b+='<div class="message-content">',b+='<h4 class="message-author message-error">Devices are not found</h4>',b+="</div>",b+="</div></div></article>",a.find(".mCSB_container").append(b)}function fixScroll(){var a=$(".l-chat:visible"),b=a.find(".l-chat-content .mCSB_container").height(),c=a.find(".l-chat-content").height(),d=a.find(".l-chat-content .mCSB_draggerContainer").height(),e=a.find(".l-chat-content .mCSB_dragger").height();a.find(".l-chat-content .mCSB_container").css({top:c-b+"px"}),a.find(".l-chat-content .mCSB_dragger").css({top:d-e+"px"})}function capitaliseFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1)}function enableFullScreenMode(){var a,b,c,d,e,f,g,h;return a=window.screen.availWidth,b=window.screen.availHeight,c=a/2,d=b/2,e=(a-c)/2,f=(b-d)/2,g=window.location.origin+window.location.pathname+"full-mode.html",h="width="+c+",height="+d+",left="+e+",top="+f+",resizable=yes",window.open(g,"call-full-mode",h)}var requirejs,require,define;!function(global){function isFunction(a){return"[object Function]"===ostring.call(a)}function isArray(a){return"[object Array]"===ostring.call(a)}function each(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function hasProp(a,b){return hasOwn.call(a,b)}function getOwn(a,b){return hasProp(a,b)&&a[b]}function eachProp(a,b){var c;for(c in a)if(hasProp(a,c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){(c||!hasProp(a,e))&&(!d||"object"!=typeof b||!b||isArray(b)||isFunction(b)||b instanceof RegExp?a[e]=b:(a[e]||(a[e]={}),mixin(a[e],b,c,d)))}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(a){throw a}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function b(a){var b,c;for(b=0;b<a.length;b++)if(c=a[b],"."===c)a.splice(b,1),b-=1;else if(".."===c){if(0===b||1===b&&".."===a[2]||".."===a[b-1])continue;b>0&&(a.splice(b-1,2),b-=2)}}function c(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q=c&&c.split("/"),r=x.map,s=r&&r["*"];if(a&&(a=a.split("/"),k=a.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(a[k])&&(a[k]=a[k].replace(jsSuffixRegExp,"")),"."===a[0].charAt(0)&&q&&(p=q.slice(0,q.length-1),a=p.concat(a)),b(a),a=a.join("/")),d&&r&&(q||s)){g=a.split("/");a:for(h=g.length;h>0;h-=1){if(j=g.slice(0,h).join("/"),q)for(i=q.length;i>0;i-=1)if(f=getOwn(r,q.slice(0,i).join("/")),f&&(f=getOwn(f,j))){l=f,m=h;break a}!n&&s&&getOwn(s,j)&&(n=getOwn(s,j),o=h)}!l&&n&&(l=n,m=o),l&&(g.splice(0,m,l),a=g.join("/"))}return e=getOwn(x.pkgs,a),e?e:a}function d(a){isBrowser&&each(scripts(),function(b){return b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===u.contextName?(b.parentNode.removeChild(b),!0):void 0})}function e(a){var b=getOwn(x.paths,a);return b&&isArray(b)&&b.length>1?(b.shift(),u.require.undef(a),u.makeRequire(null,{skipMap:!0})([a]),!0):void 0}function f(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function g(a,b,d,e){var g,h,i,j,k=null,l=b?b.name:null,m=a,n=!0,o="";return a||(n=!1,a="_@r"+(F+=1)),j=f(a),k=j[0],a=j[1],k&&(k=c(k,l,e),h=getOwn(C,k)),a&&(k?o=h&&h.normalize?h.normalize(a,function(a){return c(a,l,e)}):-1===a.indexOf("!")?c(a,l,e):a:(o=c(a,l,e),j=f(o),k=j[0],o=j[1],d=!0,g=u.nameToUrl(o))),i=!k||h||d?"":"_unnormalized"+(G+=1),{prefix:k,name:o,parentMap:b,unnormalized:!!i,url:g,originalName:m,isDefine:n,id:(k?k+"!"+o:o)+i}}function h(a){var b=a.id,c=getOwn(y,b);return c||(c=y[b]=new u.Module(a)),c}function i(a,b,c){var d=a.id,e=getOwn(y,d);!hasProp(C,d)||e&&!e.defineEmitComplete?(e=h(a),e.error&&"error"===b?c(e.error):e.on(b,c)):"defined"===b&&c(C[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=getOwn(y,b);c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function k(){globalDefQueue.length&&(each(globalDefQueue,function(a){var b=a[0];"string"==typeof b&&(u.defQueueMap[b]=!0),B.push(a)}),globalDefQueue=[])}function l(a){delete y[a],delete z[a]}function m(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,each(a.depMaps,function(d,e){var f=d.id,g=getOwn(y,f);!g||a.depMatched[e]||c[f]||(getOwn(b,f)?(a.defineDep(e,C[f]),a.check()):m(g,b,c))}),c[d]=!0)}function n(){var a,b,c=1e3*x.waitSeconds,f=c&&u.startTime+c<(new Date).getTime(),g=[],h=[],i=!1,k=!0;if(!s){if(s=!0,eachProp(z,function(a){var c=a.map,j=c.id;if(a.enabled&&(c.isDefine||h.push(a),!a.error))if(!a.inited&&f)e(j)?(b=!0,i=!0):(g.push(j),d(j));else if(!a.inited&&a.fetched&&c.isDefine&&(i=!0,!c.prefix))return k=!1}),f&&g.length)return a=makeError("timeout","Load timeout for modules: "+g,null,g),a.contextName=u.contextName,j(a);k&&each(h,function(a){m(a,{},{})}),f&&!b||!i||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,n()},50)),s=!1}}function o(a){hasProp(C,a[0])||h(g(a[0],null,!0)).init(a[1],a[2])}function p(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function q(a){var b=a.currentTarget||a.srcElement;return p(b,u.onScriptLoad,"load","onreadystatechange"),p(b,u.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}function r(){var a;for(k();B.length;){if(a=B.shift(),null===a[0])return j(makeError("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));o(a)}u.defQueueMap={}}var s,t,u,v,w,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},y={},z={},A={},B=[],C={},D={},E={},F=1,G=1;return v={require:function(a){return a.require?a.require:a.require=u.makeRequire(a.map)},exports:function(a){return a.usingExports=!0,a.map.isDefine?a.exports?C[a.map.id]=a.exports:a.exports=C[a.map.id]={}:void 0},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return getOwn(x.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}},t=function(a){this.events=getOwn(A,a.id)||{},this.map=a,this.shim=getOwn(x.shim,a.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},t.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,u.startTime=(new Date).getTime();var a=this.map;return this.shim?void u.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()})):a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;D[a]||(D[a]=!0,u.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id,d=this.depExports,e=this.exports,f=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(f)){try{e=u.execCb(c,f,d,e)}catch(g){a=g}if(this.map.isDefine&&void 0===e&&(b=this.module,b?e=b.exports:this.usingExports&&(e=this.exports)),a){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",j(this.error=a);"undefined"!=typeof console&&console.error?console.error(a):req.onError(a)}}else e=f;if(this.exports=e,this.map.isDefine&&!this.ignore&&(C[c]=e,req.onResourceLoad)){var h=[];each(this.depMaps,function(a){h.push(a.normalizedMap||a)}),req.onResourceLoad(u,this.map,h)}l(c),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(u.defQueueMap,c)||this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=g(a.prefix);this.depMaps.push(d),i(d,"defined",bind(this,function(d){var e,f,k,m=getOwn(E,this.map.id),n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null,p=u.makeRequire(a.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return c(a,o,!0)})||""),f=g(a.prefix+"!"+n,this.map.parentMap),i(f,"defined",bind(this,function(a){this.map.normalizedMap=f,this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),k=getOwn(y,f.id),void(k&&(this.depMaps.push(f),this.events.error&&k.on("error",bind(this,function(a){this.emit("error",a)})),k.enable()))):m?(this.map.url=u.nameToUrl(m),void this.load()):(e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(y,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&l(a.map.id)}),j(a)}),e.fromText=bind(this,function(c,d){var f=a.name,i=g(f),k=useInteractive;d&&(c=d),k&&(useInteractive=!1),h(i),hasProp(x.config,b)&&(x.config[f]=x.config[b]);try{req.exec(c)}catch(l){return j(makeError("fromtexteval","fromText eval for "+b+" failed: "+l,l,[b]))}k&&(useInteractive=!0),this.depMaps.push(i),u.completeLoad(f),p([f],e)}),void d.load(a.name,p,e,x))})),u.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){z[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,d,e;if("string"==typeof a){if(a=g(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,e=getOwn(v,a.id))return void(this.depExports[b]=e(this));this.depCount+=1,i(a,"defined",bind(this,function(a){this.undefed||(this.defineDep(b,a),this.check())})),this.errback?i(a,"error",bind(this,this.errback)):this.events.error&&i(a,"error",bind(this,function(a){this.emit("error",a)}))}c=a.id,d=y[c],hasProp(v,c)||!d||d.enabled||u.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=getOwn(y,a.id);b&&!b.enabled&&u.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},u={config:x,contextName:a,registry:y,defined:C,urlFetched:D,defQueue:B,defQueueMap:{},Module:t,makeModuleMap:g,nextTick:req.nextTick,onError:j,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=x.shim,c={paths:!0,bundles:!0,config:!0,map:!0};eachProp(a,function(a,b){c[b]?(x[b]||(x[b]={}),mixin(x[b],a,!0,!0)):x[b]=a}),a.bundles&&eachProp(a.bundles,function(a,b){each(a,function(a){a!==b&&(E[a]=b)})}),a.shim&&(eachProp(a.shim,function(a,c){isArray(a)&&(a={deps:a}),!a.exports&&!a.init||a.exportsFn||(a.exportsFn=u.makeShimExports(a)),b[c]=a}),x.shim=b),a.packages&&each(a.packages,function(a){var b,c;a="string"==typeof a?{name:a}:a,c=a.name,b=a.location,b&&(x.paths[c]=a.location),x.pkgs[c]=a.name+"/"+(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(y,function(a,b){a.inited||a.map.unnormalized||(a.map=g(b,null,!0))}),(a.deps||a.callback)&&u.require(a.deps||[],a.callback)},makeShimExports:function(a){function b(){var b;return a.init&&(b=a.init.apply(global,arguments)),b||a.exports&&getGlobal(a.exports)}return b},makeRequire:function(b,e){function f(c,d,i){var k,l,m;return e.enableBuildCallback&&d&&isFunction(d)&&(d.__requireJsBuild=!0),"string"==typeof c?isFunction(d)?j(makeError("requireargs","Invalid require call"),i):b&&hasProp(v,c)?v[c](y[b.id]):req.get?req.get(u,c,b,f):(l=g(c,b,!1,!0),k=l.id,hasProp(C,k)?C[k]:j(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a+(b?"":". Use require([])")))):(r(),u.nextTick(function(){r(),m=h(g(null,b)),m.skipMap=e.skipMap,m.init(c,d,i,{enabled:!0}),n()}),f)}return e=e||{},mixin(f,{isBrowser:isBrowser,toUrl:function(a){var d,e=a.lastIndexOf("."),f=a.split("/")[0],g="."===f||".."===f;return-1!==e&&(!g||e>1)&&(d=a.substring(e,a.length),a=a.substring(0,e)),u.nameToUrl(c(a,b&&b.id,!0),d,!0)},defined:function(a){return hasProp(C,g(a,b,!1,!0).id)},specified:function(a){return a=g(a,b,!1,!0).id,hasProp(C,a)||hasProp(y,a)}}),b||(f.undef=function(a){k();var c=g(a,b,!0),e=getOwn(y,a);e.undefed=!0,d(a),delete C[a],delete D[c.url],delete A[a],eachReverse(B,function(b,c){b[0]===a&&B.splice(c,1)}),delete u.defQueueMap[a],e&&(e.events.defined&&(A[a]=e.events),l(a))}),f},enable:function(a){var b=getOwn(y,a.id);b&&h(a).enable()},completeLoad:function(a){var b,c,d,f=getOwn(x.shim,a)||{},g=f.exports;for(k();B.length;){if(c=B.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);o(c)}if(u.defQueueMap={},d=getOwn(y,a),!b&&!hasProp(C,a)&&d&&!d.inited){if(!(!x.enforceDefine||g&&getGlobal(g)))return e(a)?void 0:j(makeError("nodefine","No define call for "+a,null,[a]));o([a,f.deps||[],f.exportsFn])}n()},nameToUrl:function(a,b,c){var d,e,f,g,h,i,j,k=getOwn(x.pkgs,a);if(k&&(a=k),j=getOwn(E,a))return u.nameToUrl(j,b,c);if(req.jsExtRegExp.test(a))h=a+(b||"");else{for(d=x.paths,e=a.split("/"),f=e.length;f>0;f-=1)if(g=e.slice(0,f).join("/"),i=getOwn(d,g)){isArray(i)&&(i=i[0]),e.splice(0,f,i);break}h=e.join("/"),h+=b||(/^data\:|\?/.test(h)||c?"":".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+h}return x.urlArgs?h+((-1===h.indexOf("?")?"?":"&")+x.urlArgs):h},load:function(a,b){req.load(u,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=q(a);u.completeLoad(b.id)}},onScriptError:function(a){var b=q(a);if(!e(b.id)){var c=[];return eachProp(y,function(a,d){0!==d.indexOf("_@r")&&each(a.depMaps,function(a){return a.id===b.id&&c.push(d),!0})}),j(makeError("scripterror",'Script error for "'+b.id+(c.length?'", needed by: '+c.join(", "):'"'),a,[b.id]))}}},u.require=u.makeRequire(),u}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(a){return"interactive"===a.readyState?interactiveScript=a:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(a,b,c,d){var e,f,g=defContextName;return isArray(a)||"string"==typeof a||(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=getOwn(contexts,g),e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},req.nextTick="undefined"!=typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(a){req[a]=function(){var b=contexts[defContextName];return b.require[a].apply(b,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(a,b,c){var d=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return d.type=a.scriptType||"text/javascript",d.charset="utf-8",d.async=!0,d},req.load=function(a,b,c){var d,e=a&&a.config||{};if(isBrowser)return d=req.createNode(e,b,c),e.onNodeCreated&&e.onNodeCreated(d,e,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||isOpera?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(useInteractive=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,currentlyAddingScript=d,baseElement?head.insertBefore(d,baseElement):head.appendChild(d),currentlyAddingScript=null,d;if(isWebWorker)try{importScripts(c),a.completeLoad(b)}catch(f){a.onError(makeError("importscripts","importScripts failed for "+b+" at "+c,f,[b]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(a){return head||(head=a.parentNode),dataMain=a.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),isArray(b)||(c=b,b=null),!b&&isFunction(c)&&(b=[],c.length&&(c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b))),useInteractive&&(d=currentlyAddingScript||getInteractiveScript(),d&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")])),e?(e.defQueue.push([a,b,c]),e.defQueueMap[a]=!0):globalDefQueue.push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(a){var b="length"in a&&a.length,c=_.type(a);return"function"===c||_.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}function d(a,b,c){if(_.isFunction(b))return _.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return _.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(ha.test(b))return _.filter(b,a,c);b=_.filter(b,a)}return _.grep(a,function(a){return U.call(b,a)>=0!==c})}function e(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function f(a){var b=oa[a]={};return _.each(a.match(na)||[],function(a,c){b[c]=!0}),b}function g(){Z.removeEventListener("DOMContentLoaded",g,!1),a.removeEventListener("load",g,!1),_.ready()}function h(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=_.expando+h.uid++}function i(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(ua,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:ta.test(c)?_.parseJSON(c):c}catch(e){}sa.set(a,b,c)}else c=void 0;return c}function j(){return!0}function k(){return!1}function l(){try{return Z.activeElement}catch(a){}}function m(a,b){return _.nodeName(a,"table")&&_.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function n(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function o(a){var b=Ka.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function p(a,b){for(var c=0,d=a.length;d>c;c++)ra.set(a[c],"globalEval",!b||ra.get(b[c],"globalEval"))}function q(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(ra.hasData(a)&&(f=ra.access(a),g=ra.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)_.event.add(b,e,j[e][c])}sa.hasData(a)&&(h=sa.access(a),i=_.extend({},h),sa.set(b,i))}}function r(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&_.nodeName(a,b)?_.merge([a],c):c}function s(a,b){var c=b.nodeName.toLowerCase();"input"===c&&ya.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}function t(b,c){var d,e=_(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:_.css(e[0],"display");return e.detach(),f}function u(a){var b=Z,c=Oa[a];return c||(c=t(a,b),"none"!==c&&c||(Na=(Na||_("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=Na[0].contentDocument,b.write(),b.close(),c=t(a,b),Na.detach()),Oa[a]=c),c}function v(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||_.contains(a.ownerDocument,a)||(g=_.style(a,b)),Qa.test(g)&&Pa.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function w(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}function x(a,b){if(b in a)return b;for(var c=b[0].toUpperCase()+b.slice(1),d=b,e=Xa.length;e--;)if(b=Xa[e]+c,b in a)return b;return d}function y(a,b,c){var d=Ta.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function z(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=_.css(a,c+wa[f],!0,e)),d?("content"===c&&(g-=_.css(a,"padding"+wa[f],!0,e)),"margin"!==c&&(g-=_.css(a,"border"+wa[f]+"Width",!0,e))):(g+=_.css(a,"padding"+wa[f],!0,e),"padding"!==c&&(g+=_.css(a,"border"+wa[f]+"Width",!0,e)));return g}function A(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ra(a),g="border-box"===_.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=v(a,b,f),(0>e||null==e)&&(e=a.style[b]),Qa.test(e))return e;d=g&&(Y.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+z(a,b,c||(g?"border":"content"),d,f)+"px"}function B(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=ra.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&xa(d)&&(f[g]=ra.access(d,"olddisplay",u(d.nodeName)))):(e=xa(d),"none"===c&&e||ra.set(d,"olddisplay",e?c:_.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function C(a,b,c,d,e){return new C.prototype.init(a,b,c,d,e)}function D(){return setTimeout(function(){Ya=void 0}),Ya=_.now()}function E(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=wa[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function F(a,b,c){for(var d,e=(cb[b]||[]).concat(cb["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function G(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},n=a.style,o=a.nodeType&&xa(a),p=ra.get(a,"fxshow");c.queue||(h=_._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,_.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[n.overflow,n.overflowX,n.overflowY],j=_.css(a,"display"),k="none"===j?ra.get(a,"olddisplay")||u(a.nodeName):j,"inline"===k&&"none"===_.css(a,"float")&&(n.display="inline-block")),c.overflow&&(n.overflow="hidden",l.always(function(){n.overflow=c.overflow[0],n.overflowX=c.overflow[1],n.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],$a.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(o?"hide":"show")){if("show"!==e||!p||void 0===p[d])continue;o=!0}m[d]=p&&p[d]||_.style(a,d)}else j=void 0;if(_.isEmptyObject(m))"inline"===("none"===j?u(a.nodeName):j)&&(n.display=j);else{p?"hidden"in p&&(o=p.hidden):p=ra.access(a,"fxshow",{}),f&&(p.hidden=!o),o?_(a).show():l.done(function(){_(a).hide()}),l.done(function(){var b;ra.remove(a,"fxshow");for(b in m)_.style(a,b,m[b])});for(d in m)g=F(o?p[d]:0,d,l),d in p||(p[d]=g.start,o&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function H(a,b){var c,d,e,f,g;for(c in a)if(d=_.camelCase(c),e=b[d],f=a[c],_.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=_.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function I(a,b,c){var d,e,f=0,g=bb.length,h=_.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Ya||D(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:_.extend({},b),opts:_.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Ya||D(),duration:c.duration,tweens:[],createTween:function(b,c){var d=_.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(H(k,j.opts.specialEasing);g>f;f++)if(d=bb[f].call(j,a,k,j.opts))return d;return _.map(k,F,j),_.isFunction(j.opts.start)&&j.opts.start.call(a,j),_.fx.timer(_.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function J(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(na)||[];if(_.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",
(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function K(a,b,c,d){function e(h){var i;return f[h]=!0,_.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===tb;return e(b.dataTypes[0])||!f["*"]&&e("*")}function L(a,b){var c,d,e=_.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&_.extend(!0,a,d),a}function M(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function N(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function O(a,b,c,d){var e;if(_.isArray(b))_.each(b,function(b,e){c||yb.test(a)?d(a,e):O(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==_.type(b))d(a,b);else for(e in b)O(a+"["+e+"]",b[e],c,d)}function P(a){return _.isWindow(a)?a:9===a.nodeType&&a.defaultView}var Q=[],R=Q.slice,S=Q.concat,T=Q.push,U=Q.indexOf,V={},W=V.toString,X=V.hasOwnProperty,Y={},Z=a.document,$="2.1.4",_=function(a,b){return new _.fn.init(a,b)},aa=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ba=/^-ms-/,ca=/-([\da-z])/gi,da=function(a,b){return b.toUpperCase()};_.fn=_.prototype={jquery:$,constructor:_,selector:"",length:0,toArray:function(){return R.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:R.call(this)},pushStack:function(a){var b=_.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return _.each(this,a,b)},map:function(a){return this.pushStack(_.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(R.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:T,sort:Q.sort,splice:Q.splice},_.extend=_.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||_.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(_.isPlainObject(d)||(e=_.isArray(d)))?(e?(e=!1,f=c&&_.isArray(c)?c:[]):f=c&&_.isPlainObject(c)?c:{},g[b]=_.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},_.extend({expando:"jQuery"+($+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===_.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!_.isArray(a)&&a-parseFloat(a)+1>=0},isPlainObject:function(a){return"object"!==_.type(a)||a.nodeType||_.isWindow(a)?!1:a.constructor&&!X.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?V[W.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=_.trim(a),a&&(1===a.indexOf("use strict")?(b=Z.createElement("script"),b.text=a,Z.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(ba,"ms-").replace(ca,da)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;g>f&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;g>f&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(aa,"")},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?_.merge(d,"string"==typeof a?[a]:a):T.call(d,a)),d},inArray:function(a,b,c){return null==b?-1:U.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;g>f;f++)e=b(a[f],f,d),null!=e&&i.push(e);else for(f in a)e=b(a[f],f,d),null!=e&&i.push(e);return S.apply([],i)},guid:1,proxy:function(a,b){var c,d,e;return"string"==typeof b&&(c=a[b],b=a,a=c),_.isFunction(a)?(d=R.call(arguments,2),e=function(){return a.apply(b||this,d.concat(R.call(arguments)))},e.guid=a.guid=a.guid||_.guid++,e):void 0},now:Date.now,support:Y}),_.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){V["[object "+b+"]"]=b.toLowerCase()});var ea=function(a){function b(a,b,c,d){var e,f,g,h,i,j,l,n,o,p;if((b?b.ownerDocument||b:O)!==G&&F(b),b=b||G,c=c||[],h=b.nodeType,"string"!=typeof a||!a||1!==h&&9!==h&&11!==h)return c;if(!d&&I){if(11!==h&&(e=sa.exec(a)))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&M(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return $.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&v.getElementsByClassName)return $.apply(c,b.getElementsByClassName(g)),c}if(v.qsa&&(!J||!J.test(a))){if(n=l=N,o=b,p=1!==h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=z(a),(l=b.getAttribute("id"))?n=l.replace(ua,"\\$&"):b.setAttribute("id",n),n="[id='"+n+"'] ",i=j.length;i--;)j[i]=n+m(j[i]);o=ta.test(a)&&k(b.parentNode)||b,p=j.join(",")}if(p)try{return $.apply(c,o.querySelectorAll(p)),c}catch(q){}finally{l||b.removeAttribute("id")}}}return B(a.replace(ia,"$1"),b,c,d)}function c(){function a(c,d){return b.push(c+" ")>w.cacheLength&&delete a[b.shift()],a[c+" "]=d}var b=[];return a}function d(a){return a[N]=!0,a}function e(a){var b=G.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function f(a,b){for(var c=a.split("|"),d=a.length;d--;)w.attrHandle[c[d]]=b}function g(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||V)-(~a.sourceIndex||V);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function h(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function i(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function j(a){return d(function(b){return b=+b,d(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function k(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}function l(){}function m(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function n(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=Q++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[P,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if(i=b[N]||(b[N]={}),(h=i[d])&&h[0]===P&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function o(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function p(a,c,d){for(var e=0,f=c.length;f>e;e++)b(a,c[e],d);return d}function q(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function r(a,b,c,e,f,g){return e&&!e[N]&&(e=r(e)),f&&!f[N]&&(f=r(f,g)),d(function(d,g,h,i){var j,k,l,m=[],n=[],o=g.length,r=d||p(b||"*",h.nodeType?[h]:h,[]),s=!a||!d&&b?r:q(r,m,a,h,i),t=c?f||(d?a:o||e)?[]:g:s;if(c&&c(s,t,h,i),e)for(j=q(t,n),e(j,[],h,i),k=j.length;k--;)(l=j[k])&&(t[n[k]]=!(s[n[k]]=l));if(d){if(f||a){if(f){for(j=[],k=t.length;k--;)(l=t[k])&&j.push(s[k]=l);f(null,t=[],j,i)}for(k=t.length;k--;)(l=t[k])&&(j=f?aa(d,l):m[k])>-1&&(d[j]=!(g[j]=l))}}else t=q(t===g?t.splice(o,t.length):t),f?f(null,g,t,i):$.apply(g,t)})}function s(a){for(var b,c,d,e=a.length,f=w.relative[a[0].type],g=f||w.relative[" "],h=f?1:0,i=n(function(a){return a===b},g,!0),j=n(function(a){return aa(b,a)>-1},g,!0),k=[function(a,c,d){var e=!f&&(d||c!==C)||((b=c).nodeType?i(a,c,d):j(a,c,d));return b=null,e}];e>h;h++)if(c=w.relative[a[h].type])k=[n(o(k),c)];else{if(c=w.filter[a[h].type].apply(null,a[h].matches),c[N]){for(d=++h;e>d&&!w.relative[a[d].type];d++);return r(h>1&&o(k),h>1&&m(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ia,"$1"),c,d>h&&s(a.slice(h,d)),e>d&&s(a=a.slice(d)),e>d&&m(a))}k.push(c)}return o(k)}function t(a,c){var e=c.length>0,f=a.length>0,g=function(d,g,h,i,j){var k,l,m,n=0,o="0",p=d&&[],r=[],s=C,t=d||f&&w.find.TAG("*",j),u=P+=null==s?1:Math.random()||.1,v=t.length;for(j&&(C=g!==G&&g);o!==v&&null!=(k=t[o]);o++){if(f&&k){for(l=0;m=a[l++];)if(m(k,g,h)){i.push(k);break}j&&(P=u)}e&&((k=!m&&k)&&n--,d&&p.push(k))}if(n+=o,e&&o!==n){for(l=0;m=c[l++];)m(p,r,g,h);if(d){if(n>0)for(;o--;)p[o]||r[o]||(r[o]=Y.call(i));r=q(r)}$.apply(i,r),j&&!d&&r.length>0&&n+c.length>1&&b.uniqueSort(i)}return j&&(P=u,C=s),p};return e?d(g):g}var u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N="sizzle"+1*new Date,O=a.document,P=0,Q=0,R=c(),S=c(),T=c(),U=function(a,b){return a===b&&(E=!0),0},V=1<<31,W={}.hasOwnProperty,X=[],Y=X.pop,Z=X.push,$=X.push,_=X.slice,aa=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},ba="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ca="[\\x20\\t\\r\\n\\f]",da="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ea=da.replace("w","w#"),fa="\\["+ca+"*("+da+")(?:"+ca+"*([*^$|!~]?=)"+ca+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ea+"))|)"+ca+"*\\]",ga=":("+da+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+fa+")*)|.*)\\)|)",ha=new RegExp(ca+"+","g"),ia=new RegExp("^"+ca+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ca+"+$","g"),ja=new RegExp("^"+ca+"*,"+ca+"*"),ka=new RegExp("^"+ca+"*([>+~]|"+ca+")"+ca+"*"),la=new RegExp("="+ca+"*([^\\]'\"]*?)"+ca+"*\\]","g"),ma=new RegExp(ga),na=new RegExp("^"+ea+"$"),oa={ID:new RegExp("^#("+da+")"),CLASS:new RegExp("^\\.("+da+")"),TAG:new RegExp("^("+da.replace("w","w*")+")"),ATTR:new RegExp("^"+fa),PSEUDO:new RegExp("^"+ga),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ca+"*(even|odd|(([+-]|)(\\d*)n|)"+ca+"*(?:([+-]|)"+ca+"*(\\d+)|))"+ca+"*\\)|)","i"),bool:new RegExp("^(?:"+ba+")$","i"),needsContext:new RegExp("^"+ca+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ca+"*((?:-\\d)?\\d*)"+ca+"*\\)|)(?=[^-]|$)","i")},pa=/^(?:input|select|textarea|button)$/i,qa=/^h\d$/i,ra=/^[^{]+\{\s*\[native \w/,sa=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ta=/[+~]/,ua=/'|\\/g,va=new RegExp("\\\\([\\da-f]{1,6}"+ca+"?|("+ca+")|.)","ig"),wa=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},xa=function(){F()};try{$.apply(X=_.call(O.childNodes),O.childNodes),X[O.childNodes.length].nodeType}catch(ya){$={apply:X.length?function(a,b){Z.apply(a,_.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}v=b.support={},y=b.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},F=b.setDocument=function(a){var b,c,d=a?a.ownerDocument||a:O;return d!==G&&9===d.nodeType&&d.documentElement?(G=d,H=d.documentElement,c=d.defaultView,c&&c!==c.top&&(c.addEventListener?c.addEventListener("unload",xa,!1):c.attachEvent&&c.attachEvent("onunload",xa)),I=!y(d),v.attributes=e(function(a){return a.className="i",!a.getAttribute("className")}),v.getElementsByTagName=e(function(a){return a.appendChild(d.createComment("")),!a.getElementsByTagName("*").length}),v.getElementsByClassName=ra.test(d.getElementsByClassName),v.getById=e(function(a){return H.appendChild(a).id=N,!d.getElementsByName||!d.getElementsByName(N).length}),v.getById?(w.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&I){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},w.filter.ID=function(a){var b=a.replace(va,wa);return function(a){return a.getAttribute("id")===b}}):(delete w.find.ID,w.filter.ID=function(a){var b=a.replace(va,wa);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),w.find.TAG=v.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):v.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},w.find.CLASS=v.getElementsByClassName&&function(a,b){return I?b.getElementsByClassName(a):void 0},K=[],J=[],(v.qsa=ra.test(d.querySelectorAll))&&(e(function(a){H.appendChild(a).innerHTML="<a id='"+N+"'></a><select id='"+N+"-\f]' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&J.push("[*^$]="+ca+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||J.push("\\["+ca+"*(?:value|"+ba+")"),a.querySelectorAll("[id~="+N+"-]").length||J.push("~="),a.querySelectorAll(":checked").length||J.push(":checked"),a.querySelectorAll("a#"+N+"+*").length||J.push(".#.+[+~]")}),e(function(a){var b=d.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&J.push("name"+ca+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||J.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),J.push(",.*:")})),(v.matchesSelector=ra.test(L=H.matches||H.webkitMatchesSelector||H.mozMatchesSelector||H.oMatchesSelector||H.msMatchesSelector))&&e(function(a){v.disconnectedMatch=L.call(a,"div"),L.call(a,"[s!='']:x"),K.push("!=",ga)}),J=J.length&&new RegExp(J.join("|")),K=K.length&&new RegExp(K.join("|")),b=ra.test(H.compareDocumentPosition),M=b||ra.test(H.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},U=b?function(a,b){if(a===b)return E=!0,0;var c=!a.compareDocumentPosition-!b.compareDocumentPosition;return c?c:(c=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&c||!v.sortDetached&&b.compareDocumentPosition(a)===c?a===d||a.ownerDocument===O&&M(O,a)?-1:b===d||b.ownerDocument===O&&M(O,b)?1:D?aa(D,a)-aa(D,b):0:4&c?-1:1)}:function(a,b){if(a===b)return E=!0,0;var c,e=0,f=a.parentNode,h=b.parentNode,i=[a],j=[b];if(!f||!h)return a===d?-1:b===d?1:f?-1:h?1:D?aa(D,a)-aa(D,b):0;if(f===h)return g(a,b);for(c=a;c=c.parentNode;)i.unshift(c);for(c=b;c=c.parentNode;)j.unshift(c);for(;i[e]===j[e];)e++;return e?g(i[e],j[e]):i[e]===O?-1:j[e]===O?1:0},d):G},b.matches=function(a,c){return b(a,null,null,c)},b.matchesSelector=function(a,c){if((a.ownerDocument||a)!==G&&F(a),c=c.replace(la,"='$1']"),v.matchesSelector&&I&&(!K||!K.test(c))&&(!J||!J.test(c)))try{var d=L.call(a,c);if(d||v.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return b(c,G,null,[a]).length>0},b.contains=function(a,b){return(a.ownerDocument||a)!==G&&F(a),M(a,b)},b.attr=function(a,b){(a.ownerDocument||a)!==G&&F(a);var c=w.attrHandle[b.toLowerCase()],d=c&&W.call(w.attrHandle,b.toLowerCase())?c(a,b,!I):void 0;return void 0!==d?d:v.attributes||!I?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null},b.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},b.uniqueSort=function(a){var b,c=[],d=0,e=0;if(E=!v.detectDuplicates,D=!v.sortStable&&a.slice(0),a.sort(U),E){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return D=null,a},x=b.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=x(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=x(b);return c},w=b.selectors={cacheLength:50,createPseudo:d,match:oa,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(va,wa),a[3]=(a[3]||a[4]||a[5]||"").replace(va,wa),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||b.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&b.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return oa.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&ma.test(c)&&(b=z(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(va,wa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=R[a+" "];return b||(b=new RegExp("(^|"+ca+")"+a+"("+ca+"|$)"))&&R(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,c,d){return function(e){var f=b.attr(e,a);return null==f?"!="===c:c?(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&f.indexOf(d)>-1:"$="===c?d&&f.slice(-d.length)===d:"~="===c?(" "+f.replace(ha," ")+" ").indexOf(d)>-1:"|="===c?f===d||f.slice(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[N]||(q[N]={}),j=k[a]||[],n=j[0]===P&&j[1],m=j[0]===P&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[P,n,m];break}}else if(s&&(j=(b[N]||(b[N]={}))[a])&&j[0]===P)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[N]||(l[N]={}))[a]=[P,m]),l!==b)););return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,c){var e,f=w.pseudos[a]||w.setFilters[a.toLowerCase()]||b.error("unsupported pseudo: "+a);return f[N]?f(c):f.length>1?(e=[a,a,"",c],w.setFilters.hasOwnProperty(a.toLowerCase())?d(function(a,b){for(var d,e=f(a,c),g=e.length;g--;)d=aa(a,e[g]),a[d]=!(b[d]=e[g])}):function(a){return f(a,0,e)}):f}},pseudos:{not:d(function(a){var b=[],c=[],e=A(a.replace(ia,"$1"));return e[N]?d(function(a,b,c,d){for(var f,g=e(a,null,d,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,d,f){return b[0]=a,e(b,null,f,c),b[0]=null,!c.pop()}}),has:d(function(a){return function(c){return b(a,c).length>0}}),contains:d(function(a){return a=a.replace(va,wa),function(b){return(b.textContent||b.innerText||x(b)).indexOf(a)>-1}}),lang:d(function(a){return na.test(a||"")||b.error("unsupported lang: "+a),a=a.replace(va,wa).toLowerCase(),function(b){var c;do if(c=I?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===H},focus:function(a){return a===G.activeElement&&(!G.hasFocus||G.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!w.pseudos.empty(a)},header:function(a){return qa.test(a.nodeName)},input:function(a){return pa.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:j(function(){return[0]}),last:j(function(a,b){return[b-1]}),eq:j(function(a,b,c){return[0>c?c+b:c]}),even:j(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:j(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:j(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:j(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},w.pseudos.nth=w.pseudos.eq;for(u in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[u]=h(u);for(u in{submit:!0,reset:!0})w.pseudos[u]=i(u);return l.prototype=w.filters=w.pseudos,w.setFilters=new l,z=b.tokenize=function(a,c){var d,e,f,g,h,i,j,k=S[a+" "];if(k)return c?0:k.slice(0);for(h=a,i=[],j=w.preFilter;h;){(!d||(e=ja.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=ka.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ia," ")}),h=h.slice(d.length));for(g in w.filter)!(e=oa[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return c?h.length:h?b.error(a):S(a,i).slice(0)},A=b.compile=function(a,b){var c,d=[],e=[],f=T[a+" "];if(!f){for(b||(b=z(a)),c=b.length;c--;)f=s(b[c]),f[N]?d.push(f):e.push(f);f=T(a,t(e,d)),f.selector=a}return f},B=b.select=function(a,b,c,d){var e,f,g,h,i,j="function"==typeof a&&a,l=!d&&z(a=j.selector||a);if(c=c||[],1===l.length){if(f=l[0]=l[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&v.getById&&9===b.nodeType&&I&&w.relative[f[1].type]){if(b=(w.find.ID(g.matches[0].replace(va,wa),b)||[])[0],!b)return c;j&&(b=b.parentNode),a=a.slice(f.shift().value.length)}for(e=oa.needsContext.test(a)?0:f.length;e--&&(g=f[e],!w.relative[h=g.type]);)if((i=w.find[h])&&(d=i(g.matches[0].replace(va,wa),ta.test(f[0].type)&&k(b.parentNode)||b))){if(f.splice(e,1),a=d.length&&m(f),!a)return $.apply(c,d),c;break}}return(j||A(a,l))(d,b,!I,c,ta.test(a)&&k(b.parentNode)||b),c},v.sortStable=N.split("").sort(U).join("")===N,v.detectDuplicates=!!E,F(),v.sortDetached=e(function(a){return 1&a.compareDocumentPosition(G.createElement("div"))}),e(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||f("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),v.attributes&&e(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||f("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),e(function(a){return null==a.getAttribute("disabled")})||f(ba,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),b}(a);_.find=ea,_.expr=ea.selectors,_.expr[":"]=_.expr.pseudos,_.unique=ea.uniqueSort,_.text=ea.getText,_.isXMLDoc=ea.isXML,_.contains=ea.contains;var fa=_.expr.match.needsContext,ga=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ha=/^.[^:#\[\.,]*$/;_.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?_.find.matchesSelector(d,a)?[d]:[]:_.find.matches(a,_.grep(b,function(a){return 1===a.nodeType}))},_.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(_(a).filter(function(){for(b=0;c>b;b++)if(_.contains(e[b],this))return!0}));for(b=0;c>b;b++)_.find(a,e[b],d);return d=this.pushStack(c>1?_.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(d(this,a||[],!1))},not:function(a){return this.pushStack(d(this,a||[],!0))},is:function(a){return!!d(this,"string"==typeof a&&fa.test(a)?_(a):a||[],!1).length}});var ia,ja=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ka=_.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:ja.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||ia).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof _?b[0]:b,_.merge(this,_.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:Z,!0)),ga.test(c[1])&&_.isPlainObject(b))for(c in b)_.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=Z.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=Z,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):_.isFunction(a)?"undefined"!=typeof ia.ready?ia.ready(a):a(_):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),_.makeArray(a,this))};ka.prototype=_.fn,ia=_(Z);var la=/^(?:parents|prev(?:Until|All))/,ma={children:!0,contents:!0,next:!0,prev:!0};_.extend({dir:function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&_(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),_.fn.extend({has:function(a){var b=_(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(_.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=fa.test(a)||"string"!=typeof a?_(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&_.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?_.unique(f):f)},index:function(a){return a?"string"==typeof a?U.call(_(a),this[0]):U.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(_.unique(_.merge(this.get(),_(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),_.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return _.dir(a,"parentNode")},parentsUntil:function(a,b,c){return _.dir(a,"parentNode",c)},next:function(a){return e(a,"nextSibling")},prev:function(a){return e(a,"previousSibling")},nextAll:function(a){return _.dir(a,"nextSibling")},prevAll:function(a){return _.dir(a,"previousSibling")},nextUntil:function(a,b,c){return _.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return _.dir(a,"previousSibling",c)},siblings:function(a){return _.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return _.sibling(a.firstChild)},contents:function(a){return a.contentDocument||_.merge([],a.childNodes)}},function(a,b){_.fn[a]=function(c,d){var e=_.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=_.filter(d,e)),this.length>1&&(ma[a]||_.unique(e),la.test(a)&&e.reverse()),this.pushStack(e)}});var na=/\S+/g,oa={};_.Callbacks=function(a){a="string"==typeof a?oa[a]||f(a):_.extend({},a);var b,c,d,e,g,h,i=[],j=!a.once&&[],k=function(f){for(b=a.memory&&f,c=!0,h=e||0,e=0,g=i.length,d=!0;i&&g>h;h++)if(i[h].apply(f[0],f[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,i&&(j?j.length&&k(j.shift()):b?i=[]:l.disable())},l={add:function(){if(i){var c=i.length;!function f(b){_.each(b,function(b,c){var d=_.type(c);"function"===d?a.unique&&l.has(c)||i.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),d?g=i.length:b&&(e=c,k(b))}return this},remove:function(){return i&&_.each(arguments,function(a,b){for(var c;(c=_.inArray(b,i,c))>-1;)i.splice(c,1),d&&(g>=c&&g--,h>=c&&h--)}),this},has:function(a){return a?_.inArray(a,i)>-1:!(!i||!i.length)},empty:function(){return i=[],g=0,this},disable:function(){return i=j=b=void 0,this},disabled:function(){return!i},lock:function(){return j=void 0,b||l.disable(),this},locked:function(){return!j},fireWith:function(a,b){return!i||c&&!j||(b=b||[],b=[a,b.slice?b.slice():b],d?j.push(b):k(b)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!c}};return l},_.extend({Deferred:function(a){var b=[["resolve","done",_.Callbacks("once memory"),"resolved"],["reject","fail",_.Callbacks("once memory"),"rejected"],["notify","progress",_.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return _.Deferred(function(c){_.each(b,function(b,f){var g=_.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&_.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?_.extend(a,d):d}},e={};return d.pipe=d.then,_.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=R.call(arguments),g=f.length,h=1!==g||a&&_.isFunction(a.promise)?g:0,i=1===h?a:_.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?R.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&_.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}});var pa;_.fn.ready=function(a){return _.ready.promise().done(a),this},_.extend({isReady:!1,readyWait:1,holdReady:function(a){a?_.readyWait++:_.ready(!0)},ready:function(a){(a===!0?--_.readyWait:_.isReady)||(_.isReady=!0,a!==!0&&--_.readyWait>0||(pa.resolveWith(Z,[_]),_.fn.triggerHandler&&(_(Z).triggerHandler("ready"),_(Z).off("ready"))))}}),_.ready.promise=function(b){return pa||(pa=_.Deferred(),"complete"===Z.readyState?setTimeout(_.ready):(Z.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1))),pa.promise(b)},_.ready.promise();var qa=_.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===_.type(c)){e=!0;for(h in c)_.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,_.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(_(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};_.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType},h.uid=1,h.accepts=_.acceptData,h.prototype={key:function(a){if(!h.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=h.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,_.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(_.isEmptyObject(f))_.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,_.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{_.isArray(b)?d=b.concat(b.map(_.camelCase)):(e=_.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(na)||[])),c=d.length;for(;c--;)delete g[d[c]];
}},hasData:function(a){return!_.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var ra=new h,sa=new h,ta=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ua=/([A-Z])/g;_.extend({hasData:function(a){return sa.hasData(a)||ra.hasData(a)},data:function(a,b,c){return sa.access(a,b,c)},removeData:function(a,b){sa.remove(a,b)},_data:function(a,b,c){return ra.access(a,b,c)},_removeData:function(a,b){ra.remove(a,b)}}),_.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=sa.get(f),1===f.nodeType&&!ra.get(f,"hasDataAttrs"))){for(c=g.length;c--;)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=_.camelCase(d.slice(5)),i(f,d,e[d])));ra.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){sa.set(this,a)}):qa(this,function(b){var c,d=_.camelCase(a);if(f&&void 0===b){if(c=sa.get(f,a),void 0!==c)return c;if(c=sa.get(f,d),void 0!==c)return c;if(c=i(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=sa.get(this,d);sa.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&sa.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){sa.remove(this,a)})}}),_.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=ra.get(a,b),c&&(!d||_.isArray(c)?d=ra.access(a,b,_.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=_.queue(a,b),d=c.length,e=c.shift(),f=_._queueHooks(a,b),g=function(){_.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return ra.get(a,c)||ra.access(a,c,{empty:_.Callbacks("once memory").add(function(){ra.remove(a,[b+"queue",c])})})}}),_.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?_.queue(this[0],a):void 0===b?this:this.each(function(){var c=_.queue(this,a,b);_._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&_.dequeue(this,a)})},dequeue:function(a){return this.each(function(){_.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=_.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)c=ra.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var va=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,wa=["Top","Right","Bottom","Left"],xa=function(a,b){return a=b||a,"none"===_.css(a,"display")||!_.contains(a.ownerDocument,a)},ya=/^(?:checkbox|radio)$/i;!function(){var a=Z.createDocumentFragment(),b=a.appendChild(Z.createElement("div")),c=Z.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),Y.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",Y.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var za="undefined";Y.focusinBubbles="onfocusin"in a;var Aa=/^key/,Ba=/^(?:mouse|pointer|contextmenu)|click/,Ca=/^(?:focusinfocus|focusoutblur)$/,Da=/^([^.]*)(?:\.(.+)|)$/;_.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=ra.get(a);if(q)for(c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=_.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return typeof _!==za&&_.event.triggered!==b.type?_.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(na)||[""],j=b.length;j--;)h=Da.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=_.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=_.event.special[n]||{},k=_.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&_.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,o,g)!==!1||a.addEventListener&&a.addEventListener(n,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),_.event.global[n]=!0)},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=ra.hasData(a)&&ra.get(a);if(q&&(i=q.events)){for(b=(b||"").match(na)||[""],j=b.length;j--;)if(h=Da.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=_.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||_.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)_.event.remove(a,n+b[j],c,d,!0);_.isEmptyObject(i)&&(delete q.handle,ra.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,j,k,l,m=[d||Z],n=X.call(b,"type")?b.type:b,o=X.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||Z,3!==d.nodeType&&8!==d.nodeType&&!Ca.test(n+_.event.triggered)&&(n.indexOf(".")>=0&&(o=n.split("."),n=o.shift(),o.sort()),j=n.indexOf(":")<0&&"on"+n,b=b[_.expando]?b:new _.Event(n,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=o.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:_.makeArray(c,[b]),l=_.event.special[n]||{},e||!l.trigger||l.trigger.apply(d,c)!==!1)){if(!e&&!l.noBubble&&!_.isWindow(d)){for(i=l.delegateType||n,Ca.test(i+n)||(g=g.parentNode);g;g=g.parentNode)m.push(g),h=g;h===(d.ownerDocument||Z)&&m.push(h.defaultView||h.parentWindow||a)}for(f=0;(g=m[f++])&&!b.isPropagationStopped();)b.type=f>1?i:l.bindType||n,k=(ra.get(g,"events")||{})[b.type]&&ra.get(g,"handle"),k&&k.apply(g,c),k=j&&g[j],k&&k.apply&&_.acceptData(g)&&(b.result=k.apply(g,c),b.result===!1&&b.preventDefault());return b.type=n,e||b.isDefaultPrevented()||l._default&&l._default.apply(m.pop(),c)!==!1||!_.acceptData(d)||j&&_.isFunction(d[n])&&!_.isWindow(d)&&(h=d[j],h&&(d[j]=null),_.event.triggered=n,d[n](),_.event.triggered=void 0,h&&(d[j]=h)),b.result}},dispatch:function(a){a=_.event.fix(a);var b,c,d,e,f,g=[],h=R.call(arguments),i=(ra.get(this,"events")||{})[a.type]||[],j=_.event.special[a.type]||{};if(h[0]=a,a.delegateTarget=this,!j.preDispatch||j.preDispatch.call(this,a)!==!1){for(g=_.event.handlers.call(this,a,i),b=0;(e=g[b++])&&!a.isPropagationStopped();)for(a.currentTarget=e.elem,c=0;(f=e.handlers[c++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(f.namespace))&&(a.handleObj=f,a.data=f.data,d=((_.event.special[f.origType]||{}).handle||f.handler).apply(e.elem,h),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()));return j.postDispatch&&j.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?_(e,this).index(i)>=0:_.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||Z,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[_.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Ba.test(e)?this.mouseHooks:Aa.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new _.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=Z),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==l()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===l()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&_.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return _.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=_.extend(new _.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?_.event.trigger(e,null,b):_.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},_.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},_.Event=function(a,b){return this instanceof _.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?j:k):this.type=a,b&&_.extend(this,b),this.timeStamp=a&&a.timeStamp||_.now(),void(this[_.expando]=!0)):new _.Event(a,b)},_.Event.prototype={isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=j,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=j,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=j,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},_.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){_.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!_.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),Y.focusinBubbles||_.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){_.event.simulate(b,a.target,_.event.fix(a),!0)};_.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=ra.access(d,b);e||d.addEventListener(a,c,!0),ra.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=ra.access(d,b)-1;e?ra.access(d,b,e):(d.removeEventListener(a,c,!0),ra.remove(d,b))}}}),_.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=k;else if(!d)return this;return 1===e&&(f=d,d=function(a){return _().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=_.guid++)),this.each(function(){_.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,_(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=k),this.each(function(){_.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){_.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?_.event.trigger(a,b,c,!0):void 0}});var Ea=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Fa=/<([\w:]+)/,Ga=/<|&#?\w+;/,Ha=/<(?:script|style|link)/i,Ia=/checked\s*(?:[^=]|=\s*.checked.)/i,Ja=/^$|\/(?:java|ecma)script/i,Ka=/^true\/(.*)/,La=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ma={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ma.optgroup=Ma.option,Ma.tbody=Ma.tfoot=Ma.colgroup=Ma.caption=Ma.thead,Ma.th=Ma.td,_.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=_.contains(a.ownerDocument,a);if(!(Y.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||_.isXMLDoc(a)))for(g=r(h),f=r(a),d=0,e=f.length;e>d;d++)s(f[d],g[d]);if(b)if(c)for(f=f||r(a),g=g||r(h),d=0,e=f.length;e>d;d++)q(f[d],g[d]);else q(a,h);return g=r(h,"script"),g.length>0&&p(g,!i&&r(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,n=a.length;n>m;m++)if(e=a[m],e||0===e)if("object"===_.type(e))_.merge(l,e.nodeType?[e]:e);else if(Ga.test(e)){for(f=f||k.appendChild(b.createElement("div")),g=(Fa.exec(e)||["",""])[1].toLowerCase(),h=Ma[g]||Ma._default,f.innerHTML=h[1]+e.replace(Ea,"<$1></$2>")+h[2],j=h[0];j--;)f=f.lastChild;_.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));for(k.textContent="",m=0;e=l[m++];)if((!d||-1===_.inArray(e,d))&&(i=_.contains(e.ownerDocument,e),f=r(k.appendChild(e),"script"),i&&p(f),c))for(j=0;e=f[j++];)Ja.test(e.type||"")&&c.push(e);return k},cleanData:function(a){for(var b,c,d,e,f=_.event.special,g=0;void 0!==(c=a[g]);g++){if(_.acceptData(c)&&(e=c[ra.expando],e&&(b=ra.cache[e]))){if(b.events)for(d in b.events)f[d]?_.event.remove(c,d):_.removeEvent(c,d,b.handle);ra.cache[e]&&delete ra.cache[e]}delete sa.cache[c[sa.expando]]}}}),_.fn.extend({text:function(a){return qa(this,function(a){return void 0===a?_.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=m(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=m(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?_.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||_.cleanData(r(c)),c.parentNode&&(b&&_.contains(c.ownerDocument,c)&&p(r(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(_.cleanData(r(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return _.clone(this,a,b)})},html:function(a){return qa(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!Ha.test(a)&&!Ma[(Fa.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Ea,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(_.cleanData(r(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,_.cleanData(r(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=S.apply([],a);var c,d,e,f,g,h,i=0,j=this.length,k=this,l=j-1,m=a[0],p=_.isFunction(m);if(p||j>1&&"string"==typeof m&&!Y.checkClone&&Ia.test(m))return this.each(function(c){var d=k.eq(c);p&&(a[0]=m.call(this,c,d.html())),d.domManip(a,b)});if(j&&(c=_.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(e=_.map(r(c,"script"),n),f=e.length;j>i;i++)g=c,i!==l&&(g=_.clone(g,!0,!0),f&&_.merge(e,r(g,"script"))),b.call(this[i],g,i);if(f)for(h=e[e.length-1].ownerDocument,_.map(e,o),i=0;f>i;i++)g=e[i],Ja.test(g.type||"")&&!ra.access(g,"globalEval")&&_.contains(h,g)&&(g.src?_._evalUrl&&_._evalUrl(g.src):_.globalEval(g.textContent.replace(La,"")))}return this}}),_.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){_.fn[a]=function(a){for(var c,d=[],e=_(a),f=e.length-1,g=0;f>=g;g++)c=g===f?this:this.clone(!0),_(e[g])[b](c),T.apply(d,c.get());return this.pushStack(d)}});var Na,Oa={},Pa=/^margin/,Qa=new RegExp("^("+va+")(?!px)[a-z%]+$","i"),Ra=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)};!function(){function b(){g.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",g.innerHTML="",e.appendChild(f);var b=a.getComputedStyle(g,null);c="1%"!==b.top,d="4px"===b.width,e.removeChild(f)}var c,d,e=Z.documentElement,f=Z.createElement("div"),g=Z.createElement("div");g.style&&(g.style.backgroundClip="content-box",g.cloneNode(!0).style.backgroundClip="",Y.clearCloneStyle="content-box"===g.style.backgroundClip,f.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",f.appendChild(g),a.getComputedStyle&&_.extend(Y,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return null==d&&b(),d},reliableMarginRight:function(){var b,c=g.appendChild(Z.createElement("div"));return c.style.cssText=g.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",g.style.width="1px",e.appendChild(f),b=!parseFloat(a.getComputedStyle(c,null).marginRight),e.removeChild(f),g.removeChild(c),b}}))}(),_.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Sa=/^(none|table(?!-c[ea]).+)/,Ta=new RegExp("^("+va+")(.*)$","i"),Ua=new RegExp("^([+-])=("+va+")","i"),Va={position:"absolute",visibility:"hidden",display:"block"},Wa={letterSpacing:"0",fontWeight:"400"},Xa=["Webkit","O","Moz","ms"];_.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=v(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=_.camelCase(b),i=a.style;return b=_.cssProps[h]||(_.cssProps[h]=x(i,h)),g=_.cssHooks[b]||_.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Ua.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(_.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||_.cssNumber[h]||(c+="px"),Y.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=_.camelCase(b);return b=_.cssProps[h]||(_.cssProps[h]=x(a.style,h)),g=_.cssHooks[b]||_.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=v(a,b,d)),"normal"===e&&b in Wa&&(e=Wa[b]),""===c||c?(f=parseFloat(e),c===!0||_.isNumeric(f)?f||0:e):e}}),_.each(["height","width"],function(a,b){_.cssHooks[b]={get:function(a,c,d){return c?Sa.test(_.css(a,"display"))&&0===a.offsetWidth?_.swap(a,Va,function(){return A(a,b,d)}):A(a,b,d):void 0},set:function(a,c,d){var e=d&&Ra(a);return y(a,c,d?z(a,b,d,"border-box"===_.css(a,"boxSizing",!1,e),e):0)}}}),_.cssHooks.marginRight=w(Y.reliableMarginRight,function(a,b){return b?_.swap(a,{display:"inline-block"},v,[a,"marginRight"]):void 0}),_.each({margin:"",padding:"",border:"Width"},function(a,b){_.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+wa[d]+b]=f[d]||f[d-2]||f[0];return e}},Pa.test(a)||(_.cssHooks[a+b].set=y)}),_.fn.extend({css:function(a,b){return qa(this,function(a,b,c){var d,e,f={},g=0;if(_.isArray(b)){for(d=Ra(a),e=b.length;e>g;g++)f[b[g]]=_.css(a,b[g],!1,d);return f}return void 0!==c?_.style(a,b,c):_.css(a,b)},a,b,arguments.length>1)},show:function(){return B(this,!0)},hide:function(){return B(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){xa(this)?_(this).show():_(this).hide()})}}),_.Tween=C,C.prototype={constructor:C,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(_.cssNumber[c]?"":"px")},cur:function(){var a=C.propHooks[this.prop];return a&&a.get?a.get(this):C.propHooks._default.get(this)},run:function(a){var b,c=C.propHooks[this.prop];return this.options.duration?this.pos=b=_.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):C.propHooks._default.set(this),this}},C.prototype.init.prototype=C.prototype,C.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=_.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){_.fx.step[a.prop]?_.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[_.cssProps[a.prop]]||_.cssHooks[a.prop])?_.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},C.propHooks.scrollTop=C.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},_.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},_.fx=C.prototype.init,_.fx.step={};var Ya,Za,$a=/^(?:toggle|show|hide)$/,_a=new RegExp("^(?:([+-])=|)("+va+")([a-z%]*)$","i"),ab=/queueHooks$/,bb=[G],cb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=_a.exec(b),f=e&&e[3]||(_.cssNumber[a]?"":"px"),g=(_.cssNumber[a]||"px"!==f&&+d)&&_a.exec(_.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,_.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};_.Animation=_.extend(I,{tweener:function(a,b){_.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],cb[c]=cb[c]||[],cb[c].unshift(b)},prefilter:function(a,b){b?bb.unshift(a):bb.push(a)}}),_.speed=function(a,b,c){var d=a&&"object"==typeof a?_.extend({},a):{complete:c||!c&&b||_.isFunction(a)&&a,duration:a,easing:c&&b||b&&!_.isFunction(b)&&b};return d.duration=_.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in _.fx.speeds?_.fx.speeds[d.duration]:_.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){_.isFunction(d.old)&&d.old.call(this),d.queue&&_.dequeue(this,d.queue)},d},_.fn.extend({fadeTo:function(a,b,c,d){return this.filter(xa).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=_.isEmptyObject(a),f=_.speed(b,c,d),g=function(){var b=I(this,_.extend({},a),f);(e||ra.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=_.timers,g=ra.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&ab.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&_.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=ra.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=_.timers,g=d?d.length:0;for(c.finish=!0,_.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),_.each(["toggle","show","hide"],function(a,b){var c=_.fn[b];_.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(E(b,!0),a,d,e)}}),_.each({slideDown:E("show"),slideUp:E("hide"),slideToggle:E("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){_.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),_.timers=[],_.fx.tick=function(){var a,b=0,c=_.timers;for(Ya=_.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||_.fx.stop(),Ya=void 0},_.fx.timer=function(a){_.timers.push(a),a()?_.fx.start():_.timers.pop()},_.fx.interval=13,_.fx.start=function(){Za||(Za=setInterval(_.fx.tick,_.fx.interval))},_.fx.stop=function(){clearInterval(Za),Za=null},_.fx.speeds={slow:600,fast:200,_default:400},_.fn.delay=function(a,b){return a=_.fx?_.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=Z.createElement("input"),b=Z.createElement("select"),c=b.appendChild(Z.createElement("option"));a.type="checkbox",Y.checkOn=""!==a.value,Y.optSelected=c.selected,b.disabled=!0,Y.optDisabled=!c.disabled,a=Z.createElement("input"),a.value="t",a.type="radio",Y.radioValue="t"===a.value}();var db,eb,fb=_.expr.attrHandle;_.fn.extend({attr:function(a,b){return qa(this,_.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){_.removeAttr(this,a)})}}),_.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===za?_.prop(a,b,c):(1===f&&_.isXMLDoc(a)||(b=b.toLowerCase(),d=_.attrHooks[b]||(_.expr.match.bool.test(b)?eb:db)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=_.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void _.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(na);if(f&&1===a.nodeType)for(;c=f[e++];)d=_.propFix[c]||c,_.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!Y.radioValue&&"radio"===b&&_.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),eb={set:function(a,b,c){return b===!1?_.removeAttr(a,c):a.setAttribute(c,c),c}},_.each(_.expr.match.bool.source.match(/\w+/g),function(a,b){var c=fb[b]||_.find.attr;fb[b]=function(a,b,d){var e,f;return d||(f=fb[b],fb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,fb[b]=f),e}});var gb=/^(?:input|select|textarea|button)$/i;_.fn.extend({prop:function(a,b){return qa(this,_.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[_.propFix[a]||a]})}}),_.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!_.isXMLDoc(a),f&&(b=_.propFix[b]||b,e=_.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||gb.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),Y.optSelected||(_.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),_.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){_.propFix[this.toLowerCase()]=this});var hb=/[\t\r\n\f]/g;_.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(_.isFunction(a))return this.each(function(b){_(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(na)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(hb," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=_.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(_.isFunction(a))return this.each(function(b){_(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(na)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(hb," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");g=a?_.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):_.isFunction(a)?this.each(function(c){_(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if("string"===c)for(var b,d=0,e=_(this),f=a.match(na)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else(c===za||"boolean"===c)&&(this.className&&ra.set(this,"__className__",this.className),this.className=this.className||a===!1?"":ra.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(hb," ").indexOf(b)>=0)return!0;return!1}});var ib=/\r/g;_.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=_.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,_(this).val()):a,null==e?e="":"number"==typeof e?e+="":_.isArray(e)&&(e=_.map(e,function(a){return null==a?"":a+""})),b=_.valHooks[this.type]||_.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=_.valHooks[e.type]||_.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(ib,""):null==c?"":c)}}}),_.extend({valHooks:{option:{get:function(a){var b=_.find.attr(a,"value");return null!=b?b:_.trim(_.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],(c.selected||i===e)&&(Y.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!_.nodeName(c.parentNode,"optgroup"))){if(b=_(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=_.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=_.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),_.each(["radio","checkbox"],function(){_.valHooks[this]={set:function(a,b){return _.isArray(b)?a.checked=_.inArray(_(a).val(),b)>=0:void 0}},Y.checkOn||(_.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),_.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){_.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),_.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var jb=_.now(),kb=/\?/;_.parseJSON=function(a){return JSON.parse(a+"")},_.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&_.error("Invalid XML: "+a),b};var lb=/#.*$/,mb=/([?&])_=[^&]*/,nb=/^(.*?):[ \t]*([^\r\n]*)$/gm,ob=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,pb=/^(?:GET|HEAD)$/,qb=/^\/\//,rb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,sb={},tb={},ub="*/".concat("*"),vb=a.location.href,wb=rb.exec(vb.toLowerCase())||[];
_.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:vb,type:"GET",isLocal:ob.test(wb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ub,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":_.parseJSON,"text xml":_.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?L(L(a,_.ajaxSettings),b):L(_.ajaxSettings,a)},ajaxPrefilter:J(sb),ajaxTransport:J(tb),ajax:function(a,b){function c(a,b,c,g){var i,k,r,s,u,w=b;2!==t&&(t=2,h&&clearTimeout(h),d=void 0,f=g||"",v.readyState=a>0?4:0,i=a>=200&&300>a||304===a,c&&(s=M(l,v,c)),s=N(l,s,v,i),i?(l.ifModified&&(u=v.getResponseHeader("Last-Modified"),u&&(_.lastModified[e]=u),u=v.getResponseHeader("etag"),u&&(_.etag[e]=u)),204===a||"HEAD"===l.type?w="nocontent":304===a?w="notmodified":(w=s.state,k=s.data,r=s.error,i=!r)):(r=w,(a||!w)&&(w="error",0>a&&(a=0))),v.status=a,v.statusText=(b||w)+"",i?o.resolveWith(m,[k,w,v]):o.rejectWith(m,[v,w,r]),v.statusCode(q),q=void 0,j&&n.trigger(i?"ajaxSuccess":"ajaxError",[v,l,i?k:r]),p.fireWith(m,[v,w]),j&&(n.trigger("ajaxComplete",[v,l]),--_.active||_.event.trigger("ajaxStop")))}"object"==typeof a&&(b=a,a=void 0),b=b||{};var d,e,f,g,h,i,j,k,l=_.ajaxSetup({},b),m=l.context||l,n=l.context&&(m.nodeType||m.jquery)?_(m):_.event,o=_.Deferred(),p=_.Callbacks("once memory"),q=l.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!g)for(g={};b=nb.exec(f);)g[b[1].toLowerCase()]=b[2];b=g[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return d&&d.abort(b),c(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,l.url=((a||l.url||vb)+"").replace(lb,"").replace(qb,wb[1]+"//"),l.type=b.method||b.type||l.method||l.type,l.dataTypes=_.trim(l.dataType||"*").toLowerCase().match(na)||[""],null==l.crossDomain&&(i=rb.exec(l.url.toLowerCase()),l.crossDomain=!(!i||i[1]===wb[1]&&i[2]===wb[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(wb[3]||("http:"===wb[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=_.param(l.data,l.traditional)),K(sb,l,b,v),2===t)return v;j=_.event&&l.global,j&&0===_.active++&&_.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!pb.test(l.type),e=l.url,l.hasContent||(l.data&&(e=l.url+=(kb.test(e)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=mb.test(e)?e.replace(mb,"$1_="+jb++):e+(kb.test(e)?"&":"?")+"_="+jb++)),l.ifModified&&(_.lastModified[e]&&v.setRequestHeader("If-Modified-Since",_.lastModified[e]),_.etag[e]&&v.setRequestHeader("If-None-Match",_.etag[e])),(l.data&&l.hasContent&&l.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",l.contentType),v.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+ub+"; q=0.01":""):l.accepts["*"]);for(k in l.headers)v.setRequestHeader(k,l.headers[k]);if(l.beforeSend&&(l.beforeSend.call(m,v,l)===!1||2===t))return v.abort();u="abort";for(k in{success:1,error:1,complete:1})v[k](l[k]);if(d=K(tb,l,b,v)){v.readyState=1,j&&n.trigger("ajaxSend",[v,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){v.abort("timeout")},l.timeout));try{t=1,d.send(r,c)}catch(w){if(!(2>t))throw w;c(-1,w)}}else c(-1,"No Transport");return v},getJSON:function(a,b,c){return _.get(a,b,c,"json")},getScript:function(a,b){return _.get(a,void 0,b,"script")}}),_.each(["get","post"],function(a,b){_[b]=function(a,c,d,e){return _.isFunction(c)&&(e=e||d,d=c,c=void 0),_.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),_._evalUrl=function(a){return _.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},_.fn.extend({wrapAll:function(a){var b;return _.isFunction(a)?this.each(function(b){_(this).wrapAll(a.call(this,b))}):(this[0]&&(b=_(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return _.isFunction(a)?this.each(function(b){_(this).wrapInner(a.call(this,b))}):this.each(function(){var b=_(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=_.isFunction(a);return this.each(function(c){_(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){_.nodeName(this,"body")||_(this).replaceWith(this.childNodes)}).end()}}),_.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},_.expr.filters.visible=function(a){return!_.expr.filters.hidden(a)};var xb=/%20/g,yb=/\[\]$/,zb=/\r?\n/g,Ab=/^(?:submit|button|image|reset|file)$/i,Bb=/^(?:input|select|textarea|keygen)/i;_.param=function(a,b){var c,d=[],e=function(a,b){b=_.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=_.ajaxSettings&&_.ajaxSettings.traditional),_.isArray(a)||a.jquery&&!_.isPlainObject(a))_.each(a,function(){e(this.name,this.value)});else for(c in a)O(c,a[c],b,e);return d.join("&").replace(xb,"+")},_.fn.extend({serialize:function(){return _.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=_.prop(this,"elements");return a?_.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!_(this).is(":disabled")&&Bb.test(this.nodeName)&&!Ab.test(a)&&(this.checked||!ya.test(a))}).map(function(a,b){var c=_(this).val();return null==c?null:_.isArray(c)?_.map(c,function(a){return{name:b.name,value:a.replace(zb,"\r\n")}}):{name:b.name,value:c.replace(zb,"\r\n")}}).get()}}),_.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Cb=0,Db={},Eb={0:200,1223:204},Fb=_.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in Db)Db[a]()}),Y.cors=!!Fb&&"withCredentials"in Fb,Y.ajax=Fb=!!Fb,_.ajaxTransport(function(a){var b;return Y.cors||Fb&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Cb;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Db[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Eb[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Db[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}:void 0}),_.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return _.globalEval(a),a}}}),_.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),_.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=_("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),Z.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Gb=[],Hb=/(=)\?(?=&|$)|\?\?/;_.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Gb.pop()||_.expando+"_"+jb++;return this[a]=!0,a}}),_.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Hb.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hb.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=_.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Hb,"$1"+e):b.jsonp!==!1&&(b.url+=(kb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||_.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Gb.push(e)),g&&_.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),_.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||Z;var d=ga.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=_.buildFragment([a],b,e),e&&e.length&&_(e).remove(),_.merge([],d.childNodes))};var Ib=_.fn.load;_.fn.load=function(a,b,c){if("string"!=typeof a&&Ib)return Ib.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=_.trim(a.slice(h)),a=a.slice(0,h)),_.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&_.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?_("<div>").append(_.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},_.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){_.fn[b]=function(a){return this.on(b,a)}}),_.expr.filters.animated=function(a){return _.grep(_.timers,function(b){return a===b.elem}).length};var Jb=a.document.documentElement;_.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=_.css(a,"position"),l=_(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=_.css(a,"top"),i=_.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),_.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},_.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){_.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,_.contains(b,d)?(typeof d.getBoundingClientRect!==za&&(e=d.getBoundingClientRect()),c=P(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===_.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),_.nodeName(a[0],"html")||(d=a.offset()),d.top+=_.css(a[0],"borderTopWidth",!0),d.left+=_.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-_.css(c,"marginTop",!0),left:b.left-d.left-_.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||Jb;a&&!_.nodeName(a,"html")&&"static"===_.css(a,"position");)a=a.offsetParent;return a||Jb})}}),_.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;_.fn[b]=function(e){return qa(this,function(b,e,f){var g=P(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),_.each(["top","left"],function(a,b){_.cssHooks[b]=w(Y.pixelPosition,function(a,c){return c?(c=v(a,b),Qa.test(c)?_(a).position()[b]+"px":c):void 0})}),_.each({Height:"height",Width:"width"},function(a,b){_.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){_.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return qa(this,function(b,c,d){var e;return _.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?_.css(b,c,g):_.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),_.fn.size=function(){return this.length},_.fn.andSelf=_.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return _});var Kb=a.jQuery,Lb=a.$;return _.noConflict=function(b){return a.$===_&&(a.$=Lb),b&&a.jQuery===_&&(a.jQuery=Kb),_},typeof b===za&&(a.jQuery=a.$=_),_}),define("config",[],function(){var a={qbAccount:{appId:27915,authKey:"2EADMZadWZkCH8x",authSecret:"ZvOFxvW4bpRg2Tm"},fbAccount:{appId:"605405446247805",scope:"email,user_friends"},debug:!0,isMac:navigator.platform.match(/Mac/)?1:0,defAvatar:{url:"images/ava-single.svg",group_url:"images/ava-group.svg",caption:"Choose user picture"},maxLimitFile:10,patterns:{name:"[^><;]{3,50}",password:"[A-Za-z0-9`~!@#%&=_<>;:,'\\\"\\.\\$\\^\\*\\-\\+\\\\/\\|\\(\\)\\[\\]\\{\\}\\?]{8,40}"},errors:{session:"The QB application credentials you entered are incorrect",invalidName:"Name mustn't contain '<', '>' and ';' characters",shortName:"Name must be more than 2 characters",bigName:"Name mustn't be more than 50 characters",invalidEmail:"Please enter a valid Email address",invalidPhone:"Phone mustn't contain letters",oldPass:"Old password is incorrect",invalidPass:"Password mustn't contain non-Latin characters and spaces",shortPass:"Password must be more than 7 characters",bigPass:"Password mustn't be more than 40 characters",avatarType:"Avatar must be image",fileName:"File name mustn't be more than 100 characters",fileSize:"File mustn't be more than 10 MB",emailExists:"The email has already been taken",unauthorized:"The email or password is incorrect",notFoundEmail:"The email you entered wasn't found",crashFBToken:"Sorry, we noticed that you had logged out from Facebook so we need to recreate your FB token now. Please click the Connect with FB button again",FBAccountExists:"This FB user already has an account in the Q-municate. You can't combine two Q-municate users"}};return a}),function(){var a={"😄":0,"😃":1,"😀":2,"😊":3,"☺️":4,"😉":5,"😍":6,"😘":7,"😚":8,"😗":9,"😙":10,"😜":11,"😝":12,"😛":13,"😳":14,"😁":15,"😔":16,"😌":17,"😒":18,"😞":19,"😣":20,"😢":21,"😂":22,"😭":23,"😪":24,"😥":25,"😰":26,"😅":27,"😓":28,"😩":29,"😫":30,"😨":31,"😱":32,"😠":33,"😡":34,"😤":35,"😖":36,"😆":37,"😋":38,"😷":39,"😎":40,"😴":41,"😵":42,"😲":43,"😟":44,"😦":45,"😧":46,"😈":47,"👿":48,"😮":49,"😬":50,"😐":51,"😕":52,"😯":53,"😶":54,"😇":55,"😏":56,"😑":57,"👲":58,"👳":59,"👮":60,"👷":61,"💂":62,"👶":63,"👦":64,"👧":65,"👨":66,"👩":67,"👴":68,"👵":69,"👱":70,"👼":71,"👸":72,"😺":73,"😸":74,"😻":75,"😽":76,"😼":77,"🙀":78,"😿":79,"😹":80,"😾":81,"👹":82,"👺":83,"🙈":84,"🙉":85,"🙊":86,"💀":87,"👽":88,"💩":89,"🔥":90,"✨":91,"🌟":92,"💫":93,"💥":94,"💢":95,"💦":96,"💧":97,"💤":98,"💨":99,"👂":100,"👀":101,"👃":102,"👅":103,"👄":104,"👍":105,"👎":106,"👌":107,"👊":108,"✊":109,"✌️":110,"👋":111,"✋":112,"👐":113,"👆":114,"👇":115,"👉":116,"👈":117,"🙌":118,"🙏":119,"☝️":120,"👏":121,"💪":122,"🚶":123,"🏃":124,"💃":125,"👫":126,"👪":127,"👬":128,"👭":129,"💏":130,"💑":131,"👯":132,"🙆":133,"🙅":134,"💁":135,"🙋":136,"💆":137,"💇":138,"💅":139,"👰":140,"🙎":141,"🙍":142,"🙇":143,"🎩":144,"👑":145,"👒":146,"👟":147,"👞":148,"👡":149,"👠":150,"👢":151,"👕":152,"👔":153,"👚":154,"👗":155,"🎽":156,"👖":157,"👘":158,"👙":159,"💼":160,"👜":161,"👝":162,"👛":163,"👓":164,"🎀":165,"🌂":166,"💄":167,"💛":168,"💙":169,"💜":170,"💚":171,"❤️":172,"💔":173,"💗":174,"💓":175,"💕":176,"💖":177,"💞":178,"💘":179,"💌":180,"💋":181,"💍":182,"💎":183,"👤":184,"👥":185,"💬":186,"👣":187,"💭":188,"🐶":189,"🐺":190,"🐱":191,"🐭":192,"🐹":193,"🐰":194,"🐸":195,"🐯":196,"🐨":197,"🐻":198,"🐷":199,"🐽":200,"🐮":201,"🐗":202,"🐵":203,"🐒":204,"🐴":205,"🐑":206,"🐘":207,"🐼":208,"🐧":209,"🐦":210,"🐤":211,"🐥":212,"🐣":213,"🐔":214,"🐍":215,"🐢":216,"🐛":217,"🐝":218,"🐜":219,"🐞":220,"🐌":221,"🐙":222,"🐚":223,"🐠":224,"🐟":225,"🐬":226,"🐳":227,"🐋":228,"🐄":229,"🐏":230,"🐀":231,"🐃":232,"🐅":233,"🐇":234,"🐉":235,"🐎":236,"🐐":237,"🐓":238,"🐕":239,"🐖":240,"🐁":241,"🐂":242,"🐲":243,"🐡":244,"🐊":245,"🐫":246,"🐪":247,"🐆":248,"🐈":249,"🐩":250,"🐾":251,"💐":252,"🌸":253,"🌷":254,"🍀":255,"🌹":256,"🌻":257,"🌺":258,"🍁":259,"🍃":260,"🍂":261,"🌿":262,"🌾":263,"🍄":264,"🌵":265,"🌴":266,"🌲":267,"🌳":268,"🌰":269,"🌱":270,"🌼":271,"🌐":272,"🌞":273,"🌝":274,"🌚":275,"🌑":276,"🌒":277,"🌓":278,"🌔":279,"🌕":280,"🌖":281,"🌗":282,"🌘":283,"🌜":284,"🌛":285,"🌙":286,"🌍":287,"🌎":288,"🌏":289,"🌋":290,"🌌":291,"🌠":292,"⭐️":293,"☀️":294,"⛅️":295,"☁️":296,"⚡️":297,"☔️":298,"❄️":299,"⛄️":300,"🌀":301,"🌁":302,"🌈":303,"🌊":304,"🎍":305,"💝":306,"🎎":307,"🎒":308,"🎓":309,"🎏":310,"🎆":311,"🎇":312,"🎐":313,"🎑":314,"🎃":315,"👻":316,"🎅":317,"🎄":318,"🎁":319,"🎋":320,"🎉":321,"🎊":322,"🎈":323,"🎌":324,"🔮":325,"🎥":326,"📷":327,"📹":328,"📼":329,"💿":330,"📀":331,"💽":332,"💾":333,"💻":334,"📱":335,"☎️":336,"📞":337,"📟":338,"📠":339,"📡":340,"📺":341,"📻":342,"🔊":343,"🔉":344,"🔈":345,"🔇":346,"🔔":347,"🔕":348,"📢":349,"📣":350,"⏳":351,"⌛️":352,"⏰":353,"⌚️":354,"🔓":355,"🔒":356,"🔏":357,"🔐":358,"🔑":359,"🔎":360,"💡":361,"🔦":362,"🔆":363,"🔅":364,"🔌":365,"🔋":366,"🔍":367,"🛁":368,"🛀":369,"🚿":370,"🚽":371,"🔧":372,"🔩":373,"🔨":374,"🚪":375,"🚬":376,"💣":377,"🔫":378,"🔪":379,"💊":380,"💉":381,"💰":382,"💴":383,"💵":384,"💷":385,"💶":386,"💳":387,"💸":388,"📲":389,"📧":390,"📥":391,"📤":392,"✉️":393,"📩":394,"📨":395,"📯":396,"📫":397,"📪":398,"📬":399,"📭":400,"📮":401,"📦":402,"📝":403,"📄":404,"📃":405,"📑":406,"📊":407,"📈":408,"📉":409,"📜":410,"📋":411,"📅":412,"📆":413,"📇":414,"📁":415,"📂":416,"✂️":417,"📌":418,"📎":419,"✒️":420,"✏️":421,"📏":422,"📐":423,"📕":424,"📗":425,"📘":426,"📙":427,"📓":428,"📔":429,"📒":430,"📚":431,"📖":432,"🔖":433,"📛":434,"🔬":435,"🔭":436,"📰":437,"🎨":438,"🎬":439,"🎤":440,"🎧":441,"🎼":442,"🎵":443,"🎶":444,"🎹":445,"🎻":446,"🎺":447,"🎷":448,"🎸":449,"👾":450,"🎮":451,"🃏":452,"🎴":453,"🀄️":454,"🎲":455,"🎯":456,"🏈":457,"🏀":458,"⚽️":459,"⚾️":460,"🎾":461,"🎱":462,"🏉":463,"🎳":464,"⛳️":465,"🚵":466,"🚴":467,"🏁":468,"🏇":469,"🏆":470,"🎿":471,"🏂":472,"🏊":473,"🏄":474,"🎣":475,"☕️":476,"🍵":477,"🍶":478,"🍼":479,"🍺":480,"🍻":481,"🍸":482,"🍹":483,"🍷":484,"🍴":485,"🍕":486,"🍔":487,"🍟":488,"🍗":489,"🍖":490,"🍝":491,"🍛":492,"🍤":493,"🍱":494,"🍣":495,"🍥":496,"🍙":497,"🍘":498,"🍚":499,"🍜":500,"🍲":501,"🍢":502,"🍡":503,"🍳":504,"🍞":505,"🍩":506,"🍮":507,"🍦":508,"🍨":509,"🍧":510,"🎂":511,"🍰":512,"🍪":513,"🍫":514,"🍬":515,"🍭":516,"🍯":517,"🍎":518,"🍏":519,"🍊":520,"🍋":521,"🍒":522,"🍇":523,"🍉":524,"🍓":525,"🍑":526,"🍈":527,"🍌":528,"🍐":529,"🍍":530,"🍠":531,"🍆":532,"🍅":533,"🌽":534,"🏠":535,"🏡":536,"🏫":537,"🏢":538,"🏣":539,"🏥":540,"🏦":541,"🏪":542,"🏩":543,"🏨":544,"💒":545,"⛪️":546,"🏬":547,"🏤":548,"🌇":549,"🌆":550,"🏯":551,"🏰":552,"⛺️":553,"🏭":554,"🗼":555,"🗾":556,"🗻":557,"🌄":558,"🌅":559,"🌃":560,"🗽":561,"🌉":562,"🎠":563,"🎡":564,"⛲️":565,"🎢":566,"🚢":567,"⛵️":568,"🚤":569,"🚣":570,"⚓️":571,"🚀":572,"✈️":573,"💺":574,"🚁":575,"🚂":576,"🚊":577,"🚉":578,"🚞":579,"🚆":580,"🚄":581,"🚅":582,"🚈":583,"🚇":584,"🚝":585,"🚋":586,"🚃":587,"🚎":588,"🚌":589,"🚍":590,"🚙":591,"🚘":592,"🚗":593,"🚕":594,"🚖":595,"🚛":596,"🚚":597,"🚨":598,"🚓":599,"🚔":600,"🚒":601,"🚑":602,"🚐":603,"🚲":604,"🚡":605,"🚟":606,"🚠":607,"🚜":608,"💈":609,"🚏":610,"🎫":611,"🚦":612,"🚥":613,"⚠️":614,"🚧":615,"🔰":616,"⛽️":617,"🏮":618,"🎰":619,"♨️":620,"🗿":621,"🎪":622,"🎭":623,"📍":624,"🚩":625,"🇯🇵":626,"🇰🇷":627,"🇩🇪":628,"🇨🇳":629,"🇺🇸":630,"🇫🇷":631,"🇪🇸":632,"🇮🇹":633,"🇷🇺":634,"🇬🇧":635,"1⃣":636,"2⃣":637,"3⃣":638,"4⃣":639,"5⃣":640,"6⃣":641,"7⃣":642,"8⃣":643,"9⃣":644,"0⃣":645,"🔟":646,"🔢":647,"#⃣":648,"🔣":649,"⬆️":650,"⬇️":651,"⬅️":652,"➡️":653,"🔠":654,"🔡":655,"🔤":656,"↗️":657,"↖️":658,"↘️":659,"↙️":660,"↔️":661,"↕️":662,"🔄":663,"◀️":664,"▶️":665,"🔼":666,"🔽":667,"↩️":668,"↪️":669,"ℹ️":670,"⏪":671,"⏩":672,"⏫":673,"⏬":674,"⤵️":675,"⤴️":676,"🆗":677,"🔀":678,"🔁":679,"🔂":680,"🆕":681,"🆙":682,"🆒":683,"🆓":684,"🆖":685,"📶":686,"🎦":687,"🈁":688,"🈯️":689,"🈳":690,"🈵":691,"🈴":692,"🈲":693,"🉐":694,"🈹":695,"🈺":696,"🈶":697,"🈚️":698,"🚻":699,"🚹":700,"🚺":701,"🚼":702,"🚾":703,"🚰":704,"🚮":705,"🅿️":706,"♿️":707,"🚭":708,"🈷":709,"🈸":710,"🈂":711,"Ⓜ️":712,"🛂":713,"🛄":714,"🛅":715,"🛃":716,"🉑":717,"㊙️":718,"㊗️":719,"🆑":720,"🆘":721,"🆔":722,"🚫":723,"🔞":724,"📵":725,"🚯":726,"🚱":727,"🚳":728,"🚷":729,"🚸":730,"⛔️":731,"✳️":732,"❇️":733,"❎":734,"✅":735,"✴️":736,"💟":737,"🆚":738,"📳":739,"📴":740,"🅰":741,"🅱":742,"🆎":743,"🅾":744,"💠":745,"➿":746,"♻️":747,"♈️":748,"♉️":749,"♊️":750,"♋️":751,"♌️":752,"♍️":753,"♎️":754,"♏️":755,"♐️":756,"♑️":757,"♒️":758,"♓️":759,"⛎":760,"🔯":761,"🏧":762,"💹":763,"💲":764,"💱":765,"©":766,"®":767,"™":768,"❌":769,"‼️":770,"⁉️":771,"❗️":772,"❓":773,"❕":774,"❔":775,"⭕️":776,"🔝":777,"🔚":778,"🔙":779,"🔛":780,"🔜":781,"🔃":782,"🕛":783,"🕧":784,"🕐":785,"🕜":786,"🕑":787,"🕝":788,"🕒":789,"🕞":790,"🕓":791,"🕟":792,"🕔":793,"🕠":794,"🕕":795,"🕖":796,"🕗":797,"🕘":798,"🕙":799,"🕚":800,"🕡":801,"🕢":802,"🕣":803,"🕤":804,"🕥":805,"🕦":806,"✖️":807,"➕":808,"➖":809,"➗":810,"♠️":811,"♥️":812,"♣️":813,"♦️":814,"💮":815,"💯":816,"✔️":817,"☑️":818,"🔘":819,"🔗":820,"➰":821,"〰":822,"〽️":823,"🔱":824,"◼️":825,"◻️":826,"◾️":827,"◽️":828,"▪️":829,"▫️":830,"🔺":831,"🔲":832,"🔳":833,"⚫️":834,"⚪️":835,"🔴":836,"🔵":837,"🔻":838,"⬜️":839,"⬛️":840,"🔶":841,"🔷":842,"🔸":843,"🔹":844,"☺":4,"✌":110,"☝":120,"❤":172,"⭐":293,"☀":294,"⛅":295,"☁":296,"⚡":297,"☔":298,"❄":299,"⛄":300,"☎":336,"⌛":352,"⌚":354,"✉":393,"✂":417,"✒":420,"✏":421,"🀄":454,"⚽":459,"⚾":460,"⛳":465,"☕":476,"⛪":546,"⛺":553,"⛲":565,"⛵":568,"⚓":571,"✈":573,"⚠":614,"⛽":617,"♨":620,"⬆":650,"⬇":651,"⬅":652,"➡":653,"↗":657,"↖":658,"↘":659,"↙":660,"↔":661,"↕":662,"◀":664,"▶":665,"↩":668,"↪":669,"ℹ":670,"⤵":675,"⤴":676,"🈯":689,"🈚":698,"🅿":706,"♿":707,"Ⓜ":712,"㊙":718,"㊗":719,"⛔":731,"✳":732,"❇":733,"✴":736,"♻":747,"♈":748,"♉":749,"♊":750,"♋":751,"♌":752,"♍":753,"♎":754,"♏":755,"♐":756,"♑":757,"♒":758,"♓":759,"‼":770,"⁉":771,"❗":772,"⭕":776,"✖":807,"♠":811,"♥":812,"♣":813,"♦":814,"✔":817,"☑":818,"〽":823,"◼":825,"◻":826,"◾":827,"◽":828,"▪":829,"▫":830,"⚫":834,"⚪":835,"⬜":839,"⬛":840},b=[];for(var c in a)b.push(c);var d=new RegExp("("+b.join("|")+")","g");b=null;var e=function(b){return b.replace(d,function(b,c){return'<span class="em-wrap" contenteditable="false"><span class="em emj'+a[c]+'" data-unicode="'+c+'"></span></span>'})};window.minEmoji=e}(),define("minEmoji",function(a){return function(){var b;return b||a.minEmoji}}(this)),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("quickblox",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.QB=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){this.service=a}function e(a){var b={application_id:g.creds.appId,auth_key:g.creds.authKey,nonce:h.randomNonce(),timestamp:h.unixTime()};return a.login&&a.password?b.user={login:a.login,password:a.password}:a.email&&a.password?b.user={email:a.email,password:a.password}:a.provider&&(b.provider=a.provider,a.scope&&(b.scope=a.scope),a.keys&&a.keys.token&&(b.keys={token:a.keys.token}),a.keys&&a.keys.secret&&(b.keys.secret=a.keys.secret)),b}function f(a,b){var c=Object.keys(a).map(function(b){return"object"==typeof a[b]?Object.keys(a[b]).map(function(c){return b+"["+c+"]="+a[b][c]}).sort().join("&"):b+"="+a[b]}).sort().join("&");return i(c,b).toString()}var g=a("../qbConfig"),h=a("../qbUtils"),i=a("crypto-js/hmac-sha1");d.prototype={getSession:function(a){h.QBLog("[AuthProxy]","getSession"),this.service.ajax({url:h.getUrl(g.urls.session)},function(b,c){b?a(b,null):a(b,c)})},createSession:function(a,b){if(""===g.creds.appId||""===g.creds.authKey||""===g.creds.authSecret)throw new Error("Cannot create a new session without app credentials (app ID, auth key and auth secret)");var c,d=this;"function"==typeof a&&"undefined"==typeof b&&(b=a,a={}),c=e(a),c.signature=f(c,g.creds.authSecret),h.QBLog("[AuthProxy]","createSession",c),this.service.ajax({url:h.getUrl(g.urls.session),type:"POST",data:c},function(a,c){a?b(a,null):(d.service.setSession(c.session),b(null,c.session))})},destroySession:function(a){var b=this;h.QBLog("[AuthProxy]","destroySession"),this.service.ajax({url:h.getUrl(g.urls.session),type:"DELETE",dataType:"text"},function(c,d){c?a(c,null):(b.service.setSession(null),a(null,d))})},login:function(a,b){h.QBLog("[AuthProxy]","login",a),this.service.ajax({url:h.getUrl(g.urls.login),type:"POST",data:a},function(a,c){a?b(a,null):b(null,c.user)})},logout:function(a){h.QBLog("[AuthProxy]","logout"),this.service.ajax({url:h.getUrl(g.urls.login),type:"DELETE",dataType:"text"},a)}},b.exports=d},{"../qbConfig":9,"../qbUtils":13,"crypto-js/hmac-sha1":17}],2:[function(a,b,c){function d(a,b,c){var d=this;s=b,r=c,this.service=a,p&&(this.roster=new e(a),this.muc=new f(a),this.privacylist=new g(a),this._isLogout=!1,this._isDisconnected=!1),this.dialog=new h(a),this.message=new i(a),this.helpers=new j,this._onMessage=function(a){var b=a.getAttribute("from"),c=(a.getAttribute("to"),a.getAttribute("type")),e=a.querySelector("body"),f=a.querySelector("markable"),g=a.querySelector("received"),h=a.querySelector("displayed"),i=a.querySelector("composing"),j=a.querySelector("paused"),k=a.querySelector("invite"),l=a.querySelector("extraParams"),m=a.querySelector("delay"),n=a.getAttribute("id"),p="groupchat"===c?d.helpers.getDialogIdFromNode(b):null,q="groupchat"===c?d.helpers.getIdFromResource(b):d.helpers.getIdFromNode(b),s=g||h||null;if(k)return!0;var t;if(l&&(t=d._parseExtraParams(l),t.dialogId&&(p=t.dialogId)),i||j)return"function"!=typeof d.onMessageTypingListener||"chat"!==c&&"groupchat"!==c&&m||o.safeCallbackCall(d.onMessageTypingListener,null!=i,q,p),!0;if(s)return g?"function"==typeof d.onDeliveredStatusListener&&"chat"===c&&o.safeCallbackCall(d.onDeliveredStatusListener,g.getAttribute("id"),p,q):"function"==typeof d.onReadStatusListener&&"chat"===c&&o.safeCallbackCall(d.onReadStatusListener,h.getAttribute("id"),p,q),!0;if(f&&q!=d.helpers.getIdFromNode(r.jid)){var u={messageId:n,userId:q,dialogId:p};d.sendDeliveredStatus(u)}var v={id:n,dialog_id:p,type:c,body:e&&e.textContent||null,extension:t?t.extension:null,delay:m};return f&&(v.markable=1),"function"!=typeof d.onMessageListener||"chat"!==c&&"groupchat"!==c||o.safeCallbackCall(d.onMessageListener,q,v),!0},this._onPresence=function(a){var b=a.getAttribute("from"),c=a.getAttribute("type"),e=d.helpers.getIdFromNode(b);if(c)switch(c){case"subscribe":v[e]&&"to"===v[e].subscription?(v[e]={subscription:"both",ask:null},d.roster._sendSubscriptionPresence({jid:b,type:"subscribed"})):"function"==typeof d.onSubscribeListener&&o.safeCallbackCall(d.onSubscribeListener,e);break;case"subscribed":v[e]&&"from"===v[e].subscription?v[e]={subscription:"both",ask:null}:(v[e]={subscription:"to",ask:null},"function"==typeof d.onConfirmSubscribeListener&&o.safeCallbackCall(d.onConfirmSubscribeListener,e));break;case"unsubscribed":v[e]={subscription:"none",ask:null},"function"==typeof d.onRejectSubscribeListener&&o.safeCallbackCall(d.onRejectSubscribeListener,e);break;case"unsubscribe":v[e]={subscription:"to",ask:null};break;case"unavailable":"function"==typeof d.onContactListListener&&v[e]&&"none"!==v[e].subscription&&o.safeCallbackCall(d.onContactListListener,e,c)}else"function"==typeof d.onContactListListener&&v[e]&&"none"!==v[e].subscription&&o.safeCallbackCall(d.onContactListListener,e);return!0},this._onIQ=function(a){return!0},this._onSystemMessageListener=function(a){var b,c=a.getAttribute("from"),e=(a.getAttribute("to"),a.querySelector("extraParams")),f=e.querySelector("moduleIdentifier").textContent,g=(a.querySelector("delay"),a.getAttribute("id"));if("SystemNotifications"===f&&"function"==typeof d.onSystemMessageListener){var h=d._parseExtraParams(e);b={id:g,userId:d.helpers.getIdFromNode(c),extension:h.extension},o.safeCallbackCall(d.onSystemMessageListener,b)}return!0},this._onMessageErrorListener=function(a){var b=a.getAttribute("id"),c=k(a);return"function"==typeof d.onMessageErrorListener&&o.safeCallbackCall(d.onMessageErrorListener,b,c),!0}}function e(a){this.service=a,this.helpers=new j}function f(a){this.service=a,this.helpers=new j}function g(a){this.service=a,this.helpers=new j}function h(a){this.service=a,this.helpers=new j}function i(a){this.service=a,this.helpers=new j}function j(){}function k(a){var b=a.getElementsByTagName("error")[0],c=parseInt(b.getAttribute("code")),d=b.getElementsByTagName("text")[0].textContent;return l(c,d)}function l(a,b){var c,d={code:a,status:"error",detail:b};switch(a){case 401:c="Unauthorized";break;case 422:c="Unprocessable Entity";break;case 408:c="Timeout";break;case 503:c="Service not available";break;default:c="Bad request"}return d.message=c,d}function m(){return(new Date).toTimeString().split(" ")[0]}var n=a("../qbConfig"),o=a("../qbUtils"),p="undefined"!=typeof window,q="This function isn't supported outside of the browser (...yet)";p&&(a("../../lib/strophe/strophe.min"),Strophe.addNamespace("CARBONS","urn:xmpp:carbons:2"),Strophe.addNamespace("CHAT_MARKERS","urn:xmpp:chat-markers:0"),Strophe.addNamespace("PRIVACY_LIST","jabber:iq:privacy"),Strophe.addNamespace("CHAT_STATES","http://jabber.org/protocol/chatstates"));var r,s,t=n.urls.chat+"/Dialog",u=n.urls.chat+"/Message",v={},w={};d.prototype={connect:function(a,b){if(!p)throw q;o.QBLog("[ChatProxy]","connect",a);var c,d,e,f=this;"userId"in a?(e=a.userId+"-"+n.creds.appId+"@"+n.endpoints.chat,"resource"in a&&(e=e+"/"+a.resource)):"jid"in a&&(e=a.jid),r.connect(e,a.password,function(e){switch(e){case Strophe.Status.ERROR:c=l(422,"Status.ERROR - An error has occurred"),"function"==typeof b&&b(c,null);break;case Strophe.Status.CONNECTING:o.QBLog("[ChatProxy]","Status.CONNECTING"),o.QBLog("[ChatProxy]","Chat Protocol - "+(1===n.chatProtocol.active?"BOSH":"WebSocket"));break;case Strophe.Status.CONNFAIL:c=l(422,"Status.CONNFAIL - The connection attempt failed"),"function"==typeof b&&b(c,null);break;case Strophe.Status.AUTHENTICATING:o.QBLog("[ChatProxy]","Status.AUTHENTICATING");break;case Strophe.Status.AUTHFAIL:c=l(401,"Status.AUTHFAIL - The authentication attempt failed"),"function"==typeof b&&b(c,null);break;case Strophe.Status.CONNECTED:o.QBLog("[ChatProxy]","Status.CONNECTED at "+m()),f._isDisconnected=!1,r.addHandler(f._onMessage,null,"message","chat"),r.addHandler(f._onMessage,null,"message","groupchat"),r.addHandler(f._onPresence,null,"presence"),r.addHandler(f._onIQ,null,"iq"),r.addHandler(f._onSystemMessageListener,null,"message","headline"),r.addHandler(f._onMessageErrorListener,null,"message","error"),r.addHandler(s._onMessage,null,"message","headline"),f._enableCarbons(function(){f.roster.get(function(a){if(v=a,r.send($pres().tree()),r.addTimedHandler(55e3,f._autoSendPresence),"function"==typeof b)b(null,v);else{f._isLogout=!1,d=Object.keys(w);for(var c=0,e=d.length;e>c;c++)f.muc.join(d[c]);"function"==typeof f.onReconnectListener&&o.safeCallbackCall(f.onReconnectListener)}})});break;case Strophe.Status.DISCONNECTING:o.QBLog("[ChatProxy]","Status.DISCONNECTING");break;case Strophe.Status.DISCONNECTED:o.QBLog("[ChatProxy]","Status.DISCONNECTED at "+m()),r.reset(),f._isDisconnected||"function"!=typeof f.onDisconnectedListener||o.safeCallbackCall(f.onDisconnectedListener),f._isDisconnected=!0,f._isLogout||f.connect(a);break;case Strophe.Status.ATTACHED:o.QBLog("[ChatProxy]","Status.ATTACHED")}
})},send:function(a,b){if(!p)throw q;b.id||(b.id=o.getBsonObjectId());var c=this,d=$msg({from:r.jid,to:this.helpers.jidOrUserId(a),type:b.type,id:b.id});b.body&&d.c("body",{xmlns:Strophe.NS.CLIENT}).t(b.body).up(),b.extension&&(d.c("extraParams",{xmlns:Strophe.NS.CLIENT}),Object.keys(b.extension).forEach(function(a){"attachments"===a?b.extension[a].forEach(function(a){d.c("attachment",a).up()}):"object"==typeof b.extension[a]?c._JStoXML(a,b.extension[a],d):d.c(a).t(b.extension[a]).up()}),d.up()),b.markable&&d.c("markable",{xmlns:Strophe.NS.CHAT_MARKERS}),r.send(d)},sendSystemMessage:function(a,b){if(!p)throw q;b.id||(b.id=o.getBsonObjectId());var c=this,d=$msg({id:b.id,type:"headline",to:this.helpers.jidOrUserId(a)});b.extension&&(d.c("extraParams",{xmlns:Strophe.NS.CLIENT}).c("moduleIdentifier").t("SystemNotifications").up(),Object.keys(b.extension).forEach(function(a){"object"==typeof b.extension[a]?c._JStoXML(a,b.extension[a],d):d.c(a).t(b.extension[a]).up()}),d.up()),r.send(d)},sendIsTypingStatus:function(a){if(!p)throw q;var b=$msg({from:r.jid,to:this.helpers.jidOrUserId(a),type:this.helpers.typeChat(a)});b.c("composing",{xmlns:Strophe.NS.CHAT_STATES}),r.send(b)},sendIsStopTypingStatus:function(a){if(!p)throw q;var b=$msg({from:r.jid,to:this.helpers.jidOrUserId(a),type:this.helpers.typeChat(a)});b.c("paused",{xmlns:Strophe.NS.CHAT_STATES}),r.send(b)},sendPres:function(a){if(!p)throw q;r.send($pres({from:r.jid,type:a}))},sendDeliveredStatus:function(a){if(!p)throw q;var b=$msg({from:r.jid,to:this.helpers.jidOrUserId(a.userId),type:"chat",id:o.getBsonObjectId()});b.c("received",{xmlns:Strophe.NS.CHAT_MARKERS,id:a.messageId}).up(),b.c("extraParams",{xmlns:Strophe.NS.CLIENT}).c("dialog_id").t(a.dialogId),r.send(b)},sendReadStatus:function(a){if(!p)throw q;var b=$msg({from:r.jid,to:this.helpers.jidOrUserId(a.userId),type:"chat",id:o.getBsonObjectId()});b.c("displayed",{xmlns:Strophe.NS.CHAT_MARKERS,id:a.messageId}).up(),b.c("extraParams",{xmlns:Strophe.NS.CLIENT}).c("dialog_id").t(a.dialogId),r.send(b)},disconnect:function(){if(!p)throw q;w={},this._isLogout=!0,r.flush(),r.disconnect()},addListener:function(a,b){function c(){return b(),a.live!==!1}if(!p)throw q;return r.addHandler(c,null,a.name||null,a.type||null,a.id||null,a.from||null)},deleteListener:function(a){if(!p)throw q;r.deleteHandler(a)},_JStoXML:function(a,b,c){var d=this;c.c(a),Object.keys(b).forEach(function(a){"object"==typeof b[a]?d._JStoXML(a,b[a],c):c.c(a).t(b[a]).up()}),c.up()},_XMLtoJS:function(a,b,c){var d=this;a[b]={};for(var e=0,f=c.childNodes.length;f>e;e++)c.childNodes[e].childNodes.length>1?a[b]=d._XMLtoJS(a[b],c.childNodes[e].tagName,c.childNodes[e]):a[b][c.childNodes[e].tagName]=c.childNodes[e].textContent;return a},_parseExtraParams:function(a){if(!a)return null;for(var b,c={},d=[],e=0,f=a.childNodes.length;f>e;e++)if("attachment"===a.childNodes[e].tagName){for(var g={},h=a.childNodes[e].attributes,i=0,j=h.length;j>i;i++)"id"===h[i].name||"size"===h[i].name?g[h[i].name]=parseInt(h[i].value):g[h[i].name]=h[i].value;d.push(g)}else if("dialog_id"===a.childNodes[e].tagName)b=a.childNodes[e].textContent,c.dialog_id=b;else if(a.childNodes[e].childNodes.length>1){var k=a.childNodes[e].textContent.length;if(k>4096){for(var l="",i=0;i<a.childNodes[e].childNodes.length;++i)l+=a.childNodes[e].childNodes[i].textContent;c[a.childNodes[e].tagName]=l}else c=self._XMLtoJS(c,a.childNodes[e].tagName,a.childNodes[e])}else c[a.childNodes[e].tagName]=a.childNodes[e].textContent;return d.length>0&&(c.attachments=d),c.moduleIdentifier&&delete c.moduleIdentifier,{extension:c,dialogId:b}},_autoSendPresence:function(){if(!p)throw q;return r.send($pres().tree()),!0},_enableCarbons:function(a){if(!p)throw q;var b;b=$iq({from:r.jid,type:"set",id:r.getUniqueId("enableCarbons")}).c("enable",{xmlns:Strophe.NS.CARBONS}),r.sendIQ(b,function(b){a()})}},e.prototype={get:function(a){var b,c,d,e=this,f={};b=$iq({from:r.jid,type:"get",id:r.getUniqueId("getRoster")}).c("query",{xmlns:Strophe.NS.ROSTER}),r.sendIQ(b,function(b){c=b.getElementsByTagName("item");for(var g=0,h=c.length;h>g;g++)d=e.helpers.getIdFromNode(c[g].getAttribute("jid")).toString(),f[d]={subscription:c[g].getAttribute("subscription"),ask:c[g].getAttribute("ask")||null};a(f)})},add:function(a,b){var c=this,d=this.helpers.jidOrUserId(a),e=this.helpers.getIdFromNode(d).toString();v[e]={subscription:"none",ask:"subscribe"},c._sendSubscriptionPresence({jid:d,type:"subscribe"}),"function"==typeof b&&b()},confirm:function(a,b){var c=this,d=this.helpers.jidOrUserId(a),e=this.helpers.getIdFromNode(d).toString();v[e]={subscription:"from",ask:"subscribe"},c._sendSubscriptionPresence({jid:d,type:"subscribed"}),c._sendSubscriptionPresence({jid:d,type:"subscribe"}),"function"==typeof b&&b()},reject:function(a,b){var c=this,d=this.helpers.jidOrUserId(a),e=this.helpers.getIdFromNode(d).toString();v[e]={subscription:"none",ask:null},c._sendSubscriptionPresence({jid:d,type:"unsubscribed"}),"function"==typeof b&&b()},remove:function(a,b){var c,d=this.helpers.jidOrUserId(a),e=this.helpers.getIdFromNode(d).toString();c=$iq({from:r.jid,type:"set",id:r.getUniqueId("removeRosterItem")}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:d,subscription:"remove"}),r.sendIQ(c,function(){delete v[e],"function"==typeof b&&b()})},_sendSubscriptionPresence:function(a){var b;b=$pres({to:a.jid,type:a.type}),r.send(b)}},f.prototype={join:function(a,b){var c,d=this,e=r.getUniqueId("join");w[a]=!0,c=$pres({from:r.jid,to:d.helpers.getRoomJid(a),id:e}).c("x",{xmlns:Strophe.NS.MUC}).c("history",{maxstanzas:0}),"function"==typeof b&&r.addHandler(b,null,"presence",null,e),r.send(c)},leave:function(a,b){var c,d=this,e=d.helpers.getRoomJid(a);delete w[a],c=$pres({from:r.jid,to:e,type:"unavailable"}),"function"==typeof b&&r.addHandler(b,null,"presence","unavailable",null,e),r.send(c)},listOnlineUsers:function(a,b){var c,d=this,e=[];c=$iq({from:r.jid,id:r.getUniqueId("muc_disco_items"),to:a,type:"get"}).c("query",{xmlns:"http://jabber.org/protocol/disco#items"}),r.sendIQ(c,function(a){for(var c,f=a.getElementsByTagName("item"),g=0,h=f.length;h>g;g++)c=d.helpers.getUserIdFromRoomJid(f[g].getAttribute("jid")),e.push(c);b(e)})}},g.prototype={getNames:function(a){var b=$iq({from:r.jid,type:"get",id:r.getUniqueId("getNames")}).c("query",{xmlns:Strophe.NS.PRIVACY_LIST});r.sendIQ(b,function(b){for(var c=[],d={},e=b.getElementsByTagName("default"),f=b.getElementsByTagName("active"),g=b.getElementsByTagName("list"),h=e[0].getAttribute("name"),i=f[0].getAttribute("name"),j=0,k=g.length;k>j;j++)c.push(g[j].getAttribute("name"));d={"default":h,active:i,names:c},a(null,d)},function(b){if(b){var c=k(b);a(c,null)}else a(l(408),null)})},getList:function(a,b){var c,d,e,f,g=this,h=[],i={};c=$iq({from:r.jid,type:"get",id:r.getUniqueId("getlist")}).c("query",{xmlns:Strophe.NS.PRIVACY_LIST}).c("list",{name:a}),r.sendIQ(c,function(c){d=c.getElementsByTagName("item");for(var j=0,k=d.length;k>j;j+=2)e=d[j].getAttribute("value"),f=g.helpers.getIdFromNode(e),h.push({user_id:f,action:d[j].getAttribute("action")});i={name:a,items:h},b(null,i)},function(a){if(a){var c=k(a);b(c,null)}else b(l(408),null)})},create:function(a,b){var c,d,e,f,g,h=this,i={},j=[];c=$iq({from:r.jid,type:"set",id:r.getUniqueId("edit")}).c("query",{xmlns:Strophe.NS.PRIVACY_LIST}).c("list",{name:a.name}),$(a.items).each(function(a,b){i[b.user_id]=b.action}),j=Object.keys(i);for(var m=0,n=0,o=j.length;o>m;m++,n+=2)d=j[m],f=i[d],e=h.helpers.jidOrUserId(parseInt(d,10)),g=h.helpers.getUserNickWithMucDomain(d),c.c("item",{type:"jid",value:e,action:f,order:n+1}).c("message",{}).up().c("presence-in",{}).up().c("presence-out",{}).up().c("iq",{}).up().up(),c.c("item",{type:"jid",value:g,action:f,order:n+2}).c("message",{}).up().c("presence-in",{}).up().c("presence-out",{}).up().c("iq",{}).up().up();r.sendIQ(c,function(a){b(null)},function(a){if(a){var c=k(a);b(c)}else b(l(408))})},update:function(a,b){var c=this;c.getList(a.name,function(d,e){if(d)b(d,null);else{var f=JSON.parse(JSON.stringify(a)),g=e.items,h=f.items,i={};f.items=$.merge(g,h),i=f,c.create(i,function(a,c){d?b(a,null):b(null,c)})}})},"delete":function(a,b){var c=$iq({from:r.jid,type:"set",id:r.getUniqueId("remove")}).c("query",{xmlns:Strophe.NS.PRIVACY_LIST}).c("list",{name:a?a:""});r.sendIQ(c,function(a){b(null)},function(a){if(a){var c=k(a);b(c)}else b(l(408))})},setAsDefault:function(a,b){var c=$iq({from:r.jid,type:"set",id:r.getUniqueId("default")}).c("query",{xmlns:Strophe.NS.PRIVACY_LIST}).c("default",{name:a?a:""});r.sendIQ(c,function(a){b(null)},function(a){if(a){var c=k(a);b(c)}else b(l(408))})},setAsActive:function(a,b){var c=$iq({from:r.jid,type:"set",id:r.getUniqueId("active")}).c("query",{xmlns:Strophe.NS.PRIVACY_LIST}).c("active",{name:a?a:""});r.sendIQ(c,function(a){b(null)},function(a){if(a){var c=k(a);b(c)}else b(l(408))})}},h.prototype={list:function(a,b){"function"==typeof a&&"undefined"==typeof b&&(b=a,a={}),o.QBLog("[DialogProxy]","list",a),this.service.ajax({url:o.getUrl(t),data:a},b)},create:function(a,b){a.occupants_ids instanceof Array&&(a.occupants_ids=a.occupants_ids.join(", ")),o.QBLog("[DialogProxy]","create",a),this.service.ajax({url:o.getUrl(t),type:"POST",data:a},b)},update:function(a,b,c){o.QBLog("[DialogProxy]","update",b),this.service.ajax({url:o.getUrl(t,a),type:"PUT",data:b},c)},"delete":function(a,b,c){o.QBLog("[DialogProxy]","delete",a),2==arguments.length?this.service.ajax({url:o.getUrl(t,a),type:"DELETE"},b):3==arguments.length&&this.service.ajax({url:o.getUrl(t,a),type:"DELETE",data:b},c)}},i.prototype={list:function(a,b){o.QBLog("[MessageProxy]","list",a),this.service.ajax({url:o.getUrl(u),data:a},b)},create:function(a,b){o.QBLog("[MessageProxy]","create",a),this.service.ajax({url:o.getUrl(u),type:"POST",data:a},b)},update:function(a,b,c){o.QBLog("[MessageProxy]","update",a,b),this.service.ajax({url:o.getUrl(u,a),type:"PUT",data:b},c)},"delete":function(a,b,c){o.QBLog("[DialogProxy]","delete",a),2==arguments.length?this.service.ajax({url:o.getUrl(u,a),type:"DELETE",dataType:"text"},b):3==arguments.length&&this.service.ajax({url:o.getUrl(u,a),type:"DELETE",data:b,dataType:"text"},c)},unreadCount:function(a,b){o.QBLog("[MessageProxy]","unreadCount",a),this.service.ajax({url:o.getUrl(u+"/unread"),data:a},b)}},j.prototype={jidOrUserId:function(a){var b;if("string"==typeof a)b=a;else{if("number"!=typeof a)throw q;b=a+"-"+n.creds.appId+"@"+n.endpoints.chat}return b},typeChat:function(a){var b;if("string"==typeof a)b=a.indexOf("muc")>-1?"groupchat":"chat";else{if("number"!=typeof a)throw q;b="chat"}return b},getRecipientId:function(a,b){var c=null;return a.forEach(function(a,d,e){a!=b&&(c=a)}),c},getUserJid:function(a,b){return b?a+"-"+b+"@"+n.endpoints.chat:a+"-"+n.creds.appId+"@"+n.endpoints.chat},getUserNickWithMucDomain:function(a){return n.endpoints.muc+"/"+a},getIdFromNode:function(a){return a.indexOf("@")<0?null:parseInt(a.split("@")[0].split("-")[0])},getDialogIdFromNode:function(a){return a.indexOf("@")<0?null:a.split("@")[0].split("_")[1]},getRoomJid:function(a){if(!p)throw q;return a+"/"+this.getIdFromNode(r.jid)},getIdFromResource:function(a){var b=a.split("/");return b.length<2?null:(b.splice(0,1),parseInt(b.join("/")))},getUniqueId:function(a){if(!p)throw q;return r.getUniqueId(a)},getBsonObjectId:function(){return o.getBsonObjectId()},getUserIdFromRoomJid:function(a){var b=a.toString().split("/");return 0==b.length?null:b[b.length-1]}},b.exports=d},{"../../lib/strophe/strophe.min":15,"../qbConfig":9,"../qbUtils":13}],3:[function(a,b,c){function d(a){this.service=a}function e(a){for(var b=e.options,c=b.parser[b.strictMode?"strict":"loose"].exec(a),d={},f=14;f--;)d[b.key[f]]=c[f]||"";return d[b.q.name]={},d[b.key[12]].replace(b.q.parser,function(a,c,e){c&&(d[b.q.name][c]=e)}),d}var f=a("../qbConfig"),g=a("../qbUtils"),h="undefined"!=typeof window;if(!h)var i=a("xml2js");var j=f.urls.blobs+"/tagged";d.prototype={create:function(a,b){g.QBLog("[ContentProxy]","create",a),this.service.ajax({url:g.getUrl(f.urls.blobs),data:{blob:a},type:"POST"},function(a,c){a?b(a,null):b(a,c.blob)})},list:function(a,b){"function"==typeof a&&"undefined"==typeof b&&(b=a,a=null),g.QBLog("[ContentProxy]","list",a),this.service.ajax({url:g.getUrl(f.urls.blobs),data:a,type:"GET"},function(a,c){a?b(a,null):b(a,c)})},"delete":function(a,b){g.QBLog("[ContentProxy]","delete"),this.service.ajax({url:g.getUrl(f.urls.blobs,a),type:"DELETE",dataType:"text"},function(a,c){a?b(a,null):b(null,!0)})},createAndUpload:function(a,b){var c,d,f,i,j,k={},l=this,m=JSON.parse(JSON.stringify(a));m.file.data="...",g.QBLog("[ContentProxy]","createAndUpload",m),c=a.file,d=a.name||c.name,f=a.type||c.type,i=a.size||c.size,k.name=d,k.content_type=f,a["public"]&&(k["public"]=a["public"]),a.tag_list&&(k.tag_list=a.tag_list),this.create(k,function(a,d){if(a)b(a,null);else{var f,g=e(d.blob_object_access.params),k={url:"https://"+g.host};f=h?new FormData:{},j=d.id,Object.keys(g.queryKey).forEach(function(a){h?f.append(a,decodeURIComponent(g.queryKey[a])):f[a]=decodeURIComponent(g.queryKey[a])}),h?f.append("file",c,d.name):f.file=c,k.data=f,l.upload(k,function(a,c){a?b(a,null):(h?d.path=c.Location.replace("http://","https://"):d.path=c.PostResponse.Location,l.markUploaded({id:j,size:i},function(a,c){a?b(a,null):b(null,d)}))})}})},upload:function(a,b){g.QBLog("[ContentProxy]","upload"),this.service.ajax({url:a.url,data:a.data,dataType:"xml",contentType:!1,processData:!1,type:"POST"},function(a,c){if(a)b(a,null);else if(h){var d,e,f={},g=c.documentElement,j=g.childNodes;for(d=0,e=j.length;e>d;d++)f[j[d].nodeName]=j[d].childNodes[0].nodeValue;b(null,f)}else{var k=i.parseString;k(c,function(a,c){c&&b(null,c)})}})},taggedForCurrentUser:function(a){g.QBLog("[ContentProxy]","taggedForCurrentUser"),this.service.ajax({url:g.getUrl(j)},function(b,c){b?a(b,null):a(null,c)})},markUploaded:function(a,b){g.QBLog("[ContentProxy]","markUploaded",a),this.service.ajax({url:g.getUrl(f.urls.blobs,a.id+"/complete"),type:"PUT",data:{size:a.size},dataType:"text"},function(a,c){a?b(a,null):b(null,c)})},getInfo:function(a,b){g.QBLog("[ContentProxy]","getInfo",a),this.service.ajax({url:g.getUrl(f.urls.blobs,a)},function(a,c){a?b(a,null):b(null,c)})},getFile:function(a,b){g.QBLog("[ContentProxy]","getFile",a),this.service.ajax({url:g.getUrl(f.urls.blobs,a)},function(a,c){a?b(a,null):b(null,c)})},getFileUrl:function(a,b){g.QBLog("[ContentProxy]","getFileUrl",a),this.service.ajax({url:g.getUrl(f.urls.blobs,a+"/getblobobjectbyid"),type:"POST"},function(a,c){a?b(a,null):b(null,c.blob_object_access.params)})},update:function(a,b){g.QBLog("[ContentProxy]","update",a);var c={};c.blob={},"undefined"!=typeof a.name&&(c.blob.name=a.name),this.service.ajax({url:g.getUrl(f.urls.blobs,a.id),data:c},function(a,c){a?b(a,null):b(null,c)})},privateUrl:function(a){return"https://"+f.endpoints.api+"/blobs/"+a+"?token="+this.service.getSession().token},publicUrl:function(a){return"https://"+f.endpoints.api+"/blobs/"+a}},b.exports=d,e.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}}},{"../qbConfig":9,"../qbUtils":13,xml2js:49}],4:[function(a,b,c){function d(a){this.service=a}var e=a("../qbConfig"),f=a("../qbUtils"),g="undefined"!=typeof window;d.prototype={create:function(a,b,c){f.QBLog("[DataProxy]","create",a,b),this.service.ajax({url:f.getUrl(e.urls.data,a),data:b,type:"POST"},function(a,b){a?c(a,null):c(a,b)})},list:function(a,b,c){"undefined"==typeof c&&"function"==typeof b&&(c=b,b=null),f.QBLog("[DataProxy]","list",a,b),this.service.ajax({url:f.getUrl(e.urls.data,a),data:b},function(a,b){a?c(a,null):c(a,b)})},update:function(a,b,c){f.QBLog("[DataProxy]","update",a,b),this.service.ajax({url:f.getUrl(e.urls.data,a+"/"+b._id),data:b,type:"PUT"},function(a,b){a?c(a,null):c(a,b)})},"delete":function(a,b,c){f.QBLog("[DataProxy]","delete",a,b),this.service.ajax({url:f.getUrl(e.urls.data,a+"/"+b),type:"DELETE",dataType:"text"},function(a,b){a?c(a,null):c(a,!0)})},uploadFile:function(a,b,c){f.QBLog("[DataProxy]","uploadFile",a,b);var d;g?(d=new FormData,d.append("field_name",b.field_name),d.append("file",b.file)):(d={},d.field_name=b.field_name,d.file=b.file),this.service.ajax({url:f.getUrl(e.urls.data,a+"/"+b.id+"/file"),data:d,contentType:!1,processData:!1,type:"POST"},function(a,b){a?c(a,null):c(a,b)})},downloadFile:function(a,b,c){f.QBLog("[DataProxy]","downloadFile",a,b);var d=f.getUrl(e.urls.data,a+"/"+b.id+"/file");d+="?field_name="+b.field_name+"&token="+this.service.getSession().token,c(null,d)},deleteFile:function(a,b,c){f.QBLog("[DataProxy]","deleteFile",a,b),this.service.ajax({url:f.getUrl(e.urls.data,a+"/"+b.id+"/file"),data:{field_name:b.field_name},dataType:"text",type:"DELETE"},function(a,b){a?c(a,null):c(a,!0)})}},b.exports=d},{"../qbConfig":9,"../qbUtils":13}],5:[function(a,b,c){function d(a){this.service=a,this.geodata=new e(a)}function e(a){this.service=a}var f=a("../qbConfig"),g=a("../qbUtils"),h=f.urls.geodata+"/find";e.prototype={create:function(a,b){g.QBLog("[GeoProxy]","create",a),this.service.ajax({url:g.getUrl(f.urls.geodata),data:{geo_data:a},type:"POST"},function(a,c){a?b(a,null):b(a,c.geo_datum)})},update:function(a,b){var c,d=["longitude","latitude","status"],e={};for(c in a)a.hasOwnProperty(c)&&d.indexOf(c)>0&&(e[c]=a[c]);g.QBLog("[GeoProxy]","update",a),this.service.ajax({url:g.getUrl(f.urls.geodata,a.id),data:{geo_data:e},type:"PUT"},function(a,c){a?b(a,null):b(a,c.geo_datum)})},get:function(a,b){g.QBLog("[GeoProxy]","get",a),this.service.ajax({url:g.getUrl(f.urls.geodata,a)},function(a,c){a?b(a,null):b(null,c.geo_datum)})},list:function(a,b){"function"==typeof a&&(b=a,a=void 0),g.QBLog("[GeoProxy]","find",a),this.service.ajax({url:g.getUrl(h),data:a},b)},"delete":function(a,b){g.QBLog("[GeoProxy]","delete",a),this.service.ajax({url:g.getUrl(f.urls.geodata,a),type:"DELETE",dataType:"text"},function(a,c){a?b(a,null):b(null,!0)})},purge:function(a,b){g.QBLog("[GeoProxy]","purge",a),this.service.ajax({url:g.getUrl(f.urls.geodata),data:{days:a},type:"DELETE",dataType:"text"},function(a,c){a?b(a,null):b(null,!0)})}},b.exports=d},{"../qbConfig":9,"../qbUtils":13}],6:[function(a,b,c){function d(a){this.service=a,this.subscriptions=new e(a),this.events=new f(a),this.base64Encode=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}))}}function e(a){this.service=a}function f(a){this.service=a}var g=a("../qbConfig"),h=a("../qbUtils");e.prototype={create:function(a,b){h.QBLog("[SubscriptionsProxy]","create",a),this.service.ajax({url:h.getUrl(g.urls.subscriptions),type:"POST",data:a},b)},list:function(a){h.QBLog("[SubscriptionsProxy]","list"),this.service.ajax({url:h.getUrl(g.urls.subscriptions)},a)},"delete":function(a,b){h.QBLog("[SubscriptionsProxy]","delete",a),this.service.ajax({url:h.getUrl(g.urls.subscriptions,a),type:"DELETE",dataType:"text"},function(a,c){a?b(a,null):b(null,!0)})}},f.prototype={create:function(a,b){h.QBLog("[EventsProxy]","create",a);var c={event:a};this.service.ajax({url:h.getUrl(g.urls.events),type:"POST",data:c},b)},list:function(a,b){"function"==typeof a&&"undefined"==typeof b&&(b=a,a=null),h.QBLog("[EventsProxy]","list",a),this.service.ajax({url:h.getUrl(g.urls.events),data:a},b)},get:function(a,b){h.QBLog("[EventsProxy]","get",a),this.service.ajax({url:h.getUrl(g.urls.events,a)},b)},status:function(a,b){h.QBLog("[EventsProxy]","status",a),this.service.ajax({url:h.getUrl(g.urls.events,a+"/status")},b)},"delete":function(a,b){h.QBLog("[EventsProxy]","delete",a),this.service.ajax({url:h.getUrl(g.urls.events,a),type:"DELETE"},b)}},b.exports=d},{"../qbConfig":9,"../qbUtils":13}],7:[function(a,b,c){function d(a){this.service=a}function e(a){var b=a.field in j?"date":typeof a.value;return(a.value instanceof Array||i.isArray(a.value))&&("object"==b&&(b=typeof a.value[0]),a.value=a.value.toString()),[b,a.field,a.param,a.value].join(" ")}function f(a){var b=a.field in j?"date":a.field in k?"number":"string";return[a.sort,b,a.field].join(" ")}var g=a("../qbConfig"),h=a("../qbUtils"),i=a("util"),j=["created_at","updated_at","last_request_at"],k=["id","external_user_id"],l=g.urls.users+"/password/reset";d.prototype={listUsers:function(a,b){h.QBLog("[UsersProxy]","listUsers",arguments.length>1?a:"");var c,d={},i=[];"function"==typeof a&&"undefined"==typeof b&&(b=a,a={}),a.filter&&(a.filter instanceof Array?a.filter.forEach(function(a){c=e(a),i.push(c)}):(c=e(a.filter),i.push(c)),d.filter=i),a.order&&(d.order=f(a.order)),a.page&&(d.page=a.page),a.per_page&&(d.per_page=a.per_page),this.service.ajax({url:h.getUrl(g.urls.users),data:d},b)},get:function(a,b){h.QBLog("[UsersProxy]","get",a);var c;"number"==typeof a?(c=a,a={}):a.login?c="by_login":a.full_name?c="by_full_name":a.facebook_id?c="by_facebook_id":a.twitter_id?c="by_twitter_id":a.email?c="by_email":a.tags?c="by_tags":a.external&&(c="external/"+a.external,a={}),this.service.ajax({url:h.getUrl(g.urls.users,c),data:a},function(a,c){a?b(a,null):b(null,c.user||c)})},create:function(a,b){h.QBLog("[UsersProxy]","create",a),this.service.ajax({url:h.getUrl(g.urls.users),type:"POST",data:{user:a}},function(a,c){a?b(a,null):b(null,c.user)})},update:function(a,b,c){h.QBLog("[UsersProxy]","update",a,b),this.service.ajax({url:h.getUrl(g.urls.users,a),type:"PUT",data:{user:b}},function(a,b){a?c(a,null):c(null,b.user)})},"delete":function(a,b){h.QBLog("[UsersProxy]","delete",a);var c;"number"==typeof a?c=a:a.external&&(c="external/"+a.external),this.service.ajax({url:h.getUrl(g.urls.users,c),type:"DELETE",dataType:"text"},b)},resetPassword:function(a,b){h.QBLog("[UsersProxy]","resetPassword",a),this.service.ajax({url:h.getUrl(l),data:{email:a}},b)}},b.exports=d},{"../qbConfig":9,"../qbUtils":13,util:46}],8:[function(a,b,c){function d(a,b){var c=this;p=b,this.service=a,this.helpers=new e,this._onMessage=function(a){var b=a.getAttribute("from"),d=a.querySelector("extraParams"),e=a.querySelector("delay"),g=c.helpers.getIdFromNode(b),l=c._getExtension(d);if(l.sessionID,e||l.moduleIdentifier!==A)return!0;switch(delete l.moduleIdentifier,l.signalType){case z.CALL:if(f("onCall from "+g),B[g])return f("skip onCallListener, a user already got it"),!0;i(g),null==q&&j(g,c._answerTimeoutCallback),B[g]={sessionID:l.sessionID,sdp:l.sdp},l.callType="1"===l.callType?"video":"audio",delete l.sdp,"function"==typeof c.onCallListener&&c.onCallListener(g,l);break;case z.ACCEPT:f("onAccept from "+g),k(g),m(g),"object"==typeof q&&q.onRemoteSessionCallback(l.sdp,"answer"),delete l.sdp,"function"==typeof c.onAcceptCallListener&&c.onAcceptCallListener(g,l);break;case z.REJECT:f("onReject from "+g),k(g),m(g),c._close(),"function"==typeof c.onRejectCallListener&&c.onRejectCallListener(g,l);break;case z.STOP:f("onStop from "+g),k(g),m(g),h(g),c._close(),"function"==typeof c.onStopCallListener&&c.onStopCallListener(g,l);break;case z.CANDIDATE:"object"==typeof q&&(q.addCandidates(l.iceCandidates),"answer"===q.type&&c._sendCandidate(q.opponentId,q.iceCandidates));break;case z.PARAMETERS_CHANGED:f("onUpdateCall from "+g),"function"==typeof c.onUpdateCallListener&&c.onUpdateCallListener(g,l)}return!0},this._getExtension=function(a){var b,d,e,f,g={},h=[],i=[];if(a){for(var j=0,k=a.childNodes.length;k>j;j++)if("iceCandidates"===a.childNodes[j].tagName){e=a.childNodes[j].childNodes;for(var l=0,m=e.length;m>l;l++){b={},f=e[l].childNodes;for(var n=0,o=f.length;o>n;n++)b[f[n].tagName]=f[n].textContent;h.push(b)}}else if("opponentsIDs"===a.childNodes[j].tagName){e=a.childNodes[j].childNodes;for(var l=0,m=e.length;m>l;l++)d=e[l].textContent,i.push(d)}else a.childNodes[j].childNodes.length>1?g=c._XMLtoJS(g,a.childNodes[j].tagName,a.childNodes[j]):g[a.childNodes[j].tagName]=a.childNodes[j].textContent;h.length>0&&(g.iceCandidates=h),i.length>0&&(g.opponents=i)}return g},this._answerTimeoutCallback=function(a){h(a),c._close(),"function"==typeof c.onSessionStateChangedListener&&c.onSessionStateChangedListener(c.SessionState.CLOSED,a)},this._callTimeoutCallback=function(a){f("User "+a+" not asnwer"),k(a),h(a),c._close(),"function"==typeof c.onUserNotAnswerListener&&c.onUserNotAnswerListener(a)}}function e(){}function f(a){s.debug&&t.QBLog("[QBWebRTC]",a)}function g(){var a=(new Date).toString().split(" ");return a.slice(1,5).join("-")}function h(a){var b=B[a];b&&delete B[a]}function i(a){var b=C[a];b&&(clearTimeout(b),delete C[a])}function j(a,b){var c=1e3*s.webrtc.answerTimeInterval,d=setTimeout(b,c,a);C[a]=d}function k(a){var b=D[a];b&&(clearInterval(b),delete D[a])}function l(a,b){var c=1e3*s.webrtc.dialingTimeInterval,d=setInterval(b,c);D[a]=d}function m(a){var b=E[a];b&&(clearTimeout(b),delete E[a])}function n(a,b){var c=1e3*s.webrtc.answerTimeInterval;f("startCallTimer, answerTimeInterval: "+c);var d=setTimeout(b,c,a);E[a]=d}function o(a,b){for(var c=[],d=window.atob(a.split(",")[1]),e=0,f=d.length;f>e;e++)c.push(d.charCodeAt(e));return new Blob([new Uint8Array(c)],{type:b})}a("../../lib/strophe/strophe.min");var p,q,r=a("../../lib/download/download.min"),s=a("../qbConfig"),t=a("../qbUtils"),u=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,v=window.RTCSessionDescription||window.mozRTCSessionDescription,w=window.RTCIceCandidate||window.mozRTCIceCandidate,x=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,y=window.URL||window.webkitURL,z={CALL:"call",ACCEPT:"accept",REJECT:"reject",STOP:"hangUp",CANDIDATE:"iceCandidates",PARAMETERS_CHANGED:"update"},A="WebRTCVideoChat",B={},C={},D={},E={};d.prototype.SessionState={UNDEFINED:0,CONNECTING:1,CONNECTED:2,FAILED:3,DISCONNECTED:4,CLOSED:5},d.prototype.getUserMedia=function(a,b){if(!x)throw new Error("getUserMedia() is not supported in your browser");x=x.bind(navigator);var c=this;x({audio:a.audio||!1,video:a.video||!1},function(d){c.localStream=d,a.elemId&&c.attachMediaStream(a.elemId,d,a.options),b(null,d)},function(a){b(a,null)})},d.prototype.attachMediaStream=function(a,b,c){var d=document.getElementById(a);if(!d)throw new Error("Unable to attach media stream, element "+a+" is undefined");d.src=y.createObjectURL(b),c&&c.muted&&(d.muted=!0),c&&c.mirror&&(d.style.webkitTransform="scaleX(-1)",d.style.transform="scaleX(-1)"),d.play()},d.prototype.snapshot=function(a){var b,c,d=document.getElementById(a),e=document.createElement("canvas"),f=e.getContext("2d");return d?(e.width=d.clientWidth,e.height=d.clientHeight,"scaleX(-1)"===d.style.transform&&(f.translate(e.width,0),f.scale(-1,1)),f.drawImage(d,0,0,d.clientWidth,d.clientHeight),b=e.toDataURL(),c=o(b,"image/png"),c.name="snapshot_"+g()+".png",c.url=b,c):void 0},d.prototype.filter=function(a,b){var c=document.getElementById(a);c&&(c.style.webkitFilter=b,c.style.filter=b)},d.prototype.mute=function(a){this._switchOffDevice(0,a)},d.prototype.unmute=function(a){this._switchOffDevice(1,a)},d.prototype._switchOffDevice=function(a,b){"audio"===b&&this.localStream.getAudioTracks().length>0&&this.localStream.getAudioTracks().forEach(function(b){b.enabled=!!a}),"video"===b&&this.localStream.getVideoTracks().length>0&&this.localStream.getVideoTracks().forEach(function(b){b.enabled=!!a})},d.prototype._createPeer=function(a){if(!u)throw new Error("RTCPeerConnection() is not supported in your browser");if(!this.localStream)throw new Error("You don't have an access to the local stream");var b={iceServers:s.iceServers};q=new u(b),q.init(this,a),f("Peer._createPeer: "+q+", sessionID: "+q.sessionID)},d.prototype.call=function(a,b,c){f("Call. userId: "+a+", callType: "+b+", extension: "+JSON.stringify(c)),this._createPeer();var d=this,e=a instanceof Array?a:[a],g=e[0];q.opponentId=g,q.getSessionDescription(function(a,h){if(a)f("getSessionDescription error: "+a);else{k(g);var i=function(){d._sendMessage(g,c,"CALL",b,e)};i(),l(g,i),m(g),n(g,d._callTimeoutCallback)}})},d.prototype.accept=function(a,b){var b=b||{};f("Accept. userId: "+a+", extension: "+JSON.stringify(b)),i(a);var c=B[a];c&&this._createPeer({sessionID:c.sessionID,description:c.sdp});var d=this;q.opponentId=a,q.getSessionDescription(function(c,e){c?f(c):d._sendMessage(a,b,"ACCEPT")})},d.prototype.reject=function(a,b){var b=b||{};f("Reject. userId: "+a+", extension: "+JSON.stringify(b)),i(a),B[a]&&(b.sessionID=B[a].sessionID,delete B[a]),this._sendMessage(a,b,"REJECT")},d.prototype.stop=function(a,b){var b=b||{};f("Stop. userId: "+a+", extension: "+JSON.stringify(b)),i(a),k(a),m(a),this._sendMessage(a,b,"STOP"),this._close(),h(a)},d.prototype.update=function(a,b){var b=b||{};f("Update. userId: "+a+", extension: "+JSON.stringify(b)),this._sendMessage(a,b,"PARAMETERS_CHANGED")},d.prototype.close=function(){Object.keys(C).forEach(function(a){i(a)}),Object.keys(D).forEach(function(a){k(a)}),Object.keys(E).forEach(function(a){m(a)}),this._close(),Object.keys(B).forEach(function(a){h(a)})},d.prototype._close=function(){f("Peer._close"),q&&q.close(),this.localStream&&(this.localStream.getAudioTracks().forEach(function(a){a.stop()}),this.localStream.getVideoTracks().forEach(function(a){a.stop()}),this.localStream=null)},d.prototype._sendCandidate=function(a,b){var c={iceCandidates:b};this._sendMessage(a,c,"CANDIDATE")},d.prototype._sendMessage=function(a,b,c,d,e){var f,g,b=b||{},h=this;b.moduleIdentifier=A,b.signalType=z[c],b.sessionID=q&&q.sessionID||b.sessionID,d&&(b.callType="video"===d?"1":"2"),("CALL"===c||"ACCEPT"===c)&&(b.sdp=q.localDescription.sdp,b.platform="web"),"CALL"===c&&(b.callerID=this.helpers.getIdFromNode(p.jid),b.opponentsIDs=e),g={from:p.jid,to:this.helpers.getUserJid(a,s.creds.appId),type:"headline",id:t.getBsonObjectId()},f=$msg(g).c("extraParams",{xmlns:Strophe.NS.CLIENT}),Object.keys(b).forEach(function(a){"iceCandidates"===a?(f=f.c("iceCandidates"),b[a].forEach(function(a){f=f.c("iceCandidate"),Object.keys(a).forEach(function(b){f.c(b).t(a[b]).up()}),f.up()}),f.up()):"opponentsIDs"===a?(f=f.c("opponentsIDs"),b[a].forEach(function(a){f=f.c("opponentID").t(a).up()}),f.up()):"object"==typeof b[a]?h._JStoXML(a,b[a],f):f.c(a).t(b[a]).up()}),p.send(f)},d.prototype._JStoXML=function(a,b,c){var d=this;c.c(a),Object.keys(b).forEach(function(a){"object"==typeof b[a]?d._JStoXML(a,b[a],c):c.c(a).t(b[a]).up()}),c.up()},d.prototype._XMLtoJS=function(a,b,c){var d=this;a[b]={};for(var e=0,f=c.childNodes.length;f>e;e++)c.childNodes[e].childNodes.length>1?a[b]=d._XMLtoJS(a[b],c.childNodes[e].tagName,c.childNodes[e]):a[b][c.childNodes[e].tagName]=c.childNodes[e].textContent;return a},u&&(u.prototype.init=function(a,b){this.service=a,this.sessionID=b&&b.sessionID||Date.now(),this.type=b&&b.description?"answer":"offer",this.addStream(this.service.localStream),this.onicecandidate=this.onIceCandidateCallback,this.onaddstream=this.onRemoteStreamCallback,this.onsignalingstatechange=this.onSignalingStateCallback,this.oniceconnectionstatechange=this.onIceConnectionStateCallback,"answer"===this.type&&this.onRemoteSessionCallback(b.description,"offer")},u.prototype.getSessionDescription=function(a){function b(b){q.setLocalDescription(b,function(){a(null,b)},c)}function c(b){a(b,null)}"offer"===q.type?q.createOffer(b,c):q.createAnswer(b,c)},u.prototype.onIceCandidateCallback=function(a){var b=a.candidate;b&&(f("onICECandidate: "+JSON.stringify(b)),q.iceCandidates=q.iceCandidates||[],q.iceCandidates.push({sdpMLineIndex:b.sdpMLineIndex,sdpMid:b.sdpMid,candidate:b.candidate}))},u.prototype.onRemoteSessionCallback=function(a,b){var c=new v({sdp:a,type:b});this.setRemoteDescription(c);
},u.prototype.onRemoteStreamCallback=function(a){"function"==typeof q.service.onRemoteStreamListener&&q.service.onRemoteStreamListener(a.stream)},u.prototype.addCandidates=function(a){for(var b,c=0,d=a.length;d>c;c++)b={sdpMLineIndex:a[c].sdpMLineIndex,sdpMid:a[c].sdpMid,candidate:a[c].candidate},this.addIceCandidate(new w(b))},u.prototype.onSignalingStateCallback=function(){q&&"stable"===q.signalingState&&"offer"===q.type&&q.service._sendCandidate(q.opponentId,q.iceCandidates)},u.prototype.onIceConnectionStateCallback=function(){f("onIceConnectionStateCallback: "+q.iceConnectionState);var a=q.iceConnectionState;if("function"==typeof q.service.onSessionStateChangedListener){var b=null;"checking"===a?b=q.service.SessionState.CONNECTING:"connected"===a?b=q.service.SessionState.CONNECTED:"failed"===a?b=q.service.SessionState.FAILED:"disconnected"===a?b=q.service.SessionState.DISCONNECTED:"closed"===a&&(b=q.service.SessionState.CLOSED),null!=b&&q.service.onSessionStateChangedListener(b)}"closed"===a&&(q=null)}),e.prototype={getUserJid:function(a,b){return a+"-"+b+"@"+s.endpoints.chat},getIdFromNode:function(a){return a.indexOf("@")<0?null:parseInt(a.split("@")[0].split("-")[0])}},b.exports=d,Blob.prototype.download=function(){r(this,this.name,this.type)}},{"../../lib/download/download.min":14,"../../lib/strophe/strophe.min":15,"../qbConfig":9,"../qbUtils":13}],9:[function(a,b,c){var d={version:"1.17.2",creds:{appId:"",authKey:"",authSecret:""},endpoints:{api:"api.quickblox.com",chat:"chat.quickblox.com",muc:"muc.chat.quickblox.com"},chatProtocol:{bosh:"https://chat.quickblox.com:5281",websocket:"wss://chat.quickblox.com:5291",active:2},iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"stun:turn.quickblox.com",username:"quickblox",credential:"baccb97ba2d92d71e26eb9886da5f1e0"},{url:"turn:turn.quickblox.com:3478?transport=udp",username:"quickblox",credential:"baccb97ba2d92d71e26eb9886da5f1e0"},{url:"turn:turn.quickblox.com:3478?transport=tcp",username:"quickblox",credential:"baccb97ba2d92d71e26eb9886da5f1e0"}],webrtc:{answerTimeInterval:60,dialingTimeInterval:5},urls:{session:"session",login:"login",users:"users",chat:"chat",blobs:"blobs",geodata:"geodata",pushtokens:"push_tokens",subscriptions:"subscriptions",events:"events",data:"data",type:".json"},on:{sessionExpired:null},timeout:null,debug:{mode:0,file:null},addISOTime:!1};d.set=function(a){"object"==typeof a.endpoints&&a.endpoints.chat&&(d.endpoints.muc="muc."+a.endpoints.chat,d.chatProtocol.bosh="https://"+a.endpoints.chat+":5281",d.chatProtocol.websocket="wss://"+a.endpoints.chat+":5291"),Object.keys(a).forEach(function(b){"set"!==b&&d.hasOwnProperty(b)&&("object"!=typeof a[b]?d[b]=a[b]:Object.keys(a[b]).forEach(function(c){d[b].hasOwnProperty(c)&&(d[b][c]=a[b][c])}))})},b.exports=d},{}],10:[function(a,b,c){function d(){}var e=a("./qbConfig"),f=(a("./qbUtils"),"undefined"!=typeof window);d.prototype={init:function(b,c,d,g){g&&"object"==typeof g&&e.set(g);var h=a("./qbProxy");this.service=new h;var i=a("./modules/qbAuth"),j=a("./modules/qbUsers"),k=a("./modules/qbChat"),l=a("./modules/qbContent"),m=a("./modules/qbLocation"),n=a("./modules/qbPushNotifications"),o=a("./modules/qbData");if(f){var p=a("./qbStrophe"),q=new p,r=a("./modules/qbWebRTC");this.webrtc=new r(this.service,q||null)}this.auth=new i(this.service),this.users=new j(this.service),this.chat=new k(this.service,this.webrtc||null,q||null),this.content=new l(this.service),this.location=new m(this.service),this.pushnotifications=new n(this.service),this.data=new o(this.service),"string"!=typeof b||c&&"number"!=typeof c||d?(e.creds.appId=b,e.creds.authKey=c,e.creds.authSecret=d):("number"==typeof c&&(e.creds.appId=c),this.service.setSession({token:b}))},getSession:function(a){this.auth.getSession(a)},createSession:function(a,b){this.auth.createSession(a,b)},destroySession:function(a){this.auth.destroySession(a)},login:function(a,b){this.auth.login(a,b)},logout:function(a){this.auth.logout(a)}};var g=new d;g.QuickBlox=d,b.exports=g},{"./modules/qbAuth":1,"./modules/qbChat":2,"./modules/qbContent":3,"./modules/qbData":4,"./modules/qbLocation":5,"./modules/qbPushNotifications":6,"./modules/qbUsers":7,"./modules/qbWebRTC":8,"./qbConfig":9,"./qbProxy":11,"./qbStrophe":12,"./qbUtils":13}],11:[function(a,b,c){function d(){this.qbInst={config:e,session:null}}var e=a("./qbConfig"),f=a("./qbUtils"),g=e.version,h="undefined"!=typeof window;if(!h)var i=a("request");var j=h&&window.jQuery&&window.jQuery.ajax||h&&window.Zepto&&window.Zepto.ajax;if(h&&!j)throw new Error("Quickblox requires jQuery or Zepto");d.prototype={setSession:function(a){this.qbInst.session=a},getSession:function(){return this.qbInst.session},handleResponse:function(a,b,c,d){!a||"function"!=typeof e.on.sessionExpired||"Unauthorized"!==a.message&&"401 Unauthorized"!==a.status?a?c(a,null):(e.addISOTime&&(b=f.injectISOTimes(b)),c(null,b)):e.on.sessionExpired(function(){c(a,b)},d)},ajax:function(a,b){var c;a.data&&a.data.file?(c=JSON.parse(JSON.stringify(a)),c.data.file="..."):c=a,f.QBLog("[ServiceProxy]","Request: ",a.type||"GET",{data:JSON.stringify(c)});var d=this,k=function(c){c&&d.setSession(c),d.ajax(a,b)},l={url:a.url,type:a.type||"GET",dataType:a.dataType||"json",data:a.data||" ",timeout:e.timeout,beforeSend:function(a,b){-1===b.url.indexOf("s3.amazonaws.com")&&d.qbInst.session&&d.qbInst.session.token&&(a.setRequestHeader("QB-Token",d.qbInst.session.token),a.setRequestHeader("QB-SDK","JS "+g+" - Client"))},success:function(c,g,h){f.QBLog("[ServiceProxy]","Response: ",{data:JSON.stringify(c)}),-1===a.url.indexOf(e.urls.session)?d.handleResponse(null,c,b,k):b(null,c)},error:function(c,g,h){f.QBLog("[ServiceProxy]","ajax error",c.status,h,c.responseText);var i={code:c.status,status:g,message:h,detail:c.responseText};-1===a.url.indexOf(e.urls.session)?d.handleResponse(i,null,b,k):b(i,null)}};if(!h)var m="json"===l.dataType,n=-1===a.url.indexOf("s3.amazonaws.com")&&d.qbInst&&d.qbInst.session&&d.qbInst.session.token||!1,o={url:l.url,method:l.type,timeout:e.timeout,json:m?l.data:null,headers:n?{"QB-Token":d.qbInst.session.token,"QB-SDK":"JS "+g+" - Server"}:null},p=function(a,c,f){if(a||200!==c.statusCode&&201!==c.statusCode&&202!==c.statusCode){var g;try{g={code:c&&c.statusCode||a&&a.code,status:c&&c.headers&&c.headers.status||"error",message:f||a&&a.errno,detail:f&&f.errors||a&&a.syscall}}catch(h){g=a}-1===o.url.indexOf(e.urls.session)?d.handleResponse(g,null,b,k):b(g,null)}else-1===o.url.indexOf(e.urls.session)?d.handleResponse(null,f,b,k):b(null,f)};if(("boolean"==typeof a.contentType||"string"==typeof a.contentType)&&(l.contentType=a.contentType),"boolean"==typeof a.processData&&(l.processData=a.processData),h)j(l);else{var q=i(o,p);if(!m){var r=q.form();Object.keys(l.data).forEach(function(a,b,c){r.append(a,l.data[a])})}}}},b.exports=d},{"./qbConfig":9,"./qbUtils":13,request:20}],12:[function(a,b,c){function d(){var a=1===e.chatProtocol.active?e.chatProtocol.bosh:e.chatProtocol.websocket,b=new Strophe.Connection(a);return 1===e.chatProtocol.active?(b.xmlInput=function(a){if(a.childNodes[0])for(var b=0,c=a.childNodes.length;c>b;b++)f.QBLog("[QBChat]","RECV:",a.childNodes[b])},b.xmlOutput=function(a){if(a.childNodes[0])for(var b=0,c=a.childNodes.length;c>b;b++)f.QBLog("[QBChat]","SENT:",a.childNodes[b])}):(b.xmlInput=function(a){f.QBLog("[QBChat]","RECV:",a)},b.xmlOutput=function(a){f.QBLog("[QBChat]","SENT:",a)}),b}a("../lib/strophe/strophe.min");var e=a("./qbConfig"),f=a("./qbUtils");b.exports=d},{"../lib/strophe/strophe.min":15,"./qbConfig":9,"./qbUtils":13}],13:[function(a,b,c){var d=a("./qbConfig"),e="undefined"!=typeof window,f="This function isn't supported outside of the browser (...yet)";if(!e)var g=a("fs");var h={machine:Math.floor(16777216*Math.random()).toString(16),pid:Math.floor(32767*Math.random()).toString(16),increment:0},i={safeCallbackCall:function(){if(!e)throw f;for(var a,b=arguments[0].toString(),c=b.split("(")[0].split(" ")[1],d=[],g=0;g<arguments.length;g++)d.push(arguments[g]);a=d.shift();try{a.apply(null,d)}catch(h){""===c?console.error("Error: "+h):console.error("Error in listener "+c+": "+h)}},randomNonce:function(){return Math.floor(1e4*Math.random())},unixTime:function(){return Math.floor(Date.now()/1e3)},getUrl:function(a,b){var c=b?"/"+b:"";return"https://"+d.endpoints.api+"/"+a+c+d.urls.type},getBsonObjectId:function(){var a=this.unixTime().toString(16),b=(h.increment++).toString(16);return b>16777215&&(h.increment=0),"00000000".substr(0,8-a.length)+a+"000000".substr(0,6-h.machine.length)+h.machine+"0000".substr(0,4-h.pid.length)+h.pid+"000000".substr(0,6-b.length)+b},injectISOTimes:function(a){if(a.created_at)"number"==typeof a.created_at&&(a.iso_created_at=new Date(1e3*a.created_at).toISOString()),"number"==typeof a.updated_at&&(a.iso_updated_at=new Date(1e3*a.updated_at).toISOString());else if(a.items)for(var b=0,c=a.items.length;c>b;++b)"number"==typeof a.items[b].created_at&&(a.items[b].iso_created_at=new Date(1e3*a.items[b].created_at).toISOString()),"number"==typeof a.items[b].updated_at&&(a.items[b].iso_updated_at=new Date(1e3*a.items[b].updated_at).toISOString());return a},QBLog:function(){if(this.loggers)for(var a=0;a<this.loggers.length;++a)this.loggers[a](arguments);else{this.loggers=[];var b=function(){var a=function(a){console.log.apply(console,Array.prototype.slice.call(a))};return a},c=function(){var a=function(a){if(e)throw f;for(var b=[],c=0;c<a.length;c++)b.push(JSON.stringify(a[c]));b=b.join(" ");var h="\n"+new Date+". "+b;g.appendFile(d.debug.file,h,function(a){return a?console.error("Error while writing log to file. Error: "+a):void 0})};return a};if("object"==typeof d.debug){if("number"==typeof d.debug.mode){if(1==d.debug.mode){var h=b();this.loggers.push(h)}else if(2==d.debug.mode){var h=c();this.loggers.push(h)}}else if("object"==typeof d.debug.mode){var i=this;d.debug.mode.forEach(function(a,d,e){if(1===a){var f=b();i.loggers.push(f)}else if(2===a){var f=c();i.loggers.push(f)}})}}else if("boolean"==typeof d.debug&&d.debug){var h=b();this.loggers.push(h)}if(this.loggers)for(var a=0;a<this.loggers.length;++a)this.loggers[a](arguments)}}};b.exports=i},{"./qbConfig":9,fs:20}],14:[function(a,b,c){function d(a,b,c){function d(a){var b=a.split(/[:;,]/),c=b[1],d="base64"==b[2]?atob:decodeURIComponent,e=d(b.pop()),f=e.length,g=0,h=new Uint8Array(f);for(g;f>g;++g)h[g]=e.charCodeAt(g);return new m([h],{type:c})}function e(a,b){if("download"in k)return k.href=a,k.setAttribute("download",p),k.innerHTML="downloading...",j.body.appendChild(k),setTimeout(function(){k.click(),j.body.removeChild(k),b===!0&&setTimeout(function(){f.URL.revokeObjectURL(k.href)},250)},66),!0;if("undefined"!=typeof safari)return a="data:"+a.replace(/^data:([\w\/\-\+]+)/,g),window.open(a)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=a),!0;var c=j.createElement("iframe");j.body.appendChild(c),b||(a="data:"+a.replace(/^data:([\w\/\-\+]+)/,g)),c.src=a,setTimeout(function(){j.body.removeChild(c)},333)}var f=window,g="application/octet-stream",h=c||g,i=a,j=document,k=j.createElement("a"),l=function(a){return String(a)},m=f.Blob||f.MozBlob||f.WebKitBlob||l;m=m.call?m.bind(f):Blob;var n,o,p=b||"download";if("true"===String(this)&&(i=[i,h],h=i[0],i=i[1]),String(i).match(/^data\:[\w+\-]+\/[\w+\-]+[,;]/))return navigator.msSaveBlob?navigator.msSaveBlob(d(i),p):e(i);if(n=i instanceof m?i:new m([i],{type:h}),navigator.msSaveBlob)return navigator.msSaveBlob(n,p);if(f.URL)e(f.URL.createObjectURL(n),!0);else{if("string"==typeof n||n.constructor===l)try{return e("data:"+h+";base64,"+f.btoa(n))}catch(q){return e("data:"+h+","+encodeURIComponent(n))}o=new FileReader,o.onload=function(){e(this.result)},o.readAsDataURL(n)}return!0}b.exports=d},{}],15:[function(b,c,d){!function(b){return function(b,c){"function"==typeof a&&a.amd?a("strophe-base64",function(){return c()}):b.Base64=c()}(this,function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b={encode:function(b){var c,d,e,f,g,h,i,j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),e=b.charCodeAt(k++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?(g=(3&c)<<4,h=i=64):isNaN(e)&&(i=64),j=j+a.charAt(f)+a.charAt(g)+a.charAt(h)+a.charAt(i);while(k<b.length);return j},decode:function(b){var c,d,e,f,g,h,i,j="",k=0;b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),h=a.indexOf(b.charAt(k++)),i=a.indexOf(b.charAt(k++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,j+=String.fromCharCode(c),64!=h&&(j+=String.fromCharCode(d)),64!=i&&(j+=String.fromCharCode(e));while(k<b.length);return j}};return b}),function(b,c){"function"==typeof a&&a.amd?a("strophe-sha1",function(){return c()}):b.SHA1=c()}(this,function(){function a(a,d){a[d>>5]|=128<<24-d%32,a[(d+64>>9<<4)+15]=d;var g,h,i,j,k,l,m,n,o=new Array(80),p=1732584193,q=-271733879,r=-1732584194,s=271733878,t=-1009589776;for(g=0;g<a.length;g+=16){for(j=p,k=q,l=r,m=s,n=t,h=0;80>h;h++)16>h?o[h]=a[g+h]:o[h]=f(o[h-3]^o[h-8]^o[h-14]^o[h-16],1),i=e(e(f(p,5),b(h,q,r,s)),e(e(t,o[h]),c(h))),t=s,s=r,r=f(q,30),q=p,p=i;p=e(p,j),q=e(q,k),r=e(r,l),s=e(s,m),t=e(t,n)}return[p,q,r,s,t]}function b(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function c(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function d(b,c){var d=g(b);d.length>16&&(d=a(d,8*b.length));for(var e=new Array(16),f=new Array(16),h=0;16>h;h++)e[h]=909522486^d[h],f[h]=1549556828^d[h];var i=a(e.concat(g(c)),512+8*c.length);return a(f.concat(i),672)}function e(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function f(a,b){return a<<b|a>>>32-b}function g(a){for(var b=[],c=255,d=0;d<8*a.length;d+=8)b[d>>5]|=(a.charCodeAt(d/8)&c)<<24-d%32;return b}function h(a){for(var b="",c=255,d=0;d<32*a.length;d+=8)b+=String.fromCharCode(a[d>>5]>>>24-d%32&c);return b}function i(a){for(var b,c,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e="",f=0;f<4*a.length;f+=3)for(b=(a[f>>2]>>8*(3-f%4)&255)<<16|(a[f+1>>2]>>8*(3-(f+1)%4)&255)<<8|a[f+2>>2]>>8*(3-(f+2)%4)&255,c=0;4>c;c++)e+=8*f+6*c>32*a.length?"=":d.charAt(b>>6*(3-c)&63);return e}return{b64_hmac_sha1:function(a,b){return i(d(a,b))},b64_sha1:function(b){return i(a(g(b),8*b.length))},binb2str:h,core_hmac_sha1:d,str_hmac_sha1:function(a,b){return h(d(a,b))},str_sha1:function(b){return h(a(g(b),8*b.length))}}}),function(b,c){"function"==typeof a&&a.amd?a("strophe-md5",function(){return c()}):b.MD5=c()}(this,function(a){var b=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},c=function(a,b){return a<<b|a>>>32-b},d=function(a){for(var b=[],c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32;return b},e=function(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b},f=function(a){for(var b="0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>d%4*8+4&15)+b.charAt(a[d>>2]>>d%4*8&15);return c},g=function(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)},h=function(a,b,c,d,e,f,h){return g(b&c|~b&d,a,b,e,f,h)},i=function(a,b,c,d,e,f,h){return g(b&d|c&~d,a,b,e,f,h)},j=function(a,b,c,d,e,f,h){return g(b^c^d,a,b,e,f,h)},k=function(a,b,c,d,e,f,h){return g(c^(b|~d),a,b,e,f,h)},l=function(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;for(var d,e,f,g,l=1732584193,m=-271733879,n=-1732584194,o=271733878,p=0;p<a.length;p+=16)d=l,e=m,f=n,g=o,l=h(l,m,n,o,a[p+0],7,-680876936),o=h(o,l,m,n,a[p+1],12,-389564586),n=h(n,o,l,m,a[p+2],17,606105819),m=h(m,n,o,l,a[p+3],22,-1044525330),l=h(l,m,n,o,a[p+4],7,-176418897),o=h(o,l,m,n,a[p+5],12,1200080426),n=h(n,o,l,m,a[p+6],17,-1473231341),m=h(m,n,o,l,a[p+7],22,-45705983),l=h(l,m,n,o,a[p+8],7,1770035416),o=h(o,l,m,n,a[p+9],12,-1958414417),n=h(n,o,l,m,a[p+10],17,-42063),m=h(m,n,o,l,a[p+11],22,-1990404162),l=h(l,m,n,o,a[p+12],7,1804603682),o=h(o,l,m,n,a[p+13],12,-40341101),n=h(n,o,l,m,a[p+14],17,-1502002290),m=h(m,n,o,l,a[p+15],22,1236535329),l=i(l,m,n,o,a[p+1],5,-165796510),o=i(o,l,m,n,a[p+6],9,-1069501632),n=i(n,o,l,m,a[p+11],14,643717713),m=i(m,n,o,l,a[p+0],20,-373897302),l=i(l,m,n,o,a[p+5],5,-701558691),o=i(o,l,m,n,a[p+10],9,38016083),n=i(n,o,l,m,a[p+15],14,-660478335),m=i(m,n,o,l,a[p+4],20,-405537848),l=i(l,m,n,o,a[p+9],5,568446438),o=i(o,l,m,n,a[p+14],9,-1019803690),n=i(n,o,l,m,a[p+3],14,-187363961),m=i(m,n,o,l,a[p+8],20,1163531501),l=i(l,m,n,o,a[p+13],5,-1444681467),o=i(o,l,m,n,a[p+2],9,-51403784),n=i(n,o,l,m,a[p+7],14,1735328473),m=i(m,n,o,l,a[p+12],20,-1926607734),l=j(l,m,n,o,a[p+5],4,-378558),o=j(o,l,m,n,a[p+8],11,-2022574463),n=j(n,o,l,m,a[p+11],16,1839030562),m=j(m,n,o,l,a[p+14],23,-35309556),l=j(l,m,n,o,a[p+1],4,-1530992060),o=j(o,l,m,n,a[p+4],11,1272893353),n=j(n,o,l,m,a[p+7],16,-155497632),m=j(m,n,o,l,a[p+10],23,-1094730640),l=j(l,m,n,o,a[p+13],4,681279174),o=j(o,l,m,n,a[p+0],11,-358537222),n=j(n,o,l,m,a[p+3],16,-722521979),m=j(m,n,o,l,a[p+6],23,76029189),l=j(l,m,n,o,a[p+9],4,-640364487),o=j(o,l,m,n,a[p+12],11,-421815835),n=j(n,o,l,m,a[p+15],16,530742520),m=j(m,n,o,l,a[p+2],23,-995338651),l=k(l,m,n,o,a[p+0],6,-198630844),o=k(o,l,m,n,a[p+7],10,1126891415),n=k(n,o,l,m,a[p+14],15,-1416354905),m=k(m,n,o,l,a[p+5],21,-57434055),l=k(l,m,n,o,a[p+12],6,1700485571),o=k(o,l,m,n,a[p+3],10,-1894986606),n=k(n,o,l,m,a[p+10],15,-1051523),m=k(m,n,o,l,a[p+1],21,-2054922799),l=k(l,m,n,o,a[p+8],6,1873313359),o=k(o,l,m,n,a[p+15],10,-30611744),n=k(n,o,l,m,a[p+6],15,-1560198380),m=k(m,n,o,l,a[p+13],21,1309151649),l=k(l,m,n,o,a[p+4],6,-145523070),o=k(o,l,m,n,a[p+11],10,-1120210379),n=k(n,o,l,m,a[p+2],15,718787259),m=k(m,n,o,l,a[p+9],21,-343485551),l=b(l,d),m=b(m,e),n=b(n,f),o=b(o,g);return[l,m,n,o]},m={hexdigest:function(a){return f(l(d(a),8*a.length))},hash:function(a){return e(l(d(a),8*a.length))}};return m}),Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice,d=Array.prototype.concat,e=c.call(arguments,1);return function(){return b.apply(a?a:this,d.call(e,c.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),function(b,c){if("function"==typeof a&&a.amd)a("strophe-core",["strophe-sha1","strophe-base64","strophe-md5","strophe-polyfill"],function(){return c.apply(this,arguments)});else{var d=c(b.SHA1,b.Base64,b.MD5);window.Strophe=d.Strophe,window.$build=d.$build,window.$iq=d.$iq,window.$msg=d.$msg,window.$pres=d.$pres,window.SHA1=d.SHA1,window.Base64=d.Base64,window.MD5=d.MD5,window.b64_hmac_sha1=d.SHA1.b64_hmac_sha1,window.b64_sha1=d.SHA1.b64_sha1,window.str_hmac_sha1=d.SHA1.str_hmac_sha1,window.str_sha1=d.SHA1.str_sha1}}(this,function(a,b,c){function d(a,b){return new h.Builder(a,b)}function e(a){return new h.Builder("message",a)}function f(a){return new h.Builder("iq",a)}function g(a){return new h.Builder("presence",a)}var h;return h={VERSION:"1.2.2",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(a){for(var b=0;b<h.XHTML.tags.length;b++)if(a==h.XHTML.tags[b])return!0;return!1},validAttribute:function(a,b){if("undefined"!=typeof h.XHTML.attributes[a]&&h.XHTML.attributes[a].length>0)for(var c=0;c<h.XHTML.attributes[a].length;c++)if(b==h.XHTML.attributes[a][c])return!0;return!1},validCSS:function(a){for(var b=0;b<h.XHTML.css.length;b++)if(a==h.XHTML.css[b])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(a,b){h.NS[a]=b},forEachChild:function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++)e=a.childNodes[d],e.nodeType!=h.ElementType.NORMAL||b&&!this.isTagEqual(e,b)||c(e)},isTagEqual:function(a,b){return a.tagName==b},_xmlGenerator:null,_makeGenerator:function(){var a;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(a=this._getIEXmlDom(),a.appendChild(a.createElement("strophe"))):a=document.implementation.createDocument("jabber:client","strophe",null),a},xmlGenerator:function(){return h._xmlGenerator||(h._xmlGenerator=h._makeGenerator()),h._xmlGenerator},_getIEXmlDom:function(){for(var a=null,b=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],c=0;c<b.length&&null===a;c++)try{a=new ActiveXObject(b[c])}catch(d){a=null}return a},xmlElement:function(a){if(!a)return null;var b,c,d,e=h.xmlGenerator().createElement(a);for(b=1;b<arguments.length;b++){var f=arguments[b];if(f)if("string"==typeof f||"number"==typeof f)e.appendChild(h.xmlTextNode(f));else if("object"==typeof f&&"function"==typeof f.sort)for(c=0;c<f.length;c++){var g=f[c];"object"==typeof g&&"function"==typeof g.sort&&void 0!==g[1]&&e.setAttribute(g[0],g[1])}else if("object"==typeof f)for(d in f)f.hasOwnProperty(d)&&void 0!==f[d]&&e.setAttribute(d,f[d])}return e},xmlescape:function(a){return a=a.replace(/\&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/'/g,"&apos;"),a=a.replace(/"/g,"&quot;")},xmlunescape:function(a){return a=a.replace(/\&amp;/g,"&"),a=a.replace(/&lt;/g,"<"),a=a.replace(/&gt;/g,">"),a=a.replace(/&apos;/g,"'"),a=a.replace(/&quot;/g,'"')},xmlTextNode:function(a){return h.xmlGenerator().createTextNode(a)},xmlHtmlNode:function(a){var b;if(window.DOMParser){var c=new DOMParser;b=c.parseFromString(a,"text/xml")}else b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},getText:function(a){if(!a)return null;var b="";0===a.childNodes.length&&a.nodeType==h.ElementType.TEXT&&(b+=a.nodeValue);for(var c=0;c<a.childNodes.length;c++)a.childNodes[c].nodeType==h.ElementType.TEXT&&(b+=a.childNodes[c].nodeValue);return h.xmlescape(b)},copyElement:function(a){var b,c;if(a.nodeType==h.ElementType.NORMAL){for(c=h.xmlElement(a.tagName),b=0;b<a.attributes.length;b++)c.setAttribute(a.attributes[b].nodeName,a.attributes[b].value);for(b=0;b<a.childNodes.length;b++)c.appendChild(h.copyElement(a.childNodes[b]))}else a.nodeType==h.ElementType.TEXT&&(c=h.xmlGenerator().createTextNode(a.nodeValue));return c},createHtml:function(a){var b,c,d,e,f,g,i,j,k,l,m;if(a.nodeType==h.ElementType.NORMAL)if(e=a.nodeName.toLowerCase(),h.XHTML.validTag(e))try{for(c=h.xmlElement(e),b=0;b<h.XHTML.attributes[e].length;b++)if(f=h.XHTML.attributes[e][b],g=a.getAttribute(f),"undefined"!=typeof g&&null!==g&&""!==g&&g!==!1&&0!==g)if("style"==f&&"object"==typeof g&&"undefined"!=typeof g.cssText&&(g=g.cssText),"style"==f){for(i=[],j=g.split(";"),d=0;d<j.length;d++)k=j[d].split(":"),l=k[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),h.XHTML.validCSS(l)&&(m=k[1].replace(/^\s*/,"").replace(/\s*$/,""),i.push(l+": "+m));i.length>0&&(g=i.join("; "),c.setAttribute(f,g))}else c.setAttribute(f,g);for(b=0;b<a.childNodes.length;b++)c.appendChild(h.createHtml(a.childNodes[b]))}catch(n){c=h.xmlTextNode("")}else for(c=h.xmlGenerator().createDocumentFragment(),b=0;b<a.childNodes.length;b++)c.appendChild(h.createHtml(a.childNodes[b]));else if(a.nodeType==h.ElementType.FRAGMENT)for(c=h.xmlGenerator().createDocumentFragment(),b=0;b<a.childNodes.length;b++)c.appendChild(h.createHtml(a.childNodes[b]));else a.nodeType==h.ElementType.TEXT&&(c=h.xmlTextNode(a.nodeValue));return c},escapeNode:function(a){return"string"!=typeof a?a:a.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(a){return"string"!=typeof a?a:a.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(a){return a.indexOf("@")<0?null:a.split("@")[0]},getDomainFromJid:function(a){var b=h.getBareJidFromJid(a);if(b.indexOf("@")<0)return b;var c=b.split("@");return c.splice(0,1),c.join("@")},getResourceFromJid:function(a){var b=a.split("/");return b.length<2?null:(b.splice(0,1),b.join("/"))},getBareJidFromJid:function(a){return a?a.split("/")[0]:null},log:function(a,b){},debug:function(a){this.log(this.LogLevel.DEBUG,a)},info:function(a){this.log(this.LogLevel.INFO,a)},warn:function(a){this.log(this.LogLevel.WARN,a)},error:function(a){this.log(this.LogLevel.ERROR,a)},fatal:function(a){this.log(this.LogLevel.FATAL,a)},serialize:function(a){var b;if(!a)return null;"function"==typeof a.tree&&(a=a.tree());var c,d,e=a.nodeName;for(a.getAttribute("_realname")&&(e=a.getAttribute("_realname")),b="<"+e,c=0;c<a.attributes.length;c++)"_realname"!=a.attributes[c].nodeName&&(b+=" "+a.attributes[c].nodeName+"='"+a.attributes[c].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'");if(a.childNodes.length>0){for(b+=">",c=0;c<a.childNodes.length;c++)switch(d=a.childNodes[c],d.nodeType){case h.ElementType.NORMAL:b+=h.serialize(d);break;case h.ElementType.TEXT:b+=h.xmlescape(d.nodeValue);break;case h.ElementType.CDATA:b+="<![CDATA["+d.nodeValue+"]]>"}b+="</"+e+">"}else b+="/>";return b},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(a,b){h._connectionPlugins[a]=b}},h.Builder=function(a,b){("presence"==a||"message"==a||"iq"==a)&&(b&&!b.xmlns?b.xmlns=h.NS.CLIENT:b||(b={xmlns:h.NS.CLIENT})),this.nodeTree=h.xmlElement(a,b),this.node=this.nodeTree},h.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return h.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(a){for(var b in a)a.hasOwnProperty(b)&&(void 0===a[b]?this.node.removeAttribute(b):this.node.setAttribute(b,a[b]));return this},c:function(a,b,c){var d=h.xmlElement(a,b,c);return this.node.appendChild(d),"string"!=typeof c&&(this.node=d),this},cnode:function(a){var b,c=h.xmlGenerator();try{b=void 0!==c.importNode}catch(d){b=!1}var e=b?c.importNode(a,!0):h.copyElement(a);return this.node.appendChild(e),this.node=e,this},t:function(a){var b=h.xmlTextNode(a);return this.node.appendChild(b),this},h:function(a){var b=document.createElement("body");b.innerHTML=a;for(var c=h.createHtml(b);c.childNodes.length>0;)this.node.appendChild(c.childNodes[0]);return this}},h.Handler=function(a,b,c,d,e,f,g){this.handler=a,this.ns=b,this.name=c,this.type=d,this.id=e,this.options=g||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.options.matchBare?this.from=f?h.getBareJidFromJid(f):null:this.from=f,this.user=!0},h.Handler.prototype={isMatch:function(a){var b,c=null;if(c=this.options.matchBare?h.getBareJidFromJid(a.getAttribute("from")):a.getAttribute("from"),b=!1,this.ns){var d=this;h.forEachChild(a,null,function(a){a.getAttribute("xmlns")==d.ns&&(b=!0)}),b=b||a.getAttribute("xmlns")==this.ns}else b=!0;var e=a.getAttribute("type");return!b||this.name&&!h.isTagEqual(a,this.name)||this.type&&(Array.isArray(this.type)?-1==this.type.indexOf(e):e!=this.type)||this.id&&a.getAttribute("id")!=this.id||this.from&&c!=this.from?!1:!0},run:function(a){var b=null;try{b=this.handler(a)}catch(c){throw c.sourceURL?h.fatal("error: "+this.handler+" "+c.sourceURL+":"+c.line+" - "+c.name+": "+c.message):c.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",c,c.message)),h.fatal("error: "+this.handler+" "+c.fileName+":"+c.lineNumber+" - "+c.name+": "+c.message)):h.fatal("error: "+c.message+"\n"+c.stack),c}return b},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},h.TimedHandler=function(a,b){this.period=a,this.handler=b,this.lastCalled=(new Date).getTime(),this.user=!0},h.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},h.Connection=function(a,b){this.service=a,this.options=b||{};var c=this.options.protocol||"";0===a.indexOf("ws:")||0===a.indexOf("wss:")||0===c.indexOf("ws")?this._proto=new h.Websocket(this):this._proto=new h.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var d in h._connectionPlugins)if(h._connectionPlugins.hasOwnProperty(d)){var e=h._connectionPlugins[d],f=function(){};f.prototype=e,this[d]=new f,this[d].init(this)}},h.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(a){return"string"==typeof a||"number"==typeof a?++this._uniqueId+":"+a:++this._uniqueId+""},connect:function(a,b,c,d,e,f,g){this.jid=a,this.authzid=h.getBareJidFromJid(this.jid),this.authcid=g||h.getNodeFromJid(this.jid),this.pass=b,this.servtype="xmpp",this.connect_callback=c,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=h.getDomainFromJid(this.jid),this._changeConnectStatus(h.Status.CONNECTING,null),this._proto._connect(d,e,f)},attach:function(a,b,c,d,e,f,g){if(!(this._proto instanceof h.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(a,b,c,d,e,f,g)},restore:function(a,b,c,d,e){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(a,b,c,d,e)},_sessionCachingSupported:function(){if(this._proto instanceof h.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem("_strophe_","_strophe_"),window.sessionStorage.removeItem("_strophe_");
}catch(a){return!1}return!0}return!1},xmlInput:function(a){},xmlOutput:function(a){},rawInput:function(a){},rawOutput:function(a){},send:function(a){if(null!==a){if("function"==typeof a.sort)for(var b=0;b<a.length;b++)this._queueData(a[b]);else this._queueData("function"==typeof a.tree?a.tree():a);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(a,b,c,d){var e=null,f=this;"function"==typeof a.tree&&(a=a.tree());var g=a.getAttribute("id");g||(g=this.getUniqueId("sendIQ"),a.setAttribute("id",g));var i=a.getAttribute("to"),j=this.jid,k=this.addHandler(function(a){e&&f.deleteTimedHandler(e);var d=!1,g=a.getAttribute("from");if((g===i||null===i&&(g===h.getBareJidFromJid(j)||g===h.getDomainFromJid(j)||g===j))&&(d=!0),!d)throw{name:"StropheError",message:"Got answer to IQ from wrong jid:"+g+"\nExpected jid: "+i};var k=a.getAttribute("type");if("result"==k)b&&b(a);else{if("error"!=k)throw{name:"StropheError",message:"Got bad IQ type of "+k};c&&c(a)}},null,"iq",["error","result"],g);return d&&(e=this.addTimedHandler(d,function(){return f.deleteHandler(k),c&&c(null),!1})),this.send(a),g},_queueData:function(a){if(null===a||!a.tagName||!a.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(a)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(a,b){var c=new h.TimedHandler(a,b);return this.addTimeds.push(c),c},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,b,c,d,e,f,g){var i=new h.Handler(a,b,c,d,e,f,g);return this.addHandlers.push(i),i},deleteHandler:function(a){this.removeHandlers.push(a);var b=this.addHandlers.indexOf(a);b>=0&&this.addHandlers.splice(b,1)},disconnect:function(a){if(this._changeConnectStatus(h.Status.DISCONNECTING,a),h.info("Disconnect was called because: "+a),this.connected){var b=!1;this.disconnecting=!0,this.authenticated&&(b=g({xmlns:h.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(b)}else h.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests()},_changeConnectStatus:function(a,b){for(var c in h._connectionPlugins)if(h._connectionPlugins.hasOwnProperty(c)){var d=this[c];if(d.statusChanged)try{d.statusChanged(a,b)}catch(e){h.error(""+c+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(a,b)}catch(f){h.error("User connection callback caused an exception: "+f)}},_doDisconnect:function(a){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),h.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(h.Status.DISCONNECTED,a),this.connected=!1},_dataRecv:function(a,b){h.info("_dataRecv called");var c=this._proto._reqToData(a);if(null!==c){this.xmlInput!==h.Connection.prototype.xmlInput&&this.xmlInput(c.nodeName===this._proto.strip&&c.childNodes.length?c.childNodes[0]:c),this.rawInput!==h.Connection.prototype.rawInput&&this.rawInput(b?b:h.serialize(c));for(var d,e;this.removeHandlers.length>0;)e=this.removeHandlers.pop(),d=this.handlers.indexOf(e),d>=0&&this.handlers.splice(d,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var f,g,i=c.getAttribute("type");if(null!==i&&"terminate"==i){if(this.disconnecting)return;return f=c.getAttribute("condition"),g=c.getElementsByTagName("conflict"),null!==f?("remote-stream-error"==f&&g.length>0&&(f="conflict"),this._changeConnectStatus(h.Status.CONNFAIL,f)):this._changeConnectStatus(h.Status.CONNFAIL,"unknown"),void this._doDisconnect(f)}var j=this;h.forEachChild(c,null,function(a){var b,c;for(c=j.handlers,j.handlers=[],b=0;b<c.length;b++){var d=c[b];try{!d.isMatch(a)||!j.authenticated&&d.user?j.handlers.push(d):d.run(a)&&j.handlers.push(d)}catch(e){h.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}},mechanisms:{},_connect_cb:function(a,b,c){h.info("_connect_cb was called"),this.connected=!0;var d=this._proto._reqToData(a);if(d){this.xmlInput!==h.Connection.prototype.xmlInput&&this.xmlInput(d.nodeName===this._proto.strip&&d.childNodes.length?d.childNodes[0]:d),this.rawInput!==h.Connection.prototype.rawInput&&this.rawInput(c?c:h.serialize(d));var e=this._proto._connect_cb(d);if(e!==h.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var f;f=d.getElementsByTagNameNS?d.getElementsByTagNameNS(h.NS.STREAM,"features").length>0:d.getElementsByTagName("stream:features").length>0||d.getElementsByTagName("features").length>0;var g,i,j=d.getElementsByTagName("mechanism"),k=[],l=!1;if(!f)return void this._proto._no_auth_received(b);if(j.length>0)for(g=0;g<j.length;g++)i=h.getText(j[g]),this.mechanisms[i]&&k.push(this.mechanisms[i]);return this._authentication.legacy_auth=d.getElementsByTagName("auth").length>0,(l=this._authentication.legacy_auth||k.length>0)?void(this.do_authentication!==!1&&this.authenticate(k)):void this._proto._no_auth_received(b)}}},authenticate:function(a){var c;for(c=0;c<a.length-1;++c){for(var e=c,g=c+1;g<a.length;++g)a[g].prototype.priority>a[e].prototype.priority&&(e=g);if(e!=c){var i=a[c];a[c]=a[e],a[e]=i}}var j=!1;for(c=0;c<a.length;++c)if(a[c].test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new a[c],this._sasl_mechanism.onStart(this);var k=d("auth",{xmlns:h.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var l=this._sasl_mechanism.onChallenge(this,null);k.t(b.encode(l))}this.send(k.tree()),j=!0;break}j||(null===h.getNodeFromJid(this.jid)?(this._changeConnectStatus(h.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(h.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(f({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:h.NS.AUTH}).c("username",{}).t(h.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(a){var c=b.decode(h.getText(a)),e=this._sasl_mechanism.onChallenge(this,c),f=d("response",{xmlns:h.NS.SASL});return""!==e&&f.t(b.encode(e)),this.send(f.tree()),!0},_auth1_cb:function(a){var b=f({type:"set",id:"_auth_2"}).c("query",{xmlns:h.NS.AUTH}).c("username",{}).t(h.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return h.getResourceFromJid(this.jid)||(this.jid=h.getBareJidFromJid(this.jid)+"/strophe"),b.up().c("resource",{}).t(h.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(b.tree()),!1},_sasl_success_cb:function(a){if(this._sasl_data["server-signature"]){var c,d=b.decode(h.getText(a)),e=/([a-z]+)=([^,]+)(,|$)/,f=d.match(e);if("v"==f[1]&&(c=f[2]),c!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}h.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var g=[],i=function(a,b){for(;a.length;)this.deleteHandler(a.pop());return this._sasl_auth1_cb.bind(this)(b),!1};return g.push(this._addSysHandler(function(a){i.bind(this)(g,a)}.bind(this),null,"stream:features",null,null)),g.push(this._addSysHandler(function(a){i.bind(this)(g,a)}.bind(this),h.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(a){this.features=a;var b,c;for(b=0;b<a.childNodes.length;b++)c=a.childNodes[b],"bind"==c.nodeName&&(this.do_bind=!0),"session"==c.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(h.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var d=h.getResourceFromJid(this.jid);return this.send(d?f({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:h.NS.BIND}).c("resource",{}).t(d).tree():f({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:h.NS.BIND}).tree()),!1},_sasl_bind_cb:function(a){if("error"==a.getAttribute("type")){h.info("SASL binding failed.");var b,c=a.getElementsByTagName("conflict");return c.length>0&&(b="conflict"),this._changeConnectStatus(h.Status.AUTHFAIL,b),!1}var d,e=a.getElementsByTagName("bind");return e.length>0?(d=e[0].getElementsByTagName("jid"),void(d.length>0&&(this.jid=h.getText(d[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(f({type:"set",id:"_session_auth_2"}).c("session",{xmlns:h.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(h.Status.CONNECTED,null))))):(h.info("SASL binding failed."),this._changeConnectStatus(h.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(a){if("result"==a.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(h.Status.CONNECTED,null);else if("error"==a.getAttribute("type"))return h.info("Session creation failed."),this._changeConnectStatus(h.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(a){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(h.Status.AUTHFAIL,null),!1},_auth2_cb:function(a){return"result"==a.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(h.Status.CONNECTED,null)):"error"==a.getAttribute("type")&&(this._changeConnectStatus(h.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(a,b){var c=new h.TimedHandler(a,b);return c.user=!1,this.addTimeds.push(c),c},_addSysHandler:function(a,b,c,d,e){var f=new h.Handler(a,b,c,d,e);return f.user=!1,this.addHandlers.push(f),f},_onDisconnectTimeout:function(){return h.info("_onDisconnectTimeout was called"),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var a,b,c,d;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)b=this.removeTimeds.pop(),a=this.timedHandlers.indexOf(b),a>=0&&this.timedHandlers.splice(a,1);var e=(new Date).getTime();for(d=[],a=0;a<this.timedHandlers.length;a++)b=this.timedHandlers[a],(this.authenticated||!b.user)&&(c=b.lastCalled+b.period,0>=c-e?b.run()&&d.push(b):d.push(b));this.timedHandlers=d,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(this._onIdle.bind(this),100))}},h.SASLMechanism=function(a,b,c){this.name=a,this.isClientFirst=b,this.priority=c},h.SASLMechanism.prototype={test:function(a){return!0},onStart:function(a){this._connection=a},onChallenge:function(a,b){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},h.SASLAnonymous=function(){},h.SASLAnonymous.prototype=new h.SASLMechanism("ANONYMOUS",!1,10),h.SASLAnonymous.test=function(a){return null===a.authcid},h.Connection.prototype.mechanisms[h.SASLAnonymous.prototype.name]=h.SASLAnonymous,h.SASLPlain=function(){},h.SASLPlain.prototype=new h.SASLMechanism("PLAIN",!0,20),h.SASLPlain.test=function(a){return null!==a.authcid},h.SASLPlain.prototype.onChallenge=function(a){var b=a.authzid;return b+="\x00",b+=a.authcid,b+="\x00",b+=a.pass},h.Connection.prototype.mechanisms[h.SASLPlain.prototype.name]=h.SASLPlain,h.SASLSHA1=function(){},h.SASLSHA1.prototype=new h.SASLMechanism("SCRAM-SHA-1",!0,40),h.SASLSHA1.test=function(a){return null!==a.authcid},h.SASLSHA1.prototype.onChallenge=function(d,e,f){var g=f||c.hexdigest(1234567890*Math.random()),h="n="+d.authcid;return h+=",r=",h+=g,d._sasl_data.cnonce=g,d._sasl_data["client-first-message-bare"]=h,h="n,,"+h,this.onChallenge=function(c,d){for(var e,f,g,h,i,j,k,l,m,n,o,p="c=biws,",q=c._sasl_data["client-first-message-bare"]+","+d+",",r=c._sasl_data.cnonce,s=/([a-z]+)=([^,]+)(,|$)/;d.match(s);){var t=d.match(s);switch(d=d.replace(t[0],""),t[1]){case"r":e=t[2];break;case"s":f=t[2];break;case"i":g=t[2]}}if(e.substr(0,r.length)!==r)return c._sasl_data={},c._sasl_failure_cb();for(p+="r="+e,q+=p,f=b.decode(f),f+="\x00\x00\x00",h=j=a.core_hmac_sha1(c.pass,f),k=1;g>k;k++){for(i=a.core_hmac_sha1(c.pass,a.binb2str(j)),l=0;5>l;l++)h[l]^=i[l];j=i}for(h=a.binb2str(h),m=a.core_hmac_sha1(h,"Client Key"),n=a.str_hmac_sha1(h,"Server Key"),o=a.core_hmac_sha1(a.str_sha1(a.binb2str(m)),q),c._sasl_data["server-signature"]=a.b64_hmac_sha1(n,q),l=0;5>l;l++)m[l]^=o[l];return p+=",p="+b.encode(a.binb2str(m))}.bind(this),h},h.Connection.prototype.mechanisms[h.SASLSHA1.prototype.name]=h.SASLSHA1,h.SASLMD5=function(){},h.SASLMD5.prototype=new h.SASLMechanism("DIGEST-MD5",!1,30),h.SASLMD5.test=function(a){return null!==a.authcid},h.SASLMD5.prototype._quote=function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},h.SASLMD5.prototype.onChallenge=function(a,b,d){for(var e,f=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,g=d||c.hexdigest(""+1234567890*Math.random()),h="",i=null,j="",k="";b.match(f);)switch(e=b.match(f),b=b.replace(e[0],""),e[2]=e[2].replace(/^"(.+)"$/,"$1"),e[1]){case"realm":h=e[2];break;case"nonce":j=e[2];break;case"qop":k=e[2];break;case"host":i=e[2]}var l=a.servtype+"/"+a.domain;null!==i&&(l=l+"/"+i);var m=c.hash(a.authcid+":"+h+":"+this._connection.pass)+":"+j+":"+g,n="AUTHENTICATE:"+l,o="";return o+="charset=utf-8,",o+="username="+this._quote(a.authcid)+",",o+="realm="+this._quote(h)+",",o+="nonce="+this._quote(j)+",",o+="nc=00000001,",o+="cnonce="+this._quote(g)+",",o+="digest-uri="+this._quote(l)+",",o+="response="+c.hexdigest(c.hexdigest(m)+":"+j+":00000001:"+g+":auth:"+c.hexdigest(n))+",",o+="qop=auth",this.onChallenge=function(){return""}.bind(this),o},h.Connection.prototype.mechanisms[h.SASLMD5.prototype.name]=h.SASLMD5,{Strophe:h,$build:d,$msg:e,$iq:f,$pres:g,SHA1:a,Base64:b,MD5:c}}),function(b,c){return"function"==typeof a&&a.amd?void a("strophe-bosh",["strophe-core"],function(a){return c(a.Strophe,a.$build)}):c(Strophe,$build)}(this,function(a,b){return a.Request=function(b,c,d,e){this.id=++a._requestId,this.xmlData=b,this.data=a.serialize(b),this.origFunc=c,this.func=c,this.rid=d,this.date=NaN,this.sends=e||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var a=new Date;return(a-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var a=new Date;return(a-this.dead)/1e3},this.xhr=this._newXHR()},a.Request.prototype={getResponse:function(){var b=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(b=this.xhr.responseXML.documentElement,"parsererror"==b.tagName)throw a.error("invalid response received"),a.error("responseText: "+this.xhr.responseText),a.error("responseXML: "+a.serialize(this.xhr.responseXML)),"parsererror"}else this.xhr.responseText&&(a.error("invalid response received"),a.error("responseText: "+this.xhr.responseText),a.error("responseXML: "+a.serialize(this.xhr.responseXML)));return b},_newXHR:function(){var a=null;return window.XMLHttpRequest?(a=new XMLHttpRequest,a.overrideMimeType&&a.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP")),a.onreadystatechange=this.func.bind(null,this),a}},a.Bosh=function(a){this._conn=a,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this._requests=[]},a.Bosh.prototype={strip:null,_buildBody:function(){var c=b("body",{rid:this.rid++,xmlns:a.NS.HTTPBIND});return null!==this.sid&&c.attrs({sid:this.sid}),this._conn.options.keepalive&&this._cacheSession(),c},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,window.sessionStorage.removeItem("strophe-bosh-session")},_connect:function(b,c,d){this.wait=b||this.wait,this.hold=c||this.hold,this.errors=0;var e=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":a.NS.BOSH});d&&e.attrs({route:d});var f=this._conn._connect_cb;this._requests.push(new a.Request(e.tree(),this._onRequestStateChange.bind(this,f.bind(this._conn)),e.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(b,c,d,e,f,g,h){this._conn.jid=b,this.sid=c,this.rid=d,this._conn.connect_callback=e,this._conn.domain=a.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=f||this.wait,this.hold=g||this.hold,this.window=h||this.window,this._conn._changeConnectStatus(a.Status.ATTACHED,null)},_restore:function(b,c,d,e,f){var g=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!("undefined"!=typeof g&&null!==g&&g.rid&&g.sid&&g.jid)||"undefined"!=typeof b&&a.getBareJidFromJid(g.jid)!=a.getBareJidFromJid(b))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(g.jid,g.sid,g.rid,c,d,e,f)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(b){var c,d,e=b.getAttribute("type");if(null!==e&&"terminate"==e)return c=b.getAttribute("condition"),a.error("BOSH-Connection failed: "+c),d=b.getElementsByTagName("conflict"),null!==c?("remote-stream-error"==c&&d.length>0&&(c="conflict"),this._conn._changeConnectStatus(a.Status.CONNFAIL,c)):this._conn._changeConnectStatus(a.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(c),a.Status.CONNFAIL;this.sid||(this.sid=b.getAttribute("sid"));var f=b.getAttribute("requests");f&&(this.window=parseInt(f,10));var g=b.getAttribute("hold");g&&(this.hold=parseInt(g,10));var h=b.getAttribute("wait");h&&(this.wait=parseInt(h,10))},_disconnect:function(a){this._sendTerminate(a)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),window.sessionStorage.removeItem("strophe-bosh-session")},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(b){this.errors++,a.warn("request errored, status: "+b+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(b){b=b?b.bind(this._conn):this._conn._connect_cb.bind(this._conn);var c=this._buildBody();this._requests.push(new a.Request(c.tree(),this._onRequestStateChange.bind(this,b.bind(this._conn)),c.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var a;this._requests.length>0;)a=this._requests.pop(),a.abort=!0,a.xhr.abort(),a.xhr.onreadystatechange=function(){}},_onIdle:function(){var b=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===b.length&&!this._conn.disconnecting&&(a.info("no requests during idle cycle, sending blank request"),b.push(null)),!this._conn.paused){if(this._requests.length<2&&b.length>0){for(var c=this._buildBody(),d=0;d<b.length;d++)null!==b[d]&&("restart"===b[d]?c.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":a.NS.BOSH}):c.cnode(b[d]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new a.Request(c.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),c.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(a.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),e>Math.floor(a.TIMEOUT*this.wait)&&(a.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(a.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_onRequestStateChange:function(b,c){if(a.debug("request id "+c.id+"."+c.sends+" state changed to "+c.xhr.readyState),c.abort)return void(c.abort=!1);var d;if(4==c.xhr.readyState){d=0;try{d=c.xhr.status}catch(e){}if("undefined"==typeof d&&(d=0),this.disconnecting&&d>=400)return void this._hitError(d);var f=this._requests[0]==c,g=this._requests[1]==c;(d>0&&500>d||c.sends>5)&&(this._removeRequest(c),a.debug("request id "+c.id+" should now be removed")),200==d?((g||f&&this._requests.length>0&&this._requests[0].age()>Math.floor(a.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),a.debug("request id "+c.id+"."+c.sends+" got 200"),b(c),this.errors=0):(a.error("request id "+c.id+"."+c.sends+" error "+d+" happened"),(0===d||d>=400&&600>d||d>=12e3)&&(this._hitError(d),d>=400&&500>d&&(this._conn._changeConnectStatus(a.Status.DISCONNECTING,null),this._conn._doDisconnect()))),d>0&&500>d||c.sends>5||this._throttledRequestHandler()}},_processRequest:function(b){var c=this,d=this._requests[b],e=-1;try{4==d.xhr.readyState&&(e=d.xhr.status)}catch(f){a.error("caught an error in _requests["+b+"], reqStatus: "+e)}if("undefined"==typeof e&&(e=-1),d.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var g=d.age(),h=!isNaN(g)&&g>Math.floor(a.TIMEOUT*this.wait),i=null!==d.dead&&d.timeDead()>Math.floor(a.SECONDARY_TIMEOUT*this.wait),j=4==d.xhr.readyState&&(1>e||e>=500);if((h||i||j)&&(i&&a.error("Request "+this._requests[b].id+" timed out (secondary), restarting"),d.abort=!0,d.xhr.abort(),d.xhr.onreadystatechange=function(){},this._requests[b]=new a.Request(d.xmlData,d.origFunc,d.rid,d.sends),d=this._requests[b]),0===d.xhr.readyState){a.debug("request id "+d.id+"."+d.sends+" posting");try{d.xhr.open("POST",this._conn.service,this._conn.options.sync?!1:!0),d.xhr.setRequestHeader("Content-Type","text/xml; charset=utf-8")}catch(k){return a.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(a.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(d.date=new Date,c._conn.options.customHeaders){var a=c._conn.options.customHeaders;for(var b in a)a.hasOwnProperty(b)&&d.xhr.setRequestHeader(b,a[b])}d.xhr.send(d.data)};if(d.sends>1){var m=1e3*Math.min(Math.floor(a.TIMEOUT*this.wait),Math.pow(d.sends,3));setTimeout(l,m)}else l();d.sends++,this._conn.xmlOutput!==a.Connection.prototype.xmlOutput&&this._conn.xmlOutput(d.xmlData.nodeName===this.strip&&d.xmlData.childNodes.length?d.xmlData.childNodes[0]:d.xmlData),this._conn.rawOutput!==a.Connection.prototype.rawOutput&&this._conn.rawOutput(d.data)}else a.debug("_processRequest: "+(0===b?"first":"second")+" request has readyState of "+d.xhr.readyState)},_removeRequest:function(b){a.debug("removing request");var c;for(c=this._requests.length-1;c>=0;c--)b==this._requests[c]&&this._requests.splice(c,1);b.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(a){var b=this._requests[a];null===b.dead&&(b.dead=new Date),this._processRequest(a)},_reqToData:function(a){try{return a.getResponse()}catch(b){if("parsererror"!=b)throw b;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(b){a.info("_sendTerminate was called");var c=this._buildBody().attrs({type:"terminate"});b&&c.cnode(b.tree());var d=new a.Request(c.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),c.tree().getAttribute("rid"));this._requests.push(d),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(this._conn._onIdle.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){a.debug(this._requests?"_throttledRequestHandler called with "+this._requests.length+" requests":"_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},a}),function(b,c){return"function"==typeof a&&a.amd?void a("strophe-websocket",["strophe-core"],function(a){return c(a.Strophe,a.$build)}):c(Strophe,$build)}(this,function(a,b){return a.Websocket=function(a){this._conn=a,this.strip="wrapper";var b=a.service;if(0!==b.indexOf("ws:")&&0!==b.indexOf("wss:")){var c="";c+="ws"===a.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",c+="://"+window.location.host,c+=0!==b.indexOf("/")?window.location.pathname+b:b,a.service=c}},a.Websocket.prototype={_buildStream:function(){return b("open",{xmlns:a.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(b,c){var d;if(d=b.getElementsByTagNameNS?b.getElementsByTagNameNS(a.NS.STREAM,"error"):b.getElementsByTagName("stream:error"),0===d.length)return!1;for(var e=d[0],f="",g="",h="urn:ietf:params:xml:ns:xmpp-streams",i=0;i<e.childNodes.length;i++){var j=e.childNodes[i];if(j.getAttribute("xmlns")!==h)break;"text"===j.nodeName?g=j.textContent:f=j.nodeName}var k="WebSocket stream error: ";return k+=f?f:"unknown",g&&(k+=" - "+f),a.error(k),this._conn._changeConnectStatus(c,f),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(b){var c=this._check_streamerror(b,a.Status.CONNFAIL);return c?a.Status.CONNFAIL:void 0},_handleStreamStart:function(b){var c=!1,d=b.getAttribute("xmlns");"string"!=typeof d?c="Missing xmlns in <open />":d!==a.NS.FRAMING&&(c="Wrong xmlns in <open />: "+d);var e=b.getAttribute("version");return"string"!=typeof e?c="Missing version in <open />":"1.0"!==e&&(c="Wrong version in <open />: "+e),c?(this._conn._changeConnectStatus(a.Status.CONNFAIL,c),this._conn._doDisconnect(),!1):!0},_connect_cb_wrapper:function(b){if(0===b.data.indexOf("<open ")||0===b.data.indexOf("<?xml")){var c=b.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===c)return;var d=(new DOMParser).parseFromString(c,"text/xml").documentElement;this._conn.xmlInput(d),this._conn.rawInput(b.data),this._handleStreamStart(d)&&this._connect_cb(d)}else if(0===b.data.indexOf("<close ")){this._conn.rawInput(b.data),this._conn.xmlInput(b);var e=b.getAttribute("see-other-uri");e?(this._conn._changeConnectStatus(a.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=e,this._connect()):(this._conn._changeConnectStatus(a.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var f=this._streamWrap(b.data),g=(new DOMParser).parseFromString(f,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(g,null,b.data)}},_disconnect:function(c){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){c&&this._conn.send(c);var d=b("close",{xmlns:a.NS.FRAMING});this._conn.xmlOutput(d);var e=a.serialize(d);this._conn.rawOutput(e);try{this.socket.send(e)}catch(f){a.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){a.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(a){return"<wrapper>"+a+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(a){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(a.error("Websocket closed unexcectedly"),this._conn._doDisconnect()):a.info("Websocket closed")},_no_auth_received:function(b){a.error("Server did not send any auth methods"),this._conn._changeConnectStatus(a.Status.CONNFAIL,"Server did not send any auth methods"),b&&(b=b.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(b){a.error("Websocket error "+b),this._conn._changeConnectStatus(a.Status.CONNFAIL,"The WebSocket connection could not be established was disconnected."),this._disconnect()},_onIdle:function(){var b=this._conn._data;if(b.length>0&&!this._conn.paused){for(var c=0;c<b.length;c++)if(null!==b[c]){var d,e;d="restart"===b[c]?this._buildStream().tree():b[c],e=a.serialize(d),this._conn.xmlOutput(d),this._conn.rawOutput(e),this.socket.send(e)}this._conn._data=[]}},_onMessage:function(b){var c,d,e='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(b.data===e)return this._conn.rawInput(e),this._conn.xmlInput(b),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===b.data.search("<open ")){if(c=(new DOMParser).parseFromString(b.data,"text/xml").documentElement,!this._handleStreamStart(c))return}else d=this._streamWrap(b.data),c=(new DOMParser).parseFromString(d,"text/xml").documentElement;return this._check_streamerror(c,a.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===c.firstChild.nodeName&&"unavailable"===c.firstChild.getAttribute("type")?(this._conn.xmlInput(c),void this._conn.rawInput(a.serialize(c))):void this._conn._dataRecv(c,b.data)},_onOpen:function(){a.info("Websocket open");var b=this._buildStream();this._conn.xmlOutput(b.tree());var c=a.serialize(b);this._conn.rawOutput(c),this.socket.send(c)},_reqToData:function(a){return a},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},a}),b?b(Strophe,$build,$msg,$iq,$pres):void 0}(function(a,b,c,d,e){window.Strophe=a,window.$build=b,window.$msg=c,window.$iq=d,window.$pres=e})},{}],16:[function(b,c,d){!function(b,e){"object"==typeof d?c.exports=d=e():"function"==typeof a&&a.amd?a([],e):b.CryptoJS=e()}(this,function(){var a=a||function(a,b){var c={},d=c.lib={},e=d.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;return b&&c.mixIn(b),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),f=d.WordArray=e.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,e=a.sigBytes;if(this.clamp(),d%4)for(var f=0;e>f;f++){var g=255&c[f>>>2]>>>24-8*(f%4);b[d+f>>>2]|=g<<24-8*((d+f)%4)}else if(c.length>65535)for(var f=0;e>f;f+=4)b[d+f>>>2]=c[f>>>2];else b.push.apply(b,c);return this.sigBytes+=e,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),
b.length=a.ceil(c/4)},clone:function(){var a=e.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(0|4294967296*a.random());return new f.init(c,b)}}),g=c.enc={},h=g.Hex={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=255&b[e>>>2]>>>24-8*(e%4);d.push((f>>>4).toString(16)),d.push((15&f).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new f.init(c,b/2)}},i=g.Latin1={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=255&b[e>>>2]>>>24-8*(e%4);d.push(String.fromCharCode(f))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new f.init(c,b)}},j=g.Utf8={stringify:function(a){try{return decodeURIComponent(escape(i.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return i.parse(unescape(encodeURIComponent(a)))}},k=d.BufferedBlockAlgorithm=e.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=j.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,g=this.blockSize,h=4*g,i=e/h;i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0);var j=i*g,k=a.min(4*j,e);if(j){for(var l=0;j>l;l+=g)this._doProcessBlock(d,l);var m=d.splice(0,j);c.sigBytes-=k}return new f.init(m,k)},clone:function(){var a=e.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=k.extend({cfg:e.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new l.HMAC.init(a,c).finalize(b)}}});var l=c.algo={};return c}(Math);return a})},{}],17:[function(b,c,d){!function(e,f){"object"==typeof d?c.exports=d=f(b("./core"),b("./sha1"),b("./hmac")):"function"==typeof a&&a.amd?a(["./core","./sha1","./hmac"],f):f(e.CryptoJS)}(this,function(a){return a.HmacSHA1})},{"./core":16,"./hmac":18,"./sha1":19}],18:[function(b,c,d){!function(e,f){"object"==typeof d?c.exports=d=f(b("./core")):"function"==typeof a&&a.amd?a(["./core"],f):f(e.CryptoJS)}(this,function(a){!function(){var b=a,c=b.lib,d=c.Base,e=b.enc,f=e.Utf8,g=b.algo;g.HMAC=d.extend({init:function(a,b){a=this._hasher=new a.init,"string"==typeof b&&(b=f.parse(b));var c=a.blockSize,d=4*c;b.sigBytes>d&&(b=a.finalize(b)),b.clamp();for(var e=this._oKey=b.clone(),g=this._iKey=b.clone(),h=e.words,i=g.words,j=0;c>j;j++)h[j]^=1549556828,i[j]^=909522486;e.sigBytes=g.sigBytes=d,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var b=this._hasher,c=b.finalize(a);b.reset();var d=b.finalize(this._oKey.clone().concat(c));return d}})}()})},{"./core":16}],19:[function(b,c,d){!function(e,f){"object"==typeof d?c.exports=d=f(b("./core")):"function"==typeof a&&a.amd?a(["./core"],f):f(e.CryptoJS)}(this,function(a){return function(){var b=a,c=b.lib,d=c.WordArray,e=c.Hasher,f=b.algo,g=[],h=f.SHA1=e.extend({_doReset:function(){this._hash=new d.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],h=c[3],i=c[4],j=0;80>j;j++){if(16>j)g[j]=0|a[b+j];else{var k=g[j-3]^g[j-8]^g[j-14]^g[j-16];g[j]=k<<1|k>>>31}var l=(d<<5|d>>>27)+i+g[j];l+=20>j?(e&f|~e&h)+1518500249:40>j?(e^f^h)+1859775393:60>j?(e&f|e&h|f&h)-1894007588:(e^f^h)-899497514,i=h,h=f,f=e<<30|e>>>2,e=d,d=l}c[0]=0|c[0]+d,c[1]=0|c[1]+e,c[2]=0|c[2]+f,c[3]=0|c[3]+h,c[4]=0|c[4]+i},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;return b[d>>>5]|=128<<24-d%32,b[(d+64>>>9<<4)+14]=Math.floor(c/4294967296),b[(d+64>>>9<<4)+15]=c,a.sigBytes=4*b.length,this._process(),this._hash},clone:function(){var a=e.clone.call(this);return a._hash=this._hash.clone(),a}});b.SHA1=e._createHelper(h),b.HmacSHA1=e._createHmacHelper(h)}(),a.SHA1})},{"./core":16}],20:[function(a,b,c){},{}],21:[function(a,b,c){arguments[4][20][0].apply(c,arguments)},{dup:20}],22:[function(a,b,c){(function(b){function d(){function a(){}try{var b=new Uint8Array(1);return b.foo=function(){return 42},b.constructor=a,42===b.foo()&&b.constructor===a&&"function"==typeof b.subarray&&0===b.subarray(1,1).byteLength}catch(c){return!1}}function e(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function f(a){return this instanceof f?(this.length=0,this.parent=void 0,"number"==typeof a?g(this,a):"string"==typeof a?h(this,a,arguments.length>1?arguments[1]:"utf8"):i(this,a)):arguments.length>1?new f(a,arguments[1]):new f(a)}function g(a,b){if(a=p(a,0>b?0:0|q(b)),!f.TYPED_ARRAY_SUPPORT)for(var c=0;b>c;c++)a[c]=0;return a}function h(a,b,c){("string"!=typeof c||""===c)&&(c="utf8");var d=0|s(b,c);return a=p(a,d),a.write(b,c),a}function i(a,b){if(f.isBuffer(b))return j(a,b);if(Y(b))return k(a,b);if(null==b)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(b.buffer instanceof ArrayBuffer)return l(a,b);if(b instanceof ArrayBuffer)return m(a,b)}return b.length?n(a,b):o(a,b)}function j(a,b){var c=0|q(b.length);return a=p(a,c),b.copy(a,0,0,c),a}function k(a,b){var c=0|q(b.length);a=p(a,c);for(var d=0;c>d;d+=1)a[d]=255&b[d];return a}function l(a,b){var c=0|q(b.length);a=p(a,c);for(var d=0;c>d;d+=1)a[d]=255&b[d];return a}function m(a,b){return f.TYPED_ARRAY_SUPPORT?(b.byteLength,a=f._augment(new Uint8Array(b))):a=l(a,new Uint8Array(b)),a}function n(a,b){var c=0|q(b.length);a=p(a,c);for(var d=0;c>d;d+=1)a[d]=255&b[d];return a}function o(a,b){var c,d=0;"Buffer"===b.type&&Y(b.data)&&(c=b.data,d=0|q(c.length)),a=p(a,d);for(var e=0;d>e;e+=1)a[e]=255&c[e];return a}function p(a,b){f.TYPED_ARRAY_SUPPORT?(a=f._augment(new Uint8Array(b)),a.__proto__=f.prototype):(a.length=b,a._isBuffer=!0);var c=0!==b&&b<=f.poolSize>>>1;return c&&(a.parent=Z),a}function q(a){if(a>=e())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+e().toString(16)+" bytes");return 0|a}function r(a,b){if(!(this instanceof r))return new r(a,b);var c=new f(a,b);return delete c.parent,c}function s(a,b){"string"!=typeof a&&(a=""+a);var c=a.length;if(0===c)return 0;for(var d=!1;;)switch(b){case"ascii":case"binary":case"raw":case"raws":return c;case"utf8":case"utf-8":return R(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return U(a).length;default:if(d)return R(a).length;b=(""+b).toLowerCase(),d=!0}}function t(a,b,c){var d=!1;if(b=0|b,c=void 0===c||c===1/0?this.length:0|c,a||(a="utf8"),0>b&&(b=0),c>this.length&&(c=this.length),b>=c)return"";for(;;)switch(a){case"hex":return F(this,b,c);case"utf8":case"utf-8":return B(this,b,c);case"ascii":return D(this,b,c);case"binary":return E(this,b,c);case"base64":return A(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function u(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d),d>e&&(d=e)):d=e;var f=b.length;if(f%2!==0)throw new Error("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;d>g;g++){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))throw new Error("Invalid hex string");a[c+g]=h}return g}function v(a,b,c,d){return V(R(b,a.length-c),a,c,d)}function w(a,b,c,d){return V(S(b),a,c,d)}function x(a,b,c,d){return w(a,b,c,d)}function y(a,b,c,d){return V(U(b),a,c,d)}function z(a,b,c,d){return V(T(b,a.length-c),a,c,d)}function A(a,b,c){return 0===b&&c===a.length?W.fromByteArray(a):W.fromByteArray(a.slice(b,c))}function B(a,b,c){c=Math.min(a.length,c);for(var d=[],e=b;c>e;){var f=a[e],g=null,h=f>239?4:f>223?3:f>191?2:1;if(c>=e+h){var i,j,k,l;switch(h){case 1:128>f&&(g=f);break;case 2:i=a[e+1],128===(192&i)&&(l=(31&f)<<6|63&i,l>127&&(g=l));break;case 3:i=a[e+1],j=a[e+2],128===(192&i)&&128===(192&j)&&(l=(15&f)<<12|(63&i)<<6|63&j,l>2047&&(55296>l||l>57343)&&(g=l));break;case 4:i=a[e+1],j=a[e+2],k=a[e+3],128===(192&i)&&128===(192&j)&&128===(192&k)&&(l=(15&f)<<18|(63&i)<<12|(63&j)<<6|63&k,l>65535&&1114112>l&&(g=l))}}null===g?(g=65533,h=1):g>65535&&(g-=65536,d.push(g>>>10&1023|55296),g=56320|1023&g),d.push(g),e+=h}return C(d)}function C(a){var b=a.length;if($>=b)return String.fromCharCode.apply(String,a);for(var c="",d=0;b>d;)c+=String.fromCharCode.apply(String,a.slice(d,d+=$));return c}function D(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(127&a[e]);return d}function E(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(a[e]);return d}function F(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;f++)e+=Q(a[f]);return e}function G(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function H(a,b,c){if(a%1!==0||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function I(a,b,c,d,e,g){if(!f.isBuffer(a))throw new TypeError("buffer must be a Buffer instance");if(b>e||g>b)throw new RangeError("value is out of bounds");if(c+d>a.length)throw new RangeError("index out of range")}function J(a,b,c,d){0>b&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);f>e;e++)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function K(a,b,c,d){0>b&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);f>e;e++)a[c+e]=b>>>8*(d?e:3-e)&255}function L(a,b,c,d,e,f){if(b>e||f>b)throw new RangeError("value is out of bounds");if(c+d>a.length)throw new RangeError("index out of range");if(0>c)throw new RangeError("index out of range")}function M(a,b,c,d,e){return e||L(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),X.write(a,b,c,d,23,4),c+4}function N(a,b,c,d,e){return e||L(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),X.write(a,b,c,d,52,8),c+8}function O(a){if(a=P(a).replace(aa,""),a.length<2)return"";for(;a.length%4!==0;)a+="=";return a}function P(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function Q(a){return 16>a?"0"+a.toString(16):a.toString(16)}function R(a,b){b=b||1/0;for(var c,d=a.length,e=null,f=[],g=0;d>g;g++){if(c=a.charCodeAt(g),c>55295&&57344>c){if(!e){if(c>56319){(b-=3)>-1&&f.push(239,191,189);continue}if(g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(56320>c){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=e-55296<<10|c-56320|65536}else e&&(b-=3)>-1&&f.push(239,191,189);if(e=null,128>c){if((b-=1)<0)break;f.push(c)}else if(2048>c){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(65536>c){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(1114112>c))throw new Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function S(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b}function T(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);g++)c=a.charCodeAt(g),d=c>>8,e=c%256,f.push(e),f.push(d);return f}function U(a){return W.toByteArray(O(a))}function V(a,b,c,d){for(var e=0;d>e&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}var W=a("base64-js"),X=a("ieee754"),Y=a("is-array");c.Buffer=f,c.SlowBuffer=r,c.INSPECT_MAX_BYTES=50,f.poolSize=8192;var Z={};f.TYPED_ARRAY_SUPPORT=void 0!==b.TYPED_ARRAY_SUPPORT?b.TYPED_ARRAY_SUPPORT:d(),f.TYPED_ARRAY_SUPPORT&&(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array),f.isBuffer=function(a){return!(null==a||!a._isBuffer)},f.compare=function(a,b){if(!f.isBuffer(a)||!f.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var c=a.length,d=b.length,e=0,g=Math.min(c,d);g>e&&a[e]===b[e];)++e;return e!==g&&(c=a[e],d=b[e]),d>c?-1:c>d?1:0},f.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(a,b){if(!Y(a))throw new TypeError("list argument must be an Array of Buffers.");if(0===a.length)return new f(0);var c;if(void 0===b)for(b=0,c=0;c<a.length;c++)b+=a[c].length;var d=new f(b),e=0;for(c=0;c<a.length;c++){var g=a[c];g.copy(d,e),e+=g.length}return d},f.byteLength=s,f.prototype.length=void 0,f.prototype.parent=void 0,f.prototype.toString=function(){var a=0|this.length;return 0===a?"":0===arguments.length?B(this,0,a):t.apply(this,arguments)},f.prototype.equals=function(a){if(!f.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?!0:0===f.compare(this,a)},f.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... ")),"<Buffer "+a+">"},f.prototype.compare=function(a){if(!f.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?0:f.compare(this,a)},f.prototype.indexOf=function(a,b){function c(a,b,c){for(var d=-1,e=0;c+e<a.length;e++)if(a[c+e]===b[-1===d?0:e-d]){if(-1===d&&(d=e),e-d+1===b.length)return c+d}else d=-1;return-1}if(b>2147483647?b=2147483647:-2147483648>b&&(b=-2147483648),b>>=0,0===this.length)return-1;if(b>=this.length)return-1;if(0>b&&(b=Math.max(this.length+b,0)),"string"==typeof a)return 0===a.length?-1:String.prototype.indexOf.call(this,a,b);if(f.isBuffer(a))return c(this,a,b);if("number"==typeof a)return f.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,a,b):c(this,[a],b);throw new TypeError("val must be string, number or Buffer")},f.prototype.get=function(a){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(a)},f.prototype.set=function(a,b){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(a,b)},f.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else if(isFinite(b))b=0|b,isFinite(c)?(c=0|c,void 0===d&&(d="utf8")):(d=c,c=void 0);else{var e=d;d=b,b=0|c,c=e}var f=this.length-b;if((void 0===c||c>f)&&(c=f),a.length>0&&(0>c||0>b)||b>this.length)throw new RangeError("attempt to write outside buffer bounds");d||(d="utf8");for(var g=!1;;)switch(d){case"hex":return u(this,a,b,c);case"utf8":case"utf-8":return v(this,a,b,c);case"ascii":return w(this,a,b,c);case"binary":return x(this,a,b,c);case"base64":return y(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,a,b,c);default:if(g)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),g=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $=4096;f.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,0>a?(a+=c,0>a&&(a=0)):a>c&&(a=c),0>b?(b+=c,0>b&&(b=0)):b>c&&(b=c),a>b&&(b=a);var d;if(f.TYPED_ARRAY_SUPPORT)d=f._augment(this.subarray(a,b));else{var e=b-a;d=new f(e,void 0);for(var g=0;e>g;g++)d[g]=this[g+a]}return d.length&&(d.parent=this.parent||this),d},f.prototype.readUIntLE=function(a,b,c){a=0|a,b=0|b,c||H(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},f.prototype.readUIntBE=function(a,b,c){a=0|a,b=0|b,c||H(a,b,this.length);for(var d=this[a+--b],e=1;b>0&&(e*=256);)d+=this[a+--b]*e;return d},f.prototype.readUInt8=function(a,b){return b||H(a,1,this.length),this[a]},f.prototype.readUInt16LE=function(a,b){return b||H(a,2,this.length),this[a]|this[a+1]<<8},f.prototype.readUInt16BE=function(a,b){return b||H(a,2,this.length),this[a]<<8|this[a+1]},f.prototype.readUInt32LE=function(a,b){return b||H(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},f.prototype.readUInt32BE=function(a,b){return b||H(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},f.prototype.readIntLE=function(a,b,c){a=0|a,b=0|b,c||H(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return e*=128,d>=e&&(d-=Math.pow(2,8*b)),d},f.prototype.readIntBE=function(a,b,c){a=0|a,b=0|b,c||H(a,b,this.length);for(var d=b,e=1,f=this[a+--d];d>0&&(e*=256);)f+=this[a+--d]*e;return e*=128,f>=e&&(f-=Math.pow(2,8*b)),f},f.prototype.readInt8=function(a,b){return b||H(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},f.prototype.readInt16LE=function(a,b){b||H(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},f.prototype.readInt16BE=function(a,b){b||H(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},f.prototype.readInt32LE=function(a,b){return b||H(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},f.prototype.readInt32BE=function(a,b){return b||H(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},f.prototype.readFloatLE=function(a,b){return b||H(a,4,this.length),X.read(this,a,!0,23,4)},f.prototype.readFloatBE=function(a,b){return b||H(a,4,this.length),X.read(this,a,!1,23,4)},f.prototype.readDoubleLE=function(a,b){return b||H(a,8,this.length),X.read(this,a,!0,52,8)},f.prototype.readDoubleBE=function(a,b){return b||H(a,8,this.length),X.read(this,a,!1,52,8)},f.prototype.writeUIntLE=function(a,b,c,d){a=+a,b=0|b,c=0|c,d||I(this,a,b,c,Math.pow(2,8*c),0);var e=1,f=0;for(this[b]=255&a;++f<c&&(e*=256);)this[b+f]=a/e&255;return b+c},f.prototype.writeUIntBE=function(a,b,c,d){a=+a,b=0|b,c=0|c,d||I(this,a,b,c,Math.pow(2,8*c),0);var e=c-1,f=1;for(this[b+e]=255&a;--e>=0&&(f*=256);)this[b+e]=a/f&255;return b+c},f.prototype.writeUInt8=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,1,255,0),f.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=255&a,b+1},f.prototype.writeUInt16LE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):J(this,a,b,!0),b+2},f.prototype.writeUInt16BE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):J(this,a,b,!1),b+2},f.prototype.writeUInt32LE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a):K(this,a,b,!0),b+4},f.prototype.writeUInt32BE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):K(this,a,b,!1),b+4},f.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b=0|b,!d){var e=Math.pow(2,8*c-1);I(this,a,b,c,e-1,-e)}var f=0,g=1,h=0>a?1:0;for(this[b]=255&a;++f<c&&(g*=256);)this[b+f]=(a/g>>0)-h&255;return b+c},f.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b=0|b,!d){var e=Math.pow(2,8*c-1);I(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=0>a?1:0;for(this[b+f]=255&a;--f>=0&&(g*=256);)this[b+f]=(a/g>>0)-h&255;return b+c},f.prototype.writeInt8=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,1,127,-128),f.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),0>a&&(a=255+a+1),this[b]=255&a,b+1},f.prototype.writeInt16LE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):J(this,a,b,!0),b+2},f.prototype.writeInt16BE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):J(this,a,b,!1),b+2},f.prototype.writeInt32LE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):K(this,a,b,!0),b+4},f.prototype.writeInt32BE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,4,2147483647,-2147483648),0>a&&(a=4294967295+a+1),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):K(this,a,b,!1),b+4},f.prototype.writeFloatLE=function(a,b,c){return M(this,a,b,!0,c)},f.prototype.writeFloatBE=function(a,b,c){return M(this,a,b,!1,c)},f.prototype.writeDoubleLE=function(a,b,c){return N(this,a,b,!0,c)},f.prototype.writeDoubleBE=function(a,b,c){return N(this,a,b,!1,c)},f.prototype.copy=function(a,b,c,d){if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&c>d&&(d=c),d===c)return 0;if(0===a.length||0===this.length)return 0;if(0>b)throw new RangeError("targetStart out of bounds");if(0>c||c>=this.length)throw new RangeError("sourceStart out of bounds");if(0>d)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var e,g=d-c;if(this===a&&b>c&&d>b)for(e=g-1;e>=0;e--)a[e+b]=this[e+c];else if(1e3>g||!f.TYPED_ARRAY_SUPPORT)for(e=0;g>e;e++)a[e+b]=this[e+c];else a._set(this.subarray(c,c+g),b);return g},f.prototype.fill=function(a,b,c){if(a||(a=0),b||(b=0),c||(c=this.length),b>c)throw new RangeError("end < start");if(c!==b&&0!==this.length){if(0>b||b>=this.length)throw new RangeError("start out of bounds");if(0>c||c>this.length)throw new RangeError("end out of bounds");var d;if("number"==typeof a)for(d=b;c>d;d++)this[d]=a;else{var e=R(a.toString()),f=e.length;for(d=b;c>d;d++)this[d]=e[d%f]}return this}},f.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(f.TYPED_ARRAY_SUPPORT)return new f(this).buffer;for(var a=new Uint8Array(this.length),b=0,c=a.length;c>b;b+=1)a[b]=this[b];return a.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var _=f.prototype;f._augment=function(a){return a.constructor=f,a._isBuffer=!0,a._set=a.set,a.get=_.get,a.set=_.set,a.write=_.write,a.toString=_.toString,a.toLocaleString=_.toString,a.toJSON=_.toJSON,a.equals=_.equals,a.compare=_.compare,a.indexOf=_.indexOf,a.copy=_.copy,a.slice=_.slice,a.readUIntLE=_.readUIntLE,a.readUIntBE=_.readUIntBE,a.readUInt8=_.readUInt8,a.readUInt16LE=_.readUInt16LE,a.readUInt16BE=_.readUInt16BE,a.readUInt32LE=_.readUInt32LE,a.readUInt32BE=_.readUInt32BE,a.readIntLE=_.readIntLE,a.readIntBE=_.readIntBE,a.readInt8=_.readInt8,a.readInt16LE=_.readInt16LE,a.readInt16BE=_.readInt16BE,a.readInt32LE=_.readInt32LE,a.readInt32BE=_.readInt32BE,a.readFloatLE=_.readFloatLE,a.readFloatBE=_.readFloatBE,a.readDoubleLE=_.readDoubleLE,a.readDoubleBE=_.readDoubleBE,a.writeUInt8=_.writeUInt8,a.writeUIntLE=_.writeUIntLE,a.writeUIntBE=_.writeUIntBE,a.writeUInt16LE=_.writeUInt16LE,a.writeUInt16BE=_.writeUInt16BE,a.writeUInt32LE=_.writeUInt32LE,a.writeUInt32BE=_.writeUInt32BE,a.writeIntLE=_.writeIntLE,a.writeIntBE=_.writeIntBE,a.writeInt8=_.writeInt8,a.writeInt16LE=_.writeInt16LE,a.writeInt16BE=_.writeInt16BE,a.writeInt32LE=_.writeInt32LE,a.writeInt32BE=_.writeInt32BE,a.writeFloatLE=_.writeFloatLE,a.writeFloatBE=_.writeFloatBE,a.writeDoubleLE=_.writeDoubleLE,a.writeDoubleBE=_.writeDoubleBE,a.fill=_.fill,a.inspect=_.inspect,a.toArrayBuffer=_.toArrayBuffer,a};var aa=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":23,ieee754:24,"is-array":25}],23:[function(a,b,c){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(a){"use strict";function b(a){var b=a.charCodeAt(0);return b===g||b===l?62:b===h||b===m?63:i>b?-1:i+10>b?b-i+26+26:k+26>b?b-k:j+26>b?b-j+26:void 0}function c(a){function c(a){j[l++]=a}var d,e,g,h,i,j;if(a.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var k=a.length;i="="===a.charAt(k-2)?2:"="===a.charAt(k-1)?1:0,j=new f(3*a.length/4-i),g=i>0?a.length-4:a.length;var l=0;for(d=0,e=0;g>d;d+=4,e+=3)h=b(a.charAt(d))<<18|b(a.charAt(d+1))<<12|b(a.charAt(d+2))<<6|b(a.charAt(d+3)),c((16711680&h)>>16),c((65280&h)>>8),c(255&h);return 2===i?(h=b(a.charAt(d))<<2|b(a.charAt(d+1))>>4,c(255&h)):1===i&&(h=b(a.charAt(d))<<10|b(a.charAt(d+1))<<4|b(a.charAt(d+2))>>2,c(h>>8&255),c(255&h)),j}function e(a){function b(a){return d.charAt(a)}function c(a){return b(a>>18&63)+b(a>>12&63)+b(a>>6&63)+b(63&a)}var e,f,g,h=a.length%3,i="";for(e=0,g=a.length-h;g>e;e+=3)f=(a[e]<<16)+(a[e+1]<<8)+a[e+2],i+=c(f);switch(h){case 1:f=a[a.length-1],i+=b(f>>2),i+=b(f<<4&63),i+="==";break;case 2:f=(a[a.length-2]<<8)+a[a.length-1],i+=b(f>>10),i+=b(f>>4&63),i+=b(f<<2&63),i+="="}return i}var f="undefined"!=typeof Uint8Array?Uint8Array:Array,g="+".charCodeAt(0),h="/".charCodeAt(0),i="0".charCodeAt(0),j="a".charCodeAt(0),k="A".charCodeAt(0),l="-".charCodeAt(0),m="_".charCodeAt(0);a.toByteArray=c,a.fromByteArray=e}("undefined"==typeof c?this.base64js={}:c)},{}],24:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],25:[function(a,b,c){var d=Array.isArray,e=Object.prototype.toString;b.exports=d||function(a){return!!a&&"[object Array]"==e.call(a)}},{}],26:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],27:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],28:[function(a,b,c){b.exports=function(a){return!(null==a||!(a._isBuffer||a.constructor&&"function"==typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)))}},{}],29:[function(a,b,c){b.exports=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)}},{}],30:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h&&h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],31:[function(a,b,c){b.exports=a("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":32}],32:[function(a,b,c){(function(c){function d(a){return this instanceof d?(i.call(this,a),j.call(this,a),a&&a.readable===!1&&(this.readable=!1),a&&a.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,a&&a.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",e)):new d(a)}function e(){this.allowHalfOpen||this._writableState.ended||c.nextTick(this.end.bind(this))}function f(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}b.exports=d;var g=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b},h=a("core-util-is");h.inherits=a("inherits");var i=a("./_stream_readable"),j=a("./_stream_writable");h.inherits(d,i),f(g(j.prototype),function(a){d.prototype[a]||(d.prototype[a]=j.prototype[a])})}).call(this,a("_process"))},{"./_stream_readable":34,"./_stream_writable":36,_process:30,"core-util-is":37,inherits:27}],33:[function(a,b,c){function d(a){return this instanceof d?void e.call(this,a):new d(a)}b.exports=d;var e=a("./_stream_transform"),f=a("core-util-is");f.inherits=a("inherits"),f.inherits(d,e),d.prototype._transform=function(a,b,c){c(null,a)}},{"./_stream_transform":35,"core-util-is":37,inherits:27}],34:[function(a,b,c){(function(c){function d(b,c){
var d=a("./_stream_duplex");b=b||{};var e=b.highWaterMark,f=b.objectMode?16:16384;this.highWaterMark=e||0===e?e:f,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!b.objectMode,c instanceof d&&(this.objectMode=this.objectMode||!!b.readableObjectMode),this.defaultEncoding=b.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,b.encoding&&(C||(C=a("string_decoder/").StringDecoder),this.decoder=new C(b.encoding),this.encoding=b.encoding)}function e(b){return a("./_stream_duplex"),this instanceof e?(this._readableState=new d(b,this),this.readable=!0,void A.call(this)):new e(b)}function f(a,b,c,d,e){var f=j(b,c);if(f)a.emit("error",f);else if(B.isNullOrUndefined(c))b.reading=!1,b.ended||k(a,b);else if(b.objectMode||c&&c.length>0)if(b.ended&&!e){var h=new Error("stream.push() after EOF");a.emit("error",h)}else if(b.endEmitted&&e){var h=new Error("stream.unshift() after end event");a.emit("error",h)}else!b.decoder||e||d||(c=b.decoder.write(c)),e||(b.reading=!1),b.flowing&&0===b.length&&!b.sync?(a.emit("data",c),a.read(0)):(b.length+=b.objectMode?1:c.length,e?b.buffer.unshift(c):b.buffer.push(c),b.needReadable&&l(a)),n(a,b);else e||(b.reading=!1);return g(b)}function g(a){return!a.ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function h(a){if(a>=E)a=E;else{a--;for(var b=1;32>b;b<<=1)a|=a>>b;a++}return a}function i(a,b){return 0===b.length&&b.ended?0:b.objectMode?0===a?0:1:isNaN(a)||B.isNull(a)?b.flowing&&b.buffer.length?b.buffer[0].length:b.length:0>=a?0:(a>b.highWaterMark&&(b.highWaterMark=h(a)),a>b.length?b.ended?b.length:(b.needReadable=!0,0):a)}function j(a,b){var c=null;return B.isBuffer(b)||B.isString(b)||B.isNullOrUndefined(b)||a.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),c}function k(a,b){if(b.decoder&&!b.ended){var c=b.decoder.end();c&&c.length&&(b.buffer.push(c),b.length+=b.objectMode?1:c.length)}b.ended=!0,l(a)}function l(a){var b=a._readableState;b.needReadable=!1,b.emittedReadable||(D("emitReadable",b.flowing),b.emittedReadable=!0,b.sync?c.nextTick(function(){m(a)}):m(a))}function m(a){D("emit readable"),a.emit("readable"),s(a)}function n(a,b){b.readingMore||(b.readingMore=!0,c.nextTick(function(){o(a,b)}))}function o(a,b){for(var c=b.length;!b.reading&&!b.flowing&&!b.ended&&b.length<b.highWaterMark&&(D("maybeReadMore read 0"),a.read(0),c!==b.length);)c=b.length;b.readingMore=!1}function p(a){return function(){var b=a._readableState;D("pipeOnDrain",b.awaitDrain),b.awaitDrain&&b.awaitDrain--,0===b.awaitDrain&&z.listenerCount(a,"data")&&(b.flowing=!0,s(a))}}function q(a,b){b.resumeScheduled||(b.resumeScheduled=!0,c.nextTick(function(){r(a,b)}))}function r(a,b){b.resumeScheduled=!1,a.emit("resume"),s(a),b.flowing&&!b.reading&&a.read(0)}function s(a){var b=a._readableState;if(D("flow",b.flowing),b.flowing)do var c=a.read();while(null!==c&&b.flowing)}function t(a,b){var c,d=b.buffer,e=b.length,f=!!b.decoder,g=!!b.objectMode;if(0===d.length)return null;if(0===e)c=null;else if(g)c=d.shift();else if(!a||a>=e)c=f?d.join(""):y.concat(d,e),d.length=0;else if(a<d[0].length){var h=d[0];c=h.slice(0,a),d[0]=h.slice(a)}else if(a===d[0].length)c=d.shift();else{c=f?"":new y(a);for(var i=0,j=0,k=d.length;k>j&&a>i;j++){var h=d[0],l=Math.min(a-i,h.length);f?c+=h.slice(0,l):h.copy(c,i,0,l),l<h.length?d[0]=h.slice(l):d.shift(),i+=l}}return c}function u(a){var b=a._readableState;if(b.length>0)throw new Error("endReadable called on non-empty stream");b.endEmitted||(b.ended=!0,c.nextTick(function(){b.endEmitted||0!==b.length||(b.endEmitted=!0,a.readable=!1,a.emit("end"))}))}function v(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}function w(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}b.exports=e;var x=a("isarray"),y=a("buffer").Buffer;e.ReadableState=d;var z=a("events").EventEmitter;z.listenerCount||(z.listenerCount=function(a,b){return a.listeners(b).length});var A=a("stream"),B=a("core-util-is");B.inherits=a("inherits");var C,D=a("util");D=D&&D.debuglog?D.debuglog("stream"):function(){},B.inherits(e,A),e.prototype.push=function(a,b){var c=this._readableState;return B.isString(a)&&!c.objectMode&&(b=b||c.defaultEncoding,b!==c.encoding&&(a=new y(a,b),b="")),f(this,c,a,b,!1)},e.prototype.unshift=function(a){var b=this._readableState;return f(this,b,a,"",!0)},e.prototype.setEncoding=function(b){return C||(C=a("string_decoder/").StringDecoder),this._readableState.decoder=new C(b),this._readableState.encoding=b,this};var E=8388608;e.prototype.read=function(a){D("read",a);var b=this._readableState,c=a;if((!B.isNumber(a)||a>0)&&(b.emittedReadable=!1),0===a&&b.needReadable&&(b.length>=b.highWaterMark||b.ended))return D("read: emitReadable",b.length,b.ended),0===b.length&&b.ended?u(this):l(this),null;if(a=i(a,b),0===a&&b.ended)return 0===b.length&&u(this),null;var d=b.needReadable;D("need readable",d),(0===b.length||b.length-a<b.highWaterMark)&&(d=!0,D("length less than watermark",d)),(b.ended||b.reading)&&(d=!1,D("reading or ended",d)),d&&(D("do read"),b.reading=!0,b.sync=!0,0===b.length&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1),d&&!b.reading&&(a=i(c,b));var e;return e=a>0?t(a,b):null,B.isNull(e)&&(b.needReadable=!0,a=0),b.length-=a,0!==b.length||b.ended||(b.needReadable=!0),c!==a&&b.ended&&0===b.length&&u(this),B.isNull(e)||this.emit("data",e),e},e.prototype._read=function(a){this.emit("error",new Error("not implemented"))},e.prototype.pipe=function(a,b){function d(a){D("onunpipe"),a===l&&f()}function e(){D("onend"),a.end()}function f(){D("cleanup"),a.removeListener("close",i),a.removeListener("finish",j),a.removeListener("drain",q),a.removeListener("error",h),a.removeListener("unpipe",d),l.removeListener("end",e),l.removeListener("end",f),l.removeListener("data",g),!m.awaitDrain||a._writableState&&!a._writableState.needDrain||q()}function g(b){D("ondata");var c=a.write(b);!1===c&&(D("false write response, pause",l._readableState.awaitDrain),l._readableState.awaitDrain++,l.pause())}function h(b){D("onerror",b),k(),a.removeListener("error",h),0===z.listenerCount(a,"error")&&a.emit("error",b)}function i(){a.removeListener("finish",j),k()}function j(){D("onfinish"),a.removeListener("close",i),k()}function k(){D("unpipe"),l.unpipe(a)}var l=this,m=this._readableState;switch(m.pipesCount){case 0:m.pipes=a;break;case 1:m.pipes=[m.pipes,a];break;default:m.pipes.push(a)}m.pipesCount+=1,D("pipe count=%d opts=%j",m.pipesCount,b);var n=(!b||b.end!==!1)&&a!==c.stdout&&a!==c.stderr,o=n?e:f;m.endEmitted?c.nextTick(o):l.once("end",o),a.on("unpipe",d);var q=p(l);return a.on("drain",q),l.on("data",g),a._events&&a._events.error?x(a._events.error)?a._events.error.unshift(h):a._events.error=[h,a._events.error]:a.on("error",h),a.once("close",i),a.once("finish",j),a.emit("pipe",l),m.flowing||(D("pipe resume"),l.resume()),a},e.prototype.unpipe=function(a){var b=this._readableState;if(0===b.pipesCount)return this;if(1===b.pipesCount)return a&&a!==b.pipes?this:(a||(a=b.pipes),b.pipes=null,b.pipesCount=0,b.flowing=!1,a&&a.emit("unpipe",this),this);if(!a){var c=b.pipes,d=b.pipesCount;b.pipes=null,b.pipesCount=0,b.flowing=!1;for(var e=0;d>e;e++)c[e].emit("unpipe",this);return this}var e=w(b.pipes,a);return-1===e?this:(b.pipes.splice(e,1),b.pipesCount-=1,1===b.pipesCount&&(b.pipes=b.pipes[0]),a.emit("unpipe",this),this)},e.prototype.on=function(a,b){var d=A.prototype.on.call(this,a,b);if("data"===a&&!1!==this._readableState.flowing&&this.resume(),"readable"===a&&this.readable){var e=this._readableState;if(!e.readableListening)if(e.readableListening=!0,e.emittedReadable=!1,e.needReadable=!0,e.reading)e.length&&l(this,e);else{var f=this;c.nextTick(function(){D("readable nexttick read 0"),f.read(0)})}}return d},e.prototype.addListener=e.prototype.on,e.prototype.resume=function(){var a=this._readableState;return a.flowing||(D("resume"),a.flowing=!0,a.reading||(D("resume read 0"),this.read(0)),q(this,a)),this},e.prototype.pause=function(){return D("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(D("pause"),this._readableState.flowing=!1,this.emit("pause")),this},e.prototype.wrap=function(a){var b=this._readableState,c=!1,d=this;a.on("end",function(){if(D("wrapped end"),b.decoder&&!b.ended){var a=b.decoder.end();a&&a.length&&d.push(a)}d.push(null)}),a.on("data",function(e){if(D("wrapped data"),b.decoder&&(e=b.decoder.write(e)),e&&(b.objectMode||e.length)){var f=d.push(e);f||(c=!0,a.pause())}});for(var e in a)B.isFunction(a[e])&&B.isUndefined(this[e])&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));var f=["error","close","destroy","pause","resume"];return v(f,function(b){a.on(b,d.emit.bind(d,b))}),d._read=function(b){D("wrapped _read",b),c&&(c=!1,a.resume())},d},e._fromList=t}).call(this,a("_process"))},{"./_stream_duplex":32,_process:30,buffer:22,"core-util-is":37,events:26,inherits:27,isarray:29,stream:42,"string_decoder/":43,util:21}],35:[function(a,b,c){function d(a,b){this.afterTransform=function(a,c){return e(b,a,c)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function e(a,b,c){var d=a._transformState;d.transforming=!1;var e=d.writecb;if(!e)return a.emit("error",new Error("no writecb in Transform class"));d.writechunk=null,d.writecb=null,i.isNullOrUndefined(c)||a.push(c),e&&e(b);var f=a._readableState;f.reading=!1,(f.needReadable||f.length<f.highWaterMark)&&a._read(f.highWaterMark)}function f(a){if(!(this instanceof f))return new f(a);h.call(this,a),this._transformState=new d(a,this);var b=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("prefinish",function(){i.isFunction(this._flush)?this._flush(function(a){g(b,a)}):g(b)})}function g(a,b){if(b)return a.emit("error",b);var c=a._writableState,d=a._transformState;if(c.length)throw new Error("calling transform done when ws.length != 0");if(d.transforming)throw new Error("calling transform done when still transforming");return a.push(null)}b.exports=f;var h=a("./_stream_duplex"),i=a("core-util-is");i.inherits=a("inherits"),i.inherits(f,h),f.prototype.push=function(a,b){return this._transformState.needTransform=!1,h.prototype.push.call(this,a,b)},f.prototype._transform=function(a,b,c){throw new Error("not implemented")},f.prototype._write=function(a,b,c){var d=this._transformState;if(d.writecb=c,d.writechunk=a,d.writeencoding=b,!d.transforming){var e=this._readableState;(d.needTransform||e.needReadable||e.length<e.highWaterMark)&&this._read(e.highWaterMark)}},f.prototype._read=function(a){var b=this._transformState;i.isNull(b.writechunk)||!b.writecb||b.transforming?b.needTransform=!0:(b.transforming=!0,this._transform(b.writechunk,b.writeencoding,b.afterTransform))}},{"./_stream_duplex":32,"core-util-is":37,inherits:27}],36:[function(a,b,c){(function(c){function d(a,b,c){this.chunk=a,this.encoding=b,this.callback=c}function e(b,c){var d=a("./_stream_duplex");b=b||{};var e=b.highWaterMark,f=b.objectMode?16:16384;this.highWaterMark=e||0===e?e:f,this.objectMode=!!b.objectMode,c instanceof d&&(this.objectMode=this.objectMode||!!b.writableObjectMode),this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var g=b.decodeStrings===!1;this.decodeStrings=!g,this.defaultEncoding=b.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){n(c,a)},this.writecb=null,this.writelen=0,this.buffer=[],this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function f(b){var c=a("./_stream_duplex");return this instanceof f||this instanceof c?(this._writableState=new e(b,this),this.writable=!0,void x.call(this)):new f(b)}function g(a,b,d){var e=new Error("write after end");a.emit("error",e),c.nextTick(function(){d(e)})}function h(a,b,d,e){var f=!0;if(!(w.isBuffer(d)||w.isString(d)||w.isNullOrUndefined(d)||b.objectMode)){var g=new TypeError("Invalid non-string/buffer chunk");a.emit("error",g),c.nextTick(function(){e(g)}),f=!1}return f}function i(a,b,c){return!a.objectMode&&a.decodeStrings!==!1&&w.isString(b)&&(b=new v(b,c)),b}function j(a,b,c,e,f){c=i(b,c,e),w.isBuffer(c)&&(e="buffer");var g=b.objectMode?1:c.length;b.length+=g;var h=b.length<b.highWaterMark;return h||(b.needDrain=!0),b.writing||b.corked?b.buffer.push(new d(c,e,f)):k(a,b,!1,g,c,e,f),h}function k(a,b,c,d,e,f,g){b.writelen=d,b.writecb=g,b.writing=!0,b.sync=!0,c?a._writev(e,b.onwrite):a._write(e,f,b.onwrite),b.sync=!1}function l(a,b,d,e,f){d?c.nextTick(function(){b.pendingcb--,f(e)}):(b.pendingcb--,f(e)),a._writableState.errorEmitted=!0,a.emit("error",e)}function m(a){a.writing=!1,a.writecb=null,a.length-=a.writelen,a.writelen=0}function n(a,b){var d=a._writableState,e=d.sync,f=d.writecb;if(m(d),b)l(a,d,e,b,f);else{var g=r(a,d);g||d.corked||d.bufferProcessing||!d.buffer.length||q(a,d),e?c.nextTick(function(){o(a,d,g,f)}):o(a,d,g,f)}}function o(a,b,c,d){c||p(a,b),b.pendingcb--,d(),t(a,b)}function p(a,b){0===b.length&&b.needDrain&&(b.needDrain=!1,a.emit("drain"))}function q(a,b){if(b.bufferProcessing=!0,a._writev&&b.buffer.length>1){for(var c=[],d=0;d<b.buffer.length;d++)c.push(b.buffer[d].callback);b.pendingcb++,k(a,b,!0,b.length,b.buffer,"",function(a){for(var d=0;d<c.length;d++)b.pendingcb--,c[d](a)}),b.buffer=[]}else{for(var d=0;d<b.buffer.length;d++){var e=b.buffer[d],f=e.chunk,g=e.encoding,h=e.callback,i=b.objectMode?1:f.length;if(k(a,b,!1,i,f,g,h),b.writing){d++;break}}d<b.buffer.length?b.buffer=b.buffer.slice(d):b.buffer.length=0}b.bufferProcessing=!1}function r(a,b){return b.ending&&0===b.length&&!b.finished&&!b.writing}function s(a,b){b.prefinished||(b.prefinished=!0,a.emit("prefinish"))}function t(a,b){var c=r(a,b);return c&&(0===b.pendingcb?(s(a,b),b.finished=!0,a.emit("finish")):s(a,b)),c}function u(a,b,d){b.ending=!0,t(a,b),d&&(b.finished?c.nextTick(d):a.once("finish",d)),b.ended=!0}b.exports=f;var v=a("buffer").Buffer;f.WritableState=e;var w=a("core-util-is");w.inherits=a("inherits");var x=a("stream");w.inherits(f,x),f.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},f.prototype.write=function(a,b,c){var d=this._writableState,e=!1;return w.isFunction(b)&&(c=b,b=null),w.isBuffer(a)?b="buffer":b||(b=d.defaultEncoding),w.isFunction(c)||(c=function(){}),d.ended?g(this,d,c):h(this,d,a,c)&&(d.pendingcb++,e=j(this,d,a,b,c)),e},f.prototype.cork=function(){var a=this._writableState;a.corked++},f.prototype.uncork=function(){var a=this._writableState;a.corked&&(a.corked--,a.writing||a.corked||a.finished||a.bufferProcessing||!a.buffer.length||q(this,a))},f.prototype._write=function(a,b,c){c(new Error("not implemented"))},f.prototype._writev=null,f.prototype.end=function(a,b,c){var d=this._writableState;w.isFunction(a)?(c=a,a=null,b=null):w.isFunction(b)&&(c=b,b=null),w.isNullOrUndefined(a)||this.write(a,b),d.corked&&(d.corked=1,this.uncork()),d.ending||d.finished||u(this,d,c)}}).call(this,a("_process"))},{"./_stream_duplex":32,_process:30,buffer:22,"core-util-is":37,inherits:27,stream:42}],37:[function(a,b,c){(function(a){function b(a){return Array.isArray(a)}function d(a){return"boolean"==typeof a}function e(a){return null===a}function f(a){return null==a}function g(a){return"number"==typeof a}function h(a){return"string"==typeof a}function i(a){return"symbol"==typeof a}function j(a){return void 0===a}function k(a){return l(a)&&"[object RegExp]"===r(a)}function l(a){return"object"==typeof a&&null!==a}function m(a){return l(a)&&"[object Date]"===r(a)}function n(a){return l(a)&&("[object Error]"===r(a)||a instanceof Error)}function o(a){return"function"==typeof a}function p(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function q(b){return a.isBuffer(b)}function r(a){return Object.prototype.toString.call(a)}c.isArray=b,c.isBoolean=d,c.isNull=e,c.isNullOrUndefined=f,c.isNumber=g,c.isString=h,c.isSymbol=i,c.isUndefined=j,c.isRegExp=k,c.isObject=l,c.isDate=m,c.isError=n,c.isFunction=o,c.isPrimitive=p,c.isBuffer=q}).call(this,{isBuffer:a("/Users/igorkhomenko/workspace/quickblox-javascript-sdk/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/is-buffer/index.js")})},{"/Users/igorkhomenko/workspace/quickblox-javascript-sdk/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/is-buffer/index.js":28}],38:[function(a,b,c){b.exports=a("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":33}],39:[function(a,b,c){c=b.exports=a("./lib/_stream_readable.js"),c.Stream=a("stream"),c.Readable=c,c.Writable=a("./lib/_stream_writable.js"),c.Duplex=a("./lib/_stream_duplex.js"),c.Transform=a("./lib/_stream_transform.js"),c.PassThrough=a("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":32,"./lib/_stream_passthrough.js":33,"./lib/_stream_readable.js":34,"./lib/_stream_transform.js":35,"./lib/_stream_writable.js":36,stream:42}],40:[function(a,b,c){b.exports=a("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":35}],41:[function(a,b,c){b.exports=a("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":36}],42:[function(a,b,c){function d(){e.call(this)}b.exports=d;var e=a("events").EventEmitter,f=a("inherits");f(d,e),d.Readable=a("readable-stream/readable.js"),d.Writable=a("readable-stream/writable.js"),d.Duplex=a("readable-stream/duplex.js"),d.Transform=a("readable-stream/transform.js"),d.PassThrough=a("readable-stream/passthrough.js"),d.Stream=d,d.prototype.pipe=function(a,b){function c(b){a.writable&&!1===a.write(b)&&j.pause&&j.pause()}function d(){j.readable&&j.resume&&j.resume()}function f(){k||(k=!0,a.end())}function g(){k||(k=!0,"function"==typeof a.destroy&&a.destroy())}function h(a){if(i(),0===e.listenerCount(this,"error"))throw a}function i(){j.removeListener("data",c),a.removeListener("drain",d),j.removeListener("end",f),j.removeListener("close",g),j.removeListener("error",h),a.removeListener("error",h),j.removeListener("end",i),j.removeListener("close",i),a.removeListener("close",i)}var j=this;j.on("data",c),a.on("drain",d),a._isStdio||b&&b.end===!1||(j.on("end",f),j.on("close",g));var k=!1;return j.on("error",h),a.on("error",h),j.on("end",i),j.on("close",i),a.on("close",i),a.emit("pipe",j),a}},{events:26,inherits:27,"readable-stream/duplex.js":31,"readable-stream/passthrough.js":38,"readable-stream/readable.js":39,"readable-stream/transform.js":40,"readable-stream/writable.js":41}],43:[function(a,b,c){function d(a){if(a&&!i(a))throw new Error("Unknown encoding: "+a)}function e(a){return a.toString(this.encoding)}function f(a){this.charReceived=a.length%2,this.charLength=this.charReceived?2:0}function g(a){this.charReceived=a.length%3,this.charLength=this.charReceived?3:0}var h=a("buffer").Buffer,i=h.isEncoding||function(a){switch(a&&a.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},j=c.StringDecoder=function(a){switch(this.encoding=(a||"utf8").toLowerCase().replace(/[-_]/,""),d(a),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=f;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=g;break;default:return void(this.write=e)}this.charBuffer=new h(6),this.charReceived=0,this.charLength=0};j.prototype.write=function(a){for(var b="";this.charLength;){var c=a.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:a.length;if(a.copy(this.charBuffer,this.charReceived,0,c),this.charReceived+=c,this.charReceived<this.charLength)return"";a=a.slice(c,a.length),b=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var d=b.charCodeAt(b.length-1);if(!(d>=55296&&56319>=d)){if(this.charReceived=this.charLength=0,0===a.length)return b;break}this.charLength+=this.surrogateSize,b=""}this.detectIncompleteChar(a);var e=a.length;this.charLength&&(a.copy(this.charBuffer,0,a.length-this.charReceived,e),e-=this.charReceived),b+=a.toString(this.encoding,0,e);var e=b.length-1,d=b.charCodeAt(e);if(d>=55296&&56319>=d){var f=this.surrogateSize;return this.charLength+=f,this.charReceived+=f,this.charBuffer.copy(this.charBuffer,f,0,f),a.copy(this.charBuffer,0,0,f),b.substring(0,e)}return b},j.prototype.detectIncompleteChar=function(a){for(var b=a.length>=3?3:a.length;b>0;b--){var c=a[a.length-b];if(1==b&&c>>5==6){this.charLength=2;break}if(2>=b&&c>>4==14){this.charLength=3;break}if(3>=b&&c>>3==30){this.charLength=4;break}}this.charReceived=b},j.prototype.end=function(a){var b="";if(a&&a.length&&(b=this.write(a)),this.charReceived){var c=this.charReceived,d=this.charBuffer,e=this.encoding;b+=d.slice(0,c).toString(e)}return b}},{buffer:22}],44:[function(a,b,c){function d(a,b){this._id=a,this._clearFn=b}var e=a("process/browser.js").nextTick,f=Function.prototype.apply,g=Array.prototype.slice,h={},i=0;c.setTimeout=function(){return new d(f.call(setTimeout,window,arguments),clearTimeout)},c.setInterval=function(){return new d(f.call(setInterval,window,arguments),clearInterval)},c.clearTimeout=c.clearInterval=function(a){a.close()},d.prototype.unref=d.prototype.ref=function(){},d.prototype.close=function(){this._clearFn.call(window,this._id)},c.enroll=function(a,b){clearTimeout(a._idleTimeoutId),a._idleTimeout=b},c.unenroll=function(a){clearTimeout(a._idleTimeoutId),a._idleTimeout=-1},c._unrefActive=c.active=function(a){clearTimeout(a._idleTimeoutId);var b=a._idleTimeout;b>=0&&(a._idleTimeoutId=setTimeout(function(){a._onTimeout&&a._onTimeout()},b))},c.setImmediate="function"==typeof setImmediate?setImmediate:function(a){var b=i++,d=arguments.length<2?!1:g.call(arguments,1);return h[b]=!0,e(function(){h[b]&&(d?a.apply(null,d):a.call(null),c.clearImmediate(b))}),b},c.clearImmediate="function"==typeof clearImmediate?clearImmediate:function(a){delete h[a]}},{"process/browser.js":30}],45:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],46:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":45,_process:30,inherits:27}],47:[function(a,b,c){(function(){"use strict";var b;b=a("../lib/xml2js"),c.stripBOM=function(a){return"\ufeff"===a[0]?a.substring(1):a}}).call(this)},{"../lib/xml2js":49}],48:[function(a,b,c){(function(){"use strict";var a;a=new RegExp(/(?!xmlns)^.*:/),c.normalize=function(a){return a.toLowerCase()},c.firstCharLowerCase=function(a){return a.charAt(0).toLowerCase()+a.slice(1)},c.stripPrefix=function(b){return b.replace(a,"")},c.parseNumbers=function(a){return isNaN(a)||(a=a%1===0?parseInt(a,10):parseFloat(a)),a},c.parseBooleans=function(a){return/^(?:true|false)$/i.test(a)&&(a="true"===a.toLowerCase()),a}}).call(this)},{}],49:[function(a,b,c){(function(){"use strict";var b,d,e,f,g,h,i,j,k,l,m,n=function(a,b){function c(){this.constructor=a}for(var d in b)o.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},o={}.hasOwnProperty,p=function(a,b){return function(){return a.apply(b,arguments)}};k=a("sax"),f=a("events"),d=a("xmlbuilder"),b=a("./bom"),i=a("./processors"),l=a("timers").setImmediate,g=function(a){return"object"==typeof a&&null!=a&&0===Object.keys(a).length},h=function(a,b){var c,d,e;for(c=0,d=a.length;d>c;c++)e=a[c],b=e(b);return b},j=function(a){return a.indexOf("&")>=0||a.indexOf(">")>=0||a.indexOf("<")>=0},m=function(a){return"<![CDATA["+e(a)+"]]>"},e=function(a){return a.replace("]]>","]]]]><![CDATA[>")},c.processors=i,c.defaults={.1:{explicitCharkey:!1,trim:!0,normalize:!0,normalizeTags:!1,attrkey:"@",charkey:"#",explicitArray:!1,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!1,validator:null,xmlns:!1,explicitChildren:!1,childkey:"@@",charsAsChildren:!1,async:!1,strict:!0,attrNameProcessors:null,tagNameProcessors:null,valueProcessors:null,emptyTag:""},.2:{explicitCharkey:!1,trim:!1,normalize:!1,normalizeTags:!1,attrkey:"$",charkey:"_",explicitArray:!0,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!0,validator:null,xmlns:!1,explicitChildren:!1,preserveChildrenOrder:!1,childkey:"$$",charsAsChildren:!1,async:!1,strict:!0,attrNameProcessors:null,tagNameProcessors:null,valueProcessors:null,rootName:"root",xmldec:{version:"1.0",encoding:"UTF-8",standalone:!0},doctype:null,renderOpts:{pretty:!0,indent:"  ",newline:"\n"},headless:!1,chunkSize:1e4,emptyTag:"",cdata:!1}},c.ValidationError=function(a){function b(a){this.message=a}return n(b,a),b}(Error),c.Builder=function(){function a(a){var b,d,e;this.options={},d=c.defaults[.2];for(b in d)o.call(d,b)&&(e=d[b],this.options[b]=e);for(b in a)o.call(a,b)&&(e=a[b],this.options[b]=e)}return a.prototype.buildObject=function(a){var b,e,f,g,h;return b=this.options.attrkey,e=this.options.charkey,1===Object.keys(a).length&&this.options.rootName===c.defaults[.2].rootName?(h=Object.keys(a)[0],a=a[h]):h=this.options.rootName,f=function(a){return function(c,d){var g,h,i,k,l,n;if("object"!=typeof d)a.options.cdata&&j(d)?c.raw(m(d)):c.txt(d);else for(l in d)if(o.call(d,l))if(h=d[l],l===b){if("object"==typeof h)for(g in h)n=h[g],c=c.att(g,n)}else if(l===e)c=a.options.cdata&&j(h)?c.raw(m(h)):c.txt(h);else if(Array.isArray(h))for(k in h)o.call(h,k)&&(i=h[k],c="string"==typeof i?a.options.cdata&&j(i)?c.ele(l).raw(m(i)).up():c.ele(l,i).up():f(c.ele(l),i).up());else c="object"==typeof h?f(c.ele(l),h).up():"string"==typeof h&&a.options.cdata&&j(h)?c.ele(l).raw(m(h)).up():c.ele(l,h.toString()).up();return c}}(this),g=d.create(h,this.options.xmldec,this.options.doctype,{
headless:this.options.headless}),f(g,a).end(this.options.renderOpts)},a}(),c.Parser=function(a){function d(a){this.parseString=p(this.parseString,this),this.reset=p(this.reset,this),this.assignOrPush=p(this.assignOrPush,this),this.processAsync=p(this.processAsync,this);var b,d,e;if(!(this instanceof c.Parser))return new c.Parser(a);this.options={},d=c.defaults[.2];for(b in d)o.call(d,b)&&(e=d[b],this.options[b]=e);for(b in a)o.call(a,b)&&(e=a[b],this.options[b]=e);this.options.xmlns&&(this.options.xmlnskey=this.options.attrkey+"ns"),this.options.normalizeTags&&(this.options.tagNameProcessors||(this.options.tagNameProcessors=[]),this.options.tagNameProcessors.unshift(i.normalize)),this.reset()}return n(d,a),d.prototype.processAsync=function(){var a;return this.remaining.length<=this.options.chunkSize?(a=this.remaining,this.remaining="",this.saxParser=this.saxParser.write(a),this.saxParser.close()):(a=this.remaining.substr(0,this.options.chunkSize),this.remaining=this.remaining.substr(this.options.chunkSize,this.remaining.length),this.saxParser=this.saxParser.write(a),l(this.processAsync))},d.prototype.assignOrPush=function(a,b,c){return b in a?(a[b]instanceof Array||(a[b]=[a[b]]),a[b].push(c)):this.options.explicitArray?a[b]=[c]:a[b]=c},d.prototype.reset=function(){var a,b,c,d;return this.removeAllListeners(),this.saxParser=k.parser(this.options.strict,{trim:!1,normalize:!1,xmlns:this.options.xmlns}),this.saxParser.errThrown=!1,this.saxParser.onerror=function(a){return function(b){return a.saxParser.resume(),a.saxParser.errThrown?void 0:(a.saxParser.errThrown=!0,a.emit("error",b))}}(this),this.saxParser.ended=!1,this.EXPLICIT_CHARKEY=this.options.explicitCharkey,this.resultObject=null,d=[],a=this.options.attrkey,b=this.options.charkey,this.saxParser.onopentag=function(c){return function(e){var f,g,i,j,k;if(i={},i[b]="",!c.options.ignoreAttrs){k=e.attributes;for(f in k)o.call(k,f)&&(a in i||c.options.mergeAttrs||(i[a]={}),g=e.attributes[f],j=c.options.attrNameProcessors?h(c.options.attrNameProcessors,f):f,c.options.mergeAttrs?c.assignOrPush(i,j,g):i[a][j]=g)}return i["#name"]=c.options.tagNameProcessors?h(c.options.tagNameProcessors,e.name):e.name,c.options.xmlns&&(i[c.options.xmlnskey]={uri:e.uri,local:e.local}),d.push(i)}}(this),this.saxParser.onclosetag=function(a){return function(){var c,e,f,i,j,k,l,m,n,p,q;if(l=d.pop(),k=l["#name"],a.options.explicitChildren&&a.options.preserveChildrenOrder||delete l["#name"],l.cdata===!0&&(c=l.cdata,delete l.cdata),p=d[d.length-1],l[b].match(/^\s*$/)&&!c?(e=l[b],delete l[b]):(a.options.trim&&(l[b]=l[b].trim()),a.options.normalize&&(l[b]=l[b].replace(/\s{2,}/g," ").trim()),l[b]=a.options.valueProcessors?h(a.options.valueProcessors,l[b]):l[b],1===Object.keys(l).length&&b in l&&!a.EXPLICIT_CHARKEY&&(l=l[b])),g(l)&&(l=""!==a.options.emptyTag?a.options.emptyTag:e),null!=a.options.validator){q="/"+function(){var a,b,c;for(c=[],a=0,b=d.length;b>a;a++)j=d[a],c.push(j["#name"]);return c}().concat(k).join("/");try{l=a.options.validator(q,p&&p[k],l)}catch(r){f=r,a.emit("error",f)}}if(a.options.explicitChildren&&!a.options.mergeAttrs&&"object"==typeof l)if(a.options.preserveChildrenOrder){if(p){p[a.options.childkey]=p[a.options.childkey]||[],m={};for(i in l)o.call(l,i)&&(m[i]=l[i]);p[a.options.childkey].push(m),delete l["#name"],1===Object.keys(l).length&&b in l&&!a.EXPLICIT_CHARKEY&&(l=l[b])}}else j={},a.options.attrkey in l&&(j[a.options.attrkey]=l[a.options.attrkey],delete l[a.options.attrkey]),!a.options.charsAsChildren&&a.options.charkey in l&&(j[a.options.charkey]=l[a.options.charkey],delete l[a.options.charkey]),Object.getOwnPropertyNames(l).length>0&&(j[a.options.childkey]=l),l=j;return d.length>0?a.assignOrPush(p,k,l):(a.options.explicitRoot&&(n=l,l={},l[k]=n),a.resultObject=l,a.saxParser.ended=!0,a.emit("end",a.resultObject))}}(this),c=function(a){return function(c){var e,f;return f=d[d.length-1],f?(f[b]+=c,a.options.explicitChildren&&a.options.preserveChildrenOrder&&a.options.charsAsChildren&&""!==c.replace(/\\n/g,"").trim()&&(f[a.options.childkey]=f[a.options.childkey]||[],e={"#name":"__text__"},e[b]=c,f[a.options.childkey].push(e)),f):void 0}}(this),this.saxParser.ontext=c,this.saxParser.oncdata=function(a){return function(a){var b;return b=c(a),b?b.cdata=!0:void 0}}(this)},d.prototype.parseString=function(a,c){var d;if(null!=c&&"function"==typeof c&&(this.on("end",function(a){return this.reset(),c(null,a)}),this.on("error",function(a){return this.reset(),c(a)})),a=a.toString(),""===a.trim())return this.emit("end",null),!0;try{return a=b.stripBOM(a),this.options.async?(this.remaining=a,l(this.processAsync),this.saxParser):this.saxParser.write(a).close()}catch(e){if(d=e,!this.saxParser.errThrown&&!this.saxParser.ended)return this.emit("error",d),this.saxParser.errThrown=!0;if(this.saxParser.ended)throw d}},d}(f.EventEmitter),c.parseString=function(a,b,d){var e,f,g;return null!=d?("function"==typeof d&&(e=d),"object"==typeof b&&(f=b)):("function"==typeof b&&(e=b),f={}),g=new c.Parser(f),g.parseString(a,e)}}).call(this)},{"./bom":47,"./processors":48,events:26,sax:50,timers:44,xmlbuilder:67}],50:[function(a,b,c){(function(b){!function(c){function d(a,b){if(!(this instanceof d))return new d(a,b);var e=this;f(e),e.q=e.c="",e.bufferCheckPosition=c.MAX_BUFFER_LENGTH,e.opt=b||{},e.opt.lowercase=e.opt.lowercase||e.opt.lowercasetags,e.looseCase=e.opt.lowercase?"toLowerCase":"toUpperCase",e.tags=[],e.closed=e.closedRoot=e.sawRoot=!1,e.tag=e.error=null,e.strict=!!a,e.noscript=!(!a&&!e.opt.noscript),e.state=S.BEGIN,e.strictEntities=e.opt.strictEntities,e.ENTITIES=e.strictEntities?Object.create(c.XML_ENTITIES):Object.create(c.ENTITIES),e.attribList=[],e.opt.xmlns&&(e.ns=Object.create(P)),e.trackPosition=e.opt.position!==!1,e.trackPosition&&(e.position=e.line=e.column=0),n(e,"onready")}function e(a){for(var b=Math.max(c.MAX_BUFFER_LENGTH,10),d=0,e=0,f=B.length;f>e;e++){var g=a[B[e]].length;if(g>b)switch(B[e]){case"textNode":p(a);break;case"cdata":o(a,"oncdata",a.cdata),a.cdata="";break;case"script":o(a,"onscript",a.script),a.script="";break;default:r(a,"Max buffer length exceeded: "+B[e])}d=Math.max(d,g)}a.bufferCheckPosition=c.MAX_BUFFER_LENGTH-d+a.position}function f(a){for(var b=0,c=B.length;c>b;b++)a[B[b]]=""}function g(a){p(a),""!==a.cdata&&(o(a,"oncdata",a.cdata),a.cdata=""),""!==a.script&&(o(a,"onscript",a.script),a.script="")}function h(a,b){return new i(a,b)}function i(a,b){if(!(this instanceof i))return new i(a,b);C.apply(this),this._parser=new d(a,b),this.writable=!0,this.readable=!0;var c=this;this._parser.onend=function(){c.emit("end")},this._parser.onerror=function(a){c.emit("error",a),c._parser.error=null},this._decoder=null,E.forEach(function(a){Object.defineProperty(c,"on"+a,{get:function(){return c._parser["on"+a]},set:function(b){return b?void c.on(a,b):(c.removeAllListeners(a),c._parser["on"+a]=b)},enumerable:!0,configurable:!1})})}function j(a){return a.split("").reduce(function(a,b){return a[b]=!0,a},{})}function k(a){return"[object RegExp]"===Object.prototype.toString.call(a)}function l(a,b){return k(a)?!!b.match(a):a[b]}function m(a,b){return!l(a,b)}function n(a,b,c){a[b]&&a[b](c)}function o(a,b,c){a.textNode&&p(a),n(a,b,c)}function p(a){a.textNode=q(a.opt,a.textNode),a.textNode&&n(a,"ontext",a.textNode),a.textNode=""}function q(a,b){return a.trim&&(b=b.trim()),a.normalize&&(b=b.replace(/\s+/g," ")),b}function r(a,b){return p(a),a.trackPosition&&(b+="\nLine: "+a.line+"\nColumn: "+a.column+"\nChar: "+a.c),b=new Error(b),a.error=b,n(a,"onerror",b),a}function s(a){return a.sawRoot&&!a.closedRoot&&t(a,"Unclosed root tag"),a.state!==S.BEGIN&&a.state!==S.BEGIN_WHITESPACE&&a.state!==S.TEXT&&r(a,"Unexpected end"),p(a),a.c="",a.closed=!0,n(a,"onend"),d.call(a,a.strict,a.opt),a}function t(a,b){if("object"!=typeof a||!(a instanceof d))throw new Error("bad call to strictFail");a.strict&&r(a,b)}function u(a){a.strict||(a.tagName=a.tagName[a.looseCase]());var b=a.tags[a.tags.length-1]||a,c=a.tag={name:a.tagName,attributes:{}};a.opt.xmlns&&(c.ns=b.ns),a.attribList.length=0}function v(a,b){var c=a.indexOf(":"),d=0>c?["",a]:a.split(":"),e=d[0],f=d[1];return b&&"xmlns"===a&&(e="xmlns",f=""),{prefix:e,local:f}}function w(a){if(a.strict||(a.attribName=a.attribName[a.looseCase]()),-1!==a.attribList.indexOf(a.attribName)||a.tag.attributes.hasOwnProperty(a.attribName))return a.attribName=a.attribValue="";if(a.opt.xmlns){var b=v(a.attribName,!0),c=b.prefix,d=b.local;if("xmlns"===c)if("xml"===d&&a.attribValue!==N)t(a,"xml: prefix must be bound to "+N+"\nActual: "+a.attribValue);else if("xmlns"===d&&a.attribValue!==O)t(a,"xmlns: prefix must be bound to "+O+"\nActual: "+a.attribValue);else{var e=a.tag,f=a.tags[a.tags.length-1]||a;e.ns===f.ns&&(e.ns=Object.create(f.ns)),e.ns[d]=a.attribValue}a.attribList.push([a.attribName,a.attribValue])}else a.tag.attributes[a.attribName]=a.attribValue,o(a,"onattribute",{name:a.attribName,value:a.attribValue});a.attribName=a.attribValue=""}function x(a,b){if(a.opt.xmlns){var c=a.tag,d=v(a.tagName);c.prefix=d.prefix,c.local=d.local,c.uri=c.ns[d.prefix]||"",c.prefix&&!c.uri&&(t(a,"Unbound namespace prefix: "+JSON.stringify(a.tagName)),c.uri=d.prefix);var e=a.tags[a.tags.length-1]||a;c.ns&&e.ns!==c.ns&&Object.keys(c.ns).forEach(function(b){o(a,"onopennamespace",{prefix:b,uri:c.ns[b]})});for(var f=0,g=a.attribList.length;g>f;f++){var h=a.attribList[f],i=h[0],j=h[1],k=v(i,!0),l=k.prefix,m=k.local,n=""==l?"":c.ns[l]||"",p={name:i,value:j,prefix:l,local:m,uri:n};l&&"xmlns"!=l&&!n&&(t(a,"Unbound namespace prefix: "+JSON.stringify(l)),p.uri=l),a.tag.attributes[i]=p,o(a,"onattribute",p)}a.attribList.length=0}a.tag.isSelfClosing=!!b,a.sawRoot=!0,a.tags.push(a.tag),o(a,"onopentag",a.tag),b||(a.noscript||"script"!==a.tagName.toLowerCase()?a.state=S.TEXT:a.state=S.SCRIPT,a.tag=null,a.tagName=""),a.attribName=a.attribValue="",a.attribList.length=0}function y(a){if(!a.tagName)return t(a,"Weird empty close tag."),a.textNode+="</>",void(a.state=S.TEXT);if(a.script){if("script"!==a.tagName)return a.script+="</"+a.tagName+">",a.tagName="",void(a.state=S.SCRIPT);o(a,"onscript",a.script),a.script=""}var b=a.tags.length,c=a.tagName;a.strict||(c=c[a.looseCase]());for(var d=c;b--;){var e=a.tags[b];if(e.name===d)break;t(a,"Unexpected close tag")}if(0>b)return t(a,"Unmatched closing tag: "+a.tagName),a.textNode+="</"+a.tagName+">",void(a.state=S.TEXT);a.tagName=c;for(var f=a.tags.length;f-- >b;){var g=a.tag=a.tags.pop();a.tagName=a.tag.name,o(a,"onclosetag",a.tagName);var h={};for(var i in g.ns)h[i]=g.ns[i];var j=a.tags[a.tags.length-1]||a;a.opt.xmlns&&g.ns!==j.ns&&Object.keys(g.ns).forEach(function(b){var c=g.ns[b];o(a,"onclosenamespace",{prefix:b,uri:c})})}0===b&&(a.closedRoot=!0),a.tagName=a.attribValue=a.attribName="",a.attribList.length=0,a.state=S.TEXT}function z(a){var b,c=a.entity,d=c.toLowerCase(),e="";return a.ENTITIES[c]?a.ENTITIES[c]:a.ENTITIES[d]?a.ENTITIES[d]:(c=d,"#"===c.charAt(0)&&("x"===c.charAt(1)?(c=c.slice(2),b=parseInt(c,16),e=b.toString(16)):(c=c.slice(1),b=parseInt(c,10),e=b.toString(10))),c=c.replace(/^0+/,""),e.toLowerCase()!==c?(t(a,"Invalid character entity"),"&"+a.entity+";"):String.fromCodePoint(b))}function A(a){var b=this;if(this.error)throw this.error;if(b.closed)return r(b,"Cannot write after close. Assign an onready handler.");if(null===a)return s(b);for(var c=0,d="";b.c=d=a.charAt(c++);)switch(b.trackPosition&&(b.position++,"\n"===d?(b.line++,b.column=0):b.column++),b.state){case S.BEGIN:if(b.state=S.BEGIN_WHITESPACE,"\ufeff"===d)continue;case S.BEGIN_WHITESPACE:"<"===d?(b.state=S.OPEN_WAKA,b.startTagPosition=b.position):m(F,d)&&(t(b,"Non-whitespace before first tag."),b.textNode=d,b.state=S.TEXT);continue;case S.TEXT:if(b.sawRoot&&!b.closedRoot){for(var f=c-1;d&&"<"!==d&&"&"!==d;)d=a.charAt(c++),d&&b.trackPosition&&(b.position++,"\n"===d?(b.line++,b.column=0):b.column++);b.textNode+=a.substring(f,c-1)}"<"!==d||b.sawRoot&&b.closedRoot&&!b.strict?(!m(F,d)||b.sawRoot&&!b.closedRoot||t(b,"Text data outside of root node."),"&"===d?b.state=S.TEXT_ENTITY:b.textNode+=d):(b.state=S.OPEN_WAKA,b.startTagPosition=b.position);continue;case S.SCRIPT:"<"===d?b.state=S.SCRIPT_ENDING:b.script+=d;continue;case S.SCRIPT_ENDING:"/"===d?b.state=S.CLOSE_TAG:(b.script+="<"+d,b.state=S.SCRIPT);continue;case S.OPEN_WAKA:if("!"===d)b.state=S.SGML_DECL,b.sgmlDecl="";else if(l(F,d));else if(l(Q,d))b.state=S.OPEN_TAG,b.tagName=d;else if("/"===d)b.state=S.CLOSE_TAG,b.tagName="";else if("?"===d)b.state=S.PROC_INST,b.procInstName=b.procInstBody="";else{if(t(b,"Unencoded <"),b.startTagPosition+1<b.position){var g=b.position-b.startTagPosition;d=new Array(g).join(" ")+d}b.textNode+="<"+d,b.state=S.TEXT}continue;case S.SGML_DECL:(b.sgmlDecl+d).toUpperCase()===L?(o(b,"onopencdata"),b.state=S.CDATA,b.sgmlDecl="",b.cdata=""):b.sgmlDecl+d==="--"?(b.state=S.COMMENT,b.comment="",b.sgmlDecl=""):(b.sgmlDecl+d).toUpperCase()===M?(b.state=S.DOCTYPE,(b.doctype||b.sawRoot)&&t(b,"Inappropriately located doctype declaration"),b.doctype="",b.sgmlDecl=""):">"===d?(o(b,"onsgmldeclaration",b.sgmlDecl),b.sgmlDecl="",b.state=S.TEXT):l(I,d)?(b.state=S.SGML_DECL_QUOTED,b.sgmlDecl+=d):b.sgmlDecl+=d;continue;case S.SGML_DECL_QUOTED:d===b.q&&(b.state=S.SGML_DECL,b.q=""),b.sgmlDecl+=d;continue;case S.DOCTYPE:">"===d?(b.state=S.TEXT,o(b,"ondoctype",b.doctype),b.doctype=!0):(b.doctype+=d,"["===d?b.state=S.DOCTYPE_DTD:l(I,d)&&(b.state=S.DOCTYPE_QUOTED,b.q=d));continue;case S.DOCTYPE_QUOTED:b.doctype+=d,d===b.q&&(b.q="",b.state=S.DOCTYPE);continue;case S.DOCTYPE_DTD:b.doctype+=d,"]"===d?b.state=S.DOCTYPE:l(I,d)&&(b.state=S.DOCTYPE_DTD_QUOTED,b.q=d);continue;case S.DOCTYPE_DTD_QUOTED:b.doctype+=d,d===b.q&&(b.state=S.DOCTYPE_DTD,b.q="");continue;case S.COMMENT:"-"===d?b.state=S.COMMENT_ENDING:b.comment+=d;continue;case S.COMMENT_ENDING:"-"===d?(b.state=S.COMMENT_ENDED,b.comment=q(b.opt,b.comment),b.comment&&o(b,"oncomment",b.comment),b.comment=""):(b.comment+="-"+d,b.state=S.COMMENT);continue;case S.COMMENT_ENDED:">"!==d?(t(b,"Malformed comment"),b.comment+="--"+d,b.state=S.COMMENT):b.state=S.TEXT;continue;case S.CDATA:"]"===d?b.state=S.CDATA_ENDING:b.cdata+=d;continue;case S.CDATA_ENDING:"]"===d?b.state=S.CDATA_ENDING_2:(b.cdata+="]"+d,b.state=S.CDATA);continue;case S.CDATA_ENDING_2:">"===d?(b.cdata&&o(b,"oncdata",b.cdata),o(b,"onclosecdata"),b.cdata="",b.state=S.TEXT):"]"===d?b.cdata+="]":(b.cdata+="]]"+d,b.state=S.CDATA);continue;case S.PROC_INST:"?"===d?b.state=S.PROC_INST_ENDING:l(F,d)?b.state=S.PROC_INST_BODY:b.procInstName+=d;continue;case S.PROC_INST_BODY:if(!b.procInstBody&&l(F,d))continue;"?"===d?b.state=S.PROC_INST_ENDING:b.procInstBody+=d;continue;case S.PROC_INST_ENDING:">"===d?(o(b,"onprocessinginstruction",{name:b.procInstName,body:b.procInstBody}),b.procInstName=b.procInstBody="",b.state=S.TEXT):(b.procInstBody+="?"+d,b.state=S.PROC_INST_BODY);continue;case S.OPEN_TAG:l(R,d)?b.tagName+=d:(u(b),">"===d?x(b):"/"===d?b.state=S.OPEN_TAG_SLASH:(m(F,d)&&t(b,"Invalid character in tag name"),b.state=S.ATTRIB));continue;case S.OPEN_TAG_SLASH:">"===d?(x(b,!0),y(b)):(t(b,"Forward-slash in opening tag not followed by >"),b.state=S.ATTRIB);continue;case S.ATTRIB:if(l(F,d))continue;">"===d?x(b):"/"===d?b.state=S.OPEN_TAG_SLASH:l(Q,d)?(b.attribName=d,b.attribValue="",b.state=S.ATTRIB_NAME):t(b,"Invalid attribute name");continue;case S.ATTRIB_NAME:"="===d?b.state=S.ATTRIB_VALUE:">"===d?(t(b,"Attribute without value"),b.attribValue=b.attribName,w(b),x(b)):l(F,d)?b.state=S.ATTRIB_NAME_SAW_WHITE:l(R,d)?b.attribName+=d:t(b,"Invalid attribute name");continue;case S.ATTRIB_NAME_SAW_WHITE:if("="===d)b.state=S.ATTRIB_VALUE;else{if(l(F,d))continue;t(b,"Attribute without value"),b.tag.attributes[b.attribName]="",b.attribValue="",o(b,"onattribute",{name:b.attribName,value:""}),b.attribName="",">"===d?x(b):l(Q,d)?(b.attribName=d,b.state=S.ATTRIB_NAME):(t(b,"Invalid attribute name"),b.state=S.ATTRIB)}continue;case S.ATTRIB_VALUE:if(l(F,d))continue;l(I,d)?(b.q=d,b.state=S.ATTRIB_VALUE_QUOTED):(t(b,"Unquoted attribute value"),b.state=S.ATTRIB_VALUE_UNQUOTED,b.attribValue=d);continue;case S.ATTRIB_VALUE_QUOTED:if(d!==b.q){"&"===d?b.state=S.ATTRIB_VALUE_ENTITY_Q:b.attribValue+=d;continue}w(b),b.q="",b.state=S.ATTRIB_VALUE_CLOSED;continue;case S.ATTRIB_VALUE_CLOSED:l(F,d)?b.state=S.ATTRIB:">"===d?x(b):"/"===d?b.state=S.OPEN_TAG_SLASH:l(Q,d)?(t(b,"No whitespace between attributes"),b.attribName=d,b.attribValue="",b.state=S.ATTRIB_NAME):t(b,"Invalid attribute name");continue;case S.ATTRIB_VALUE_UNQUOTED:if(m(K,d)){"&"===d?b.state=S.ATTRIB_VALUE_ENTITY_U:b.attribValue+=d;continue}w(b),">"===d?x(b):b.state=S.ATTRIB;continue;case S.CLOSE_TAG:if(b.tagName)">"===d?y(b):l(R,d)?b.tagName+=d:b.script?(b.script+="</"+b.tagName,b.tagName="",b.state=S.SCRIPT):(m(F,d)&&t(b,"Invalid tagname in closing tag"),b.state=S.CLOSE_TAG_SAW_WHITE);else{if(l(F,d))continue;m(Q,d)?b.script?(b.script+="</"+d,b.state=S.SCRIPT):t(b,"Invalid tagname in closing tag."):b.tagName=d}continue;case S.CLOSE_TAG_SAW_WHITE:if(l(F,d))continue;">"===d?y(b):t(b,"Invalid characters in closing tag");continue;case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:switch(b.state){case S.TEXT_ENTITY:var h=S.TEXT,i="textNode";break;case S.ATTRIB_VALUE_ENTITY_Q:var h=S.ATTRIB_VALUE_QUOTED,i="attribValue";break;case S.ATTRIB_VALUE_ENTITY_U:var h=S.ATTRIB_VALUE_UNQUOTED,i="attribValue"}";"===d?(b[i]+=z(b),b.entity="",b.state=h):l(J,d)?b.entity+=d:(t(b,"Invalid character entity"),b[i]+="&"+b.entity+d,b.entity="",b.state=h);continue;default:throw new Error(b,"Unknown state: "+b.state)}return b.position>=b.bufferCheckPosition&&e(b),b}c.parser=function(a,b){return new d(a,b)},c.SAXParser=d,c.SAXStream=i,c.createStream=h,c.MAX_BUFFER_LENGTH=65536;var B=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];c.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(a){function b(){this.__proto__=a}return b.prototype=a,new b}),Object.getPrototypeOf||(Object.getPrototypeOf=function(a){return a.__proto__}),Object.keys||(Object.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}),d.prototype={end:function(){s(this)},write:A,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){g(this)}};try{var C=a("stream").Stream}catch(D){var C=function(){}}var E=c.EVENTS.filter(function(a){return"error"!==a&&"end"!==a});i.prototype=Object.create(C.prototype,{constructor:{value:i}}),i.prototype.write=function(c){if("function"==typeof b&&"function"==typeof b.isBuffer&&b.isBuffer(c)){if(!this._decoder){var d=a("string_decoder").StringDecoder;this._decoder=new d("utf8")}c=this._decoder.write(c)}return this._parser.write(c.toString()),this.emit("data",c),!0},i.prototype.end=function(a){return a&&a.length&&this.write(a),this._parser.end(),!0},i.prototype.on=function(a,b){var c=this;return c._parser["on"+a]||-1===E.indexOf(a)||(c._parser["on"+a]=function(){var b=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);b.splice(0,0,a),c.emit.apply(c,b)}),C.prototype.on.call(c,a,b)};var F="\r\n	 ",G="0124356789",H="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",I="'\"",J=G+H+"#",K=F+">",L="[CDATA[",M="DOCTYPE",N="http://www.w3.org/XML/1998/namespace",O="http://www.w3.org/2000/xmlns/",P={xml:N,xmlns:O};F=j(F),G=j(G),H=j(H);var Q=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,R=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;I=j(I),J=j(J),K=j(K);var S=0;c.STATE={BEGIN:S++,BEGIN_WHITESPACE:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++},c.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},c.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(c.ENTITIES).forEach(function(a){var b=c.ENTITIES[a],d="number"==typeof b?String.fromCharCode(b):b;c.ENTITIES[a]=d});for(var S in c.STATE)c.STATE[c.STATE[S]]=S;S=c.STATE,String.fromCodePoint||!function(){var a=String.fromCharCode,b=Math.floor,c=function(){var c,d,e=16384,f=[],g=-1,h=arguments.length;if(!h)return"";for(var i="";++g<h;){var j=Number(arguments[g]);if(!isFinite(j)||0>j||j>1114111||b(j)!=j)throw RangeError("Invalid code point: "+j);65535>=j?f.push(j):(j-=65536,c=(j>>10)+55296,d=j%1024+56320,f.push(c,d)),(g+1==h||f.length>e)&&(i+=a.apply(null,f),f.length=0)}return i};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:c,configurable:!0,writable:!0}):String.fromCodePoint=c}()}("undefined"==typeof c?sax={}:c)}).call(this,a("buffer").Buffer)},{buffer:22,stream:42,string_decoder:43}],51:[function(a,b,c){(function(){var c,d;d=a("lodash/object/create"),b.exports=c=function(){function a(a,b,c){if(this.stringify=a.stringify,null==b)throw new Error("Missing attribute name of element "+a.name);if(null==c)throw new Error("Missing attribute value for attribute "+b+" of element "+a.name);this.name=this.stringify.attName(b),this.value=this.stringify.attValue(c)}return a.prototype.clone=function(){return d(a.prototype,this)},a.prototype.toString=function(a,b){return" "+this.name+'="'+this.value+'"'},a}()}).call(this)},{"lodash/object/create":121}],52:[function(a,b,c){(function(){var c,d,e,f,g;g=a("./XMLStringifier"),d=a("./XMLDeclaration"),e=a("./XMLDocType"),f=a("./XMLElement"),b.exports=c=function(){function a(a,b){var c,d;if(null==a)throw new Error("Root element needs a name");null==b&&(b={}),this.options=b,this.stringify=new g(b),d=new f(this,"doc"),c=d.element(a),c.isRoot=!0,c.documentObject=this,this.rootObject=c,b.headless||(c.declaration(b),(null!=b.pubID||null!=b.sysID)&&c.doctype(b))}return a.prototype.root=function(){return this.rootObject},a.prototype.end=function(a){return this.toString(a)},a.prototype.toString=function(a){var b,c,d,e,f,g,h,i;return e=(null!=a?a.pretty:void 0)||!1,b=null!=(g=null!=a?a.indent:void 0)?g:"  ",d=null!=(h=null!=a?a.offset:void 0)?h:0,c=null!=(i=null!=a?a.newline:void 0)?i:"\n",f="",null!=this.xmldec&&(f+=this.xmldec.toString(a)),null!=this.doctype&&(f+=this.doctype.toString(a)),f+=this.rootObject.toString(a),e&&f.slice(-c.length)===c&&(f=f.slice(0,-c.length)),f},a}()}).call(this)},{"./XMLDeclaration":59,"./XMLDocType":60,"./XMLElement":61,"./XMLStringifier":65}],53:[function(a,b,c){(function(){var c,d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;e=a("lodash/object/create"),d=a("./XMLNode"),b.exports=c=function(a){function b(a,c){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing CDATA text");this.text=this.stringify.cdata(c)}return f(b,a),b.prototype.clone=function(){return e(b.prototype,this)},b.prototype.toString=function(a,b){var c,d,e,f,g,h,i,j,k;return f=(null!=a?a.pretty:void 0)||!1,c=null!=(h=null!=a?a.indent:void 0)?h:"  ",e=null!=(i=null!=a?a.offset:void 0)?i:0,d=null!=(j=null!=a?a.newline:void 0)?j:"\n",b||(b=0),k=new Array(b+e+1).join(c),g="",f&&(g+=k),g+="<![CDATA["+this.text+"]]>",f&&(g+=d),g},b}(d)}).call(this)},{"./XMLNode":62,"lodash/object/create":121}],54:[function(a,b,c){(function(){var c,d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;e=a("lodash/object/create"),d=a("./XMLNode"),b.exports=c=function(a){function b(a,c){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing comment text");this.text=this.stringify.comment(c)}return f(b,a),b.prototype.clone=function(){return e(b.prototype,this)},b.prototype.toString=function(a,b){var c,d,e,f,g,h,i,j,k;return f=(null!=a?a.pretty:void 0)||!1,c=null!=(h=null!=a?a.indent:void 0)?h:"  ",e=null!=(i=null!=a?a.offset:void 0)?i:0,d=null!=(j=null!=a?a.newline:void 0)?j:"\n",b||(b=0),k=new Array(b+e+1).join(c),g="",f&&(g+=k),g+="<!-- "+this.text+" -->",f&&(g+=d),g},b}(d)}).call(this)},{"./XMLNode":62,"lodash/object/create":121}],55:[function(a,b,c){(function(){var c,d;d=a("lodash/object/create"),b.exports=c=function(){function a(a,b,c,d,e,f){if(this.stringify=a.stringify,null==b)throw new Error("Missing DTD element name");if(null==c)throw new Error("Missing DTD attribute name");if(!d)throw new Error("Missing DTD attribute type");if(!e)throw new Error("Missing DTD attribute default");if(0!==e.indexOf("#")&&(e="#"+e),!e.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT");if(f&&!e.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT");this.elementName=this.stringify.eleName(b),this.attributeName=this.stringify.attName(c),this.attributeType=this.stringify.dtdAttType(d),this.defaultValue=this.stringify.dtdAttDefault(f),this.defaultValueType=e}return a.prototype.clone=function(){return d(a.prototype,this)},a.prototype.toString=function(a,b){var c,d,e,f,g,h,i,j,k;return f=(null!=a?a.pretty:void 0)||!1,c=null!=(h=null!=a?a.indent:void 0)?h:"  ",e=null!=(i=null!=a?a.offset:void 0)?i:0,d=null!=(j=null!=a?a.newline:void 0)?j:"\n",b||(b=0),k=new Array(b+e+1).join(c),g="",f&&(g+=k),g+="<!ATTLIST "+this.elementName+" "+this.attributeName+" "+this.attributeType,"#DEFAULT"!==this.defaultValueType&&(g+=" "+this.defaultValueType),this.defaultValue&&(g+=' "'+this.defaultValue+'"'),g+=">",f&&(g+=d),g},a}()}).call(this)},{"lodash/object/create":121}],56:[function(a,b,c){(function(){var c,d;d=a("lodash/object/create"),b.exports=c=function(){function a(a,b,c){if(this.stringify=a.stringify,null==b)throw new Error("Missing DTD element name");c||(c="(#PCDATA)"),Array.isArray(c)&&(c="("+c.join(",")+")"),this.name=this.stringify.eleName(b),this.value=this.stringify.dtdElementValue(c)}return a.prototype.clone=function(){return d(a.prototype,this)},a.prototype.toString=function(a,b){var c,d,e,f,g,h,i,j,k;return f=(null!=a?a.pretty:void 0)||!1,c=null!=(h=null!=a?a.indent:void 0)?h:"  ",e=null!=(i=null!=a?a.offset:void 0)?i:0,d=null!=(j=null!=a?a.newline:void 0)?j:"\n",b||(b=0),k=new Array(b+e+1).join(c),g="",f&&(g+=k),g+="<!ELEMENT "+this.name+" "+this.value+">",f&&(g+=d),g},a}()}).call(this)},{"lodash/object/create":121}],57:[function(a,b,c){(function(){var c,d,e;d=a("lodash/object/create"),e=a("lodash/lang/isObject"),b.exports=c=function(){function a(a,b,c,d){if(this.stringify=a.stringify,null==c)throw new Error("Missing entity name");if(null==d)throw new Error("Missing entity value");if(this.pe=!!b,this.name=this.stringify.eleName(c),e(d)){if(!d.pubID&&!d.sysID)throw new Error("Public and/or system identifiers are required for an external entity");if(d.pubID&&!d.sysID)throw new Error("System identifier is required for a public external entity");if(null!=d.pubID&&(this.pubID=this.stringify.dtdPubID(d.pubID)),null!=d.sysID&&(this.sysID=this.stringify.dtdSysID(d.sysID)),null!=d.nData&&(this.nData=this.stringify.dtdNData(d.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity")}else this.value=this.stringify.dtdEntityValue(d)}return a.prototype.clone=function(){return d(a.prototype,this)},a.prototype.toString=function(a,b){var c,d,e,f,g,h,i,j,k;return f=(null!=a?a.pretty:void 0)||!1,c=null!=(h=null!=a?a.indent:void 0)?h:"  ",e=null!=(i=null!=a?a.offset:void 0)?i:0,d=null!=(j=null!=a?a.newline:void 0)?j:"\n",b||(b=0),k=new Array(b+e+1).join(c),g="",f&&(g+=k),g+="<!ENTITY",this.pe&&(g+=" %"),g+=" "+this.name,this.value?g+=' "'+this.value+'"':(this.pubID&&this.sysID?g+=' PUBLIC "'+this.pubID+'" "'+this.sysID+'"':this.sysID&&(g+=' SYSTEM "'+this.sysID+'"'),this.nData&&(g+=" NDATA "+this.nData)),g+=">",f&&(g+=d),g},a}()}).call(this)},{"lodash/lang/isObject":117,"lodash/object/create":121}],58:[function(a,b,c){(function(){var c,d;d=a("lodash/object/create"),b.exports=c=function(){function a(a,b,c){if(this.stringify=a.stringify,null==b)throw new Error("Missing notation name");if(!c.pubID&&!c.sysID)throw new Error("Public or system identifiers are required for an external entity");this.name=this.stringify.eleName(b),null!=c.pubID&&(this.pubID=this.stringify.dtdPubID(c.pubID)),null!=c.sysID&&(this.sysID=this.stringify.dtdSysID(c.sysID))}return a.prototype.clone=function(){return d(a.prototype,this)},a.prototype.toString=function(a,b){var c,d,e,f,g,h,i,j,k;return f=(null!=a?a.pretty:void 0)||!1,c=null!=(h=null!=a?a.indent:void 0)?h:"  ",e=null!=(i=null!=a?a.offset:void 0)?i:0,d=null!=(j=null!=a?a.newline:void 0)?j:"\n",b||(b=0),k=new Array(b+e+1).join(c),
g="",f&&(g+=k),g+="<!NOTATION "+this.name,this.pubID&&this.sysID?g+=' PUBLIC "'+this.pubID+'" "'+this.sysID+'"':this.pubID?g+=' PUBLIC "'+this.pubID+'"':this.sysID&&(g+=' SYSTEM "'+this.sysID+'"'),g+=">",f&&(g+=d),g},a}()}).call(this)},{"lodash/object/create":121}],59:[function(a,b,c){(function(){var c,d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("lodash/object/create"),f=a("lodash/lang/isObject"),d=a("./XMLNode"),b.exports=c=function(a){function b(a,c,d,e){var g;b.__super__.constructor.call(this,a),f(c)&&(g=c,c=g.version,d=g.encoding,e=g.standalone),c||(c="1.0"),null!=c&&(this.version=this.stringify.xmlVersion(c)),null!=d&&(this.encoding=this.stringify.xmlEncoding(d)),null!=e&&(this.standalone=this.stringify.xmlStandalone(e))}return g(b,a),b.prototype.clone=function(){return e(b.prototype,this)},b.prototype.toString=function(a,b){var c,d,e,f,g,h,i,j,k;return f=(null!=a?a.pretty:void 0)||!1,c=null!=(h=null!=a?a.indent:void 0)?h:"  ",e=null!=(i=null!=a?a.offset:void 0)?i:0,d=null!=(j=null!=a?a.newline:void 0)?j:"\n",b||(b=0),k=new Array(b+e+1).join(c),g="",f&&(g+=k),g+="<?xml",null!=this.version&&(g+=' version="'+this.version+'"'),null!=this.encoding&&(g+=' encoding="'+this.encoding+'"'),null!=this.standalone&&(g+=' standalone="'+this.standalone+'"'),g+="?>",f&&(g+=d),g},b}(d)}).call(this)},{"./XMLNode":62,"lodash/lang/isObject":117,"lodash/object/create":121}],60:[function(a,b,c){(function(){var c,d,e,f,g,h,i,j,k,l;k=a("lodash/object/create"),l=a("lodash/lang/isObject"),c=a("./XMLCData"),d=a("./XMLComment"),e=a("./XMLDTDAttList"),g=a("./XMLDTDEntity"),f=a("./XMLDTDElement"),h=a("./XMLDTDNotation"),j=a("./XMLProcessingInstruction"),b.exports=i=function(){function a(a,b,c){var d,e;this.documentObject=a,this.stringify=this.documentObject.stringify,this.children=[],l(b)&&(d=b,b=d.pubID,c=d.sysID),null==c&&(e=[b,c],c=e[0],b=e[1]),null!=b&&(this.pubID=this.stringify.dtdPubID(b)),null!=c&&(this.sysID=this.stringify.dtdSysID(c))}return a.prototype.clone=function(){return k(a.prototype,this)},a.prototype.element=function(a,b){var c;return c=new f(this,a,b),this.children.push(c),this},a.prototype.attList=function(a,b,c,d,f){var g;return g=new e(this,a,b,c,d,f),this.children.push(g),this},a.prototype.entity=function(a,b){var c;return c=new g(this,!1,a,b),this.children.push(c),this},a.prototype.pEntity=function(a,b){var c;return c=new g(this,!0,a,b),this.children.push(c),this},a.prototype.notation=function(a,b){var c;return c=new h(this,a,b),this.children.push(c),this},a.prototype.cdata=function(a){var b;return b=new c(this,a),this.children.push(b),this},a.prototype.comment=function(a){var b;return b=new d(this,a),this.children.push(b),this},a.prototype.instruction=function(a,b){var c;return c=new j(this,a,b),this.children.push(c),this},a.prototype.root=function(){return this.documentObject.root()},a.prototype.document=function(){return this.documentObject},a.prototype.toString=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;if(i=(null!=a?a.pretty:void 0)||!1,e=null!=(k=null!=a?a.indent:void 0)?k:"  ",h=null!=(l=null!=a?a.offset:void 0)?l:0,g=null!=(m=null!=a?a.newline:void 0)?m:"\n",b||(b=0),o=new Array(b+h+1).join(e),j="",i&&(j+=o),j+="<!DOCTYPE "+this.root().name,this.pubID&&this.sysID?j+=' PUBLIC "'+this.pubID+'" "'+this.sysID+'"':this.sysID&&(j+=' SYSTEM "'+this.sysID+'"'),this.children.length>0){for(j+=" [",i&&(j+=g),n=this.children,d=0,f=n.length;f>d;d++)c=n[d],j+=c.toString(a,b+1);j+="]"}return j+=">",i&&(j+=g),j},a.prototype.ele=function(a,b){return this.element(a,b)},a.prototype.att=function(a,b,c,d,e){return this.attList(a,b,c,d,e)},a.prototype.ent=function(a,b){return this.entity(a,b)},a.prototype.pent=function(a,b){return this.pEntity(a,b)},a.prototype.not=function(a,b){return this.notation(a,b)},a.prototype.dat=function(a){return this.cdata(a)},a.prototype.com=function(a){return this.comment(a)},a.prototype.ins=function(a,b){return this.instruction(a,b)},a.prototype.up=function(){return this.root()},a.prototype.doc=function(){return this.document()},a}()}).call(this)},{"./XMLCData":53,"./XMLComment":54,"./XMLDTDAttList":55,"./XMLDTDElement":56,"./XMLDTDEntity":57,"./XMLDTDNotation":58,"./XMLProcessingInstruction":63,"lodash/lang/isObject":117,"lodash/object/create":121}],61:[function(a,b,c){(function(){var c,d,e,f,g,h,i,j,k=function(a,b){function c(){this.constructor=a}for(var d in b)l.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},l={}.hasOwnProperty;g=a("lodash/object/create"),j=a("lodash/lang/isObject"),i=a("lodash/lang/isFunction"),h=a("lodash/collection/every"),e=a("./XMLNode"),c=a("./XMLAttribute"),f=a("./XMLProcessingInstruction"),b.exports=d=function(a){function b(a,c,d){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing element name");this.name=this.stringify.eleName(c),this.children=[],this.instructions=[],this.attributes={},null!=d&&this.attribute(d)}return k(b,a),b.prototype.clone=function(){var a,c,d,e,f,h,i,j;d=g(b.prototype,this),d.isRoot&&(d.documentObject=null),d.attributes={},i=this.attributes;for(c in i)l.call(i,c)&&(a=i[c],d.attributes[c]=a.clone());for(d.instructions=[],j=this.instructions,e=0,f=j.length;f>e;e++)h=j[e],d.instructions.push(h.clone());return d.children=[],this.children.forEach(function(a){var b;return b=a.clone(),b.parent=d,d.children.push(b)}),d},b.prototype.attribute=function(a,b){var d,e;if(null!=a&&(a=a.valueOf()),j(a))for(d in a)l.call(a,d)&&(e=a[d],this.attribute(d,e));else i(b)&&(b=b.apply()),this.options.skipNullAttributes&&null==b||(this.attributes[a]=new c(this,a,b));return this},b.prototype.removeAttribute=function(a){var b,c,d;if(null==a)throw new Error("Missing attribute name");if(a=a.valueOf(),Array.isArray(a))for(c=0,d=a.length;d>c;c++)b=a[c],delete this.attributes[b];else delete this.attributes[a];return this},b.prototype.instruction=function(a,b){var c,d,e,g,h;if(null!=a&&(a=a.valueOf()),null!=b&&(b=b.valueOf()),Array.isArray(a))for(c=0,h=a.length;h>c;c++)d=a[c],this.instruction(d);else if(j(a))for(d in a)l.call(a,d)&&(e=a[d],this.instruction(d,e));else i(b)&&(b=b.apply()),g=new f(this,a,b),this.instructions.push(g);return this},b.prototype.toString=function(a,b){var c,d,e,f,g,i,j,k,m,n,o,p,q,r,s,t,u,v,w,x;for(p=(null!=a?a.pretty:void 0)||!1,f=null!=(r=null!=a?a.indent:void 0)?r:"  ",o=null!=(s=null!=a?a.offset:void 0)?s:0,n=null!=(t=null!=a?a.newline:void 0)?t:"\n",b||(b=0),x=new Array(b+o+1).join(f),q="",u=this.instructions,e=0,j=u.length;j>e;e++)g=u[e],q+=g.toString(a,b);p&&(q+=x),q+="<"+this.name,v=this.attributes;for(m in v)l.call(v,m)&&(c=v[m],q+=c.toString(a));if(0===this.children.length||h(this.children,function(a){return""===a.value}))q+="/>",p&&(q+=n);else if(p&&1===this.children.length&&null!=this.children[0].value)q+=">",q+=this.children[0].value,q+="</"+this.name+">",q+=n;else{for(q+=">",p&&(q+=n),w=this.children,i=0,k=w.length;k>i;i++)d=w[i],q+=d.toString(a,b+1);p&&(q+=x),q+="</"+this.name+">",p&&(q+=n)}return q},b.prototype.att=function(a,b){return this.attribute(a,b)},b.prototype.ins=function(a,b){return this.instruction(a,b)},b.prototype.a=function(a,b){return this.attribute(a,b)},b.prototype.i=function(a,b){return this.instruction(a,b)},b}(e)}).call(this)},{"./XMLAttribute":51,"./XMLNode":62,"./XMLProcessingInstruction":63,"lodash/collection/every":69,"lodash/lang/isFunction":115,"lodash/lang/isObject":117,"lodash/object/create":121}],62:[function(a,b,c){(function(){var c,d,e,f,g,h,i,j,k,l,m,n={}.hasOwnProperty;m=a("lodash/lang/isObject"),l=a("lodash/lang/isFunction"),k=a("lodash/lang/isEmpty"),g=null,c=null,d=null,e=null,f=null,i=null,j=null,b.exports=h=function(){function b(b){this.parent=b,this.options=this.parent.options,this.stringify=this.parent.stringify,null===g&&(g=a("./XMLElement"),c=a("./XMLCData"),d=a("./XMLComment"),e=a("./XMLDeclaration"),f=a("./XMLDocType"),i=a("./XMLRaw"),j=a("./XMLText"))}return b.prototype.clone=function(){throw new Error("Cannot clone generic XMLNode")},b.prototype.element=function(a,b,c){var d,e,f,g,h,i,j;if(g=null,null==b&&(b={}),b=b.valueOf(),m(b)||(i=[b,c],c=i[0],b=i[1]),null!=a&&(a=a.valueOf()),Array.isArray(a))for(e=0,h=a.length;h>e;e++)d=a[e],g=this.element(d);else if(l(a))g=this.element(a.apply());else if(m(a))for(f in a)n.call(a,f)&&(j=a[f],l(j)&&(j=j.apply()),m(j)&&k(j)&&(j=null),j||this.options.ignoreDecorators||!this.stringify.convertListKey||0!==f.indexOf(this.stringify.convertListKey)?!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===f.indexOf(this.stringify.convertAttKey)?g=this.attribute(f.substr(this.stringify.convertAttKey.length),j):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===f.indexOf(this.stringify.convertPIKey)?g=this.instruction(f.substr(this.stringify.convertPIKey.length),j):m(j)?!this.options.ignoreDecorators&&this.stringify.convertListKey&&0===f.indexOf(this.stringify.convertListKey)&&Array.isArray(j)?g=this.element(j):(g=this.element(f),g.element(j)):g=this.element(f,j):g=this);else g=!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===a.indexOf(this.stringify.convertTextKey)?this.text(c):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===a.indexOf(this.stringify.convertCDataKey)?this.cdata(c):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===a.indexOf(this.stringify.convertCommentKey)?this.comment(c):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===a.indexOf(this.stringify.convertRawKey)?this.raw(c):this.node(a,b,c);if(null==g)throw new Error("Could not create any elements with: "+a);return g},b.prototype.insertBefore=function(a,b,c){var d,e,f;if(this.isRoot)throw new Error("Cannot insert elements at root level");return e=this.parent.children.indexOf(this),f=this.parent.children.splice(e),d=this.parent.element(a,b,c),Array.prototype.push.apply(this.parent.children,f),d},b.prototype.insertAfter=function(a,b,c){var d,e,f;if(this.isRoot)throw new Error("Cannot insert elements at root level");return e=this.parent.children.indexOf(this),f=this.parent.children.splice(e+1),d=this.parent.element(a,b,c),Array.prototype.push.apply(this.parent.children,f),d},b.prototype.remove=function(){var a,b;if(this.isRoot)throw new Error("Cannot remove the root element");return a=this.parent.children.indexOf(this),[].splice.apply(this.parent.children,[a,a-a+1].concat(b=[])),this.parent},b.prototype.node=function(a,b,c){var d,e;return null!=a&&(a=a.valueOf()),null==b&&(b={}),b=b.valueOf(),m(b)||(e=[b,c],c=e[0],b=e[1]),d=new g(this,a,b),null!=c&&d.text(c),this.children.push(d),d},b.prototype.text=function(a){var b;return b=new j(this,a),this.children.push(b),this},b.prototype.cdata=function(a){var b;return b=new c(this,a),this.children.push(b),this},b.prototype.comment=function(a){var b;return b=new d(this,a),this.children.push(b),this},b.prototype.raw=function(a){var b;return b=new i(this,a),this.children.push(b),this},b.prototype.declaration=function(a,b,c){var d,f;return d=this.document(),f=new e(d,a,b,c),d.xmldec=f,d.root()},b.prototype.doctype=function(a,b){var c,d;return c=this.document(),d=new f(c,a,b),c.doctype=d,d},b.prototype.up=function(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent},b.prototype.root=function(){var a;if(this.isRoot)return this;for(a=this.parent;!a.isRoot;)a=a.parent;return a},b.prototype.document=function(){return this.root().documentObject},b.prototype.end=function(a){return this.document().toString(a)},b.prototype.prev=function(){var a;if(this.isRoot)throw new Error("Root node has no siblings");if(a=this.parent.children.indexOf(this),1>a)throw new Error("Already at the first node");return this.parent.children[a-1]},b.prototype.next=function(){var a;if(this.isRoot)throw new Error("Root node has no siblings");if(a=this.parent.children.indexOf(this),-1===a||a===this.parent.children.length-1)throw new Error("Already at the last node");return this.parent.children[a+1]},b.prototype.importXMLBuilder=function(a){var b;return b=a.root().clone(),b.parent=this,b.isRoot=!1,this.children.push(b),this},b.prototype.ele=function(a,b,c){return this.element(a,b,c)},b.prototype.nod=function(a,b,c){return this.node(a,b,c)},b.prototype.txt=function(a){return this.text(a)},b.prototype.dat=function(a){return this.cdata(a)},b.prototype.com=function(a){return this.comment(a)},b.prototype.doc=function(){return this.document()},b.prototype.dec=function(a,b,c){return this.declaration(a,b,c)},b.prototype.dtd=function(a,b){return this.doctype(a,b)},b.prototype.e=function(a,b,c){return this.element(a,b,c)},b.prototype.n=function(a,b,c){return this.node(a,b,c)},b.prototype.t=function(a){return this.text(a)},b.prototype.d=function(a){return this.cdata(a)},b.prototype.c=function(a){return this.comment(a)},b.prototype.r=function(a){return this.raw(a)},b.prototype.u=function(){return this.up()},b}()}).call(this)},{"./XMLCData":53,"./XMLComment":54,"./XMLDeclaration":59,"./XMLDocType":60,"./XMLElement":61,"./XMLRaw":64,"./XMLText":66,"lodash/lang/isEmpty":114,"lodash/lang/isFunction":115,"lodash/lang/isObject":117}],63:[function(a,b,c){(function(){var c,d;d=a("lodash/object/create"),b.exports=c=function(){function a(a,b,c){if(this.stringify=a.stringify,null==b)throw new Error("Missing instruction target");this.target=this.stringify.insTarget(b),c&&(this.value=this.stringify.insValue(c))}return a.prototype.clone=function(){return d(a.prototype,this)},a.prototype.toString=function(a,b){var c,d,e,f,g,h,i,j,k;return f=(null!=a?a.pretty:void 0)||!1,c=null!=(h=null!=a?a.indent:void 0)?h:"  ",e=null!=(i=null!=a?a.offset:void 0)?i:0,d=null!=(j=null!=a?a.newline:void 0)?j:"\n",b||(b=0),k=new Array(b+e+1).join(c),g="",f&&(g+=k),g+="<?",g+=this.target,this.value&&(g+=" "+this.value),g+="?>",f&&(g+=d),g},a}()}).call(this)},{"lodash/object/create":121}],64:[function(a,b,c){(function(){var c,d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;e=a("lodash/object/create"),c=a("./XMLNode"),b.exports=d=function(a){function b(a,c){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing raw text");this.value=this.stringify.raw(c)}return f(b,a),b.prototype.clone=function(){return e(b.prototype,this)},b.prototype.toString=function(a,b){var c,d,e,f,g,h,i,j,k;return f=(null!=a?a.pretty:void 0)||!1,c=null!=(h=null!=a?a.indent:void 0)?h:"  ",e=null!=(i=null!=a?a.offset:void 0)?i:0,d=null!=(j=null!=a?a.newline:void 0)?j:"\n",b||(b=0),k=new Array(b+e+1).join(c),g="",f&&(g+=k),g+=this.value,f&&(g+=d),g},b}(c)}).call(this)},{"./XMLNode":62,"lodash/object/create":121}],65:[function(a,b,c){(function(){var a,c=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty;b.exports=a=function(){function a(a){this.assertLegalChar=c(this.assertLegalChar,this);var b,e,f;this.allowSurrogateChars=null!=a?a.allowSurrogateChars:void 0,e=(null!=a?a.stringify:void 0)||{};for(b in e)d.call(e,b)&&(f=e[b],this[b]=f)}return a.prototype.eleName=function(a){return a=""+a||"",this.assertLegalChar(a)},a.prototype.eleText=function(a){return a=""+a||"",this.assertLegalChar(this.elEscape(a))},a.prototype.cdata=function(a){if(a=""+a||"",a.match(/]]>/))throw new Error("Invalid CDATA text: "+a);return this.assertLegalChar(a)},a.prototype.comment=function(a){if(a=""+a||"",a.match(/--/))throw new Error("Comment text cannot contain double-hypen: "+a);return this.assertLegalChar(a)},a.prototype.raw=function(a){return""+a||""},a.prototype.attName=function(a){return""+a||""},a.prototype.attValue=function(a){return a=""+a||"",this.attEscape(a)},a.prototype.insTarget=function(a){return""+a||""},a.prototype.insValue=function(a){if(a=""+a||"",a.match(/\?>/))throw new Error("Invalid processing instruction value: "+a);return a},a.prototype.xmlVersion=function(a){if(a=""+a||"",!a.match(/1\.[0-9]+/))throw new Error("Invalid version number: "+a);return a},a.prototype.xmlEncoding=function(a){if(a=""+a||"",!a.match(/[A-Za-z](?:[A-Za-z0-9._-]|-)*/))throw new Error("Invalid encoding: "+a);return a},a.prototype.xmlStandalone=function(a){return a?"yes":"no"},a.prototype.dtdPubID=function(a){return""+a||""},a.prototype.dtdSysID=function(a){return""+a||""},a.prototype.dtdElementValue=function(a){return""+a||""},a.prototype.dtdAttType=function(a){return""+a||""},a.prototype.dtdAttDefault=function(a){return null!=a?""+a||"":a},a.prototype.dtdEntityValue=function(a){return""+a||""},a.prototype.dtdNData=function(a){return""+a||""},a.prototype.convertAttKey="@",a.prototype.convertPIKey="?",a.prototype.convertTextKey="#text",a.prototype.convertCDataKey="#cdata",a.prototype.convertCommentKey="#comment",a.prototype.convertRawKey="#raw",a.prototype.convertListKey="#list",a.prototype.assertLegalChar=function(a){var b,c;if(b=this.allowSurrogateChars?/[\u0000-\u0008\u000B-\u000C\u000E-\u001F\uFFFE-\uFFFF]/:/[\u0000-\u0008\u000B-\u000C\u000E-\u001F\uD800-\uDFFF\uFFFE-\uFFFF]/,c=a.match(b))throw new Error("Invalid character ("+c+") in string: "+a+" at index "+c.index);return a},a.prototype.elEscape=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")},a.prototype.attEscape=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},a}()}).call(this)},{}],66:[function(a,b,c){(function(){var c,d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;e=a("lodash/object/create"),c=a("./XMLNode"),b.exports=d=function(a){function b(a,c){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing element text");this.value=this.stringify.eleText(c)}return f(b,a),b.prototype.clone=function(){return e(b.prototype,this)},b.prototype.toString=function(a,b){var c,d,e,f,g,h,i,j,k;return f=(null!=a?a.pretty:void 0)||!1,c=null!=(h=null!=a?a.indent:void 0)?h:"  ",e=null!=(i=null!=a?a.offset:void 0)?i:0,d=null!=(j=null!=a?a.newline:void 0)?j:"\n",b||(b=0),k=new Array(b+e+1).join(c),g="",f&&(g+=k),g+=this.value,f&&(g+=d),g},b}(c)}).call(this)},{"./XMLNode":62,"lodash/object/create":121}],67:[function(a,b,c){(function(){var c,d;d=a("lodash/object/assign"),c=a("./XMLBuilder"),b.exports.create=function(a,b,e,f){return f=d({},b,e,f),new c(a,f).root()}}).call(this)},{"./XMLBuilder":52,"lodash/object/assign":120}],68:[function(a,b,c){function d(a){var b=a?a.length:0;return b?a[b-1]:void 0}b.exports=d},{}],69:[function(a,b,c){function d(a,b,c){var d=h(a)?e:g;return c&&i(a,b,c)&&(b=void 0),("function"!=typeof b||void 0!==c)&&(b=f(b,c,3)),d(a,b)}var e=a("../internal/arrayEvery"),f=a("../internal/baseCallback"),g=a("../internal/baseEvery"),h=a("../lang/isArray"),i=a("../internal/isIterateeCall");b.exports=d},{"../internal/arrayEvery":71,"../internal/baseCallback":75,"../internal/baseEvery":79,"../internal/isIterateeCall":104,"../lang/isArray":113}],70:[function(a,b,c){function d(a,b){if("function"!=typeof a)throw new TypeError(e);return b=f(void 0===b?a.length-1:+b||0,0),function(){for(var c=arguments,d=-1,e=f(c.length-b,0),g=Array(e);++d<e;)g[d]=c[b+d];switch(b){case 0:return a.call(this,g);case 1:return a.call(this,c[0],g);case 2:return a.call(this,c[0],c[1],g)}var h=Array(b+1);for(d=-1;++d<b;)h[d]=c[d];return h[b]=g,a.apply(this,h)}}var e="Expected a function",f=Math.max;b.exports=d},{}],71:[function(a,b,c){function d(a,b){for(var c=-1,d=a.length;++c<d;)if(!b(a[c],c,a))return!1;return!0}b.exports=d},{}],72:[function(a,b,c){function d(a,b){for(var c=-1,d=a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}b.exports=d},{}],73:[function(a,b,c){function d(a,b,c){for(var d=-1,f=e(b),g=f.length;++d<g;){var h=f[d],i=a[h],j=c(i,b[h],h,a,b);(j===j?j===i:i!==i)&&(void 0!==i||h in a)||(a[h]=j)}return a}var e=a("../object/keys");b.exports=d},{"../object/keys":122}],74:[function(a,b,c){function d(a,b){return null==b?a:e(b,f(b),a)}var e=a("./baseCopy"),f=a("../object/keys");b.exports=d},{"../object/keys":122,"./baseCopy":76}],75:[function(a,b,c){function d(a,b,c){var d=typeof a;return"function"==d?void 0===b?a:g(a,b,c):null==a?h:"object"==d?e(a):void 0===b?i(a):f(a,b)}var e=a("./baseMatches"),f=a("./baseMatchesProperty"),g=a("./bindCallback"),h=a("../utility/identity"),i=a("../utility/property");b.exports=d},{"../utility/identity":125,"../utility/property":126,"./baseMatches":86,"./baseMatchesProperty":87,"./bindCallback":92}],76:[function(a,b,c){function d(a,b,c){c||(c={});for(var d=-1,e=b.length;++d<e;){var f=b[d];c[f]=a[f]}return c}b.exports=d},{}],77:[function(a,b,c){var d=a("../lang/isObject"),e=function(){function a(){}return function(b){if(d(b)){a.prototype=b;var c=new a;a.prototype=void 0}return c||{}}}();b.exports=e},{"../lang/isObject":117}],78:[function(a,b,c){var d=a("./baseForOwn"),e=a("./createBaseEach"),f=e(d);b.exports=f},{"./baseForOwn":81,"./createBaseEach":94}],79:[function(a,b,c){function d(a,b){var c=!0;return e(a,function(a,d,e){return c=!!b(a,d,e)}),c}var e=a("./baseEach");b.exports=d},{"./baseEach":78}],80:[function(a,b,c){var d=a("./createBaseFor"),e=d();b.exports=e},{"./createBaseFor":95}],81:[function(a,b,c){function d(a,b){return e(a,b,f)}var e=a("./baseFor"),f=a("../object/keys");b.exports=d},{"../object/keys":122,"./baseFor":80}],82:[function(a,b,c){function d(a,b,c){if(null!=a){void 0!==c&&c in e(a)&&(b=[c]);for(var d=0,f=b.length;null!=a&&f>d;)a=a[b[d++]];return d&&d==f?a:void 0}}var e=a("./toObject");b.exports=d},{"./toObject":110}],83:[function(a,b,c){function d(a,b,c,h,i,j){return a===b?!0:null==a||null==b||!f(a)&&!g(b)?a!==a&&b!==b:e(a,b,d,c,h,i,j)}var e=a("./baseIsEqualDeep"),f=a("../lang/isObject"),g=a("./isObjectLike");b.exports=d},{"../lang/isObject":117,"./baseIsEqualDeep":84,"./isObjectLike":107}],84:[function(a,b,c){function d(a,b,c,d,m,p,q){var r=h(a),s=h(b),t=k,u=k;r||(t=o.call(a),t==j?t=l:t!=l&&(r=i(a))),s||(u=o.call(b),u==j?u=l:u!=l&&(s=i(b)));var v=t==l,w=u==l,x=t==u;if(x&&!r&&!v)return f(a,b,t);if(!m){var y=v&&n.call(a,"__wrapped__"),z=w&&n.call(b,"__wrapped__");if(y||z)return c(y?a.value():a,z?b.value():b,d,m,p,q)}if(!x)return!1;p||(p=[]),q||(q=[]);for(var A=p.length;A--;)if(p[A]==a)return q[A]==b;p.push(a),q.push(b);var B=(r?e:g)(a,b,c,d,m,p,q);return p.pop(),q.pop(),B}var e=a("./equalArrays"),f=a("./equalByTag"),g=a("./equalObjects"),h=a("../lang/isArray"),i=a("../lang/isTypedArray"),j="[object Arguments]",k="[object Array]",l="[object Object]",m=Object.prototype,n=m.hasOwnProperty,o=m.toString;b.exports=d},{"../lang/isArray":113,"../lang/isTypedArray":119,"./equalArrays":96,"./equalByTag":97,"./equalObjects":98}],85:[function(a,b,c){function d(a,b,c){var d=b.length,g=d,h=!c;if(null==a)return!g;for(a=f(a);d--;){var i=b[d];if(h&&i[2]?i[1]!==a[i[0]]:!(i[0]in a))return!1}for(;++d<g;){i=b[d];var j=i[0],k=a[j],l=i[1];if(h&&i[2]){if(void 0===k&&!(j in a))return!1}else{var m=c?c(k,l,j):void 0;if(!(void 0===m?e(l,k,c,!0):m))return!1}}return!0}var e=a("./baseIsEqual"),f=a("./toObject");b.exports=d},{"./baseIsEqual":83,"./toObject":110}],86:[function(a,b,c){function d(a){var b=f(a);if(1==b.length&&b[0][2]){var c=b[0][0],d=b[0][1];return function(a){return null==a?!1:a[c]===d&&(void 0!==d||c in g(a))}}return function(a){return e(a,b)}}var e=a("./baseIsMatch"),f=a("./getMatchData"),g=a("./toObject");b.exports=d},{"./baseIsMatch":85,"./getMatchData":100,"./toObject":110}],87:[function(a,b,c){function d(a,b){var c=h(a),d=i(a)&&j(b),n=a+"";return a=m(a),function(h){if(null==h)return!1;var i=n;if(h=l(h),(c||!d)&&!(i in h)){if(h=1==a.length?h:e(h,g(a,0,-1)),null==h)return!1;i=k(a),h=l(h)}return h[i]===b?void 0!==b||i in h:f(b,h[i],void 0,!0)}}var e=a("./baseGet"),f=a("./baseIsEqual"),g=a("./baseSlice"),h=a("../lang/isArray"),i=a("./isKey"),j=a("./isStrictComparable"),k=a("../array/last"),l=a("./toObject"),m=a("./toPath");b.exports=d},{"../array/last":68,"../lang/isArray":113,"./baseGet":82,"./baseIsEqual":83,"./baseSlice":90,"./isKey":105,"./isStrictComparable":108,"./toObject":110,"./toPath":111}],88:[function(a,b,c){function d(a){return function(b){return null==b?void 0:b[a]}}b.exports=d},{}],89:[function(a,b,c){function d(a){var b=a+"";return a=f(a),function(c){return e(c,a,b)}}var e=a("./baseGet"),f=a("./toPath");b.exports=d},{"./baseGet":82,"./toPath":111}],90:[function(a,b,c){function d(a,b,c){var d=-1,e=a.length;b=null==b?0:+b||0,0>b&&(b=-b>e?0:e+b),c=void 0===c||c>e?e:+c||0,0>c&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}b.exports=d},{}],91:[function(a,b,c){function d(a){return null==a?"":a+""}b.exports=d},{}],92:[function(a,b,c){function d(a,b,c){if("function"!=typeof a)return e;if(void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)};case 5:return function(c,d,e,f,g){return a.call(b,c,d,e,f,g)}}return function(){return a.apply(b,arguments)}}var e=a("../utility/identity");b.exports=d},{"../utility/identity":125}],93:[function(a,b,c){function d(a){return g(function(b,c){var d=-1,g=null==b?0:c.length,h=g>2?c[g-2]:void 0,i=g>2?c[2]:void 0,j=g>1?c[g-1]:void 0;for("function"==typeof h?(h=e(h,j,5),g-=2):(h="function"==typeof j?j:void 0,g-=h?1:0),i&&f(c[0],c[1],i)&&(h=3>g?void 0:h,g=1);++d<g;){var k=c[d];k&&a(b,k,h)}return b})}var e=a("./bindCallback"),f=a("./isIterateeCall"),g=a("../function/restParam");b.exports=d},{"../function/restParam":70,"./bindCallback":92,"./isIterateeCall":104}],94:[function(a,b,c){function d(a,b){return function(c,d){var h=c?e(c):0;if(!f(h))return a(c,d);for(var i=b?h:-1,j=g(c);(b?i--:++i<h)&&d(j[i],i,j)!==!1;);return c}}var e=a("./getLength"),f=a("./isLength"),g=a("./toObject");b.exports=d},{"./getLength":99,"./isLength":106,"./toObject":110}],95:[function(a,b,c){function d(a){return function(b,c,d){for(var f=e(b),g=d(b),h=g.length,i=a?h:-1;a?i--:++i<h;){var j=g[i];if(c(f[j],j,f)===!1)break}return b}}var e=a("./toObject");b.exports=d},{"./toObject":110}],96:[function(a,b,c){function d(a,b,c,d,f,g,h){var i=-1,j=a.length,k=b.length;if(j!=k&&!(f&&k>j))return!1;for(;++i<j;){var l=a[i],m=b[i],n=d?d(f?m:l,f?l:m,i):void 0;if(void 0!==n){if(n)continue;return!1}if(f){if(!e(b,function(a){return l===a||c(l,a,d,f,g,h)}))return!1}else if(l!==m&&!c(l,m,d,f,g,h))return!1}return!0}var e=a("./arraySome");b.exports=d},{"./arraySome":72}],97:[function(a,b,c){function d(a,b,c){switch(c){case e:case f:return+a==+b;case g:return a.name==b.name&&a.message==b.message;case h:return a!=+a?b!=+b:a==+b;case i:case j:return a==b+""}return!1}var e="[object Boolean]",f="[object Date]",g="[object Error]",h="[object Number]",i="[object RegExp]",j="[object String]";b.exports=d},{}],98:[function(a,b,c){function d(a,b,c,d,f,h,i){var j=e(a),k=j.length,l=e(b),m=l.length;if(k!=m&&!f)return!1;for(var n=k;n--;){var o=j[n];if(!(f?o in b:g.call(b,o)))return!1}for(var p=f;++n<k;){o=j[n];var q=a[o],r=b[o],s=d?d(f?r:q,f?q:r,o):void 0;if(!(void 0===s?c(q,r,d,f,h,i):s))return!1;p||(p="constructor"==o)}if(!p){var t=a.constructor,u=b.constructor;if(t!=u&&"constructor"in a&&"constructor"in b&&!("function"==typeof t&&t instanceof t&&"function"==typeof u&&u instanceof u))return!1}return!0}var e=a("../object/keys"),f=Object.prototype,g=f.hasOwnProperty;b.exports=d},{"../object/keys":122}],99:[function(a,b,c){var d=a("./baseProperty"),e=d("length");b.exports=e},{"./baseProperty":88}],100:[function(a,b,c){function d(a){for(var b=f(a),c=b.length;c--;)b[c][2]=e(b[c][1]);return b}var e=a("./isStrictComparable"),f=a("../object/pairs");b.exports=d},{"../object/pairs":124,"./isStrictComparable":108}],101:[function(a,b,c){function d(a,b){var c=null==a?void 0:a[b];return e(c)?c:void 0}var e=a("../lang/isNative");b.exports=d},{"../lang/isNative":116}],102:[function(a,b,c){function d(a){return null!=a&&f(e(a))}var e=a("./getLength"),f=a("./isLength");b.exports=d},{"./getLength":99,"./isLength":106}],103:[function(a,b,c){function d(a,b){return a="number"==typeof a||e.test(a)?+a:-1,b=null==b?f:b,a>-1&&a%1==0&&b>a}var e=/^\d+$/,f=9007199254740991;b.exports=d},{}],104:[function(a,b,c){function d(a,b,c){if(!g(c))return!1;var d=typeof b;if("number"==d?e(c)&&f(b,c.length):"string"==d&&b in c){var h=c[b];return a===a?a===h:h!==h}return!1}var e=a("./isArrayLike"),f=a("./isIndex"),g=a("../lang/isObject");b.exports=d},{"../lang/isObject":117,"./isArrayLike":102,"./isIndex":103}],105:[function(a,b,c){function d(a,b){var c=typeof a;if("string"==c&&h.test(a)||"number"==c)return!0;if(e(a))return!1;var d=!g.test(a);return d||null!=b&&a in f(b)}var e=a("../lang/isArray"),f=a("./toObject"),g=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,h=/^\w*$/;b.exports=d},{"../lang/isArray":113,"./toObject":110}],106:[function(a,b,c){function d(a){return"number"==typeof a&&a>-1&&a%1==0&&e>=a}var e=9007199254740991;b.exports=d},{}],107:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}b.exports=d},{}],108:[function(a,b,c){function d(a){return a===a&&!e(a)}var e=a("../lang/isObject");b.exports=d},{"../lang/isObject":117}],109:[function(a,b,c){function d(a){for(var b=i(a),c=b.length,d=c&&a.length,j=!!d&&h(d)&&(f(a)||e(a)),l=-1,m=[];++l<c;){var n=b[l];(j&&g(n,d)||k.call(a,n))&&m.push(n)}return m}var e=a("../lang/isArguments"),f=a("../lang/isArray"),g=a("./isIndex"),h=a("./isLength"),i=a("../object/keysIn"),j=Object.prototype,k=j.hasOwnProperty;b.exports=d},{"../lang/isArguments":112,"../lang/isArray":113,"../object/keysIn":123,"./isIndex":103,"./isLength":106}],110:[function(a,b,c){function d(a){return e(a)?a:Object(a)}var e=a("../lang/isObject");b.exports=d},{"../lang/isObject":117}],111:[function(a,b,c){function d(a){if(f(a))return a;var b=[];return e(a).replace(g,function(a,c,d,e){b.push(d?e.replace(h,"$1"):c||a)}),b}var e=a("./baseToString"),f=a("../lang/isArray"),g=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,h=/\\(\\)?/g;b.exports=d},{"../lang/isArray":113,"./baseToString":91}],112:[function(a,b,c){function d(a){return f(a)&&e(a)&&h.call(a,"callee")&&!i.call(a,"callee")}var e=a("../internal/isArrayLike"),f=a("../internal/isObjectLike"),g=Object.prototype,h=g.hasOwnProperty,i=g.propertyIsEnumerable;b.exports=d},{"../internal/isArrayLike":102,"../internal/isObjectLike":107}],113:[function(a,b,c){var d=a("../internal/getNative"),e=a("../internal/isLength"),f=a("../internal/isObjectLike"),g="[object Array]",h=Object.prototype,i=h.toString,j=d(Array,"isArray"),k=j||function(a){return f(a)&&e(a.length)&&i.call(a)==g};b.exports=k},{"../internal/getNative":101,"../internal/isLength":106,"../internal/isObjectLike":107}],114:[function(a,b,c){function d(a){return null==a?!0:g(a)&&(f(a)||j(a)||e(a)||i(a)&&h(a.splice))?!a.length:!k(a).length}var e=a("./isArguments"),f=a("./isArray"),g=a("../internal/isArrayLike"),h=a("./isFunction"),i=a("../internal/isObjectLike"),j=a("./isString"),k=a("../object/keys");b.exports=d},{"../internal/isArrayLike":102,"../internal/isObjectLike":107,"../object/keys":122,"./isArguments":112,"./isArray":113,"./isFunction":115,"./isString":118}],115:[function(a,b,c){function d(a){return e(a)&&h.call(a)==f}var e=a("./isObject"),f="[object Function]",g=Object.prototype,h=g.toString;b.exports=d},{"./isObject":117}],116:[function(a,b,c){function d(a){return null==a?!1:e(a)?k.test(i.call(a)):f(a)&&g.test(a)}var e=a("./isFunction"),f=a("../internal/isObjectLike"),g=/^\[object .+?Constructor\]$/,h=Object.prototype,i=Function.prototype.toString,j=h.hasOwnProperty,k=RegExp("^"+i.call(j).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");b.exports=d},{"../internal/isObjectLike":107,"./isFunction":115}],117:[function(a,b,c){function d(a){var b=typeof a;return!!a&&("object"==b||"function"==b);
}b.exports=d},{}],118:[function(a,b,c){function d(a){return"string"==typeof a||e(a)&&h.call(a)==f}var e=a("../internal/isObjectLike"),f="[object String]",g=Object.prototype,h=g.toString;b.exports=d},{"../internal/isObjectLike":107}],119:[function(a,b,c){function d(a){return f(a)&&e(a.length)&&!!D[F.call(a)]}var e=a("../internal/isLength"),f=a("../internal/isObjectLike"),g="[object Arguments]",h="[object Array]",i="[object Boolean]",j="[object Date]",k="[object Error]",l="[object Function]",m="[object Map]",n="[object Number]",o="[object Object]",p="[object RegExp]",q="[object Set]",r="[object String]",s="[object WeakMap]",t="[object ArrayBuffer]",u="[object Float32Array]",v="[object Float64Array]",w="[object Int8Array]",x="[object Int16Array]",y="[object Int32Array]",z="[object Uint8Array]",A="[object Uint8ClampedArray]",B="[object Uint16Array]",C="[object Uint32Array]",D={};D[u]=D[v]=D[w]=D[x]=D[y]=D[z]=D[A]=D[B]=D[C]=!0,D[g]=D[h]=D[t]=D[i]=D[j]=D[k]=D[l]=D[m]=D[n]=D[o]=D[p]=D[q]=D[r]=D[s]=!1;var E=Object.prototype,F=E.toString;b.exports=d},{"../internal/isLength":106,"../internal/isObjectLike":107}],120:[function(a,b,c){var d=a("../internal/assignWith"),e=a("../internal/baseAssign"),f=a("../internal/createAssigner"),g=f(function(a,b,c){return c?d(a,b,c):e(a,b)});b.exports=g},{"../internal/assignWith":73,"../internal/baseAssign":74,"../internal/createAssigner":93}],121:[function(a,b,c){function d(a,b,c){var d=f(a);return c&&g(a,b,c)&&(b=void 0),b?e(d,b):d}var e=a("../internal/baseAssign"),f=a("../internal/baseCreate"),g=a("../internal/isIterateeCall");b.exports=d},{"../internal/baseAssign":74,"../internal/baseCreate":77,"../internal/isIterateeCall":104}],122:[function(a,b,c){var d=a("../internal/getNative"),e=a("../internal/isArrayLike"),f=a("../lang/isObject"),g=a("../internal/shimKeys"),h=d(Object,"keys"),i=h?function(a){var b=null==a?void 0:a.constructor;return"function"==typeof b&&b.prototype===a||"function"!=typeof a&&e(a)?g(a):f(a)?h(a):[]}:g;b.exports=i},{"../internal/getNative":101,"../internal/isArrayLike":102,"../internal/shimKeys":109,"../lang/isObject":117}],123:[function(a,b,c){function d(a){if(null==a)return[];i(a)||(a=Object(a));var b=a.length;b=b&&h(b)&&(f(a)||e(a))&&b||0;for(var c=a.constructor,d=-1,j="function"==typeof c&&c.prototype===a,l=Array(b),m=b>0;++d<b;)l[d]=d+"";for(var n in a)m&&g(n,b)||"constructor"==n&&(j||!k.call(a,n))||l.push(n);return l}var e=a("../lang/isArguments"),f=a("../lang/isArray"),g=a("../internal/isIndex"),h=a("../internal/isLength"),i=a("../lang/isObject"),j=Object.prototype,k=j.hasOwnProperty;b.exports=d},{"../internal/isIndex":103,"../internal/isLength":106,"../lang/isArguments":112,"../lang/isArray":113,"../lang/isObject":117}],124:[function(a,b,c){function d(a){a=f(a);for(var b=-1,c=e(a),d=c.length,g=Array(d);++b<d;){var h=c[b];g[b]=[h,a[h]]}return g}var e=a("./keys"),f=a("../internal/toObject");b.exports=d},{"../internal/toObject":110,"./keys":122}],125:[function(a,b,c){function d(a){return a}b.exports=d},{}],126:[function(a,b,c){function d(a){return g(a)?e(a):f(a)}var e=a("../internal/baseProperty"),f=a("../internal/basePropertyDeep"),g=a("../internal/isKey");b.exports=d},{"../internal/baseProperty":88,"../internal/basePropertyDeep":89,"../internal/isKey":105}]},{},[10])(10)}),define("UserModule",["jquery","config","quickblox"],function(a,b,c){function d(a){this.app=a,this._is_import=null,this._remember=!1,this._valid=!1}function e(c,d){var e,g,i,j,k=1024*b.maxLimitFile*1024,l=c.find("input:checkbox")[0],m=c.find("input:file")[0];return h={},c.find("input:not(:file, :checkbox)").each(function(){return this.value=this.value.trim(),e=this.id.split("-")[1],g=this.placeholder,i=this.value,this.checkValidity()?(d._valid=!0,void(h[e]=i)):(this.validity.valueMissing?j=g+" is required":this.validity.typeMismatch?(this.value="",j=b.errors.invalidEmail):this.validity.patternMismatch&&"Name"===g?j=i.length<3?b.errors.shortName:i.length>50?b.errors.bigName:b.errors.invalidName:!this.validity.patternMismatch||"Password"!==g&&"New password"!==g||(j=i.length<8?b.errors.shortPass:i.length>40?b.errors.bigPass:b.errors.invalidPass),f(d,j),a(this).addClass("is-error").focus(),!1)}),d._valid&&l&&(d._remember=l.checked),d._valid&&m&&m.files[0]&&(m=m.files[0],-1===m.type.indexOf("image/")?(j=b.errors.avatarType,f(d,j)):m.name.length>100?(j=b.errors.fileName,f(d,j)):m.size>k?(j=b.errors.fileSize,f(d,j)):h.blob=m),d._valid}function f(b,c){b._valid=!1,a("section:visible .text_error").addClass("is-error").text(c),a("section:visible input:password").val(""),a("section:visible .chroma-hash label").css("background-color","rgb(255, 255, 255)")}function g(a){var b;try{b=JSON.parse(a.custom_data).is_import||null}catch(c){b=null}return b}var h;return d.prototype={connectFB:function(a){var c,d=this.app.service,e=this.app.views.User,f=this.app.views.Dialog,h=this.app.models.Contact,i=this;e.loginQB(),e.createSpinner(),c={provider:"facebook",keys:{token:a}},d.createSession(c,function(a){d.getUser(a.user_id,function(a){i.contact=h.create(a),i._is_import=g(a),b.debug&&console.log("User",i),d.connectChat(i.contact.user_jid,function(b){i.rememberMe(),e.successFormCallback(),f.prepareDownloading(b),i._is_import?f.downloadDialogs(b):i["import"](b,a)})})},!0)},"import":function(a,c){var d=this.app.views.Dialog,e=!1,f=this;FB.api("/me/permissions",function(g){b.debug&&console.log("FB Permissions",g);for(var h=0,i=g.data.length;i>h;h++)"user_friends"===g.data[h].permission&&"granted"===g.data[h].status&&(e=!0);e?FB.api("/me/friends",function(c){b.debug&&console.log("FB friends",c);for(var e=[],f=0,g=c.data.length;g>f;f++)e.push(c.data[f].id);e.length>0?d.downloadDialogs(a,e):d.downloadDialogs(a)}):d.downloadDialogs(a),f._is_import="1",f.updateQBUser(c)})},updateQBUser:function(a){var b,c=this.app.service;try{b=JSON.parse(a.custom_data)||{}}catch(d){b={}}b.is_import="1",b=JSON.stringify(b),c.updateUser(a.id,{custom_data:b},function(a){})},signup:function(){var c,d=this.app.service,f=this.app.views.User,g=this.app.views.Dialog,i=this.app.models.Contact,j=a("section:visible form"),k=this;e(j,this)&&(f.createSpinner(),c={full_name:h.full_name,email:h.email,password:h.password,tag_list:"web"},d.createSession({},function(){d.createUser(c,function(){delete c.full_name,delete c.tag_list,d.loginUser(c,function(a){k.contact=i.create(a),b.debug&&console.log("User",k),d.connectChat(k.contact.user_jid,function(a){h.blob?k.uploadAvatar(a):(f.successFormCallback(),g.prepareDownloading(a),g.downloadDialogs(a))})})})},!1))},uploadAvatar:function(a){var b,c=this.app.service,d=this.app.views.User,e=this.app.views.Dialog,f=this.app.models.Attach,g=this;f.crop(h.blob,{w:146,h:146},function(f){c.createBlob({file:f,"public":!0},function(f){g.contact.blob_id=f.id,g.contact.avatar_url=f.path,d.successFormCallback(),e.prepareDownloading(a),e.downloadDialogs(a),b=JSON.stringify({avatar_url:f.path}),c.updateUser(g.contact.id,{blob_id:f.id,custom_data:b},function(a){})})})},login:function(){var c,d=this.app.service,f=this.app.views.User,g=this.app.views.Dialog,i=this.app.models.Contact,j=a("section:visible form"),k=this;e(j,this)&&(f.createSpinner(),c={email:h.email,password:h.password},d.createSession(c,function(a){d.getUser(a.user_id,function(a){k.contact=i.create(a),b.debug&&console.log("User",k),d.connectChat(k.contact.user_jid,function(a){k._remember&&k.rememberMe(),f.successFormCallback(),g.prepareDownloading(a),g.downloadDialogs(a)})})},k._remember))},rememberMe:function(){var a={},b=this;Object.keys(b.contact).forEach(function(c){"app"!==c&&(a[c]=b.contact[c])}),localStorage.setItem("QM.user",JSON.stringify(a))},forgot:function(){var b=this.app.service,c=this.app.views.User,d=a("section:visible form"),f=this;e(d,this)&&(c.createSpinner(),b.createSession({},function(){b.forgotPassword(h.email,function(){c.successSendEmailCallback(),f._valid=!1})},!1))},resetPass:function(){var b=(this.app.service,this.app.views.User,a("section:visible form"));e(b,this)},autologin:function(){var a=this.app.service,c=this.app.views.User,d=this.app.views.Dialog,e=this.app.models.Contact,f=JSON.parse(localStorage["QM.user"]),g=this;c.createSpinner(),this.contact=e.create(f),b.debug&&console.log("User",g),a.connectChat(g.contact.user_jid,function(a){c.successFormCallback(),d.prepareDownloading(a),d.downloadDialogs(a)})},logout:function(a){var b=this.app.service,d=this.app.views.Dialog,e=this;c.chat.disconnect(),d.hideDialogs(),b.logoutUser(function(){localStorage.removeItem("QM.user"),e.contact=null,e._remember=!1,e._valid=!1,a()})}},d}),define("SessionModule",["config","cryptojs"],function(a,b){function c(a){this.app=a,this._remember=!1}return c.prototype={create:function(a,b){this.token=a.token,this.expirationTime=a.expirationTime||null,this.authParams=a.authParams,this._remember=b||!1},update:function(a){var b,c;a.token?this.token=a.token:(a.authParams&&(this.authParams=a.authParams),a.date&&(c=a.date,c.setHours(c.getHours()+2),this.expirationTime=c.toISOString()),this._remember&&(b={token:this.token,expirationTime:this.expirationTime,authParams:this.authParams},localStorage.setItem("QM.session",JSON.stringify(b))))},destroy:function(){localStorage.removeItem("QM.session"),this.token=null,this.expirationTime=null,this.authParams=null,this._remember=!1},encrypt:function(c){return c&&c.password&&(c.password=b.AES.encrypt(c.password,a.qbAccount.authSecret).toString()),c},decrypt:function(c){return c&&c.password&&(c.password=b.AES.decrypt(c.password,a.qbAccount.authSecret).toString(b.enc.Utf8)),c}},c}),define("ContactModule",["config","quickblox"],function(a,b){function c(a){this.app=a}function d(b){var c;return c=b.custom_data&&JSON.parse(b.custom_data).avatar_url,c||(c=b.facebook_id?"https://graph.facebook.com/v2.2/"+b.facebook_id+"/picture?width=146&height=146":a.defAvatar.url),c}function e(a){return a.custom_data&&JSON.parse(a.custom_data).status||""}return c.prototype={create:function(c){return{id:c.id,full_name:c.full_name,email:c.email,phone:c.phone||"",facebook_id:c.facebook_id||null,blob_id:c.blob_id||null,avatar_url:(c.avatar_url||d(c)).replace("http://","https://"),status:c.status||e(c),tag:c.tag||c.user_tags||null,user_jid:c.user_jid||b.chat.helpers.getUserJid(c.id,a.qbAccount.appId),custom_data:c.custom_data||null}}},c}),function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&g>f;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=t(d,f,4);var g=!A(c)&&s.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function b(a){return function(b,c,d){c=u(c,d);for(var e=z(b),f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}}function c(a,b,c){return function(d,e,f){var g=0,h=z(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(k.call(d,g,h),s.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&h>f;f+=a)if(d[f]===e)return f;return-1}}function d(a,b){var c=F.length,d=a.constructor,e=s.isFunction(d)&&d.prototype||h,f="constructor";for(s.has(a,f)&&!s.contains(b,f)&&b.push(f);c--;)f=F[c],f in a&&a[f]!==e[f]&&!s.contains(b,f)&&b.push(f)}var e=this,f=e._,g=Array.prototype,h=Object.prototype,i=Function.prototype,j=g.push,k=g.slice,l=h.toString,m=h.hasOwnProperty,n=Array.isArray,o=Object.keys,p=i.bind,q=Object.create,r=function(){},s=function(a){return a instanceof s?a:this instanceof s?void(this._wrapped=a):new s(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports._=s):e._=s,s.VERSION="1.8.3";var t=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},u=function(a,b,c){return null==a?s.identity:s.isFunction(a)?t(a,b,c):s.isObject(a)?s.matcher(a):s.property(a)};s.iteratee=function(a,b){return u(a,b,1/0)};var v=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},w=function(a){if(!s.isObject(a))return{};if(q)return q(a);r.prototype=a;var b=new r;return r.prototype=null,b},x=function(a){return function(b){return null==b?void 0:b[a]}},y=Math.pow(2,53)-1,z=x("length"),A=function(a){var b=z(a);return"number"==typeof b&&b>=0&&y>=b};s.each=s.forEach=function(a,b,c){b=t(b,c);var d,e;if(A(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=s.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},s.map=s.collect=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},s.reduce=s.foldl=s.inject=a(1),s.reduceRight=s.foldr=a(-1),s.find=s.detect=function(a,b,c){var d;return d=A(a)?s.findIndex(a,b,c):s.findKey(a,b,c),void 0!==d&&-1!==d?a[d]:void 0},s.filter=s.select=function(a,b,c){var d=[];return b=u(b,c),s.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},s.reject=function(a,b,c){return s.filter(a,s.negate(u(b)),c)},s.every=s.all=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},s.some=s.any=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},s.contains=s.includes=s.include=function(a,b,c,d){return A(a)||(a=s.values(a)),("number"!=typeof c||d)&&(c=0),s.indexOf(a,b,c)>=0},s.invoke=function(a,b){var c=k.call(arguments,2),d=s.isFunction(b);return s.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},s.pluck=function(a,b){return s.map(a,s.property(b))},s.where=function(a,b){return s.filter(a,s.matcher(b))},s.findWhere=function(a,b){return s.find(a,s.matcher(b))},s.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},s.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(g>e||e===1/0&&f===1/0)&&(f=a,g=e)});return f},s.shuffle=function(a){for(var b,c=A(a)?a:s.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=s.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},s.sample=function(a,b,c){return null==b||c?(A(a)||(a=s.values(a)),a[s.random(a.length-1)]):s.shuffle(a).slice(0,Math.max(0,b))},s.sortBy=function(a,b,c){return b=u(b,c),s.pluck(s.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var B=function(a){return function(b,c,d){var e={};return c=u(c,d),s.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};s.groupBy=B(function(a,b,c){s.has(a,c)?a[c].push(b):a[c]=[b]}),s.indexBy=B(function(a,b,c){a[c]=b}),s.countBy=B(function(a,b,c){s.has(a,c)?a[c]++:a[c]=1}),s.toArray=function(a){return a?s.isArray(a)?k.call(a):A(a)?s.map(a,s.identity):s.values(a):[]},s.size=function(a){return null==a?0:A(a)?a.length:s.keys(a).length},s.partition=function(a,b,c){b=u(b,c);var d=[],e=[];return s.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},s.first=s.head=s.take=function(a,b,c){return null!=a?null==b||c?a[0]:s.initial(a,a.length-b):void 0},s.initial=function(a,b,c){return k.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},s.last=function(a,b,c){return null!=a?null==b||c?a[a.length-1]:s.rest(a,Math.max(0,a.length-b)):void 0},s.rest=s.tail=s.drop=function(a,b,c){return k.call(a,null==b||c?1:b)},s.compact=function(a){return s.filter(a,s.identity)};var C=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=z(a);h>g;g++){var i=a[g];if(A(i)&&(s.isArray(i)||s.isArguments(i))){b||(i=C(i,b,c));var j=0,k=i.length;for(e.length+=k;k>j;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};s.flatten=function(a,b){return C(a,b,!1)},s.without=function(a){return s.difference(a,k.call(arguments,1))},s.uniq=s.unique=function(a,b,c,d){s.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=u(c,d));for(var e=[],f=[],g=0,h=z(a);h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?s.contains(f,j)||(f.push(j),e.push(i)):s.contains(e,i)||e.push(i)}return e},s.union=function(){return s.uniq(C(arguments,!0,!0))},s.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=z(a);e>d;d++){var f=a[d];if(!s.contains(b,f)){for(var g=1;c>g&&s.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},s.difference=function(a){var b=C(arguments,!0,!0,1);return s.filter(a,function(a){return!s.contains(b,a)})},s.zip=function(){return s.unzip(arguments)},s.unzip=function(a){for(var b=a&&s.max(a,z).length||0,c=Array(b),d=0;b>d;d++)c[d]=s.pluck(a,d);return c},s.object=function(a,b){for(var c={},d=0,e=z(a);e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},s.findIndex=b(1),s.findLastIndex=b(-1),s.sortedIndex=function(a,b,c,d){c=u(c,d,1);for(var e=c(b),f=0,g=z(a);g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},s.indexOf=c(1,s.findIndex,s.sortedIndex),s.lastIndexOf=c(-1,s.findLastIndex),s.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var D=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=w(a.prototype),g=a.apply(f,e);return s.isObject(g)?g:f};s.bind=function(a,b){if(p&&a.bind===p)return p.apply(a,k.call(arguments,1));if(!s.isFunction(a))throw new TypeError("Bind must be called on a function");var c=k.call(arguments,2),d=function(){return D(a,d,b,this,c.concat(k.call(arguments)))};return d},s.partial=function(a){var b=k.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;e>g;g++)f[g]=b[g]===s?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return D(a,c,this,this,f)};return c},s.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=s.bind(a[c],a);return a},s.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return s.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},s.delay=function(a,b){var c=k.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},s.defer=s.partial(s.delay,s,1),s.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:s.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=s.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},s.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=s.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=s.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},s.wrap=function(a,b){return s.partial(b,a)},s.negate=function(a){return function(){return!a.apply(this,arguments)}},s.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},s.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},s.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},s.once=s.partial(s.before,2);var E=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];s.keys=function(a){if(!s.isObject(a))return[];if(o)return o(a);var b=[];for(var c in a)s.has(a,c)&&b.push(c);return E&&d(a,b),b},s.allKeys=function(a){if(!s.isObject(a))return[];var b=[];for(var c in a)b.push(c);return E&&d(a,b),b},s.values=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},s.mapObject=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=e.length,g={},h=0;f>h;h++)d=e[h],g[d]=b(a[d],d,a);return g},s.pairs=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},s.invert=function(a){for(var b={},c=s.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},s.functions=s.methods=function(a){var b=[];for(var c in a)s.isFunction(a[c])&&b.push(c);return b.sort()},s.extend=v(s.allKeys),s.extendOwn=s.assign=v(s.keys),s.findKey=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},s.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;s.isFunction(b)?(e=s.allKeys(g),d=t(b,c)):(e=C(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;i>h;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},s.omit=function(a,b,c){if(s.isFunction(b))b=s.negate(b);else{var d=s.map(C(arguments,!1,!1,1),String);b=function(a,b){return!s.contains(d,b)}}return s.pick(a,b,c)},s.defaults=v(s.allKeys,!0),s.create=function(a,b){var c=w(a);return b&&s.extendOwn(c,b),c},s.clone=function(a){return s.isObject(a)?s.isArray(a)?a.slice():s.extend({},a):a},s.tap=function(a,b){return b(a),a},s.isMatch=function(a,b){var c=s.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof s&&(a=a._wrapped),b instanceof s&&(b=b._wrapped);var e=l.call(a);if(e!==l.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(s.isFunction(g)&&g instanceof g&&s.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!G(a[i],b[i],c,d))return!1}else{var j,k=s.keys(a);if(i=k.length,s.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!s.has(b,j)||!G(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};s.isEqual=function(a,b){return G(a,b)},s.isEmpty=function(a){return null==a?!0:A(a)&&(s.isArray(a)||s.isString(a)||s.isArguments(a))?0===a.length:0===s.keys(a).length},s.isElement=function(a){return!(!a||1!==a.nodeType)},s.isArray=n||function(a){return"[object Array]"===l.call(a)},s.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},s.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){s["is"+a]=function(b){return l.call(b)==="[object "+a+"]"}}),s.isArguments(arguments)||(s.isArguments=function(a){return s.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(s.isFunction=function(a){return"function"==typeof a||!1}),s.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},s.isNaN=function(a){return s.isNumber(a)&&a!==+a},s.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===l.call(a)},s.isNull=function(a){return null===a},s.isUndefined=function(a){return void 0===a},s.has=function(a,b){return null!=a&&m.call(a,b)},s.noConflict=function(){return e._=f,this},s.identity=function(a){return a},s.constant=function(a){return function(){return a}},s.noop=function(){},s.property=x,s.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},s.matcher=s.matches=function(a){return a=s.extendOwn({},a),function(b){return s.isMatch(b,a)}},s.times=function(a,b,c){var d=Array(Math.max(0,a));b=t(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},s.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},s.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=s.invert(H),J=function(a){var b=function(b){return a[b]},c="(?:"+s.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};s.escape=J(H),s.unescape=J(I),s.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),s.isFunction(d)?d.call(a):d};var K=0;s.uniqueId=function(a){var b=++K+"";return a?a+b:b},s.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,O=function(a){return"\\"+M[a]};s.template=function(a,b,c){!b&&c&&(b=c),b=s.defaults({},b,s.templateSettings);var d=RegExp([(b.escape||L).source,(b.interpolate||L).source,(b.evaluate||L).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(N,O),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,s)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},s.chain=function(a){var b=s(a);return b._chain=!0,b};var P=function(a,b){return a._chain?s(b).chain():b};s.mixin=function(a){s.each(s.functions(a),function(b){var c=s[b]=a[b];s.prototype[b]=function(){var a=[this._wrapped];return j.apply(a,arguments),P(this,c.apply(s,a))}})},s.mixin(s),s.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=g[a];s.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],P(this,c)}}),s.each(["concat","join","slice"],function(a){var b=g[a];s.prototype[a]=function(){return P(this,b.apply(this._wrapped,arguments))}}),s.prototype.value=function(){return this._wrapped},s.prototype.valueOf=s.prototype.toJSON=s.prototype.value,s.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return s})}.call(this),define("DialogModule",["config","quickblox","underscore"],function(a,b,c){function d(a){this.app=a}return d.prototype={download:function(a){var b=this.app.service;b.listDialogs({sort_desc:"last_message_date_sent"},function(b){a(b)})},create:function(a){var b=this.app.models.User,d=c.without(a.occupants_ids,b.contact.id);return{id:a._id,type:a.type,room_jid:a.xmpp_room_jid||null,room_name:a.name||null,room_photo:a.photo&&a.photo.replace("http://","https://")||null,occupants_ids:d,last_message_date_sent:a.last_message_date_sent||null,unread_count:a.unread_messages_count||""}},createPrivate:function(c,d){var e,f=this.app.service,g=this.app.views.Dialog,h=this.app.models.ContactList,i=(this.app.models.User,b.chat.helpers.getIdFromNode(c)),j=this;f.createDialog({type:3,occupants_ids:i},function(f){e=j.create(f),h.dialogs[e.id]=e,a.debug&&console.log("Dialog",e),localStorage["QM.dialog-"+e.id]||localStorage.setItem("QM.dialog-"+e.id,JSON.stringify({messages:[]})),b.chat.send(c,{type:"chat",body:"Contact request",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"4"}}),h.add(e.occupants_ids,null,function(){g.addDialogItem(e,null,d)})})},createGroup:function(c,d,e){var f,g=this.app.service,h=this.app.views.Dialog,i=this.app.models.ContactList,j=i.contacts,k=(this.app.models.User,this);g.createDialog(d,function(c){f=k.create(c),i.dialogs[f.id]=f,a.debug&&console.log("Dialog",f),localStorage["QM.dialog-"+f.id]||localStorage.setItem("QM.dialog-"+f.id,JSON.stringify({messages:[]})),b.chat.muc.join(f.room_jid,function(){var a=b.chat.helpers.getBsonObjectId();b.chat.addListener({name:"message",type:"groupchat",id:a},function(){h.addDialogItem(f),e(f);for(var a,d=0,g=f.occupants_ids.length;g>d;d++)a=f.occupants_ids[d],b.chat.send(j[a].user_jid,{type:"chat",body:"Notification message",extension:{dialog_id:f.id,date_sent:Math.floor(Date.now()/1e3),notification_type:"1",room_jid:f.room_jid,room_name:f.room_name,occupants_ids:c.occupants_ids.join()}})}),b.chat.send(f.room_jid,{id:a,type:"groupchat",body:"Notification message",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"1",occupants_ids:c.occupants_ids.join()}})})})},updateGroup:function(c,d,e){var f,g,h=this.app.service,i=(this.app.views.Dialog,this.app.models.ContactList),j=i.contacts,k=(this.app.models.User,this);h.updateDialog(d.dialog_id,{push_all:{occupants_ids:[d.occupants_ids]}},function(c){f=k.create(c),i.dialogs[d.dialog_id]=f,a.debug&&console.log("Dialog",f);var h=b.chat.helpers.getBsonObjectId();b.chat.addListener({name:"message",type:"groupchat",id:h},function(){e(f);for(var a,h=0,i=d.new_ids.length;i>h;h++)a=d.new_ids[h],g={dialog_id:f.id,date_sent:Math.floor(Date.now()/1e3),notification_type:"1",room_jid:f.room_jid,room_name:f.room_name,occupants_ids:c.occupants_ids.join()},f.room_photo&&(g.room_photo=f.room_photo),b.chat.send(j[a].user_jid,{type:"chat",body:"Notification message",extension:g})}),b.chat.send(f.room_jid,{id:h,type:"groupchat",body:"Notification message",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"2",occupants_ids:d.new_ids.join()}})})},changeName:function(c,d){var e,f=this.app.service,g=this.app.models.ContactList,h=this;f.updateDialog(c,{name:d},function(f){e=h.create(f),g.dialogs[c]=e,a.debug&&console.log("Dialog",e),b.chat.send(e.room_jid,{type:"groupchat",body:"Notification message",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"2",room_name:d}})})},changeAvatar:function(c,d,e){var f,g,h=this.app.service,i=this.app.models.ContactList,j=this.app.models.Attach,k=d[0].files[0]||null,l=this;k?(-1===k.type.indexOf("image/")?f=a.errors.avatarType:k.name.length>100&&(f=a.errors.fileName),f?(console.log(f),e(!1)):j.crop(k,{w:40,h:40},function(d){j.upload(d,function(d){h.updateDialog(c,{photo:d.path},function(f){g=l.create(f),i.dialogs[c]=g,a.debug&&console.log("Dialog",g),b.chat.send(g.room_jid,{type:"groupchat",body:"Notification message",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"2",room_photo:d.path}}),e(d.path)})})})):e(!1)},leaveChat:function(a,c){var d=this.app.service,e=this.app.models.User;b.chat.send(a.room_jid,{type:"groupchat",body:"Notification message",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"2",deleted_id:e.contact.id}}),d.updateDialog(a.id,{pull_all:{occupants_ids:[e.contact.id]}},function(){}),c()}},d}),define("MessageModule",[],function(){function a(a){this.app=a,this.skip={}}return a.prototype={download:function(a,b,c,d){var e=this.app.service,f=this.app.views.Dialog,g=this;return g.skip[a]&&g.skip[a]===c?!1:(d&&f.createDataSpinner(null,null,!0),void e.listMessages({chat_dialog_id:a,sort_desc:"date_sent",limit:50,skip:c||0},function(e){d&&f.removeDataSpinner(),b(e),g.skip[a]=c}))},create:function(a){var b;this.app.models.User;return b={id:a.extension&&a.extension.message_id||a._id||null,dialog_id:a.extension&&a.extension.dialog_id||a.chat_dialog_id,body:a.body||a.message||null,notification_type:a.extension&&a.extension.notification_type||a.notification_type||null,date_sent:a.extension&&a.extension.date_sent||a.date_sent,read:a.read||!1,attachment:a.extension&&a.extension.attachments&&a.extension.attachments[0]||a.attachments&&a.attachments[0]||a.attachment||null,sender_id:a.sender_id||null,recipient_id:a.recipient_id||null,occupants_ids:a.extension&&a.extension.occupants_ids||a.occupants_ids||null,
room_name:a.extension&&a.extension.room_name||a.room_name||null,room_photo:a.extension&&a.extension.room_photo&&a.extension.room_photo.replace("http://","https://")||a.room_photo&&a.room_photo.replace("http://","https://")||null,deleted_id:a.extension&&a.extension.deleted_id||a.deleted_id||null,callType:a.extension&&a.extension.callType||a.callType||null,callState:a.extension&&a.extension.callState||a.callState||null,caller:parseInt(a.extension&&a.extension.caller)||parseInt(a.caller)||null,callee:parseInt(a.extension&&a.extension.callee)||parseInt(a.callee)||null,duration:a.extension&&a.extension.duration||a.duration||null,sessionID:a.extension&&a.extension.sessionID||a.sessionID||null},b.attachment&&(b.attachment.size=parseInt(b.attachment.size)),b},update:function(a,b){var c=this.app.service;c.updateMessage(a,{chat_dialog_id:b,read:1},function(){})}},a}),function(a){"use strict";var b=function(a,c,d){var e,f,g=document.createElement("img");if(g.onerror=c,g.onload=function(){!f||d&&d.noRevoke||b.revokeObjectURL(f),c&&c(b.scale(g,d))},b.isInstanceOf("Blob",a)||b.isInstanceOf("File",a))e=f=b.createObjectURL(a),g._type=a.type;else{if("string"!=typeof a)return!1;e=a,d&&d.crossOrigin&&(g.crossOrigin=d.crossOrigin)}return e?(g.src=e,g):b.readFile(a,function(a){var b=a.target;b&&b.result?g.src=b.result:c&&c(a)})},c=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},b.transformCoordinates=function(){},b.getTransformedOptions=function(a,b){var c,d,e,f,g=b.aspectRatio;if(!g)return b;c={};for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c.crop=!0,e=a.naturalWidth||a.width,f=a.naturalHeight||a.height,e/f>g?(c.maxWidth=f*g,c.maxHeight=f):(c.maxWidth=e,c.maxHeight=e/g),c},b.renderImageToCanvas=function(a,b,c,d,e,f,g,h,i,j){return a.getContext("2d").drawImage(b,c,d,e,f,g,h,i,j),a},b.hasCanvasOption=function(a){return a.canvas||a.crop||a.aspectRatio},b.scale=function(a,c){c=c||{};var d,e,f,g,h,i,j,k,l,m=document.createElement("canvas"),n=a.getContext||b.hasCanvasOption(c)&&m.getContext,o=a.naturalWidth||a.width,p=a.naturalHeight||a.height,q=o,r=p,s=function(){var a=Math.max((f||q)/q,(g||r)/r);a>1&&(q*=a,r*=a)},t=function(){var a=Math.min((d||q)/q,(e||r)/r);1>a&&(q*=a,r*=a)};return n&&(c=b.getTransformedOptions(a,c),j=c.left||0,k=c.top||0,c.sourceWidth?(h=c.sourceWidth,void 0!==c.right&&void 0===c.left&&(j=o-h-c.right)):h=o-j-(c.right||0),c.sourceHeight?(i=c.sourceHeight,void 0!==c.bottom&&void 0===c.top&&(k=p-i-c.bottom)):i=p-k-(c.bottom||0),q=h,r=i),d=c.maxWidth,e=c.maxHeight,f=c.minWidth,g=c.minHeight,n&&d&&e&&c.crop?(q=d,r=e,l=h/i-d/e,0>l?(i=e*h/d,void 0===c.top&&void 0===c.bottom&&(k=(p-i)/2)):l>0&&(h=d*i/e,void 0===c.left&&void 0===c.right&&(j=(o-h)/2))):((c.contain||c.cover)&&(f=d=d||f,g=e=e||g),c.cover?(t(),s()):(s(),t())),n?(m.width=q,m.height=r,b.transformCoordinates(m,c),b.renderImageToCanvas(m,a,j,k,h,i,0,0,q,r)):(a.width=q,a.height=r,a)},b.createObjectURL=function(a){return c?c.createObjectURL(a):!1},b.revokeObjectURL=function(a){return c?c.revokeObjectURL(a):!1},b.readFile=function(a,b,c){if(window.FileReader){var d=new FileReader;if(d.onload=d.onerror=b,c=c||"readAsDataURL",d[c])return d[c](a),d}return!1},"function"==typeof define&&define.amd?define("loadImage",[],function(){return b}):a.loadImage=b}(window),function(a){"use strict";var b=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,c=a.Blob&&function(){try{return Boolean(new Blob)}catch(a){return!1}}(),d=c&&a.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(a){return!1}}(),e=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,f=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,g=(c||e)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,g,h,i,j,k,l,m,n;if(b=a.match(f),!b)throw new Error("invalid data URI");for(g=b[2]?b[1]:"text/plain"+(b[3]||";charset=US-ASCII"),h=!!b[4],i=a.slice(b[0].length),j=h?atob(i):decodeURIComponent(i),k=new ArrayBuffer(j.length),l=new Uint8Array(k),m=0;m<j.length;m+=1)l[m]=j.charCodeAt(m);return c?new Blob([d?l:k],{type:g}):(n=new e,n.append(k),n.getBlob(g))};a.HTMLCanvasElement&&!b.toBlob&&(b.mozGetAsFile?b.toBlob=function(a,c,d){a(d&&b.toDataURL&&g?g(this.toDataURL(c,d)):this.mozGetAsFile("blob",c))}:b.toDataURL&&g&&(b.toBlob=function(a,b,c){a(g(this.toDataURL(b,c)))})),"function"==typeof define&&define.amd?define("canvasToBlob",[],function(){return g}):a.dataURLtoBlob=g}(window),define("AttachModule",["loadImage","canvasToBlob"],function(a,b){function c(a){this.app=a}return c.prototype={upload:function(a,b){var c=this.app.service;c.createBlob({file:a,"public":!0},function(a){b(a)})},create:function(a,b){var c=0===a.content_type.indexOf("audio/")?"audio":0===a.content_type.indexOf("video/")?"video":"photo";return{type:c,url:a.path&&a.path.replace("http://","https://")||null,name:a.name,size:b,"content-type":a.content_type}},crop:function(b,c,d){a(b,function(e){var f={crop:!0};e.width>e.height?f.maxWidth=c.w:f.maxHeight=c.h,a(b,function(a){a.toBlob(function(a){a.name=b.name,d(a)},b.type)},f)})}},c}),define("ContactListModule",["config","underscore"],function(a,b){function c(a){this.app=a,this.roster={},this.contacts=d(),this.dialogs={},e=Object.keys(this.contacts).map(Number)}function d(){var a={},b=localStorage["QM.contacts"]?localStorage["QM.contacts"].split(","):[];if(b.length>0)try{for(var c=0,d=b.length;d>c;c++)a[b[c]]="undefined"!=typeof localStorage["QM.contact-"+b[c]]?JSON.parse(localStorage["QM.contact-"+b[c]]):!0,a[b[c]]===!0&&delete a[b[c]]}catch(e){console.log("Error getting contacts from cache. Clearing..."),localStorage.clear(),a={}}return a}var e;return c.prototype={saveRoster:function(a){this.roster=a},saveNotConfirmed:function(a){localStorage.setItem("QM.notConfirmed",JSON.stringify(a))},saveHiddenDialogs:function(a){sessionStorage.setItem("QM.hiddenDialogs",JSON.stringify(a))},add:function(c,d,f,g){var h,i,j=this.app.service,k=this.app.models.Contact,l=this;h=[].concat(b.difference(c,e)),e=e.concat(h),localStorage.setItem("QM.contacts",e.join()),g&&(h=c),h.length>0?(i={filter:{field:"id",param:"in",value:h},per_page:100},j.listUsers(i,function(b){b.items.forEach(function(a){var b=a.user,c=k.create(b);l.contacts[b.id]=c,localStorage.setItem("QM.contact-"+b.id,JSON.stringify(c))}),a.debug&&console.log("Contact List is updated",l),f(d)})):f(d)},globalSearch:function(b){var c,d=this.app.service,e=sessionStorage["QM.search.value"],f=sessionStorage["QM.search.page"],g=this;d.getUser({full_name:e,page:f},function(d){sessionStorage.setItem("QM.search.allPages",Math.ceil(d.total_entries/d.per_page)),sessionStorage.setItem("QM.search.page",++f),c=g.getResults(d.items),a.debug&&console.log("Search results",c),b(c)})},getResults:function(a){var b,c=this.app.models.Contact,d=this.app.models.User,e=[];return a.forEach(function(a){a.user.id!==d.contact.id&&(b=c.create(a.user),e.push(b))}),e},getFBFriends:function(b,c){var d,f=this.app.service,g=this.app.models.Contact,h=this,i=[];d={filter:{field:"facebook_id",param:"in",value:b}},f.listUsers(d,function(b){b.items.forEach(function(a){var b=a.user,c=g.create(b);i.push(b.id),h.contacts[b.id]=c,localStorage.setItem("QM.contact-"+b.id,JSON.stringify(c))}),e=e.concat(i),localStorage.setItem("QM.contacts",e.join()),a.debug&&console.log("Contact List is updated",h),c(i)})}},c}),define("VideoChatModule",["jquery","config","quickblox"],function(a,b,c){function d(a){this.app=a,f=this}function e(b){0===b.contents().length&&b.parent().addClass("is-hidden"),0===a("#historyList ul").contents().length&&a("#historyList ul").parent().addClass("is-hidden"),a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")}var f;return d.prototype.getUserMedia=function(b,d,e){var g=this.app.models.User,h={audio:!0,video:"video"===d?!0:!1,elemId:"localStream",options:{muted:!0,mirror:!0}};c.webrtc.getUserMedia(h,function(h,i){if(h)console.log(h),b.isCallee?(f.sendMessage(b.opponentId,"4",null,b.dialogId,d,!0),e(h,null)):e(h,null);else{if(console.log(i),!a('.l-chat[data-dialog="'+b.dialogId+'"]').find(".mediacall")[0])return i.stop(),!0;b.isCallee?(c.webrtc.accept(b.opponentId,{dialog_id:b.dialogId}),f.caller=b.opponentId,f.callee=g.contact.id):(c.webrtc.call(b.opponentId,d,{dialog_id:b.dialogId,avatar:g.contact.avatar_url,full_name:g.contact.full_name}),f.caller=g.contact.id,f.callee=b.opponentId),e(null,i)}})},d.prototype.sendMessage=function(d,g,h,i,j,k,l){var m,n,o,p=c.chat.helpers.getUserJid(d,b.qbAccount.appId),q=this.app.models.User,r=this.app.models.Message,s=this.app.views.Message,t=this.app.views.VideoChat,u=Math.floor(Date.now()/1e3),v=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+i+'"]');k?o={save_to_history:1,date_sent:u,callType:"video"===j?"1":"2",callState:g,caller:d,callee:q.contact.id}:(o={save_to_history:1,date_sent:u,callType:"3"===g?"video"===j?"1":"2":"video"===t.type?"1":"2",callState:"1"!==g||h?g:"2",caller:"3"===g?d:f.caller,callee:"3"===g?q.contact.id:f.callee},h&&(o.duration=h)),l&&(o.sessionID=l),c.chat.send(p,{type:"chat",body:"Call info",extension:o}),n=r.create({chat_dialog_id:i,date_sent:u,sender_id:q.contact.id,callType:o.callType,callState:o.callState,caller:o.caller,callee:o.callee,duration:o.duration||null,sessionID:o.sessionID||null}),b.debug&&console.log(n),s.addItem(n,!0,!0),v.length>0&&(m=v.clone(),v.remove(),a("#recentList ul").prepend(m),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),e(a("#recentList ul"))))},d}),define("UserView",["jquery","config","quickblox"],function(a,b,c){function d(a){this.app=a,e=this.app.models.User,g=this.app.models.Contact,f=this.app.models.ContactList}var e,f,g,h=null;d.prototype={signupQB:function(){j(a("#signUpPage"))},loginQB:function(){j(a("#loginPage"))},forgot:function(){j(a("#forgotPage"))},connectFB:function(a){e.connectFB(a)},signupForm:function(){i(),e.signup()},loginForm:function(){i(),e.login()},forgotForm:function(){i(),e.forgot()},resetForm:function(){i(),e.resetPass()},autologin:function(){j(a("#loginPage")),e.autologin()},createSpinner:function(){a("section:visible form").addClass("is-hidden").next(".l-spinner").removeClass("is-hidden")},removeSpinner:function(){a("section:visible form").removeClass("is-hidden").next(".l-spinner").addClass("is-hidden")},successFormCallback:function(){this.removeSpinner(),a("#profile").find(".avatar").addClass("profileUserAvatar").css("background-image","url("+e.contact.avatar_url+")"),a("#profile").find(".avatar").attr("data-id",e.contact.id),j(a("#mainPage"))},successSendEmailCallback:function(){var b='<div class="note l-form l-flexbox l-flexbox_column">';b+='<span class="text text_alert text_alert_success">Success!</span>',b+='<span class="text">Please check your email and click a link in the letter in order to reset your password</span>',b+="</div>",this.removeSpinner(),a("section:visible form").addClass("is-hidden").after(b)},getFBStatus:function(a){return"undefined"==typeof FB?(h=a,sessionStorage.setItem("QM.is_getFBStatus",!0),!1):(a=a||h,h=null,FB.getLoginStatus(function(c){b.debug&&console.log("FB status response",c),a&&("connected"===c.status?a(c.authResponse.accessToken):FB.login(function(c){b.debug&&console.log("FB authResponse",c),"connected"===c.status&&a(c.authResponse.accessToken)}))},!0),void 0)},profilePopover:function(a){var b='<ul class="list-actions list-actions_profile popover">';b+='<li class="list-item"><a id="userProfile" class="list-actions-action" href="#">Profile</a></li>',b+='<li class="list-item"><a id="logout" class="list-actions-action" href="#">Log Out</a></li>',b+="</ul>",a.after(b),l()},contactPopover:function(b){var c,d=b.parent().data("id"),e=b.parent().data("dialog"),g=f.roster,h=f.dialogs;c='<ul class="list-actions list-actions_contacts popover">',3===h[e].type&&g[d]&&"none"!==g[d].subscription?(c+='<li class="list-item"><a class="videoCall list-actions-action writeMessage" data-id="'+d+'" href="#">Video call</a></li>',c+='<li class="list-item"><a class="audioCall list-actions-action writeMessage" data-id="'+d+'" href="#">Audio call</a></li>',c+='<li class="list-item"><a class="list-actions-action createGroupChat" data-ids="'+d+'" data-private="1" href="#">Add people</a></li>'):3!==h[e].type&&(c+='<li class="list-item"><a class="list-actions-action addToGroupChat" data-group="true" data-ids="'+h[e].occupants_ids+'" data-dialog="'+e+'" href="#">Add people</a></li>'),3===h[e].type?(c+='<li class="list-item"><a class="list-actions-action userDetails" data-id="'+d+'" href="#">Profile</a></li>',c+='<li class="list-item"><a class="deleteContact list-actions-action" href="#">Delete contact</a></li>'):c+='<li class="list-item"><a class="leaveChat list-actions-action" data-group="true" href="#">Leave chat</a></li>',c+="</ul>",b.after(c).parent().addClass("is-contextmenu"),l();var i=b.offset().top,j=a(".mCustomScrollBox").height()+a(".mCustomScrollBox").offset().top,k=b.next(),m=k.children().length;50*m>=j-i&&k.addClass("margin-up")},occupantPopover:function(d,e){var g,h=d.data("id"),i=c.chat.helpers.getUserJid(h,b.qbAccount.appId),j=f.roster,k=e.currentTarget.getBoundingClientRect();g='<ul class="list-actions list-actions_occupants popover">',!j[h]||"none"===j[h].subscription&&!j[h].ask?g+='<li class="list-item" data-jid="'+i+'"><a class="list-actions-action requestAction" data-id="'+h+'" href="#">Send request</a></li>':(g+='<li class="list-item"><a class="videoCall list-actions-action writeMessage" data-id="'+h+'" href="#">Video call</a></li>',g+='<li class="list-item"><a class="audioCall list-actions-action writeMessage" data-id="'+h+'" href="#">Audio call</a></li>',g+='<li class="list-item"><a class="list-actions-action writeMessage" data-id="'+h+'" href="#">Write message</a></li>',g+='<li class="list-item"><a class="list-actions-action userDetails" data-id="'+h+'" href="#">Profile</a></li>'),g+="</ul>",a("body").append(g),l(),d.addClass("is-active"),a(".list-actions_occupants").offset({top:k.top,left:k.left})},buildDetails:function(b){var c=a("#popupDetails"),d=f.contacts[b],e=f.roster,g=e[b]?e[b]:null;navigator.userAgent.match(/Firefox/)&&c.find(".userDetails-controls button").css("padding","0 12px"),c.find(".userDetails-avatar").attr("data-id",b).css("background-image","url("+d.avatar_url+")"),c.find(".userDetails-filename").attr("data-id",b).text(d.full_name),c.find(".userDetails-status").attr("data-id",b).text(d.status),g&&g.status?c.find(".userDetails-chatStatus").html('<span class="status status_online"></span><span class="status_text">Online</span>'):c.find(".userDetails-chatStatus").html('<span class="status"></span><span class="status_text">Offline</span>'),c.find(".writeMessage").data("id",b),c.find(".userDetails-field").attr("data-id",b).html(d.phone?'<span class="userDetails-label">Phone:</span><span class="userDetails-phone">'+d.phone+"</span>":""),this.getNewProfile(b)},getNewProfile:function(b){var c=this.app.service,d=this.app.models.Contact,e=this.app.models.ContactList;c.getUser(b,function(b){var c=d.create(b);e.contacts[c.id]=c,a('.profileUserName[data-id="'+c.id+'"]').text(c.full_name),a('.profileUserStatus[data-id="'+c.id+'"]').text(c.status),c.phone&&a('.profileUserPhone[data-id="'+c.id+'"]').html('<span class="userDetails-label">Phone:</span><span class="userDetails-phone">'+c.phone+"</span>"),a('.profileUserAvatar[data-id="'+c.id+'"]').css("background-image","url("+c.avatar_url+")"),localStorage.setItem("QM.contact-"+c.id,JSON.stringify(c))})},smilePopover:function(b){1===b.find("img").length&&b.addClass("is-active").append('<img src="images/icon-smile_active.svg" alt="smile">').find("*:first").addClass("is-hidden"),a(".popover_smile").show(150)},logout:function(){var c=this.app.views.Dialog;a(".mediacall .btn_hangup").click(),e.logout(function(){k(),a("#capBox").removeClass("is-hidden"),a(".l-chat").remove(),b.debug&&console.log("current User and Session were destroyed"),c.logoutWithClearData()})},localSearch:function(b){var c=b.find('input[type="search"]').val().trim().toLowerCase();c.length>0?(a("#searchList").removeClass("is-hidden").siblings("section").addClass("is-hidden"),a("#searchList ul").html("").add("#searchList .note").removeClass("is-hidden"),a("#recentList, #historyList").find(".dialog-item").each(function(){var b=a(this).find(".name").text().toLowerCase(),d=a(this).clone();b.indexOf(c)>-1&&(a("#searchList ul").append(d),a("#searchList .note").addClass("is-hidden"))}),0===a("#searchList ul").find("li").length&&a("#searchList .note").removeClass("is-hidden").siblings("ul").addClass("is-hidden")):(a("#searchList").addClass("is-hidden"),a("#recentList, #historyList, #requestsList").each(function(){a(this).find(".list-item").length>0&&a(this).removeClass("is-hidden")}),0===a(".l-list-wrap section:not(#searchList) .list-item").length&&a("#emptyList").removeClass("is-hidden"))},friendsSearch:function(b){var c=b.find('input[type="search"]').val().trim().toLowerCase(),d=b.next();d.find("ul").removeClass("is-hidden").siblings().addClass("is-hidden"),d.find("ul li").removeClass("is-hidden"),c.length>0&&(d.find("ul li").each(function(){var b=a(this).find(".name").text().toLowerCase(),d=a(this);-1===b.indexOf(c)&&d.addClass("is-hidden")}),0===d.find("ul li:visible").length&&d.find(".note").removeClass("is-hidden").siblings().addClass("is-hidden"))}};var i=function(){a(".is-error").removeClass("is-error")},j=function(c){a("body").removeClass("is-welcome"),c.removeClass("is-hidden").siblings("section").addClass("is-hidden"),i(),a(".no-connection").addClass("is-hidden"),c.find("input").val(""),c.is("#mainPage")||(c.find("form").removeClass("is-hidden").next(".l-form").remove(),c.find("input:file").prev().find(".avatar").css("background-image","url("+b.defAvatar.url+")").siblings("span").text(b.defAvatar.caption),c.find("input:checkbox").prop("checked",!1))},k=function(){a("body").addClass("is-welcome"),a("#welcomePage").removeClass("is-hidden").siblings("section").addClass("is-hidden")},l=function(){a(".popover:not(.popover_smile)").show(150)};return d}),function(a){var b="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(c,d,e){b.Backbone=a(b,e,c,d)});else if("undefined"!=typeof exports){var c,d=require("underscore");try{c=require("jquery")}catch(e){}a(b,exports,d,c)}else b.Backbone=a(b,{},b._,b.jQuery||b.Zepto||b.ender||b.$)}(function(a,b,c,d){var e=a.Backbone,f=Array.prototype.slice;b.VERSION="1.2.3",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var g=function(a,b,d){switch(a){case 1:return function(){return c[b](this[d])};case 2:return function(a){return c[b](this[d],a)};case 3:return function(a,e){return c[b](this[d],i(a,this),e)};case 4:return function(a,e,f){return c[b](this[d],i(a,this),e,f)};default:return function(){var a=f.call(arguments);return a.unshift(this[d]),c[b].apply(c,a)}}},h=function(a,b,d){c.each(b,function(b,e){c[e]&&(a.prototype[e]=g(b,e,d))})},i=function(a,b){return c.isFunction(a)?a:c.isObject(a)&&!b._isModel(a)?j(a):c.isString(a)?function(b){return b.get(a)}:a},j=function(a){var b=c.matches(a);return function(a){return b(a.attributes)}},k=b.Events={},l=/\s+/,m=function(a,b,d,e,f){var g,h=0;if(d&&"object"==typeof d){void 0!==e&&"context"in f&&void 0===f.context&&(f.context=e);for(g=c.keys(d);h<g.length;h++)b=m(a,b,g[h],d[g[h]],f)}else if(d&&l.test(d))for(g=d.split(l);h<g.length;h++)b=a(b,g[h],e,f);else b=a(b,d,e,f);return b};k.on=function(a,b,c){return n(this,a,b,c)};var n=function(a,b,c,d,e){if(a._events=m(o,a._events||{},b,c,{context:d,ctx:a,listening:e}),e){var f=a._listeners||(a._listeners={});f[e.id]=e}return a};k.listenTo=function(a,b,d){if(!a)return this;var e=a._listenId||(a._listenId=c.uniqueId("l")),f=this._listeningTo||(this._listeningTo={}),g=f[e];if(!g){var h=this._listenId||(this._listenId=c.uniqueId("l"));g=f[e]={obj:a,objId:e,id:h,listeningTo:f,count:0}}return n(a,b,d,this,g),this};var o=function(a,b,c,d){if(c){var e=a[b]||(a[b]=[]),f=d.context,g=d.ctx,h=d.listening;h&&h.count++,e.push({callback:c,context:f,ctx:f||g,listening:h})}return a};k.off=function(a,b,c){return this._events?(this._events=m(p,this._events,a,b,{context:c,listeners:this._listeners}),this):this},k.stopListening=function(a,b,d){var e=this._listeningTo;if(!e)return this;for(var f=a?[a._listenId]:c.keys(e),g=0;g<f.length;g++){var h=e[f[g]];if(!h)break;h.obj.off(b,d,this)}return c.isEmpty(e)&&(this._listeningTo=void 0),this};var p=function(a,b,d,e){if(a){var f,g=0,h=e.context,i=e.listeners;if(b||d||h){for(var j=b?[b]:c.keys(a);g<j.length;g++){b=j[g];var k=a[b];if(!k)break;for(var l=[],m=0;m<k.length;m++){var n=k[m];d&&d!==n.callback&&d!==n.callback._callback||h&&h!==n.context?l.push(n):(f=n.listening,f&&0===--f.count&&(delete i[f.id],delete f.listeningTo[f.objId]))}l.length?a[b]=l:delete a[b]}return c.size(a)?a:void 0}for(var o=c.keys(i);g<o.length;g++)f=i[o[g]],delete i[f.id],delete f.listeningTo[f.objId]}};k.once=function(a,b,d){var e=m(q,{},a,b,c.bind(this.off,this));return this.on(e,void 0,d)},k.listenToOnce=function(a,b,d){var e=m(q,{},b,d,c.bind(this.stopListening,this,a));return this.listenTo(a,e)};var q=function(a,b,d,e){if(d){var f=a[b]=c.once(function(){e(b,f),d.apply(this,arguments)});f._callback=d}return a};k.trigger=function(a){if(!this._events)return this;for(var b=Math.max(0,arguments.length-1),c=Array(b),d=0;b>d;d++)c[d]=arguments[d+1];return m(r,this._events,a,void 0,c),this};var r=function(a,b,c,d){if(a){var e=a[b],f=a.all;e&&f&&(f=f.slice()),e&&s(e,d),f&&s(f,[b].concat(d))}return a},s=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}};k.bind=k.on,k.unbind=k.off,c.extend(b,k);var t=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId(this.cidPrefix),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(t.prototype,k,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(a){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},matches:function(a){return!!c.iteratee(a,this)(this.attributes)},set:function(a,b,d){if(null==a)return this;var e;if("object"==typeof a?(e=a,d=b):(e={})[a]=b,d||(d={}),!this._validate(e,d))return!1;var f=d.unset,g=d.silent,h=[],i=this._changing;this._changing=!0,i||(this._previousAttributes=c.clone(this.attributes),this.changed={});var j=this.attributes,k=this.changed,l=this._previousAttributes;for(var m in e)b=e[m],c.isEqual(j[m],b)||h.push(m),c.isEqual(l[m],b)?delete k[m]:k[m]=b,f?delete j[m]:j[m]=b;if(this.id=this.get(this.idAttribute),!g){h.length&&(this._pending=d);for(var n=0;n<h.length;n++)this.trigger("change:"+h[n],this,j[h[n]],d)}if(i)return this;if(!g)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var b=this._changing?this._previousAttributes:this.attributes,d={};for(var e in a){var f=a[e];c.isEqual(b[e],f)||(d[e]=f)}return c.size(d)?d:!1},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=c.extend({parse:!0},a);var b=this,d=a.success;return a.success=function(c){var e=a.parse?b.parse(c,a):c;return b.set(e,a)?(d&&d.call(a.context,b,c,a),void b.trigger("sync",b,c,a)):!1},P(this,a),this.sync("read",this,a)},save:function(a,b,d){var e;null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0,parse:!0},d);var f=d.wait;if(e&&!f){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;var g=this,h=d.success,i=this.attributes;d.success=function(a){g.attributes=i;var b=d.parse?g.parse(a,d):a;return f&&(b=c.extend({},e,b)),b&&!g.set(b,d)?!1:(h&&h.call(d.context,g,a,d),void g.trigger("sync",g,a,d))},P(this,d),e&&f&&(this.attributes=c.extend({},i,e));var j=this.isNew()?"create":d.patch?"patch":"update";"patch"!==j||d.attrs||(d.attrs=e);var k=this.sync(j,this,d);return this.attributes=i,k},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=a.wait,f=function(){b.stopListening(),b.trigger("destroy",b,b.collection,a)};a.success=function(c){e&&f(),d&&d.call(a.context,b,c,a),b.isNew()||b.trigger("sync",b,c,a)};var g=!1;return this.isNew()?c.defer(a.success):(P(this,a),g=this.sync("delete",this,a)),e||f(),g},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||O();if(this.isNew())return a;var b=this.get(this.idAttribute);return a.replace(/[^\/]$/,"$&/")+encodeURIComponent(b)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.defaults({validate:!0},a))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return d?(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1):!0}});var u={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};h(t,u,"attributes");var v=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))},w={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},y=function(a,b,c){c=Math.min(Math.max(c,0),a.length);for(var d=Array(a.length-c),e=b.length,f=0;f<d.length;f++)d[f]=a[f+c];for(f=0;e>f;f++)a[f+c]=b[f];for(f=0;f<d.length;f++)a[f+e+c]=d[f]};c.extend(v.prototype,k,{model:t,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,x))},remove:function(a,b){b=c.extend({},b);var d=!c.isArray(a);a=d?[a]:c.clone(a);var e=this._removeModels(a,b);return!b.silent&&e&&this.trigger("update",this,b),d?e[0]:e},set:function(a,b){if(null!=a){b=c.defaults({},b,w),b.parse&&!this._isModel(a)&&(a=this.parse(a,b));var d=!c.isArray(a);a=d?[a]:a.slice();var e=b.at;null!=e&&(e=+e),0>e&&(e+=this.length+1);for(var f,g=[],h=[],i=[],j={},k=b.add,l=b.merge,m=b.remove,n=!1,o=this.comparator&&null==e&&b.sort!==!1,p=c.isString(this.comparator)?this.comparator:null,q=0;q<a.length;q++){f=a[q];var r=this.get(f);if(r){if(l&&f!==r){var s=this._isModel(f)?f.attributes:f;b.parse&&(s=r.parse(s,b)),r.set(s,b),o&&!n&&(n=r.hasChanged(p))}j[r.cid]||(j[r.cid]=!0,g.push(r)),a[q]=r}else k&&(f=a[q]=this._prepareModel(f,b),f&&(h.push(f),this._addReference(f,b),j[f.cid]=!0,g.push(f)))}if(m){for(q=0;q<this.length;q++)f=this.models[q],j[f.cid]||i.push(f);i.length&&this._removeModels(i,b)}var t=!1,u=!o&&k&&m;if(g.length&&u?(t=this.length!=g.length||c.some(this.models,function(a,b){return a!==g[b]}),this.models.length=0,y(this.models,g,0),this.length=this.models.length):h.length&&(o&&(n=!0),y(this.models,h,null==e?this.length:e),this.length=this.models.length),n&&this.sort({silent:!0}),!b.silent){for(q=0;q<h.length;q++)null!=e&&(b.index=e+q),f=h[q],f.trigger("add",f,this,b);(n||t)&&this.trigger("sort",this,b),(h.length||i.length)&&this.trigger("update",this,b)}return d?a[0]:a}},reset:function(a,b){b=b?c.clone(b):{};for(var d=0;d<this.models.length;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a)},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a)},slice:function(){return f.apply(this.models,arguments)},get:function(a){if(null!=a){var b=this.modelId(this._isModel(a)?a.attributes:a);return this._byId[a]||this._byId[b]||this._byId[a.cid]}},at:function(a){return 0>a&&(a+=this.length),this.models[a]},where:function(a,b){return this[b?"find":"filter"](a)},findWhere:function(a){return this.where(a,!0)},sort:function(a){var b=this.comparator;if(!b)throw new Error("Cannot sort a set without a comparator");a||(a={});var d=b.length;return c.isFunction(b)&&(b=c.bind(b,this)),1===d||c.isString(b)?this.models=this.sortBy(b):this.models.sort(b),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=c.extend({parse:!0},a);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b.call(a.context,d,c,a),d.trigger("sync",d,c,a)},P(this,a),this.sync("read",this,a)},create:function(a,b){b=b?c.clone(b):{};var d=b.wait;if(a=this._prepareModel(a,b),!a)return!1;d||this.add(a,b);var e=this,f=b.success;return b.success=function(a,b,c){d&&e.add(a,c),f&&f.call(c.context,a,b,c)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(a){return a[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(this._isModel(a))return a.collection||(a.collection=this),a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_removeModels:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=this.get(a[d]);if(e){var f=this.indexOf(e);this.models.splice(f,1),this.length--,b.silent||(b.index=f,e.trigger("remove",e,this,b)),c.push(e),this._removeReference(e,b)}}return c.length?c:!1},_isModel:function(a){return a instanceof t},_addReference:function(a,b){this._byId[a.cid]=a;var c=this.modelId(a.attributes);null!=c&&(this._byId[c]=a),a.on("all",this._onModelEvent,this)},_removeReference:function(a,b){delete this._byId[a.cid];var c=this.modelId(a.attributes);null!=c&&delete this._byId[c],this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if("add"!==a&&"remove"!==a||c===this){if("destroy"===a&&this.remove(b,d),"change"===a){var e=this.modelId(b.previousAttributes()),f=this.modelId(b.attributes);e!==f&&(null!=e&&delete this._byId[e],null!=f&&(this._byId[f]=b))}this.trigger.apply(this,arguments)}}});var z={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3};h(v,z,"models");var A=b.View=function(a){this.cid=c.uniqueId("view"),c.extend(this,c.pick(a,C)),
this._ensureElement(),this.initialize.apply(this,arguments)},B=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName","events"];c.extend(A.prototype,k,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(a){return this.undelegateEvents(),this._setElement(a),this.delegateEvents(),this},_setElement:function(a){this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0]},delegateEvents:function(a){if(a||(a=c.result(this,"events")),!a)return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[d]),d){var e=b.match(B);this.delegate(e[1],e[2],c.bind(d,this))}}return this},delegate:function(a,b,c){return this.$el.on(a+".delegateEvents"+this.cid,b,c),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(a,b,c){return this.$el.off(a+".delegateEvents"+this.cid,b,c),this},_createElement:function(a){return document.createElement(a)},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"));else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className")),this.setElement(this._createElement(c.result(this,"tagName"))),this._setAttributes(a)}},_setAttributes:function(a){this.$el.attr(a)}}),b.sync=function(a,d,e){var f=D[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||O()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",f),h?h.apply(this,arguments):void 0}}"GET"===g.type||e.emulateJSON||(g.processData=!1);var i=e.error;e.error=function(a,b,c){e.textStatus=b,e.errorThrown=c,i&&i.call(e.context,a,b,c)};var j=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,j,e),j};var D={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var E=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},F=/\((.*?)\)/g,G=/(\(\?)?:\w+/g,H=/\*\w+/g,I=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(E.prototype,k,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g,d)!==!1&&(f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g))}),this},execute:function(a,b,c){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(I,"\\$&").replace(F,"(?:$1)?").replace(G,function(a,b){return b?a:"([^/?]+)"}).replace(H,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var J=b.History=function(){this.handlers=[],this.checkUrl=c.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},K=/^[#\/]|\s+$/g,L=/^\/+|\/+$/g,M=/#.*$/;J.started=!1,c.extend(J.prototype,k,{interval:50,atRoot:function(){var a=this.location.pathname.replace(/[^\/]$/,"$&/");return a===this.root&&!this.getSearch()},matchRoot:function(){var a=this.decodeFragment(this.location.pathname),b=a.slice(0,this.root.length-1)+"/";return b===this.root},decodeFragment:function(a){return decodeURI(a.replace(/%25/g,"%2525"))},getSearch:function(){var a=this.location.href.replace(/#.*/,"").match(/\?.+/);return a?a[0]:""},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getPath:function(){var a=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===a.charAt(0)?a.slice(1):a},getFragment:function(a){return null==a&&(a=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),a.replace(K,"")},start:function(a){if(J.started)throw new Error("Backbone.history has already been started");if(J.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(L,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var b=this.root.slice(0,-1)||"/";return this.location.replace(b+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var d=document.body,e=d.insertBefore(this.iframe,d.firstChild).contentWindow;e.document.open(),e.document.close(),e.location.hash="#"+this.fragment}var f=window.addEventListener||function(a,b){return attachEvent("on"+a,b)};return this._usePushState?f("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?f("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.options.silent?void 0:this.loadUrl()},stop:function(){var a=window.removeEventListener||function(a,b){return detachEvent("on"+a,b)};this._usePushState?a("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&a("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),J.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getHash(this.iframe.contentWindow)),b===this.fragment?!1:(this.iframe&&this.navigate(b),void this.loadUrl())},loadUrl:function(a){return this.matchRoot()?(a=this.fragment=this.getFragment(a),c.some(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})):!1},navigate:function(a,b){if(!J.started)return!1;b&&b!==!0||(b={trigger:!!b}),a=this.getFragment(a||"");var c=this.root;(""===a||"?"===a.charAt(0))&&(c=c.slice(0,-1)||"/");var d=c+a;if(a=this.decodeFragment(a.replace(M,"")),this.fragment!==a){if(this.fragment=a,this._usePushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,d);else{if(!this._wantsHashChange)return this.location.assign(d);if(this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getHash(this.iframe.contentWindow)){var e=this.iframe.contentWindow;b.replace||(e.document.open(),e.document.close()),this._updateHash(e.location,a,b.replace)}}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new J;var N=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};t.extend=v.extend=E.extend=A.extend=J.extend=N;var O=function(){throw new Error('A "url" property or function must be specified')},P=function(a,b){var c=b.error;b.error=function(d){c&&c.call(b.context,a,d,b),a.trigger("error",a,d,b)}};return b}),define("models/person",["jquery","underscore","backbone","config"],function(a,b,c,d){var e,f=c.Model.extend({defaults:{full_name:null,email:null,password:"",phone:"",facebook_id:null,avatar:null,avatar_url:d.defAvatar.url,status:"",tag:null},validate:function(a){var b=1024*d.maxLimitFile*1024;if(!a.full_name)return"Name is required";if(a.full_name.length<3)return d.errors.shortName;if(!/^[^><;]+$/.test(a.full_name))return d.errors.invalidName;if(a.password){if(!/^[A-Za-z0-9`~!@#%&=_<>;:,'\"\.\$\^\*\-\+\\\/\|\(\)\[\]\{\}\?]+$/.test(a.password))return d.errors.invalidPass;if(a.password.length<8)return d.errors.shortPass}if(a.phone&&!/^[-0-9()+*#]+$/.test(a.phone))return d.errors.invalidPhone;if(a.avatar){if(!/^image.{0,}$/.test(a.avatar.type))return d.errors.avatarType;if(a.avatar.size>b)return d.errors.fileSize;if(a.avatar.name.length>100)return d.errors.fileName}},parse:function(a,c){return"object"==typeof c&&(e=c.app),b.each(a,function(c,d){var e=b.has(this.defaults,d);"id"===d||e?"string"==typeof c&&(a[d]=c.trim()):delete a[d]},this),a},initialize:function(){},update:function(){var b=e.models.User.contact,c=e.service,f=this.changed,g={},h=b.custom_data&&JSON.parse(b.custom_data)||{},i=this;0===Object.keys(f).length||1===Object.keys(f).length&&"avatar"===Object.keys(f)[0]&&!f.avatar||(f.full_name&&(g.full_name=b.full_name=f.full_name),f.phone&&(g.phone=b.phone=f.phone),f.status&&(h.status=b.status=f.status,g.custom_data=b.custom_data=JSON.stringify(h)),f.avatar?this.uploadAvatar(f.avatar,function(f){i.set("avatar_url",f.path),g.blob_id=b.blob_id=f.id,h.avatar_url=b.avatar_url=f.path,g.custom_data=b.custom_data=JSON.stringify(h),a('.profileUserName[data-id="'+b.id+'"]').text(b.full_name),a('.profileUserAvatar[data-id="'+b.id+'"]').css("background-image","url("+b.avatar_url+")"),e.models.User.rememberMe(),c.updateUser(b.id,g,function(a){d.debug&&console.log("update of user",a)})}):(a('.profileUserName[data-id="'+b.id+'"]').text(b.full_name),e.models.User.rememberMe(),c.updateUser(b.id,g,function(a){d.debug&&console.log("update of user",a)})))},uploadAvatar:function(a,b){var c=e.service,d=e.models.Attach;d.crop(a,{w:146,h:146},function(a){c.createBlob({file:a,"public":!0},function(a){b(a)})})},changeQBPass:function(a,b){var c=e.models.User.contact,f=e.models.Session,g=e.service,h={},i=this;h.old_password=a.oldPass,h.password=a.newPass,g.updateUser(c.id,h,function(a,e){a?(d.debug&&console.log("update of user",a),f.update({authParams:f.encrypt({email:c.email,password:h.password})},!0),i.set("password",""),b(null,a)):b(e,null)})},connectFB:function(b,c){var f=e.models.User.contact,g=e.service,h=f.custom_data&&JSON.parse(f.custom_data)||{},i={},j=this;j.get("avatar_url")===d.defAvatar.url&&(h.avatar_url="https://graph.facebook.com/v2.2/"+b+"/picture?width=146&height=146"),h.is_import="1",i.facebook_id=b,i.custom_data=JSON.stringify(h),g.updateUser(f.id,i,function(g,k){g?(d.debug&&console.log("update of user",g),j.get("avatar_url")===d.defAvatar.url&&(j.set("avatar_url",h.avatar_url),f.avatar_url=h.avatar_url),j.set("facebook_id",b),f.facebook_id=b,f.custom_data=i.custom_data,a('.profileUserAvatar[data-id="'+f.id+'"]').css("background-image","url("+f.avatar_url+")"),e.models.User.rememberMe(),j.getFBFriends(),c(null,g)):c(k,null)})},getFBFriends:function(){var a=!1,b=this;FB.api("/me/permissions",function(c){d.debug&&console.log("FB Permissions",c);for(var e=0,f=c.data.length;f>e;e++)"user_friends"===c.data[e].permission&&"granted"===c.data[e].status&&(a=!0);a&&FB.api("/me/friends",function(a){d.debug&&console.log("FB friends",a);for(var c=[],e=0,f=a.data.length;f>e;e++)c.push(a.data[e].id);c.length>0&&b["import"](c)})})},"import":function(a){var b=e.models.ContactList,c=e.views.ContactList,d=e.views.FBImport;b.getFBFriends(a,function(a){for(var b=0,e=a.length;e>b;b++)c.importFBFriend(a[b]);d.render().openPopup()})}});return f}),define("views/profile",["jquery","underscore","backbone","config"],function(a,b,c,d){var e=c.View.extend({className:"profileWrap",template:b.template(a("#templateProfile").html()),initialize:function(){this.model.on("invalid",this.validateError,this)},events:{"click .userProfile-field_phone":"editPhone",click:"editProfile","change .btn_userProfile_file":"chooseAvatar"},render:function(){var b=this.$el.html(this.template(this.model.toJSON()));return a(".popups").append(b),this.delegateEvents(this.events),this},openPopup:function(){this.$el.find(".popup").add(".popups").addClass("is-overlay")},closePopup:function(){a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay")},editPhone:function(){this.$el.find(".userProfile-phone").focus()},editProfile:function(b){var c,d=a(b.target);d.is("."+this.className)&&(c={full_name:this.$el.find(".userProfile-filename").val().trim(),phone:this.$el.find(".userProfile-phone").val().trim(),status:this.$el.find(".userProfile-status-field").val().trim(),avatar:this.$el.find(".btn_userProfile_file")[0].files[0]||null},this.model.set(c,{validate:!0}),console.log(this.model),this.model.validationError||(this.model.update(),this.remove(),this.closePopup()))},validateError:function(a,b){this.$el.find(".userProfile-errors").text(b),this.$el.find(".userProfile-success").text("")},chooseAvatar:function(){var a=window.webkitURL||window.URL,b=this.$el.find(".btn_userProfile_file")[0].files[0],c=b?a.createObjectURL(b):this.model.get("avatar_url")===d.defAvatar.url?d.defAvatar.url:this.model.get("avatar_url");this.$el.find(".userDetails-avatar").css("background-image","url("+c+")")},addFBAccount:function(a){var b=this;this.model.connectFB(a,function(a,c){a?(b.validateError(b.model,d.errors.FBAccountExists),b.$el.find(".btn_userProfile_connect").prop("disabled",!1)):(b.$el.find(".userProfile-field-facebook").html('<span class="userDetails-label">Facebook:</span><span class="userProfile-facebook">Connected</span>'),b.$el.find(".userProfile-errors, .userProfile-success").text(""))})}});return e}),function(a){"use strict";var b=function(){var a=document.body||document.documentElement,b=a.style;if("string"==typeof b.transition)return!0;var c=["moz","webkit","khtml","o","ms"];for(var d in c)if("string"==typeof b[c[d]+"Transition"])return!0;return!1}()?"css":"animate";a.fn.extend({chromaHash:function(c){var d={bars:3,salt:"7be82b35cb0199120eea35a4507c9acf",minimum:6};c=a.extend(d,c);var e=0,f=function(a){function b(a,b,c,d,e,h,i){return f(g(f(f(a,b&c|~b&d),f(e,i)),h),b)}function c(a,b,c,d,e,h,i){return f(g(f(f(a,b&d|c&~d),f(e,i)),h),b)}function d(a,b,c,d,e,h,i){return f(g(f(f(a,b^c^d),f(e,i)),h),b)}function e(a,b,c,d,e,h,i){return f(g(f(f(a,c^(b|~d)),f(e,i)),h),b)}function f(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c}function g(a,b){return a<<b|a>>>32-b}for(var h,i,j="",k=-1;++k<a.length;)h=a.charCodeAt(k),i=k+1<a.length?a.charCodeAt(k+1):0,h>=55296&&56319>=h&&i>=56320&&57343>=i&&(h=65536+((1023&h)<<10)+(1023&i),k++),127>=h?j+=String.fromCharCode(h):2047>=h?j+=String.fromCharCode(192|h>>>6&31,128|63&h):65535>=h?j+=String.fromCharCode(224|h>>>12&15,128|h>>>6&63,128|63&h):2097151>=h&&(j+=String.fromCharCode(240|h>>>18&7,128|h>>>12&63,128|h>>>6&63,128|63&h));for(a=Array(j.length>>2),k=0;k<a.length;k++)a[k]=0;for(k=0;k<8*j.length;k+=8)a[k>>5]|=(255&j.charCodeAt(k/8))<<k%32;j=8*j.length,a[j>>5]|=128<<j%32,a[(j+64>>>9<<4)+14]=j,j=1732584193,k=-271733879,h=-1732584194,i=271733878;for(var l=0;l<a.length;l+=16){var m=j,n=k,o=h,p=i,j=b(j,k,h,i,a[l+0],7,-680876936);i=b(i,j,k,h,a[l+1],12,-389564586),h=b(h,i,j,k,a[l+2],17,606105819),k=b(k,h,i,j,a[l+3],22,-1044525330),j=b(j,k,h,i,a[l+4],7,-176418897),i=b(i,j,k,h,a[l+5],12,1200080426),h=b(h,i,j,k,a[l+6],17,-1473231341),k=b(k,h,i,j,a[l+7],22,-45705983),j=b(j,k,h,i,a[l+8],7,1770035416),i=b(i,j,k,h,a[l+9],12,-1958414417),h=b(h,i,j,k,a[l+10],17,-42063),k=b(k,h,i,j,a[l+11],22,-1990404162),j=b(j,k,h,i,a[l+12],7,1804603682),i=b(i,j,k,h,a[l+13],12,-40341101),h=b(h,i,j,k,a[l+14],17,-1502002290),k=b(k,h,i,j,a[l+15],22,1236535329),j=c(j,k,h,i,a[l+1],5,-165796510),i=c(i,j,k,h,a[l+6],9,-1069501632),h=c(h,i,j,k,a[l+11],14,643717713),k=c(k,h,i,j,a[l+0],20,-373897302),j=c(j,k,h,i,a[l+5],5,-701558691),i=c(i,j,k,h,a[l+10],9,38016083),h=c(h,i,j,k,a[l+15],14,-660478335),k=c(k,h,i,j,a[l+4],20,-405537848),j=c(j,k,h,i,a[l+9],5,568446438),i=c(i,j,k,h,a[l+14],9,-1019803690),h=c(h,i,j,k,a[l+3],14,-187363961),k=c(k,h,i,j,a[l+8],20,1163531501),j=c(j,k,h,i,a[l+13],5,-1444681467),i=c(i,j,k,h,a[l+2],9,-51403784),h=c(h,i,j,k,a[l+7],14,1735328473),k=c(k,h,i,j,a[l+12],20,-1926607734),j=d(j,k,h,i,a[l+5],4,-378558),i=d(i,j,k,h,a[l+8],11,-2022574463),h=d(h,i,j,k,a[l+11],16,1839030562),k=d(k,h,i,j,a[l+14],23,-35309556),j=d(j,k,h,i,a[l+1],4,-1530992060),i=d(i,j,k,h,a[l+4],11,1272893353),h=d(h,i,j,k,a[l+7],16,-155497632),k=d(k,h,i,j,a[l+10],23,-1094730640),j=d(j,k,h,i,a[l+13],4,681279174),i=d(i,j,k,h,a[l+0],11,-358537222),h=d(h,i,j,k,a[l+3],16,-722521979),k=d(k,h,i,j,a[l+6],23,76029189),j=d(j,k,h,i,a[l+9],4,-640364487),i=d(i,j,k,h,a[l+12],11,-421815835),h=d(h,i,j,k,a[l+15],16,530742520),k=d(k,h,i,j,a[l+2],23,-995338651),j=e(j,k,h,i,a[l+0],6,-198630844),i=e(i,j,k,h,a[l+7],10,1126891415),h=e(h,i,j,k,a[l+14],15,-1416354905),k=e(k,h,i,j,a[l+5],21,-57434055),j=e(j,k,h,i,a[l+12],6,1700485571),i=e(i,j,k,h,a[l+3],10,-1894986606),h=e(h,i,j,k,a[l+10],15,-1051523),k=e(k,h,i,j,a[l+1],21,-2054922799),j=e(j,k,h,i,a[l+8],6,1873313359),i=e(i,j,k,h,a[l+15],10,-30611744),h=e(h,i,j,k,a[l+6],15,-1560198380),k=e(k,h,i,j,a[l+13],21,1309151649),j=e(j,k,h,i,a[l+4],6,-145523070),i=e(i,j,k,h,a[l+11],10,-1120210379),h=e(h,i,j,k,a[l+2],15,718787259),k=e(k,h,i,j,a[l+9],21,-343485551),j=f(j,m),k=f(k,n),h=f(h,o),i=f(i,p)}for(a=[j,k,h,i],j="",k=0;k<32*a.length;k+=8)j+=String.fromCharCode(a[k>>5]>>>k%32&255);for(a=j,j="0123456789ABCDEF",k="",i=0;i<a.length;i++)h=a.charCodeAt(i),k+=j.charAt(h>>>4&15)+j.charAt(15&h);return k};return this.each(function(){if(c.bars<1||c.bars>4)return console.error("Chroma-Hash expects a number parameter between 1 and 4, given "+c.bars),!1;var d=["primary","secondary","tertiary","quaternary"].slice(0,c.bars),g=function(b){var c=a(b).attr("id");return a("label.chroma-hash").filter(function(){return a(this).attr("for")===c})},h=function(){var d=a(this);if(""===d.val())return void g(this)[b]({background:"",opacity:"0"});var e=d.position(),h=d.outerHeight(),i=d.outerWidth();g(this).each(function(b){var c={position:"absolute",opacity:"1.0",left:e.left+i-1,top:e.top,height:h-2+"px",width:"8px",margin:"0px",marginLeft:-8*++b+"px",transition:"background 0.5s","-moz-transition":"background 0.5s","-webkit-transition":"background 0.5s","-khtml-transition":"background 0.5s","-o-transition":"background 0.5s","-ms-transition":"background 0.5s"};navigator.userAgent.indexOf("Safari")>-1?c.marginTop="3px":c.marginTop="1px",a(this).css(c)});var j=(d.attr("id"),f(""+d.val()+":"+c.salt)),k=j.match(/([\dABCDEF]{6})/gi);d.val().length<c.minimum?g(this).each(function(c){var d=(parseInt(k[c],16)%15).toString(16),e="#"+d+d+d;a(this).stop()[b]("background",e)}):g(this).each(function(c){var d=("#"+k[c]+"000000").slice(0,7);a(this).stop()[b]("background",d)})};a(this).each(function(b){var c=a(this),f=c.attr("id");f&&""!==f||(f="chroma-hash_"+e++,c.attr("id",f));for(var g in d)c.after('<label for="'+f+'" class="'+d[g]+' chroma-hash"></label>');c.bind("keyup",h).bind("blur",h)})})}})}(jQuery),define("chromaHash",["jquery"],function(){}),define("views/change_password",["jquery","underscore","backbone","config","chromaHash"],function(a,b,c,d){var e=c.View.extend({className:"passWrap",template:b.template(a("#templateChangePass").html()),initialize:function(){this.model.on("invalid",this.validateError,this)},events:{click:"cancelChange"},render:function(){var b=this.$el.html(this.template(this.model.toJSON()));return a(".popups").append(b),this.delegateEvents(this.events),this},openPopup:function(){this.$el.find(".popup").add(".popups").addClass("is-overlay"),this.$el.find("input:password").chromaHash({bars:4})},validateError:function(a,b){("Fields mustn't be empty"===b||b===d.errors.oldPass||b===d.errors.invalidPass||b===d.errors.shortPass)&&(a.set("password",""),this.remove(),this.render().openPopup(),this.$el.find(".changePass-errors").text(b))},cancelChange:function(b){var c=a(b.target);c.is("."+this.className)&&(this.remove(),a(".profileWrap .userProfile-errors, .profileWrap .userProfile-success").text(""),a(".profileWrap").show())},submitForm:function(){this.$el.find(".btn_popup_changepass").hide(),this.createDataSpinner(),this.changePass()},createDataSpinner:function(){var a='<div class="popup-elem spinner_bounce spinner_bounce_changepass">';a+='<div class="spinner_bounce-bounce1"></div>',a+='<div class="spinner_bounce-bounce2"></div>',a+='<div class="spinner_bounce-bounce3"></div>',a+="</div>",this.$el.find(".popup-footer").append(a)},removeDataSpinner:function(){this.$el.find(".spinner_bounce").remove(),this.$el.find(".btn_popup_changepass").show()},changePass:function(){var b=this,c={oldPass:this.$el.find("#old-password").val().trim(),newPass:this.$el.find("#new-password").val().trim()};c.oldPass&&c.newPass?(this.model.set({password:c.newPass},{validate:!0}),console.log(this.model),this.model.validationError||this.model.changeQBPass(c,function(c,e){c?b.validateError(b.model,d.errors.oldPass):(b.remove(),a(".profileWrap .userProfile-errors").text(""),a(".profileWrap .userProfile-success").text("Your password has been successfully changed"),a(".profileWrap").show())})):this.validateError(this.model,"Fields mustn't be empty")}});return e}),define("views/fb_import",["jquery","underscore","backbone"],function(a,b,c){var d=c.View.extend({className:"importWrap",template:b.template(a("#templateFBImport").html()),events:{"click .returnBackToPopup":"returnToPopup"},render:function(){var b=this.$el.html(this.template());return a(".popups").append(b),this.delegateEvents(this.events),this},openPopup:function(){a(".passWrap")[0]?a(".passWrap").addClass("tempHide"):a(".profileWrap")[0]?a(".profileWrap").addClass("tempHide"):a(".popup.is-overlay").addClass("tempHide"),a(".tempHide").hide(),this.$el.find(".popup").add(".popups").addClass("is-overlay")},returnToPopup:function(b){b.preventDefault(),this.remove(),a(".tempHide").show(),a(".tempHide").removeClass("tempHide")}});return d}),function(a){"undefined"!=typeof module&&module.exports?module.exports=a:a(jQuery,window,document)}(function(a){!function(b){var c="function"==typeof define&&define.amd,d="undefined"!=typeof module&&module.exports,e="https:"==document.location.protocol?"https:":"http:",f="cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js";c||(d?require("jquery-mousewheel")(a):a.event.special.mousewheel||a("head").append(decodeURI("%3Cscript src="+e+"//"+f+"%3E%3C/script%3E"))),b()}(function(){var b,c="mCustomScrollbar",d="mCS",e=".mCustomScrollbar",f={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,documentTouchScroll:!0,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:"auto",autoUpdateTimeout:60},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0}},g=0,h={},i=window.attachEvent&&!window.addEventListener?1:0,j=!1,k=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],l={init:function(b){var b=a.extend(!0,{},f,b),c=m.call(this);if(b.live){var i=b.liveSelector||this.selector||e,j=a(i);if("off"===b.live)return void o(i);h[i]=setTimeout(function(){j.mCustomScrollbar(b),"once"===b.live&&j.length&&o(i)},500)}else o(i);return b.setWidth=b.set_width?b.set_width:b.setWidth,b.setHeight=b.set_height?b.set_height:b.setHeight,b.axis=b.horizontalScroll?"x":p(b.axis),b.scrollInertia=b.scrollInertia>0&&b.scrollInertia<17?17:b.scrollInertia,"object"!=typeof b.mouseWheel&&1==b.mouseWheel&&(b.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),b.mouseWheel.scrollAmount=b.mouseWheelPixels?b.mouseWheelPixels:b.mouseWheel.scrollAmount,b.mouseWheel.normalizeDelta=b.advanced.normalizeMouseWheelDelta?b.advanced.normalizeMouseWheelDelta:b.mouseWheel.normalizeDelta,b.scrollButtons.scrollType=q(b.scrollButtons.scrollType),n(b),a(c).each(function(){var c=a(this);if(!c.data(d)){c.data(d,{idx:++g,opt:b,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:!1,tweenRunning:!1,sequential:{},langDir:c.css("direction"),cbOffsets:null,trigger:null,poll:{size:{o:0,n:0},img:{o:0,n:0},change:{o:0,n:0}}});var e=c.data(d),f=e.opt,h=c.data("mcs-axis"),i=c.data("mcs-scrollbar-position"),j=c.data("mcs-theme");h&&(f.axis=h),i&&(f.scrollbarPosition=i),j&&(f.theme=j,n(f)),r.call(this),e&&f.callbacks.onCreate&&"function"==typeof f.callbacks.onCreate&&f.callbacks.onCreate.call(this),a("#mCSB_"+e.idx+"_container img:not(."+k[2]+")").addClass(k[2]),l.update.call(null,c)}})},update:function(b,c){var e=b||m.call(this);return a(e).each(function(){var b=a(this);if(b.data(d)){var e=b.data(d),f=e.opt,g=a("#mCSB_"+e.idx+"_container"),h=a("#mCSB_"+e.idx),i=[a("#mCSB_"+e.idx+"_dragger_vertical"),a("#mCSB_"+e.idx+"_dragger_horizontal")];if(!g.length)return;e.tweenRunning&&U(b),c&&e&&f.callbacks.onBeforeUpdate&&"function"==typeof f.callbacks.onBeforeUpdate&&f.callbacks.onBeforeUpdate.call(this),b.hasClass(k[3])&&b.removeClass(k[3]),b.hasClass(k[4])&&b.removeClass(k[4]),h.css("max-height","none"),h.height()!==b.height()&&h.css("max-height",b.height()),t.call(this),"y"===f.axis||f.advanced.autoExpandHorizontalScroll||g.css("width",s(g)),e.overflowed=y.call(this),C.call(this),f.autoDraggerLength&&v.call(this),w.call(this),A.call(this);var j=[Math.abs(g[0].offsetTop),Math.abs(g[0].offsetLeft)];"x"!==f.axis&&(e.overflowed[0]?i[0].height()>i[0].parent().height()?z.call(this):(V(b,j[0].toString(),{dir:"y",dur:0,overwrite:"none"}),e.contentReset.y=null):(z.call(this),"y"===f.axis?B.call(this):"yx"===f.axis&&e.overflowed[1]&&V(b,j[1].toString(),{dir:"x",dur:0,overwrite:"none"}))),"y"!==f.axis&&(e.overflowed[1]?i[1].width()>i[1].parent().width()?z.call(this):(V(b,j[1].toString(),{dir:"x",dur:0,overwrite:"none"}),e.contentReset.x=null):(z.call(this),"x"===f.axis?B.call(this):"yx"===f.axis&&e.overflowed[0]&&V(b,j[0].toString(),{dir:"y",dur:0,overwrite:"none"}))),c&&e&&(2===c&&f.callbacks.onImageLoad&&"function"==typeof f.callbacks.onImageLoad?f.callbacks.onImageLoad.call(this):3===c&&f.callbacks.onSelectorChange&&"function"==typeof f.callbacks.onSelectorChange?f.callbacks.onSelectorChange.call(this):f.callbacks.onUpdate&&"function"==typeof f.callbacks.onUpdate&&f.callbacks.onUpdate.call(this)),S.call(this)}})},scrollTo:function(b,c){if("undefined"!=typeof b&&null!=b){var e=m.call(this);return a(e).each(function(){var e=a(this);if(e.data(d)){var f=e.data(d),g=f.opt,h={trigger:"external",scrollInertia:g.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,timeout:60,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},i=a.extend(!0,{},h,c),j=Q.call(this,b),k=i.scrollInertia>0&&i.scrollInertia<17?17:i.scrollInertia;j[0]=R.call(this,j[0],"y"),j[1]=R.call(this,j[1],"x"),i.moveDragger&&(j[0]*=f.scrollRatio.y,j[1]*=f.scrollRatio.x),i.dur=ca()?0:k,setTimeout(function(){null!==j[0]&&"undefined"!=typeof j[0]&&"x"!==g.axis&&f.overflowed[0]&&(i.dir="y",i.overwrite="all",V(e,j[0].toString(),i)),null!==j[1]&&"undefined"!=typeof j[1]&&"y"!==g.axis&&f.overflowed[1]&&(i.dir="x",i.overwrite="none",V(e,j[1].toString(),i))},i.timeout)}})}},stop:function(){var b=m.call(this);return a(b).each(function(){var b=a(this);b.data(d)&&U(b)})},disable:function(b){var c=m.call(this);return a(c).each(function(){var c=a(this);if(c.data(d)){c.data(d);S.call(this,"remove"),B.call(this),b&&z.call(this),C.call(this,!0),c.addClass(k[3])}})},destroy:function(){var b=m.call(this);return a(b).each(function(){var e=a(this);if(e.data(d)){var f=e.data(d),g=f.opt,h=a("#mCSB_"+f.idx),i=a("#mCSB_"+f.idx+"_container"),j=a(".mCSB_"+f.idx+"_scrollbar");g.live&&o(g.liveSelector||a(b).selector),S.call(this,"remove"),B.call(this),z.call(this),e.removeData(d),Z(this,"mcs"),j.remove(),i.find("img."+k[2]).removeClass(k[2]),h.replaceWith(i.contents()),e.removeClass(c+" _"+d+"_"+f.idx+" "+k[6]+" "+k[7]+" "+k[5]+" "+k[3]).addClass(k[4])}})}},m=function(){return"object"!=typeof a(this)||a(this).length<1?e:this},n=function(b){var c=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],d=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],e=["minimal","minimal-dark"],f=["minimal","minimal-dark"],g=["minimal","minimal-dark"];b.autoDraggerLength=a.inArray(b.theme,c)>-1?!1:b.autoDraggerLength,b.autoExpandScrollbar=a.inArray(b.theme,d)>-1?!1:b.autoExpandScrollbar,b.scrollButtons.enable=a.inArray(b.theme,e)>-1?!1:b.scrollButtons.enable,b.autoHideScrollbar=a.inArray(b.theme,f)>-1?!0:b.autoHideScrollbar,b.scrollbarPosition=a.inArray(b.theme,g)>-1?"outside":b.scrollbarPosition},o=function(a){h[a]&&(clearTimeout(h[a]),Z(h,a))},p=function(a){return"yx"===a||"xy"===a||"auto"===a?"yx":"x"===a||"horizontal"===a?"x":"y"},q=function(a){return"stepped"===a||"pixels"===a||"step"===a||"click"===a?"stepped":"stepless"},r=function(){var b=a(this),e=b.data(d),f=e.opt,g=f.autoExpandScrollbar?" "+k[1]+"_expand":"",h=["<div id='mCSB_"+e.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+e.idx+"_scrollbar mCS-"+f.theme+" mCSB_scrollTools_vertical"+g+"'><div class='"+k[12]+"'><div id='mCSB_"+e.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+e.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+e.idx+"_scrollbar mCS-"+f.theme+" mCSB_scrollTools_horizontal"+g+"'><div class='"+k[12]+"'><div id='mCSB_"+e.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],i="yx"===f.axis?"mCSB_vertical_horizontal":"x"===f.axis?"mCSB_horizontal":"mCSB_vertical",j="yx"===f.axis?h[0]+h[1]:"x"===f.axis?h[1]:h[0],l="yx"===f.axis?"<div id='mCSB_"+e.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",m=f.autoHideScrollbar?" "+k[6]:"",n="x"!==f.axis&&"rtl"===e.langDir?" "+k[7]:"";f.setWidth&&b.css("width",f.setWidth),f.setHeight&&b.css("height",f.setHeight),f.setLeft="y"!==f.axis&&"rtl"===e.langDir?"989999px":f.setLeft,b.addClass(c+" _"+d+"_"+e.idx+m+n).wrapInner("<div id='mCSB_"+e.idx+"' class='mCustomScrollBox mCS-"+f.theme+" "+i+"'><div id='mCSB_"+e.idx+"_container' class='mCSB_container' style='position:relative; top:"+f.setTop+"; left:"+f.setLeft+";' dir="+e.langDir+" /></div>");var o=a("#mCSB_"+e.idx),p=a("#mCSB_"+e.idx+"_container");"y"===f.axis||f.advanced.autoExpandHorizontalScroll||p.css("width",s(p)),
"outside"===f.scrollbarPosition?("static"===b.css("position")&&b.css("position","relative"),b.css("overflow","visible"),o.addClass("mCSB_outside").after(j)):(o.addClass("mCSB_inside").append(j),p.wrap(l)),u.call(this);var q=[a("#mCSB_"+e.idx+"_dragger_vertical"),a("#mCSB_"+e.idx+"_dragger_horizontal")];q[0].css("min-height",q[0].height()),q[1].css("min-width",q[1].width())},s=function(b){var c=[b[0].scrollWidth,Math.max.apply(Math,b.children().map(function(){return a(this).outerWidth(!0)}).get())],d=b.parent().width();return c[0]>d?c[0]:c[1]>d?c[1]:"100%"},t=function(){var b=a(this),c=b.data(d),e=c.opt,f=a("#mCSB_"+c.idx+"_container");if(e.advanced.autoExpandHorizontalScroll&&"y"!==e.axis){f.css({width:"auto","min-width":0,"overflow-x":"scroll"});var g=Math.ceil(f[0].scrollWidth);3===e.advanced.autoExpandHorizontalScroll||2!==e.advanced.autoExpandHorizontalScroll&&g>f.parent().width()?f.css({width:g,"min-width":"100%","overflow-x":"inherit"}):f.css({"overflow-x":"inherit",position:"absolute"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(f[0].getBoundingClientRect().right+.4)-Math.floor(f[0].getBoundingClientRect().left),"min-width":"100%",position:"relative"}).unwrap()}},u=function(){var b=a(this),c=b.data(d),e=c.opt,f=a(".mCSB_"+c.idx+"_scrollbar:first"),g=aa(e.scrollButtons.tabindex)?"tabindex='"+e.scrollButtons.tabindex+"'":"",h=["<a href='#' class='"+k[13]+"' oncontextmenu='return false;' "+g+" />","<a href='#' class='"+k[14]+"' oncontextmenu='return false;' "+g+" />","<a href='#' class='"+k[15]+"' oncontextmenu='return false;' "+g+" />","<a href='#' class='"+k[16]+"' oncontextmenu='return false;' "+g+" />"],i=["x"===e.axis?h[2]:h[0],"x"===e.axis?h[3]:h[1],h[2],h[3]];e.scrollButtons.enable&&f.prepend(i[0]).append(i[1]).next(".mCSB_scrollTools").prepend(i[2]).append(i[3])},v=function(){var b=a(this),c=b.data(d),e=a("#mCSB_"+c.idx),f=a("#mCSB_"+c.idx+"_container"),g=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")],h=[e.height()/f.outerHeight(!1),e.width()/f.outerWidth(!1)],j=[parseInt(g[0].css("min-height")),Math.round(h[0]*g[0].parent().height()),parseInt(g[1].css("min-width")),Math.round(h[1]*g[1].parent().width())],k=i&&j[1]<j[0]?j[0]:j[1],l=i&&j[3]<j[2]?j[2]:j[3];g[0].css({height:k,"max-height":g[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":j[0]+"px"}),g[1].css({width:l,"max-width":g[1].parent().width()-10})},w=function(){var b=a(this),c=b.data(d),e=a("#mCSB_"+c.idx),f=a("#mCSB_"+c.idx+"_container"),g=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")],h=[f.outerHeight(!1)-e.height(),f.outerWidth(!1)-e.width()],i=[h[0]/(g[0].parent().height()-g[0].height()),h[1]/(g[1].parent().width()-g[1].width())];c.scrollRatio={y:i[0],x:i[1]}},x=function(a,b,c){var d=c?k[0]+"_expanded":"",e=a.closest(".mCSB_scrollTools");"active"===b?(a.toggleClass(k[0]+" "+d),e.toggleClass(k[1]),a[0]._draggable=a[0]._draggable?0:1):a[0]._draggable||("hide"===b?(a.removeClass(k[0]),e.removeClass(k[1])):(a.addClass(k[0]),e.addClass(k[1])))},y=function(){var b=a(this),c=b.data(d),e=a("#mCSB_"+c.idx),f=a("#mCSB_"+c.idx+"_container"),g=null==c.overflowed?f.height():f.outerHeight(!1),h=null==c.overflowed?f.width():f.outerWidth(!1),i=f[0].scrollHeight,j=f[0].scrollWidth;return i>g&&(g=i),j>h&&(h=j),[g>e.height(),h>e.width()]},z=function(){var b=a(this),c=b.data(d),e=c.opt,f=a("#mCSB_"+c.idx),g=a("#mCSB_"+c.idx+"_container"),h=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")];if(U(b),("x"!==e.axis&&!c.overflowed[0]||"y"===e.axis&&c.overflowed[0])&&(h[0].add(g).css("top",0),V(b,"_resetY")),"y"!==e.axis&&!c.overflowed[1]||"x"===e.axis&&c.overflowed[1]){var i=dx=0;"rtl"===c.langDir&&(i=f.width()-g.outerWidth(!1),dx=Math.abs(i/c.scrollRatio.x)),g.css("left",i),h[1].css("left",dx),V(b,"_resetX")}},A=function(){function b(){g=setTimeout(function(){a.event.special.mousewheel?(clearTimeout(g),H.call(c[0])):b()},100)}var c=a(this),e=c.data(d),f=e.opt;if(!e.bindEvents){if(E.call(this),f.contentTouchScroll&&F.call(this),G.call(this),f.mouseWheel.enable){var g;b()}K.call(this),M.call(this),f.advanced.autoScrollOnFocus&&L.call(this),f.scrollButtons.enable&&N.call(this),f.keyboard.enable&&O.call(this),e.bindEvents=!0}},B=function(){var b=a(this),c=b.data(d),e=c.opt,f=d+"_"+c.idx,g=".mCSB_"+c.idx+"_scrollbar",h=a("#mCSB_"+c.idx+",#mCSB_"+c.idx+"_container,#mCSB_"+c.idx+"_container_wrapper,"+g+" ."+k[12]+",#mCSB_"+c.idx+"_dragger_vertical,#mCSB_"+c.idx+"_dragger_horizontal,"+g+">a"),i=a("#mCSB_"+c.idx+"_container");e.advanced.releaseDraggableSelectors&&h.add(a(e.advanced.releaseDraggableSelectors)),e.advanced.extraDraggableSelectors&&h.add(a(e.advanced.extraDraggableSelectors)),c.bindEvents&&(a(document).add(a(!I()||top.document)).unbind("."+f),h.each(function(){a(this).unbind("."+f)}),clearTimeout(b[0]._focusTimeout),Z(b[0],"_focusTimeout"),clearTimeout(c.sequential.step),Z(c.sequential,"step"),clearTimeout(i[0].onCompleteTimeout),Z(i[0],"onCompleteTimeout"),c.bindEvents=!1)},C=function(b){var c=a(this),e=c.data(d),f=e.opt,g=a("#mCSB_"+e.idx+"_container_wrapper"),h=g.length?g:a("#mCSB_"+e.idx+"_container"),i=[a("#mCSB_"+e.idx+"_scrollbar_vertical"),a("#mCSB_"+e.idx+"_scrollbar_horizontal")],j=[i[0].find(".mCSB_dragger"),i[1].find(".mCSB_dragger")];"x"!==f.axis&&(e.overflowed[0]&&!b?(i[0].add(j[0]).add(i[0].children("a")).css("display","block"),h.removeClass(k[8]+" "+k[10])):(f.alwaysShowScrollbar?(2!==f.alwaysShowScrollbar&&j[0].css("display","none"),h.removeClass(k[10])):(i[0].css("display","none"),h.addClass(k[10])),h.addClass(k[8]))),"y"!==f.axis&&(e.overflowed[1]&&!b?(i[1].add(j[1]).add(i[1].children("a")).css("display","block"),h.removeClass(k[9]+" "+k[11])):(f.alwaysShowScrollbar?(2!==f.alwaysShowScrollbar&&j[1].css("display","none"),h.removeClass(k[11])):(i[1].css("display","none"),h.addClass(k[11])),h.addClass(k[9]))),e.overflowed[0]||e.overflowed[1]?c.removeClass(k[5]):c.addClass(k[5])},D=function(b){var c=b.type,d=b.target.ownerDocument!==document?[a(frameElement).offset().top,a(frameElement).offset().left]:null,e=I()&&b.target.ownerDocument!==top.document?[a(b.view.frameElement).offset().top,a(b.view.frameElement).offset().left]:[0,0];switch(c){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return d?[b.originalEvent.pageY-d[0]+e[0],b.originalEvent.pageX-d[1]+e[1],!1]:[b.originalEvent.pageY,b.originalEvent.pageX,!1];case"touchstart":case"touchmove":case"touchend":var f=b.originalEvent.touches[0]||b.originalEvent.changedTouches[0],g=b.originalEvent.touches.length||b.originalEvent.changedTouches.length;return b.target.ownerDocument!==document?[f.screenY,f.screenX,g>1]:[f.pageY,f.pageX,g>1];default:return d?[b.pageY-d[0]+e[0],b.pageX-d[1]+e[1],!1]:[b.pageY,b.pageX,!1]}},E=function(){function b(a){var b=o.find("iframe");if(b.length){var c=a?"auto":"none";b.css("pointer-events",c)}}function c(a,b,c,d){if(o[0].idleTimer=l.scrollInertia<233?250:0,e.attr("id")===n[1])var f="x",g=(e[0].offsetLeft-b+d)*k.scrollRatio.x;else var f="y",g=(e[0].offsetTop-a+c)*k.scrollRatio.y;V(h,g.toString(),{dir:f,drag:!0})}var e,f,g,h=a(this),k=h.data(d),l=k.opt,m=d+"_"+k.idx,n=["mCSB_"+k.idx+"_dragger_vertical","mCSB_"+k.idx+"_dragger_horizontal"],o=a("#mCSB_"+k.idx+"_container"),p=a("#"+n[0]+",#"+n[1]),q=l.advanced.releaseDraggableSelectors?p.add(a(l.advanced.releaseDraggableSelectors)):p,r=l.advanced.extraDraggableSelectors?a(!I()||top.document).add(a(l.advanced.extraDraggableSelectors)):a(!I()||top.document);p.bind("mousedown."+m+" touchstart."+m+" pointerdown."+m+" MSPointerDown."+m,function(c){if(c.stopImmediatePropagation(),c.preventDefault(),$(c)){j=!0,i&&(document.onselectstart=function(){return!1}),b(!1),U(h),e=a(this);var d=e.offset(),k=D(c)[0]-d.top,m=D(c)[1]-d.left,n=e.height()+d.top,o=e.width()+d.left;n>k&&k>0&&o>m&&m>0&&(f=k,g=m),x(e,"active",l.autoExpandScrollbar)}}).bind("touchmove."+m,function(a){a.stopImmediatePropagation(),a.preventDefault();var b=e.offset(),d=D(a)[0]-b.top,h=D(a)[1]-b.left;c(f,g,d,h)}),a(document).add(r).bind("mousemove."+m+" pointermove."+m+" MSPointerMove."+m,function(a){if(e){var b=e.offset(),d=D(a)[0]-b.top,h=D(a)[1]-b.left;if(f===d&&g===h)return;c(f,g,d,h)}}).add(q).bind("mouseup."+m+" touchend."+m+" pointerup."+m+" MSPointerUp."+m,function(a){e&&(x(e,"active",l.autoExpandScrollbar),e=null),j=!1,i&&(document.onselectstart=null),b(!0)})},F=function(){function c(a){if(!_(a)||j||D(a)[2])return void(b=0);b=1,w=0,x=0,k=1,y.removeClass("mCS_touch_action");var c=E.offset();l=D(a)[0]-c.top,m=D(a)[1]-c.left,L=[D(a)[0],D(a)[1]]}function e(a){if(_(a)&&!j&&!D(a)[2]&&(A.documentTouchScroll||a.preventDefault(),a.stopImmediatePropagation(),(!x||w)&&k)){q=X();var b=C.offset(),c=D(a)[0]-b.top,d=D(a)[1]-b.left,e="mcsLinearOut";if(G.push(c),H.push(d),L[2]=Math.abs(D(a)[0]-L[0]),L[3]=Math.abs(D(a)[1]-L[1]),z.overflowed[0])var f=F[0].parent().height()-F[0].height(),g=l-c>0&&c-l>-(f*z.scrollRatio.y)&&(2*L[3]<L[2]||"yx"===A.axis);if(z.overflowed[1])var h=F[1].parent().width()-F[1].width(),n=m-d>0&&d-m>-(h*z.scrollRatio.x)&&(2*L[2]<L[3]||"yx"===A.axis);g||n?(O||a.preventDefault(),w=1):(x=1,y.addClass("mCS_touch_action")),O&&a.preventDefault(),u="yx"===A.axis?[l-c,m-d]:"x"===A.axis?[null,m-d]:[l-c,null],E[0].idleTimer=250,z.overflowed[0]&&i(u[0],J,e,"y","all",!0),z.overflowed[1]&&i(u[1],J,e,"x",K,!0)}}function f(a){if(!_(a)||j||D(a)[2])return void(b=0);b=1,a.stopImmediatePropagation(),U(y),p=X();var c=C.offset();n=D(a)[0]-c.top,o=D(a)[1]-c.left,G=[],H=[]}function g(a){if(_(a)&&!j&&!D(a)[2]){k=0,a.stopImmediatePropagation(),w=0,x=0,r=X();var b=C.offset(),c=D(a)[0]-b.top,d=D(a)[1]-b.left;if(!(r-q>30)){t=1e3/(r-p);var e="mcsEaseOut",f=2.5>t,g=f?[G[G.length-2],H[H.length-2]]:[0,0];s=f?[c-g[0],d-g[1]]:[c-n,d-o];var l=[Math.abs(s[0]),Math.abs(s[1])];t=f?[Math.abs(s[0]/4),Math.abs(s[1]/4)]:[t,t];var m=[Math.abs(E[0].offsetTop)-s[0]*h(l[0]/t[0],t[0]),Math.abs(E[0].offsetLeft)-s[1]*h(l[1]/t[1],t[1])];u="yx"===A.axis?[m[0],m[1]]:"x"===A.axis?[null,m[1]]:[m[0],null],v=[4*l[0]+A.scrollInertia,4*l[1]+A.scrollInertia];var y=parseInt(A.contentTouchScroll)||0;u[0]=l[0]>y?u[0]:0,u[1]=l[1]>y?u[1]:0,z.overflowed[0]&&i(u[0],v[0],e,"y",K,!1),z.overflowed[1]&&i(u[1],v[1],e,"x",K,!1)}}}function h(a,b){var c=[1.5*b,2*b,b/1.5,b/2];return a>90?b>4?c[0]:c[3]:a>60?b>3?c[3]:c[2]:a>30?b>8?c[1]:b>6?c[0]:b>4?b:c[2]:b>8?b:c[3]}function i(a,b,c,d,e,f){a&&V(y,a.toString(),{dur:b,scrollEasing:c,dir:d,overwrite:e,drag:f})}var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=a(this),z=y.data(d),A=z.opt,B=d+"_"+z.idx,C=a("#mCSB_"+z.idx),E=a("#mCSB_"+z.idx+"_container"),F=[a("#mCSB_"+z.idx+"_dragger_vertical"),a("#mCSB_"+z.idx+"_dragger_horizontal")],G=[],H=[],J=0,K="yx"===A.axis?"none":"all",L=[],M=E.find("iframe"),N=["touchstart."+B+" pointerdown."+B+" MSPointerDown."+B,"touchmove."+B+" pointermove."+B+" MSPointerMove."+B,"touchend."+B+" pointerup."+B+" MSPointerUp."+B],O=void 0!==document.body.style.touchAction;E.bind(N[0],function(a){c(a)}).bind(N[1],function(a){e(a)}),C.bind(N[0],function(a){f(a)}).bind(N[2],function(a){g(a)}),M.length&&M.each(function(){a(this).load(function(){I(this)&&a(this.contentDocument||this.contentWindow.document).bind(N[0],function(a){c(a),f(a)}).bind(N[1],function(a){e(a)}).bind(N[2],function(a){g(a)})})})},G=function(){function c(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:0}function e(a,b,c){k.type=c&&f?"stepped":"stepless",k.scrollAmount=10,P(g,a,b,"mcsLinearOut",c?60:null)}var f,g=a(this),h=g.data(d),i=h.opt,k=h.sequential,l=d+"_"+h.idx,m=a("#mCSB_"+h.idx+"_container"),n=m.parent();m.bind("mousedown."+l,function(a){b||f||(f=1,j=!0)}).add(document).bind("mousemove."+l,function(a){if(!b&&f&&c()){var d=m.offset(),g=D(a)[0]-d.top+m[0].offsetTop,j=D(a)[1]-d.left+m[0].offsetLeft;g>0&&g<n.height()&&j>0&&j<n.width()?k.step&&e("off",null,"stepped"):("x"!==i.axis&&h.overflowed[0]&&(0>g?e("on",38):g>n.height()&&e("on",40)),"y"!==i.axis&&h.overflowed[1]&&(0>j?e("on",37):j>n.width()&&e("on",39)))}}).bind("mouseup."+l+" dragend."+l,function(a){b||(f&&(f=0,e("off",null)),j=!1)})},H=function(){function b(b,d){if(U(c),!J(c,b.target)){var g="auto"!==f.mouseWheel.deltaFactor?parseInt(f.mouseWheel.deltaFactor):i&&b.deltaFactor<100?100:b.deltaFactor||100,k=f.scrollInertia;if("x"===f.axis||"x"===f.mouseWheel.axis)var l="x",m=[Math.round(g*e.scrollRatio.x),parseInt(f.mouseWheel.scrollAmount)],n="auto"!==f.mouseWheel.scrollAmount?m[1]:m[0]>=h.width()?.9*h.width():m[0],o=Math.abs(a("#mCSB_"+e.idx+"_container")[0].offsetLeft),p=j[1][0].offsetLeft,q=j[1].parent().width()-j[1].width(),r=b.deltaX||b.deltaY||d;else var l="y",m=[Math.round(g*e.scrollRatio.y),parseInt(f.mouseWheel.scrollAmount)],n="auto"!==f.mouseWheel.scrollAmount?m[1]:m[0]>=h.height()?.9*h.height():m[0],o=Math.abs(a("#mCSB_"+e.idx+"_container")[0].offsetTop),p=j[0][0].offsetTop,q=j[0].parent().height()-j[0].height(),r=b.deltaY||d;"y"===l&&!e.overflowed[0]||"x"===l&&!e.overflowed[1]||((f.mouseWheel.invert||b.webkitDirectionInvertedFromDevice)&&(r=-r),f.mouseWheel.normalizeDelta&&(r=0>r?-1:1),(r>0&&0!==p||0>r&&p!==q||f.mouseWheel.preventDefault)&&(b.stopImmediatePropagation(),b.preventDefault()),b.deltaFactor<2&&!f.mouseWheel.normalizeDelta&&(n=b.deltaFactor,k=17),V(c,(o-r*n).toString(),{dir:l,dur:k}))}}if(a(this).data(d)){var c=a(this),e=c.data(d),f=e.opt,g=d+"_"+e.idx,h=a("#mCSB_"+e.idx),j=[a("#mCSB_"+e.idx+"_dragger_vertical"),a("#mCSB_"+e.idx+"_dragger_horizontal")],k=a("#mCSB_"+e.idx+"_container").find("iframe");k.length&&k.each(function(){a(this).load(function(){I(this)&&a(this.contentDocument||this.contentWindow.document).bind("mousewheel."+g,function(a,c){b(a,c)})})}),h.bind("mousewheel."+g,function(a,c){b(a,c)})}},I=function(a){var b=null;if(a){try{var c=a.contentDocument||a.contentWindow.document;b=c.body.innerHTML}catch(d){}return null!==b}try{var c=top.document;b=c.body.innerHTML}catch(d){}return null!==b},J=function(b,c){var e=c.nodeName.toLowerCase(),f=b.data(d).opt.mouseWheel.disableOver,g=["select","textarea"];return a.inArray(e,f)>-1&&!(a.inArray(e,g)>-1&&!a(c).is(":focus"))},K=function(){var b,c=a(this),e=c.data(d),f=d+"_"+e.idx,g=a("#mCSB_"+e.idx+"_container"),h=g.parent(),i=a(".mCSB_"+e.idx+"_scrollbar ."+k[12]);i.bind("mousedown."+f+" touchstart."+f+" pointerdown."+f+" MSPointerDown."+f,function(c){j=!0,a(c.target).hasClass("mCSB_dragger")||(b=1)}).bind("touchend."+f+" pointerup."+f+" MSPointerUp."+f,function(a){j=!1}).bind("click."+f,function(d){if(b&&(b=0,a(d.target).hasClass(k[12])||a(d.target).hasClass("mCSB_draggerRail"))){U(c);var f=a(this),i=f.find(".mCSB_dragger");if(f.parent(".mCSB_scrollTools_horizontal").length>0){if(!e.overflowed[1])return;var j="x",l=d.pageX>i.offset().left?-1:1,m=Math.abs(g[0].offsetLeft)-l*(.9*h.width())}else{if(!e.overflowed[0])return;var j="y",l=d.pageY>i.offset().top?-1:1,m=Math.abs(g[0].offsetTop)-l*(.9*h.height())}V(c,m.toString(),{dir:j,scrollEasing:"mcsEaseInOut"})}})},L=function(){var b=a(this),c=b.data(d),e=c.opt,f=d+"_"+c.idx,g=a("#mCSB_"+c.idx+"_container"),h=g.parent();g.bind("focusin."+f,function(c){var d=a(document.activeElement),f=g.find(".mCustomScrollBox").length,i=0;d.is(e.advanced.autoScrollOnFocus)&&(U(b),clearTimeout(b[0]._focusTimeout),b[0]._focusTimer=f?(i+17)*f:0,b[0]._focusTimeout=setTimeout(function(){var a=[ba(d)[0],ba(d)[1]],c=[g[0].offsetTop,g[0].offsetLeft],f=[c[0]+a[0]>=0&&c[0]+a[0]<h.height()-d.outerHeight(!1),c[1]+a[1]>=0&&c[0]+a[1]<h.width()-d.outerWidth(!1)],j="yx"!==e.axis||f[0]||f[1]?"all":"none";"x"===e.axis||f[0]||V(b,a[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:j,dur:i}),"y"===e.axis||f[1]||V(b,a[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:j,dur:i})},b[0]._focusTimer))})},M=function(){var b=a(this),c=b.data(d),e=d+"_"+c.idx,f=a("#mCSB_"+c.idx+"_container").parent();f.bind("scroll."+e,function(b){(0!==f.scrollTop()||0!==f.scrollLeft())&&a(".mCSB_"+c.idx+"_scrollbar").css("visibility","hidden")})},N=function(){var b=a(this),c=b.data(d),e=c.opt,f=c.sequential,g=d+"_"+c.idx,h=".mCSB_"+c.idx+"_scrollbar",i=a(h+">a");i.bind("mousedown."+g+" touchstart."+g+" pointerdown."+g+" MSPointerDown."+g+" mouseup."+g+" touchend."+g+" pointerup."+g+" MSPointerUp."+g+" mouseout."+g+" pointerout."+g+" MSPointerOut."+g+" click."+g,function(d){function g(a,c){f.scrollAmount=e.scrollButtons.scrollAmount,P(b,a,c)}if(d.preventDefault(),$(d)){var h=a(this).attr("class");switch(f.type=e.scrollButtons.scrollType,d.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===f.type)return;j=!0,c.tweenRunning=!1,g("on",h);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===f.type)return;j=!1,f.dir&&g("off",h);break;case"click":if("stepped"!==f.type||c.tweenRunning)return;g("on",h)}}})},O=function(){function b(b){function d(a,b){g.type=f.keyboard.scrollType,g.scrollAmount=f.keyboard.scrollAmount,"stepped"===g.type&&e.tweenRunning||P(c,a,b)}switch(b.type){case"blur":e.tweenRunning&&g.dir&&d("off",null);break;case"keydown":case"keyup":var h=b.keyCode?b.keyCode:b.which,i="on";if("x"!==f.axis&&(38===h||40===h)||"y"!==f.axis&&(37===h||39===h)){if((38===h||40===h)&&!e.overflowed[0]||(37===h||39===h)&&!e.overflowed[1])return;"keyup"===b.type&&(i="off"),a(document.activeElement).is(l)||(b.preventDefault(),b.stopImmediatePropagation(),d(i,h))}else if(33===h||34===h){if((e.overflowed[0]||e.overflowed[1])&&(b.preventDefault(),b.stopImmediatePropagation()),"keyup"===b.type){U(c);var m=34===h?-1:1;if("x"===f.axis||"yx"===f.axis&&e.overflowed[1]&&!e.overflowed[0])var n="x",o=Math.abs(j[0].offsetLeft)-m*(.9*k.width());else var n="y",o=Math.abs(j[0].offsetTop)-m*(.9*k.height());V(c,o.toString(),{dir:n,scrollEasing:"mcsEaseInOut"})}}else if((35===h||36===h)&&!a(document.activeElement).is(l)&&((e.overflowed[0]||e.overflowed[1])&&(b.preventDefault(),b.stopImmediatePropagation()),"keyup"===b.type)){if("x"===f.axis||"yx"===f.axis&&e.overflowed[1]&&!e.overflowed[0])var n="x",o=35===h?Math.abs(k.width()-j.outerWidth(!1)):0;else var n="y",o=35===h?Math.abs(k.height()-j.outerHeight(!1)):0;V(c,o.toString(),{dir:n,scrollEasing:"mcsEaseInOut"})}}}var c=a(this),e=c.data(d),f=e.opt,g=e.sequential,h=d+"_"+e.idx,i=a("#mCSB_"+e.idx),j=a("#mCSB_"+e.idx+"_container"),k=j.parent(),l="input,textarea,select,datalist,keygen,[contenteditable='true']",m=j.find("iframe"),n=["blur."+h+" keydown."+h+" keyup."+h];m.length&&m.each(function(){a(this).load(function(){I(this)&&a(this.contentDocument||this.contentWindow.document).bind(n[0],function(a){b(a)})})}),i.attr("tabindex","0").bind(n[0],function(a){b(a)})},P=function(b,c,e,f,g){function h(a){l.snapAmount&&(m.scrollAmount=l.snapAmount instanceof Array?"x"===m.dir[0]?l.snapAmount[1]:l.snapAmount[0]:l.snapAmount);var c="stepped"!==m.type,d=g?g:a?c?p/1.5:q:1e3/60,e=a?c?7.5:40:2.5,i=[Math.abs(n[0].offsetTop),Math.abs(n[0].offsetLeft)],k=[j.scrollRatio.y>10?10:j.scrollRatio.y,j.scrollRatio.x>10?10:j.scrollRatio.x],o="x"===m.dir[0]?i[1]+m.dir[1]*(k[1]*e):i[0]+m.dir[1]*(k[0]*e),r="x"===m.dir[0]?i[1]+m.dir[1]*parseInt(m.scrollAmount):i[0]+m.dir[1]*parseInt(m.scrollAmount),s="auto"!==m.scrollAmount?r:o,t=f?f:a?c?"mcsLinearOut":"mcsEaseInOut":"mcsLinear",u=a?!0:!1;return a&&17>d&&(s="x"===m.dir[0]?i[1]:i[0]),V(b,s.toString(),{dir:m.dir[0],scrollEasing:t,dur:d,onComplete:u}),a?void(m.dir=!1):(clearTimeout(m.step),void(m.step=setTimeout(function(){h()},d)))}function i(){clearTimeout(m.step),Z(m,"step"),U(b)}var j=b.data(d),l=j.opt,m=j.sequential,n=a("#mCSB_"+j.idx+"_container"),o="stepped"===m.type?!0:!1,p=l.scrollInertia<26?26:l.scrollInertia,q=l.scrollInertia<1?17:l.scrollInertia;switch(c){case"on":if(m.dir=[e===k[16]||e===k[15]||39===e||37===e?"x":"y",e===k[13]||e===k[15]||38===e||37===e?-1:1],U(b),aa(e)&&"stepped"===m.type)return;h(o);break;case"off":i(),(o||j.tweenRunning&&m.dir)&&h(!0)}},Q=function(b){var c=a(this).data(d).opt,e=[];return"function"==typeof b&&(b=b()),b instanceof Array?e=b.length>1?[b[0],b[1]]:"x"===c.axis?[null,b[0]]:[b[0],null]:(e[0]=b.y?b.y:b.x||"x"===c.axis?null:b,e[1]=b.x?b.x:b.y||"y"===c.axis?null:b),"function"==typeof e[0]&&(e[0]=e[0]()),"function"==typeof e[1]&&(e[1]=e[1]()),e},R=function(b,c){if(null!=b&&"undefined"!=typeof b){var e=a(this),f=e.data(d),g=f.opt,h=a("#mCSB_"+f.idx+"_container"),i=h.parent(),j=typeof b;c||(c="x"===g.axis?"x":"y");var k="x"===c?h.outerWidth(!1):h.outerHeight(!1),m="x"===c?h[0].offsetLeft:h[0].offsetTop,n="x"===c?"left":"top";switch(j){case"function":return b();case"object":var o=b.jquery?b:a(b);if(!o.length)return;return"x"===c?ba(o)[1]:ba(o)[0];case"string":case"number":if(aa(b))return Math.abs(b);if(-1!==b.indexOf("%"))return Math.abs(k*parseInt(b)/100);if(-1!==b.indexOf("-="))return Math.abs(m-parseInt(b.split("-=")[1]));if(-1!==b.indexOf("+=")){var p=m+parseInt(b.split("+=")[1]);return p>=0?0:Math.abs(p)}if(-1!==b.indexOf("px")&&aa(b.split("px")[0]))return Math.abs(b.split("px")[0]);if("top"===b||"left"===b)return 0;if("bottom"===b)return Math.abs(i.height()-h.outerHeight(!1));if("right"===b)return Math.abs(i.width()-h.outerWidth(!1));if("first"===b||"last"===b){var o=h.find(":"+b);return"x"===c?ba(o)[1]:ba(o)[0]}return a(b).length?"x"===c?ba(a(b))[1]:ba(a(b))[0]:(h.css(n,b),void l.update.call(null,e[0]))}}},S=function(b){function c(){return clearTimeout(m[0].autoUpdate),0===h.parents("html").length?void(h=null):void(m[0].autoUpdate=setTimeout(function(){return j.advanced.updateOnSelectorChange&&(i.poll.change.n=f(),i.poll.change.n!==i.poll.change.o)?(i.poll.change.o=i.poll.change.n,void g(3)):j.advanced.updateOnContentResize&&(i.poll.size.n=h[0].scrollHeight+h[0].scrollWidth+m[0].offsetHeight+h[0].offsetHeight+h[0].offsetWidth,i.poll.size.n!==i.poll.size.o)?(i.poll.size.o=i.poll.size.n,void g(1)):!j.advanced.updateOnImageLoad||"auto"===j.advanced.updateOnImageLoad&&"y"===j.axis||(i.poll.img.n=m.find("img").length,i.poll.img.n===i.poll.img.o)?void((j.advanced.updateOnSelectorChange||j.advanced.updateOnContentResize||j.advanced.updateOnImageLoad)&&c()):(i.poll.img.o=i.poll.img.n,void m.find("img").each(function(){e(this)}))},j.advanced.autoUpdateTimeout))}function e(b){function c(a,b){return function(){return b.apply(a,arguments)}}function d(){this.onload=null,a(b).addClass(k[2]),g(2)}if(a(b).hasClass(k[2]))return void g();var e=new Image;e.onload=c(e,d),e.src=b.src}function f(){j.advanced.updateOnSelectorChange===!0&&(j.advanced.updateOnSelectorChange="*");var a=0,b=m.find(j.advanced.updateOnSelectorChange);return j.advanced.updateOnSelectorChange&&b.length>0&&b.each(function(){a+=this.offsetHeight+this.offsetWidth}),a}function g(a){clearTimeout(m[0].autoUpdate),l.update.call(null,h[0],a)}var h=a(this),i=h.data(d),j=i.opt,m=a("#mCSB_"+i.idx+"_container");return b?(clearTimeout(m[0].autoUpdate),void Z(m[0],"autoUpdate")):void c()},T=function(a,b,c){return Math.round(a/b)*b-c},U=function(b){var c=b.data(d),e=a("#mCSB_"+c.idx+"_container,#mCSB_"+c.idx+"_container_wrapper,#mCSB_"+c.idx+"_dragger_vertical,#mCSB_"+c.idx+"_dragger_horizontal");e.each(function(){Y.call(this)})},V=function(b,c,e){function f(a){return i&&j.callbacks[a]&&"function"==typeof j.callbacks[a]}function g(){return[j.callbacks.alwaysTriggerOffsets||u>=v[0]+y,j.callbacks.alwaysTriggerOffsets||-z>=u]}function h(){var a=[n[0].offsetTop,n[0].offsetLeft],c=[s[0].offsetTop,s[0].offsetLeft],d=[n.outerHeight(!1),n.outerWidth(!1)],f=[m.height(),m.width()];b[0].mcs={content:n,top:a[0],left:a[1],draggerTop:c[0],draggerLeft:c[1],topPct:Math.round(100*Math.abs(a[0])/(Math.abs(d[0])-f[0])),leftPct:Math.round(100*Math.abs(a[1])/(Math.abs(d[1])-f[1])),direction:e.dir}}var i=b.data(d),j=i.opt,k={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:j.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},e=a.extend(k,e),l=[e.dur,e.drag?0:e.dur],m=a("#mCSB_"+i.idx),n=a("#mCSB_"+i.idx+"_container"),o=n.parent(),p=j.callbacks.onTotalScrollOffset?Q.call(b,j.callbacks.onTotalScrollOffset):[0,0],q=j.callbacks.onTotalScrollBackOffset?Q.call(b,j.callbacks.onTotalScrollBackOffset):[0,0];if(i.trigger=e.trigger,(0!==o.scrollTop()||0!==o.scrollLeft())&&(a(".mCSB_"+i.idx+"_scrollbar").css("visibility","visible"),o.scrollTop(0).scrollLeft(0)),"_resetY"!==c||i.contentReset.y||(f("onOverflowYNone")&&j.callbacks.onOverflowYNone.call(b[0]),i.contentReset.y=1),"_resetX"!==c||i.contentReset.x||(f("onOverflowXNone")&&j.callbacks.onOverflowXNone.call(b[0]),i.contentReset.x=1),"_resetY"!==c&&"_resetX"!==c){if(!i.contentReset.y&&b[0].mcs||!i.overflowed[0]||(f("onOverflowY")&&j.callbacks.onOverflowY.call(b[0]),i.contentReset.x=null),!i.contentReset.x&&b[0].mcs||!i.overflowed[1]||(f("onOverflowX")&&j.callbacks.onOverflowX.call(b[0]),i.contentReset.x=null),j.snapAmount){var r=j.snapAmount instanceof Array?"x"===e.dir?j.snapAmount[1]:j.snapAmount[0]:j.snapAmount;c=T(c,r,j.snapOffset)}switch(e.dir){case"x":var s=a("#mCSB_"+i.idx+"_dragger_horizontal"),t="left",u=n[0].offsetLeft,v=[m.width()-n.outerWidth(!1),s.parent().width()-s.width()],w=[c,0===c?0:c/i.scrollRatio.x],y=p[1],z=q[1],A=y>0?y/i.scrollRatio.x:0,B=z>0?z/i.scrollRatio.x:0;break;case"y":var s=a("#mCSB_"+i.idx+"_dragger_vertical"),t="top",u=n[0].offsetTop,v=[m.height()-n.outerHeight(!1),s.parent().height()-s.height()],w=[c,0===c?0:c/i.scrollRatio.y],y=p[0],z=q[0],A=y>0?y/i.scrollRatio.y:0,B=z>0?z/i.scrollRatio.y:0}w[1]<0||0===w[0]&&0===w[1]?w=[0,0]:w[1]>=v[1]?w=[v[0],v[1]]:w[0]=-w[0],b[0].mcs||(h(),f("onInit")&&j.callbacks.onInit.call(b[0])),clearTimeout(n[0].onCompleteTimeout),W(s[0],t,Math.round(w[1]),l[1],e.scrollEasing),(i.tweenRunning||!(0===u&&w[0]>=0||u===v[0]&&w[0]<=v[0]))&&W(n[0],t,Math.round(w[0]),l[0],e.scrollEasing,e.overwrite,{onStart:function(){e.callbacks&&e.onStart&&!i.tweenRunning&&(f("onScrollStart")&&(h(),j.callbacks.onScrollStart.call(b[0])),i.tweenRunning=!0,x(s),i.cbOffsets=g())},onUpdate:function(){e.callbacks&&e.onUpdate&&f("whileScrolling")&&(h(),j.callbacks.whileScrolling.call(b[0]))},onComplete:function(){if(e.callbacks&&e.onComplete){"yx"===j.axis&&clearTimeout(n[0].onCompleteTimeout);var a=n[0].idleTimer||0;n[0].onCompleteTimeout=setTimeout(function(){f("onScroll")&&(h(),j.callbacks.onScroll.call(b[0])),f("onTotalScroll")&&w[1]>=v[1]-A&&i.cbOffsets[0]&&(h(),j.callbacks.onTotalScroll.call(b[0])),f("onTotalScrollBack")&&w[1]<=B&&i.cbOffsets[1]&&(h(),j.callbacks.onTotalScrollBack.call(b[0])),i.tweenRunning=!1,n[0].idleTimer=0,x(s,"hide")},a)}}})}},W=function(a,b,c,d,e,f,g){function h(){v.stop||(s||o.call(),s=X()-r,i(),s>=v.time&&(v.time=s>v.time?s+m-(s-v.time):s+m-1,v.time<s+1&&(v.time=s+1)),v.time<d?v.id=n(h):q.call())}function i(){d>0?(v.currVal=l(v.time,t,w,d,e),u[b]=Math.round(v.currVal)+"px"):u[b]=c+"px",p.call()}function j(){m=1e3/60,v.time=s+m,n=window.requestAnimationFrame?window.requestAnimationFrame:function(a){return i(),setTimeout(a,.01)},v.id=n(h)}function k(){null!=v.id&&(window.requestAnimationFrame?window.cancelAnimationFrame(v.id):clearTimeout(v.id),v.id=null)}function l(a,b,c,d,e){switch(e){case"linear":case"mcsLinear":return c*a/d+b;case"mcsLinearOut":return a/=d,a--,c*Math.sqrt(1-a*a)+b;case"easeInOutSmooth":return a/=d/2,1>a?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b);case"easeInOutStrong":return a/=d/2,1>a?c/2*Math.pow(2,10*(a-1))+b:(a--,c/2*(-Math.pow(2,-10*a)+2)+b);case"easeInOut":case"mcsEaseInOut":return a/=d/2,1>a?c/2*a*a*a+b:(a-=2,c/2*(a*a*a+2)+b);case"easeOutSmooth":return a/=d,a--,-c*(a*a*a*a-1)+b;case"easeOutStrong":return c*(-Math.pow(2,-10*a/d)+1)+b;case"easeOut":case"mcsEaseOut":default:var f=(a/=d)*a,g=f*a;return b+c*(.499999999999997*g*f+-2.5*f*f+5.5*g+-6.5*f+4*a)}}a._mTween||(a._mTween={top:{},left:{}});var m,n,g=g||{},o=g.onStart||function(){},p=g.onUpdate||function(){},q=g.onComplete||function(){},r=X(),s=0,t=a.offsetTop,u=a.style,v=a._mTween[b];"left"===b&&(t=a.offsetLeft);var w=c-t;v.stop=0,"none"!==f&&k(),j()},X=function(){return window.performance&&window.performance.now?window.performance.now():window.performance&&window.performance.webkitNow?window.performance.webkitNow():Date.now?Date.now():(new Date).getTime()},Y=function(){var a=this;a._mTween||(a._mTween={top:{},left:{}});for(var b=["top","left"],c=0;c<b.length;c++){var d=b[c];a._mTween[d].id&&(window.requestAnimationFrame?window.cancelAnimationFrame(a._mTween[d].id):clearTimeout(a._mTween[d].id),a._mTween[d].id=null,a._mTween[d].stop=1)}},Z=function(a,b){try{delete a[b]}catch(c){a[b]=null}},$=function(a){return!(a.which&&1!==a.which)},_=function(a){var b=a.originalEvent.pointerType;return!(b&&"touch"!==b&&2!==b)},aa=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},ba=function(a){var b=a.parents(".mCSB_container");return[a.offset().top-b.offset().top,a.offset().left-b.offset().left]},ca=function(){function a(){var a=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var b=0;b<a.length;b++)if(a[b]+"Hidden"in document)return a[b]+"Hidden";return null}var b=a();return b?document[b]:!1};a.fn[c]=function(b){return l[b]?l[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist"):l.init.apply(this,arguments)},a[c]=function(b){return l[b]?l[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist"):l.init.apply(this,arguments)},a[c].defaults=f,window[c]=!0,a(window).load(function(){a(e)[c](),a.extend(a.expr[":"],{mcsInView:a.expr[":"].mcsInView||function(b){var c,d,e=a(b),f=e.parents(".mCSB_container");if(f.length)return c=f.parent(),d=[f[0].offsetTop,f[0].offsetLeft],d[0]+ba(e)[0]>=0&&d[0]+ba(e)[0]<c.height()-e.outerHeight(!1)&&d[1]+ba(e)[1]>=0&&d[1]+ba(e)[1]<c.width()-e.outerWidth(!1)},mcsOverflow:a.expr[":"].mcsOverflow||function(b){var c=a(b).data(d);if(c)return c.overflowed[0]||c.overflowed[1]}})})})}),define("mCustomScrollbar",function(){}),function(a){"function"==typeof define&&define.amd?define("nicescroll",["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){"use strict";function b(){var a=document.getElementsByTagName("script"),b=a.length?a[a.length-1].src.split("?")[0]:"";return b.split("/").length>0?b.split("/").slice(0,-1).join("/")+"/":""}function c(a,b,c){for(var d=0;d<b.length;d++)c(a,b[d])}var d=!1,e=!1,f=0,g=2e3,h=0,i=a,j=["webkit","ms","moz","o"],k=window.requestAnimationFrame||!1,l=window.cancelAnimationFrame||!1;if(!k)for(var m in j){var n=j[m];k||(k=window[n+"RequestAnimationFrame"]),l||(l=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"])}var o=window.MutationObserver||window.WebKitMutationObserver||!1,p={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"5px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,railhoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:"auto",cursordragontouch:!1,oneaxismousemode:"auto",scriptpath:b(),preventmultitouchscrolling:!0},q=!1,r=function(){function a(){var a=["-webkit-grab","-moz-grab","grab"];(f.ischrome&&!f.ischrome22||f.isie)&&(a=[]);for(var b=0;b<a.length;b++){var d=a[b];if(c.cursor=d,c.cursor==d)return d}return"url(//mail.google.com/mail/images/2/openhand.cur),n-resize";
}if(q)return q;var b=document.createElement("DIV"),c=b.style,d=navigator.userAgent,e=navigator.platform,f={};f.haspointerlock="pointerLockElement"in document||"webkitPointerLockElement"in document||"mozPointerLockElement"in document,f.isopera="opera"in window,f.isopera12=f.isopera&&"getUserMedia"in navigator,f.isoperamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),f.isie="all"in document&&"attachEvent"in b&&!f.isopera,f.isieold=f.isie&&!("msInterpolationMode"in c),f.isie7=f.isie&&!f.isieold&&(!("documentMode"in document)||7==document.documentMode),f.isie8=f.isie&&"documentMode"in document&&8==document.documentMode,f.isie9=f.isie&&"performance"in window&&document.documentMode>=9,f.isie10=f.isie&&"performance"in window&&10==document.documentMode,f.isie11="msRequestFullscreen"in b&&document.documentMode>=11,f.isieedge=navigator.userAgent.match(/Edge\/12\./),f.isie9mobile=/iemobile.9/i.test(d),f.isie9mobile&&(f.isie9=!1),f.isie7mobile=!f.isie9mobile&&f.isie7&&/iemobile/i.test(d),f.ismozilla="MozAppearance"in c,f.iswebkit="WebkitAppearance"in c,f.ischrome="chrome"in window,f.ischrome22=f.ischrome&&f.haspointerlock,f.ischrome26=f.ischrome&&"transition"in c,f.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window,f.hasmstouch=window.MSPointerEvent||!1,f.hasw3ctouch=(window.PointerEvent||!1)&&(navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0),f.ismac=/^mac$/i.test(e),f.isios=f.cantouch&&/iphone|ipad|ipod/i.test(e),f.isios4=f.isios&&!("seal"in Object),f.isios7=f.isios&&"webkitHidden"in document,f.isandroid=/android/i.test(d),f.haseventlistener="addEventListener"in b,f.trstyle=!1,f.hastransform=!1,f.hastranslate3d=!1,f.transitionstyle=!1,f.hastransition=!1,f.transitionend=!1;var g,h=["transform","msTransform","webkitTransform","MozTransform","OTransform"];for(g=0;g<h.length;g++)if("undefined"!=typeof c[h[g]]){f.trstyle=h[g];break}f.hastransform=!!f.trstyle,f.hastransform&&(c[f.trstyle]="translate3d(1px,2px,3px)",f.hastranslate3d=/translate3d/.test(c[f.trstyle])),f.transitionstyle=!1,f.prefixstyle="",f.transitionend=!1,h=["transition","webkitTransition","msTransition","MozTransition","OTransition","OTransition","KhtmlTransition"];var i=["","-webkit-","-ms-","-moz-","-o-","-o","-khtml-"],j=["transitionend","webkitTransitionEnd","msTransitionEnd","transitionend","otransitionend","oTransitionEnd","KhtmlTransitionEnd"];for(g=0;g<h.length;g++)if(h[g]in c){f.transitionstyle=h[g],f.prefixstyle=i[g],f.transitionend=j[g];break}return f.ischrome26&&(f.prefixstyle=i[1]),f.hastransition=f.transitionstyle,f.cursorgrabvalue=a(),f.hasmousecapture="setCapture"in b,f.hasMutationObserver=o!==!1,b=null,q=f,f},s=function(a,b){function c(){var a=s.doc.css(v.trstyle);return a&&"matrix"==a.substr(0,6)?a.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/):!1}function j(){var a=s.win;if("zIndex"in a)return a.zIndex();for(;a.length>0;){if(9==a[0].nodeType)return!1;var b=a.css("zIndex");if(!isNaN(b)&&0!=b)return parseInt(b);a=a.parent()}return!1}function m(a,b,c){var d=a.css(b),e=parseFloat(d);if(isNaN(e)){e=z[d]||0;var f=3==e?c?s.win.outerHeight()-s.win.innerHeight():s.win.outerWidth()-s.win.innerWidth():1;return s.isie8&&e&&(e+=1),f?e:0}return e}function n(a,b,c,d){s._bind(a,b,function(d){var d=d?d:window.event,e={original:d,target:d.target||d.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==d.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return d.preventDefault?d.preventDefault():d.returnValue=!1,!1},stopImmediatePropagation:function(){d.stopImmediatePropagation?d.stopImmediatePropagation():d.cancelBubble=!0}};return"mousewheel"==b?(e.deltaY=-1/40*d.wheelDelta,d.wheelDeltaX&&(e.deltaX=-1/40*d.wheelDeltaX)):e.deltaY=d.detail,c.call(a,e)},d)}function q(a,b,c){var d,e;if(0==a.deltaMode?(d=-Math.floor(a.deltaX*(s.opt.mousescrollstep/54)),e=-Math.floor(a.deltaY*(s.opt.mousescrollstep/54))):1==a.deltaMode&&(d=-Math.floor(a.deltaX*s.opt.mousescrollstep),e=-Math.floor(a.deltaY*s.opt.mousescrollstep)),b&&s.opt.oneaxismousemode&&0==d&&e&&(d=e,e=0,c)){var f=0>d?s.getScrollLeft()>=s.page.maxw:s.getScrollLeft()<=0;f&&(e=d,d=0)}if(d&&(s.scrollmom&&s.scrollmom.stop(),s.lastdeltax+=d,s.debounced("mousewheelx",function(){var a=s.lastdeltax;s.lastdeltax=0,s.rail.drag||s.doScrollLeftBy(a)},15)),e){if(s.opt.nativeparentscrolling&&c&&!s.ispage&&!s.zoomactive)if(0>e){if(s.getScrollTop()>=s.page.maxh)return!0}else if(s.getScrollTop()<=0)return!0;s.scrollmom&&s.scrollmom.stop(),s.lastdeltay+=e,s.debounced("mousewheely",function(){var a=s.lastdeltay;s.lastdeltay=0,s.rail.drag||s.doScrollBy(a)},15)}return a.stopImmediatePropagation(),a.preventDefault()}var s=this;if(this.version="3.6.6",this.name="nicescroll",this.me=b,this.opt={doc:i("body"),win:!1},i.extend(this.opt,p),this.opt.snapbackspeed=80,a)for(var u in s.opt)"undefined"!=typeof a[u]&&(s.opt[u]=a[u]);this.doc=s.opt.doc,this.iddoc=this.doc&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/^BODY|HTML/.test(s.opt.win?s.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=s.opt.win!==!1,this.win=s.opt.win||(this.ispage?i(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?i(window):this.win,this.body=i("body"),this.viewport=!1,this.isfixed=!1,this.iframe=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=s.opt.autohidemode,this.onmousedown=!1,this.onmouseup=!1,this.onmousemove=!1,this.onmousewheel=!1,this.onkeypress=!1,this.ongesturezoom=!1,this.onclick=!1,this.onscrollstart=!1,this.onscrollend=!1,this.onscrollcancel=!1,this.onzoomin=!1,this.onzoomout=!1,this.view=!1,this.page=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,this.isrtlmode="auto"==this.opt.rtlmode?"rtl"==(this.win[0]==window?this.body:this.win).css("direction"):this.opt.rtlmode===!0,this.scrollrunning=!1,this.scrollmom=!1,this.observer=!1,this.observerremover=!1,this.observerbody=!1;do this.id="ascrail"+g++;while(document.getElementById(this.id));this.rail=!1,this.cursor=!1,this.cursorfreezed=!1,this.selectiondrag=!1,this.zoom=!1,this.zoomactive=!1,this.hasfocus=!1,this.hasmousefocus=!1,this.visibility=!0,this.railslocked=!1,this.locked=!1,this.hidden=!1,this.cursoractive=!0,this.wheelprevented=!1,this.overflowx=s.opt.overflowx,this.overflowy=s.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltax=0,this.lastdeltay=0,this.detected=r();var v=i.extend({},this.detected);this.canhwscroll=v.hastransform&&s.opt.hwacceleration,this.ishwscroll=this.canhwscroll&&s.haswrapper,this.hasreversehr=this.isrtlmode&&!v.iswebkit,this.istouchcapable=!1,!v.cantouch||v.isios||v.isandroid||!v.iswebkit&&!v.ismozilla||(this.istouchcapable=!0,v.cantouch=!1),s.opt.enablemouselockapi||(v.hasmousecapture=!1,v.haspointerlock=!1),this.debounced=function(a,b,c){var d=s.delaylist[a];s.delaylist[a]=b,d||(s.debouncedelayed=setTimeout(function(){if(s){var b=s.delaylist[a];s.delaylist[a]=!1,b.call(s)}},c))};var w=!1;this.synched=function(a,b){function c(){w||(k(function(){w=!1;for(var a in s.synclist){var b=s.synclist[a];b&&b.call(s),s.synclist[a]=!1}}),w=!0)}return s.synclist[a]=b,c(),a},this.unsynched=function(a){s.synclist[a]&&(s.synclist[a]=!1)},this.css=function(a,b){for(var c in b)s.saved.css.push([a,c,a.css(c)]),a.css(c,b[c])},this.scrollTop=function(a){return"undefined"==typeof a?s.getScrollTop():s.setScrollTop(a)},this.scrollLeft=function(a){return"undefined"==typeof a?s.getScrollLeft():s.setScrollLeft(a)};var x=function(a,b,c,d,e,f,g){this.st=a,this.ed=b,this.spd=c,this.p1=d||0,this.p2=e||1,this.p3=f||0,this.p4=g||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st};if(x.prototype={B2:function(a){return 3*a*a*(1-a)},B3:function(a){return 3*a*(1-a)*(1-a)},B4:function(a){return(1-a)*(1-a)*(1-a)},getNow:function(){var a=(new Date).getTime(),b=1-(a-this.ts)/this.spd,c=this.B2(b)+this.B3(b)+this.B4(b);return 0>b?this.ed:this.st+Math.round(this.df*c)},update:function(a,b){return this.st=this.getNow(),this.ed=a,this.spd=b,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}},this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},v.hastranslate3d&&v.isios&&this.doc.css("-webkit-backface-visibility","hidden"),this.getScrollTop=function(a){if(!a){var b=c();if(b)return 16==b.length?-b[13]:-b[5];if(s.timerscroll&&s.timerscroll.bz)return s.timerscroll.bz.getNow()}return s.doc.translate.y},this.getScrollLeft=function(a){if(!a){var b=c();if(b)return 16==b.length?-b[12]:-b[4];if(s.timerscroll&&s.timerscroll.bh)return s.timerscroll.bh.getNow()}return s.doc.translate.x},this.notifyScrollEvent=function(a){var b=document.createEvent("UIEvents");b.initUIEvent("scroll",!1,!0,window,1),b.niceevent=!0,a.dispatchEvent(b)};var y=this.isrtlmode?1:-1;v.hastranslate3d&&s.opt.enabletranslate3d?(this.setScrollTop=function(a,b){s.doc.translate.y=a,s.doc.translate.ty=-1*a+"px",s.doc.css(v.trstyle,"translate3d("+s.doc.translate.tx+","+s.doc.translate.ty+",0px)"),b||s.notifyScrollEvent(s.win[0])},this.setScrollLeft=function(a,b){s.doc.translate.x=a,s.doc.translate.tx=a*y+"px",s.doc.css(v.trstyle,"translate3d("+s.doc.translate.tx+","+s.doc.translate.ty+",0px)"),b||s.notifyScrollEvent(s.win[0])}):(this.setScrollTop=function(a,b){s.doc.translate.y=a,s.doc.translate.ty=-1*a+"px",s.doc.css(v.trstyle,"translate("+s.doc.translate.tx+","+s.doc.translate.ty+")"),b||s.notifyScrollEvent(s.win[0])},this.setScrollLeft=function(a,b){s.doc.translate.x=a,s.doc.translate.tx=a*y+"px",s.doc.css(v.trstyle,"translate("+s.doc.translate.tx+","+s.doc.translate.ty+")"),b||s.notifyScrollEvent(s.win[0])})}else this.getScrollTop=function(){return s.docscroll.scrollTop()},this.setScrollTop=function(a){return setTimeout(function(){s.docscroll.scrollTop(a)},1)},this.getScrollLeft=function(){return s.detected.ismozilla&&s.isrtlmode?Math.abs(s.docscroll.scrollLeft()):s.docscroll.scrollLeft()},this.setScrollLeft=function(a){return setTimeout(function(){s.docscroll.scrollLeft(s.detected.ismozilla&&s.isrtlmode?-a:a)},1)};this.getTarget=function(a){return a?a.target?a.target:a.srcElement?a.srcElement:!1:!1},this.hasParent=function(a,b){if(!a)return!1;for(var c=a.target||a.srcElement||a||!1;c&&c.id!=b;)c=c.parentNode||!1;return c!==!1};var z={thin:1,medium:3,thick:5};this.getDocumentScrollOffset=function(){return{top:window.pageYOffset||document.documentElement.scrollTop,left:window.pageXOffset||document.documentElement.scrollLeft}},this.getOffset=function(){if(s.isfixed){var a=s.win.offset(),b=s.getDocumentScrollOffset();return a.top-=b.top,a.left-=b.left,a}var c=s.win.offset();if(!s.viewport)return c;var d=s.viewport.offset();return{top:c.top-d.top,left:c.left-d.left}},this.updateScrollBar=function(a){if(s.ishwscroll)s.rail.css({height:s.win.innerHeight()-(s.opt.railpadding.top+s.opt.railpadding.bottom)}),s.railh&&s.railh.css({width:s.win.innerWidth()-(s.opt.railpadding.left+s.opt.railpadding.right)});else{var b=s.getOffset(),c={top:b.top,left:b.left-(s.opt.railpadding.left+s.opt.railpadding.right)};c.top+=m(s.win,"border-top-width",!0),c.left+=s.rail.align?s.win.outerWidth()-m(s.win,"border-right-width")-s.rail.width:m(s.win,"border-left-width");var d=s.opt.railoffset;if(d&&(d.top&&(c.top+=d.top),d.left&&(c.left+=d.left)),s.railslocked||s.rail.css({top:c.top,left:c.left,height:(a?a.h:s.win.innerHeight())-(s.opt.railpadding.top+s.opt.railpadding.bottom)}),s.zoom&&s.zoom.css({top:c.top+1,left:1==s.rail.align?c.left-20:c.left+s.rail.width+4}),s.railh&&!s.railslocked){var c={top:b.top,left:b.left},d=s.opt.railhoffset;d&&(d.top&&(c.top+=d.top),d.left&&(c.left+=d.left));var e=s.railh.align?c.top+m(s.win,"border-top-width",!0)+s.win.innerHeight()-s.railh.height:c.top+m(s.win,"border-top-width",!0),f=c.left+m(s.win,"border-left-width");s.railh.css({top:e-(s.opt.railpadding.top+s.opt.railpadding.bottom),left:f,width:s.railh.width})}}},this.doRailClick=function(a,b,c){var d,e,f,g;s.railslocked||(s.cancelEvent(a),b?(d=c?s.doScrollLeft:s.doScrollTop,f=c?(a.pageX-s.railh.offset().left-s.cursorwidth/2)*s.scrollratio.x:(a.pageY-s.rail.offset().top-s.cursorheight/2)*s.scrollratio.y,d(f)):(d=c?s.doScrollLeftBy:s.doScrollBy,f=c?s.scroll.x:s.scroll.y,g=c?a.pageX-s.railh.offset().left:a.pageY-s.rail.offset().top,e=c?s.view.w:s.view.h,d(f>=g?e:-e)))},s.hasanimationframe=k,s.hascancelanimationframe=l,s.hasanimationframe?s.hascancelanimationframe||(l=function(){s.cancelAnimationFrame=!0}):(k=function(a){return setTimeout(a,15-Math.floor(+new Date/1e3)%16)},l=clearInterval),this.init=function(){if(s.saved.css=[],v.isie7mobile)return!0;if(v.isoperamini)return!0;if(v.hasmstouch&&s.css(s.ispage?i("html"):s.win,{"-ms-touch-action":"none"}),s.zindex="auto",s.ispage||"auto"!=s.opt.zindex?s.zindex=s.opt.zindex:s.zindex=j()||"auto",s.ispage||"auto"==s.zindex||s.zindex>h&&(h=s.zindex),s.isie&&0==s.zindex&&"auto"==s.opt.zindex&&(s.zindex="auto"),!s.ispage||!v.cantouch&&!v.isieold&&!v.isie9mobile){var a=s.docscroll;s.ispage&&(a=s.haswrapper?s.win:s.doc),v.isie9mobile||s.css(a,{"overflow-y":"hidden"}),s.ispage&&v.isie7&&("BODY"==s.doc[0].nodeName?s.css(i("html"),{"overflow-y":"hidden"}):"HTML"==s.doc[0].nodeName&&s.css(i("body"),{"overflow-y":"hidden"})),!v.isios||s.ispage||s.haswrapper||s.css(i("body"),{"-webkit-overflow-scrolling":"touch"});var b=i(document.createElement("div"));b.css({position:"relative",top:0,"float":"right",width:s.opt.cursorwidth,height:"0px","background-color":s.opt.cursorcolor,border:s.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":s.opt.cursorborderradius,"-moz-border-radius":s.opt.cursorborderradius,"border-radius":s.opt.cursorborderradius}),b.hborder=parseFloat(b.outerHeight()-b.innerHeight()),b.addClass("nicescroll-cursors"),s.cursor=b;var c=i(document.createElement("div"));c.attr("id",s.id),c.addClass("nicescroll-rails nicescroll-rails-vr");var g,k,l=["left","right","top","bottom"];for(var m in l)k=l[m],g=s.opt.railpadding[k],g?c.css("padding-"+k,g+"px"):s.opt.railpadding[k]=0;c.append(b),c.width=Math.max(parseFloat(s.opt.cursorwidth),b.outerWidth()),c.css({width:c.width+"px",zIndex:s.zindex,background:s.opt.background,cursor:"default"}),c.visibility=!0,c.scrollable=!0,c.align="left"==s.opt.railalign?0:1,s.rail=c,s.rail.drag=!1;var n=!1;!s.opt.boxzoom||s.ispage||v.isieold||(n=document.createElement("div"),s.bind(n,"click",s.doZoom),s.bind(n,"mouseenter",function(){s.zoom.css("opacity",s.opt.cursoropacitymax)}),s.bind(n,"mouseleave",function(){s.zoom.css("opacity",s.opt.cursoropacitymin)}),s.zoom=i(n),s.zoom.css({cursor:"pointer","z-index":s.zindex,backgroundImage:"url("+s.opt.scriptpath+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),s.opt.dblclickzoom&&s.bind(s.win,"dblclick",s.doZoom),v.cantouch&&s.opt.gesturezoom&&(s.ongesturezoom=function(a){return a.scale>1.5&&s.doZoomIn(a),a.scale<.8&&s.doZoomOut(a),s.cancelEvent(a)},s.bind(s.win,"gestureend",s.ongesturezoom))),s.railh=!1;var p;if(s.opt.horizrailenabled){s.css(a,{"overflow-x":"hidden"});var b=i(document.createElement("div"));b.css({position:"absolute",top:0,height:s.opt.cursorwidth,width:"0px","background-color":s.opt.cursorcolor,border:s.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":s.opt.cursorborderradius,"-moz-border-radius":s.opt.cursorborderradius,"border-radius":s.opt.cursorborderradius}),v.isieold&&b.css({overflow:"hidden"}),b.wborder=parseFloat(b.outerWidth()-b.innerWidth()),b.addClass("nicescroll-cursors"),s.cursorh=b,p=i(document.createElement("div")),p.attr("id",s.id+"-hr"),p.addClass("nicescroll-rails nicescroll-rails-hr"),p.height=Math.max(parseFloat(s.opt.cursorwidth),b.outerHeight()),p.css({height:p.height+"px",zIndex:s.zindex,background:s.opt.background}),p.append(b),p.visibility=!0,p.scrollable=!0,p.align="top"==s.opt.railvalign?0:1,s.railh=p,s.railh.drag=!1}if(s.ispage)c.css({position:"fixed",top:"0px",height:"100%"}),c.align?c.css({right:"0px"}):c.css({left:"0px"}),s.body.append(c),s.railh&&(p.css({position:"fixed",left:"0px",width:"100%"}),p.align?p.css({bottom:"0px"}):p.css({top:"0px"}),s.body.append(p));else{if(s.ishwscroll){"static"==s.win.css("position")&&s.css(s.win,{position:"relative"});var q="HTML"==s.win[0].nodeName?s.body:s.win;i(q).scrollTop(0).scrollLeft(0),s.zoom&&(s.zoom.css({position:"absolute",top:1,right:0,"margin-right":c.width+4}),q.append(s.zoom)),c.css({position:"absolute",top:0}),c.align?c.css({right:0}):c.css({left:0}),q.append(c),p&&(p.css({position:"absolute",left:0,bottom:0}),p.align?p.css({bottom:0}):p.css({top:0}),q.append(p))}else{s.isfixed="fixed"==s.win.css("position");var r=s.isfixed?"fixed":"absolute";s.isfixed||(s.viewport=s.getViewport(s.win[0])),s.viewport&&(s.body=s.viewport,0==/fixed|absolute/.test(s.viewport.css("position"))&&s.css(s.viewport,{position:"relative"})),c.css({position:r}),s.zoom&&s.zoom.css({position:r}),s.updateScrollBar(),s.body.append(c),s.zoom&&s.body.append(s.zoom),s.railh&&(p.css({position:r}),s.body.append(p))}v.isios&&s.css(s.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),v.isie&&s.opt.disableoutline&&s.win.attr("hideFocus","true"),v.iswebkit&&s.opt.disableoutline&&s.win.css({outline:"none"})}if(s.opt.autohidemode===!1?(s.autohidedom=!1,s.rail.css({opacity:s.opt.cursoropacitymax}),s.railh&&s.railh.css({opacity:s.opt.cursoropacitymax})):s.opt.autohidemode===!0||"leave"===s.opt.autohidemode?(s.autohidedom=i().add(s.rail),v.isie8&&(s.autohidedom=s.autohidedom.add(s.cursor)),s.railh&&(s.autohidedom=s.autohidedom.add(s.railh)),s.railh&&v.isie8&&(s.autohidedom=s.autohidedom.add(s.cursorh))):"scroll"==s.opt.autohidemode?(s.autohidedom=i().add(s.rail),s.railh&&(s.autohidedom=s.autohidedom.add(s.railh))):"cursor"==s.opt.autohidemode?(s.autohidedom=i().add(s.cursor),s.railh&&(s.autohidedom=s.autohidedom.add(s.cursorh))):"hidden"==s.opt.autohidemode&&(s.autohidedom=!1,s.hide(),s.railslocked=!1),v.isie9mobile){s.scrollmom=new t(s),s.onmangotouch=function(){var a=s.getScrollTop(),b=s.getScrollLeft();if(a==s.scrollmom.lastscrolly&&b==s.scrollmom.lastscrollx)return!0;var c=a-s.mangotouch.sy,d=b-s.mangotouch.sx,e=Math.round(Math.sqrt(Math.pow(d,2)+Math.pow(c,2)));if(0!=e){var f=0>c?-1:1,g=0>d?-1:1,h=+new Date;if(s.mangotouch.lazy&&clearTimeout(s.mangotouch.lazy),h-s.mangotouch.tm>80||s.mangotouch.dry!=f||s.mangotouch.drx!=g)s.scrollmom.stop(),s.scrollmom.reset(b,a),s.mangotouch.sy=a,s.mangotouch.ly=a,s.mangotouch.sx=b,s.mangotouch.lx=b,s.mangotouch.dry=f,s.mangotouch.drx=g,s.mangotouch.tm=h;else{s.scrollmom.stop(),s.scrollmom.update(s.mangotouch.sx-d,s.mangotouch.sy-c),s.mangotouch.tm=h;var i=Math.max(Math.abs(s.mangotouch.ly-a),Math.abs(s.mangotouch.lx-b));s.mangotouch.ly=a,s.mangotouch.lx=b,i>2&&(s.mangotouch.lazy=setTimeout(function(){s.mangotouch.lazy=!1,s.mangotouch.dry=0,s.mangotouch.drx=0,s.mangotouch.tm=0,s.scrollmom.doMomentum(30)},100))}}};var u=s.getScrollTop(),w=s.getScrollLeft();s.mangotouch={sy:u,ly:u,dry:0,sx:w,lx:w,drx:0,lazy:!1,tm:0},s.bind(s.docscroll,"scroll",s.onmangotouch)}else{if(v.cantouch||s.istouchcapable||s.opt.touchbehavior||v.hasmstouch){s.scrollmom=new t(s),s.ontouchstart=function(a){if(a.pointerType&&2!=a.pointerType&&"touch"!=a.pointerType)return!1;if(s.hasmoving=!1,!s.railslocked){var b;if(v.hasmstouch)for(b=a.target?a.target:!1;b;){var c=i(b).getNiceScroll();if(c.length>0&&c[0].me==s.me)break;if(c.length>0)return!1;if("DIV"==b.nodeName&&b.id==s.id)break;b=b.parentNode?b.parentNode:!1}if(s.cancelScroll(),b=s.getTarget(a)){var d=/INPUT/i.test(b.nodeName)&&/range/i.test(b.type);if(d)return s.stopPropagation(a)}if(!("clientX"in a)&&"changedTouches"in a&&(a.clientX=a.changedTouches[0].clientX,a.clientY=a.changedTouches[0].clientY),s.forcescreen){var e=a;a={original:a.original?a.original:a},a.clientX=e.screenX,a.clientY=e.screenY}if(s.rail.drag={x:a.clientX,y:a.clientY,sx:s.scroll.x,sy:s.scroll.y,st:s.getScrollTop(),sl:s.getScrollLeft(),pt:2,dl:!1},s.ispage||!s.opt.directionlockdeadzone)s.rail.drag.dl="f";else{var f={w:i(window).width(),h:i(window).height()},g={w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},h=Math.max(0,g.h-f.h),j=Math.max(0,g.w-f.w);!s.rail.scrollable&&s.railh.scrollable?s.rail.drag.ck=h>0?"v":!1:s.rail.scrollable&&!s.railh.scrollable?s.rail.drag.ck=j>0?"h":!1:s.rail.drag.ck=!1,s.rail.drag.ck||(s.rail.drag.dl="f")}if(s.opt.touchbehavior&&s.isiframe&&v.isie){var k=s.win.position();s.rail.drag.x+=k.left,s.rail.drag.y+=k.top}if(s.hasmoving=!1,s.lastmouseup=!1,s.scrollmom.reset(a.clientX,a.clientY),!v.cantouch&&!this.istouchcapable&&!a.pointerType){var l=b?/INPUT|SELECT|TEXTAREA/i.test(b.nodeName):!1;if(!l)return!s.ispage&&v.hasmousecapture&&b.setCapture(),s.opt.touchbehavior?(b.onclick&&!b._onclick&&(b._onclick=b.onclick,b.onclick=function(a){return s.hasmoving?!1:void b._onclick.call(this,a)}),s.cancelEvent(a)):s.stopPropagation(a);/SUBMIT|CANCEL|BUTTON/i.test(i(b).attr("type"))&&(pc={tg:b,click:!1},s.preventclick=pc)}}},s.ontouchend=function(a){if(!s.rail.drag)return!0;if(2==s.rail.drag.pt){if(a.pointerType&&2!=a.pointerType&&"touch"!=a.pointerType)return!1;if(s.scrollmom.doMomentum(),s.rail.drag=!1,s.hasmoving&&(s.lastmouseup=!0,s.hideCursor(),v.hasmousecapture&&document.releaseCapture(),!v.cantouch))return s.cancelEvent(a)}else if(1==s.rail.drag.pt)return s.onmouseup(a)};var x=s.opt.touchbehavior&&s.isiframe&&!v.hasmousecapture;s.ontouchmove=function(a,b){if(!s.rail.drag)return!1;if(a.targetTouches&&s.opt.preventmultitouchscrolling&&a.targetTouches.length>1)return!1;if(a.pointerType&&2!=a.pointerType&&"touch"!=a.pointerType)return!1;if(2==s.rail.drag.pt){if(v.cantouch&&v.isios&&"undefined"==typeof a.original)return!0;s.hasmoving=!0,s.preventclick&&!s.preventclick.click&&(s.preventclick.click=s.preventclick.tg.onclick||!1,s.preventclick.tg.onclick=s.onpreventclick);var c=i.extend({original:a},a);if(a=c,"changedTouches"in a&&(a.clientX=a.changedTouches[0].clientX,a.clientY=a.changedTouches[0].clientY),s.forcescreen){var d=a;a={original:a.original?a.original:a},a.clientX=d.screenX,a.clientY=d.screenY}var e,f;if(f=e=0,x&&!b){var g=s.win.position();f=-g.left,e=-g.top}var h=a.clientY+e,j=h-s.rail.drag.y,k=a.clientX+f,l=k-s.rail.drag.x,m=s.rail.drag.st-j;s.ishwscroll&&s.opt.bouncescroll?0>m?m=Math.round(m/2):m>s.page.maxh&&(m=s.page.maxh+Math.round((m-s.page.maxh)/2)):(0>m&&(m=0,h=0),m>s.page.maxh&&(m=s.page.maxh,h=0));var n;s.railh&&s.railh.scrollable&&(n=s.isrtlmode?l-s.rail.drag.sl:s.rail.drag.sl-l,s.ishwscroll&&s.opt.bouncescroll?0>n?n=Math.round(n/2):n>s.page.maxw&&(n=s.page.maxw+Math.round((n-s.page.maxw)/2)):(0>n&&(n=0,k=0),n>s.page.maxw&&(n=s.page.maxw,k=0)));var o=!1;if(s.rail.drag.dl)o=!0,"v"==s.rail.drag.dl?n=s.rail.drag.sl:"h"==s.rail.drag.dl&&(m=s.rail.drag.st);else{var p=Math.abs(j),q=Math.abs(l),r=s.opt.directionlockdeadzone;if("v"==s.rail.drag.ck){if(p>r&&.3*p>=q)return s.rail.drag=!1,!0;q>r&&(s.rail.drag.dl="f",i("body").scrollTop(i("body").scrollTop()))}else if("h"==s.rail.drag.ck){if(q>r&&.3*q>=p)return s.rail.drag=!1,!0;p>r&&(s.rail.drag.dl="f",i("body").scrollLeft(i("body").scrollLeft()))}}if(s.synched("touchmove",function(){s.rail.drag&&2==s.rail.drag.pt&&(s.prepareTransition&&s.prepareTransition(0),s.rail.scrollable&&s.setScrollTop(m),s.scrollmom.update(k,h),s.railh&&s.railh.scrollable?(s.setScrollLeft(n),s.showCursor(m,n)):s.showCursor(m),v.isie10&&document.selection.clear())}),v.ischrome&&s.istouchcapable&&(o=!1),o)return s.cancelEvent(a)}else if(1==s.rail.drag.pt)return s.onmousemove(a)}}if(s.onmousedown=function(a,b){if(!s.rail.drag||1==s.rail.drag.pt){if(s.railslocked)return s.cancelEvent(a);s.cancelScroll(),s.rail.drag={x:a.clientX,y:a.clientY,sx:s.scroll.x,sy:s.scroll.y,pt:1,hr:!!b};var c=s.getTarget(a);return!s.ispage&&v.hasmousecapture&&c.setCapture(),s.isiframe&&!v.hasmousecapture&&(s.saved.csspointerevents=s.doc.css("pointer-events"),s.css(s.doc,{"pointer-events":"none"})),s.hasmoving=!1,s.cancelEvent(a)}},s.onmouseup=function(a){return s.rail.drag?1!=s.rail.drag.pt?!0:(v.hasmousecapture&&document.releaseCapture(),s.isiframe&&!v.hasmousecapture&&s.doc.css("pointer-events",s.saved.csspointerevents),s.rail.drag=!1,s.hasmoving&&s.triggerScrollEnd(),s.cancelEvent(a)):void 0},s.onmousemove=function(a){if(s.rail.drag){if(1!=s.rail.drag.pt)return;if(v.ischrome&&0==a.which)return s.onmouseup(a);if(s.cursorfreezed=!0,s.hasmoving=!0,s.rail.drag.hr){s.scroll.x=s.rail.drag.sx+(a.clientX-s.rail.drag.x),s.scroll.x<0&&(s.scroll.x=0);var b=s.scrollvaluemaxw;s.scroll.x>b&&(s.scroll.x=b)}else{s.scroll.y=s.rail.drag.sy+(a.clientY-s.rail.drag.y),s.scroll.y<0&&(s.scroll.y=0);var c=s.scrollvaluemax;s.scroll.y>c&&(s.scroll.y=c)}return s.synched("mousemove",function(){s.rail.drag&&1==s.rail.drag.pt&&(s.showCursor(),s.rail.drag.hr?s.hasreversehr?s.doScrollLeft(s.scrollvaluemaxw-Math.round(s.scroll.x*s.scrollratio.x),s.opt.cursordragspeed):s.doScrollLeft(Math.round(s.scroll.x*s.scrollratio.x),s.opt.cursordragspeed):s.doScrollTop(Math.round(s.scroll.y*s.scrollratio.y),s.opt.cursordragspeed))}),s.cancelEvent(a)}s.checkarea=0},v.cantouch||s.opt.touchbehavior)s.onpreventclick=function(a){return s.preventclick?(s.preventclick.tg.onclick=s.preventclick.click,s.preventclick=!1,s.cancelEvent(a)):void 0},s.bind(s.win,"mousedown",s.ontouchstart),s.onclick=v.isios?!1:function(a){return s.lastmouseup?(s.lastmouseup=!1,s.cancelEvent(a)):!0},s.opt.grabcursorenabled&&v.cursorgrabvalue&&(s.css(s.ispage?s.doc:s.win,{cursor:v.cursorgrabvalue}),s.css(s.rail,{cursor:v.cursorgrabvalue}));else{var y=function(a){if(s.selectiondrag){if(a){var b=s.win.outerHeight(),c=a.pageY-s.selectiondrag.top;c>0&&b>c&&(c=0),c>=b&&(c-=b),s.selectiondrag.df=c}if(0!=s.selectiondrag.df){var d=2*-Math.floor(s.selectiondrag.df/6);s.doScrollBy(d),s.debounced("doselectionscroll",function(){y()},50)}}};"getSelection"in document?s.hasTextSelected=function(){return document.getSelection().rangeCount>0}:"selection"in document?s.hasTextSelected=function(){return"None"!=document.selection.type}:s.hasTextSelected=function(){return!1},s.onselectionstart=function(a){s.ispage||(s.selectiondrag=s.win.offset())},s.onselectionend=function(a){s.selectiondrag=!1},s.onselectiondrag=function(a){s.selectiondrag&&s.hasTextSelected()&&s.debounced("selectionscroll",function(){y(a)},250)}}v.hasw3ctouch?(s.css(s.rail,{"touch-action":"none"}),s.css(s.cursor,{"touch-action":"none"}),s.bind(s.win,"pointerdown",s.ontouchstart),s.bind(document,"pointerup",s.ontouchend),s.bind(document,"pointermove",s.ontouchmove)):v.hasmstouch?(s.css(s.rail,{"-ms-touch-action":"none"}),s.css(s.cursor,{"-ms-touch-action":"none"}),s.bind(s.win,"MSPointerDown",s.ontouchstart),s.bind(document,"MSPointerUp",s.ontouchend),s.bind(document,"MSPointerMove",s.ontouchmove),s.bind(s.cursor,"MSGestureHold",function(a){a.preventDefault()}),s.bind(s.cursor,"contextmenu",function(a){a.preventDefault()})):this.istouchcapable&&(s.bind(s.win,"touchstart",s.ontouchstart),s.bind(document,"touchend",s.ontouchend),s.bind(document,"touchcancel",s.ontouchend),s.bind(document,"touchmove",s.ontouchmove)),(s.opt.cursordragontouch||!v.cantouch&&!s.opt.touchbehavior)&&(s.rail.css({cursor:"default"}),s.railh&&s.railh.css({cursor:"default"}),s.jqbind(s.rail,"mouseenter",function(){return s.ispage||s.win.is(":visible")?(s.canshowonmouseevent&&s.showCursor(),void(s.rail.active=!0)):!1}),s.jqbind(s.rail,"mouseleave",function(){s.rail.active=!1,s.rail.drag||s.hideCursor()}),s.opt.sensitiverail&&(s.bind(s.rail,"click",function(a){s.doRailClick(a,!1,!1)}),s.bind(s.rail,"dblclick",function(a){s.doRailClick(a,!0,!1)}),s.bind(s.cursor,"click",function(a){s.cancelEvent(a)}),s.bind(s.cursor,"dblclick",function(a){s.cancelEvent(a)})),s.railh&&(s.jqbind(s.railh,"mouseenter",function(){return s.ispage||s.win.is(":visible")?(s.canshowonmouseevent&&s.showCursor(),void(s.rail.active=!0)):!1}),s.jqbind(s.railh,"mouseleave",function(){s.rail.active=!1,s.rail.drag||s.hideCursor()}),s.opt.sensitiverail&&(s.bind(s.railh,"click",function(a){s.doRailClick(a,!1,!0)}),s.bind(s.railh,"dblclick",function(a){s.doRailClick(a,!0,!0)}),s.bind(s.cursorh,"click",function(a){s.cancelEvent(a)}),s.bind(s.cursorh,"dblclick",function(a){s.cancelEvent(a)})))),v.cantouch||s.opt.touchbehavior?(s.bind(v.hasmousecapture?s.win:document,"mouseup",s.ontouchend),s.bind(document,"mousemove",s.ontouchmove),s.onclick&&s.bind(document,"click",s.onclick),s.opt.cursordragontouch&&(s.bind(s.cursor,"mousedown",s.onmousedown),s.bind(s.cursor,"mouseup",s.onmouseup),s.cursorh&&s.bind(s.cursorh,"mousedown",function(a){s.onmousedown(a,!0)}),s.cursorh&&s.bind(s.cursorh,"mouseup",s.onmouseup))):(s.bind(v.hasmousecapture?s.win:document,"mouseup",s.onmouseup),s.bind(document,"mousemove",s.onmousemove),s.onclick&&s.bind(document,"click",s.onclick),s.bind(s.cursor,"mousedown",s.onmousedown),s.bind(s.cursor,"mouseup",s.onmouseup),s.railh&&(s.bind(s.cursorh,"mousedown",function(a){s.onmousedown(a,!0)}),s.bind(s.cursorh,"mouseup",s.onmouseup)),!s.ispage&&s.opt.enablescrollonselection&&(s.bind(s.win[0],"mousedown",s.onselectionstart),s.bind(document,"mouseup",s.onselectionend),s.bind(s.cursor,"mouseup",s.onselectionend),s.cursorh&&s.bind(s.cursorh,"mouseup",s.onselectionend),s.bind(document,"mousemove",s.onselectiondrag)),s.zoom&&(s.jqbind(s.zoom,"mouseenter",function(){s.canshowonmouseevent&&s.showCursor(),s.rail.active=!0}),s.jqbind(s.zoom,"mouseleave",function(){s.rail.active=!1,s.rail.drag||s.hideCursor()}))),s.opt.enablemousewheel&&(s.isiframe||s.bind(v.isie&&s.ispage?document:s.win,"mousewheel",s.onmousewheel),s.bind(s.rail,"mousewheel",s.onmousewheel),s.railh&&s.bind(s.railh,"mousewheel",s.onmousewheelhr)),s.ispage||v.cantouch||/HTML|^BODY/.test(s.win[0].nodeName)||(s.win.attr("tabindex")||s.win.attr({tabindex:f++}),s.jqbind(s.win,"focus",function(a){d=s.getTarget(a).id||!0,s.hasfocus=!0,s.canshowonmouseevent&&s.noticeCursor()}),s.jqbind(s.win,"blur",function(a){d=!1,s.hasfocus=!1}),s.jqbind(s.win,"mouseenter",function(a){e=s.getTarget(a).id||!0,s.hasmousefocus=!0,s.canshowonmouseevent&&s.noticeCursor()}),s.jqbind(s.win,"mouseleave",function(){e=!1,s.hasmousefocus=!1,s.rail.drag||s.hideCursor()}))}if(s.onkeypress=function(a){if(s.railslocked&&0==s.page.maxh)return!0;a=a?a:window.e;var b=s.getTarget(a);if(b&&/INPUT|TEXTAREA|SELECT|OPTION/.test(b.nodeName)){var c=b.getAttribute("type")||b.type||!1;if(!c||!/submit|button|cancel/i.tp)return!0}if(i(b).attr("contenteditable"))return!0;if(s.hasfocus||s.hasmousefocus&&!d||s.ispage&&!d&&!e){var f=a.keyCode;if(s.railslocked&&27!=f)return s.cancelEvent(a);var g=a.ctrlKey||!1,h=a.shiftKey||!1,j=!1;switch(f){case 38:case 63233:s.doScrollBy(72),j=!0;break;case 40:case 63235:s.doScrollBy(-72),j=!0;break;case 37:case 63232:s.railh&&(g?s.doScrollLeft(0):s.doScrollLeftBy(72),j=!0);break;case 39:case 63234:s.railh&&(g?s.doScrollLeft(s.page.maxw):s.doScrollLeftBy(-72),j=!0);break;case 33:case 63276:s.doScrollBy(s.view.h),j=!0;break;case 34:case 63277:s.doScrollBy(-s.view.h),j=!0;break;case 36:case 63273:s.railh&&g?s.doScrollPos(0,0):s.doScrollTo(0),j=!0;break;case 35:case 63275:s.railh&&g?s.doScrollPos(s.page.maxw,s.page.maxh):s.doScrollTo(s.page.maxh),j=!0;break;case 32:s.opt.spacebarenabled&&(h?s.doScrollBy(s.view.h):s.doScrollBy(-s.view.h),j=!0);break;case 27:s.zoomactive&&(s.doZoom(),j=!0)}if(j)return s.cancelEvent(a)}},s.opt.enablekeyboard&&s.bind(document,v.isopera&&!v.isopera12?"keypress":"keydown",s.onkeypress),s.bind(document,"keydown",function(a){var b=a.ctrlKey||!1;b&&(s.wheelprevented=!0)}),s.bind(document,"keyup",function(a){var b=a.ctrlKey||!1;b||(s.wheelprevented=!1)}),s.bind(window,"blur",function(a){s.wheelprevented=!1}),s.bind(window,"resize",s.lazyResize),s.bind(window,"orientationchange",s.lazyResize),s.bind(window,"load",s.lazyResize),v.ischrome&&!s.ispage&&!s.haswrapper){var z=s.win.attr("style"),A=parseFloat(s.win.css("width"))+1;
s.win.css("width",A),s.synched("chromefix",function(){s.win.attr("style",z)})}s.onAttributeChange=function(a){s.lazyResize(s.isieold?250:30)},o!==!1&&(s.observerbody=new o(function(a){return a.forEach(function(a){return"attributes"==a.type?i("body").hasClass("modal-open")&&!i.contains(i(".modal-dialog")[0],s.doc[0])?s.hide():s.show():void 0}),document.body.scrollHeight!=s.page.maxh?s.lazyResize(30):void 0}),s.observerbody.observe(document.body,{childList:!0,subtree:!0,characterData:!1,attributes:!0,attributeFilter:["class"]})),s.ispage||s.haswrapper||(o!==!1?(s.observer=new o(function(a){a.forEach(s.onAttributeChange)}),s.observer.observe(s.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),s.observerremover=new o(function(a){a.forEach(function(a){if(a.removedNodes.length>0)for(var b in a.removedNodes)if(s&&a.removedNodes[b]==s.win[0])return s.remove()})}),s.observerremover.observe(s.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(s.bind(s.win,v.isie&&!v.isie9?"propertychange":"DOMAttrModified",s.onAttributeChange),v.isie9&&s.win[0].attachEvent("onpropertychange",s.onAttributeChange),s.bind(s.win,"DOMNodeRemoved",function(a){a.target==s.win[0]&&s.remove()}))),!s.ispage&&s.opt.boxzoom&&s.bind(window,"resize",s.resizeZoom),s.istextarea&&(s.bind(s.win,"keydown",s.lazyResize),s.bind(s.win,"mouseup",s.lazyResize)),s.lazyResize(30)}if("IFRAME"==this.doc[0].nodeName){var B=function(){s.iframexd=!1;var a;try{a="contentDocument"in this?this.contentDocument:this.contentWindow.document;a.domain}catch(b){s.iframexd=!0,a=!1}if(s.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;if(s.forcescreen=!0,s.isiframe&&(s.iframe={doc:i(a),html:s.doc.contents().find("html")[0],body:s.doc.contents().find("body")[0]},s.getContentSize=function(){return{w:Math.max(s.iframe.html.scrollWidth,s.iframe.body.scrollWidth),h:Math.max(s.iframe.html.scrollHeight,s.iframe.body.scrollHeight)}},s.docscroll=i(s.iframe.body)),!v.isios&&s.opt.iframeautoresize&&!s.isiframe){s.win.scrollTop(0),s.doc.height("");var c=Math.max(a.getElementsByTagName("html")[0].scrollHeight,a.body.scrollHeight);s.doc.height(c)}s.lazyResize(30),v.isie7&&s.css(i(s.iframe.html),{"overflow-y":"hidden"}),s.css(i(s.iframe.body),{"overflow-y":"hidden"}),v.isios&&s.haswrapper&&s.css(i(a.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?s.bind(this.contentWindow,"scroll",s.onscroll):s.bind(a,"scroll",s.onscroll),s.opt.enablemousewheel&&s.bind(a,"mousewheel",s.onmousewheel),s.opt.enablekeyboard&&s.bind(a,v.isopera?"keypress":"keydown",s.onkeypress),(v.cantouch||s.opt.touchbehavior)&&(s.bind(a,"mousedown",s.ontouchstart),s.bind(a,"mousemove",function(a){return s.ontouchmove(a,!0)}),s.opt.grabcursorenabled&&v.cursorgrabvalue&&s.css(i(a.body),{cursor:v.cursorgrabvalue})),s.bind(a,"mouseup",s.ontouchend),s.zoom&&(s.opt.dblclickzoom&&s.bind(a,"dblclick",s.doZoom),s.ongesturezoom&&s.bind(a,"gestureend",s.ongesturezoom))};this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){B.call(s.doc[0],!1)},500),s.bind(this.doc,"load",B)}},this.showCursor=function(a,b){if(s.cursortimeout&&(clearTimeout(s.cursortimeout),s.cursortimeout=0),s.rail){if(s.autohidedom&&(s.autohidedom.stop().css({opacity:s.opt.cursoropacitymax}),s.cursoractive=!0),s.rail.drag&&1==s.rail.drag.pt||("undefined"!=typeof a&&a!==!1&&(s.scroll.y=Math.round(1*a/s.scrollratio.y)),"undefined"!=typeof b&&(s.scroll.x=Math.round(1*b/s.scrollratio.x))),s.cursor.css({height:s.cursorheight,top:s.scroll.y}),s.cursorh){var c=s.hasreversehr?s.scrollvaluemaxw-s.scroll.x:s.scroll.x;!s.rail.align&&s.rail.visibility?s.cursorh.css({width:s.cursorwidth,left:c+s.rail.width}):s.cursorh.css({width:s.cursorwidth,left:c}),s.cursoractive=!0}s.zoom&&s.zoom.stop().css({opacity:s.opt.cursoropacitymax})}},this.hideCursor=function(a){s.cursortimeout||s.rail&&s.autohidedom&&(s.hasmousefocus&&"leave"==s.opt.autohidemode||(s.cursortimeout=setTimeout(function(){s.rail.active&&s.showonmouseevent||(s.autohidedom.stop().animate({opacity:s.opt.cursoropacitymin}),s.zoom&&s.zoom.stop().animate({opacity:s.opt.cursoropacitymin}),s.cursoractive=!1),s.cursortimeout=0},a||s.opt.hidecursordelay)))},this.noticeCursor=function(a,b,c){s.showCursor(b,c),s.rail.active||s.hideCursor(a)},this.getContentSize=s.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:s.haswrapper?function(){return{w:s.doc.outerWidth()+parseInt(s.win.css("paddingLeft"))+parseInt(s.win.css("paddingRight")),h:s.doc.outerHeight()+parseInt(s.win.css("paddingTop"))+parseInt(s.win.css("paddingBottom"))}}:function(){return{w:s.docscroll[0].scrollWidth,h:s.docscroll[0].scrollHeight}},this.onResize=function(a,b){if(!s||!s.win)return!1;if(!s.haswrapper&&!s.ispage){if("none"==s.win.css("display"))return s.visibility&&s.hideRail().hideRailHr(),!1;s.hidden||s.visibility||s.showRail().showRailHr()}var c=s.page.maxh,d=s.page.maxw,e={h:s.view.h,w:s.view.w};if(s.view={w:s.ispage?s.win.width():parseInt(s.win[0].clientWidth),h:s.ispage?s.win.height():parseInt(s.win[0].clientHeight)},s.page=b?b:s.getContentSize(),s.page.maxh=Math.max(0,s.page.h-s.view.h),s.page.maxw=Math.max(0,s.page.w-s.view.w),s.page.maxh==c&&s.page.maxw==d&&s.view.w==e.w&&s.view.h==e.h){if(s.ispage)return s;var f=s.win.offset();if(s.lastposition){var g=s.lastposition;if(g.top==f.top&&g.left==f.left)return s}s.lastposition=f}if(0==s.page.maxh?(s.hideRail(),s.scrollvaluemax=0,s.scroll.y=0,s.scrollratio.y=0,s.cursorheight=0,s.setScrollTop(0),s.rail&&(s.rail.scrollable=!1)):(s.page.maxh-=s.opt.railpadding.top+s.opt.railpadding.bottom,s.rail.scrollable=!0),0==s.page.maxw?(s.hideRailHr(),s.scrollvaluemaxw=0,s.scroll.x=0,s.scrollratio.x=0,s.cursorwidth=0,s.setScrollLeft(0),s.railh&&(s.railh.scrollable=!1)):(s.page.maxw-=s.opt.railpadding.left+s.opt.railpadding.right,s.railh&&(s.railh.scrollable=s.opt.horizrailenabled)),s.railslocked=s.locked||0==s.page.maxh&&0==s.page.maxw,s.railslocked)return s.ispage||s.updateScrollBar(s.view),!1;s.hidden||s.visibility?!s.railh||s.hidden||s.railh.visibility||s.showRailHr():s.showRail().showRailHr(),s.istextarea&&s.win.css("resize")&&"none"!=s.win.css("resize")&&(s.view.h-=20),s.cursorheight=Math.min(s.view.h,Math.round(s.view.h*(s.view.h/s.page.h))),s.cursorheight=s.opt.cursorfixedheight?s.opt.cursorfixedheight:Math.max(s.opt.cursorminheight,s.cursorheight),s.cursorwidth=Math.min(s.view.w,Math.round(s.view.w*(s.view.w/s.page.w))),s.cursorwidth=s.opt.cursorfixedheight?s.opt.cursorfixedheight:Math.max(s.opt.cursorminheight,s.cursorwidth),s.scrollvaluemax=s.view.h-s.cursorheight-s.cursor.hborder-(s.opt.railpadding.top+s.opt.railpadding.bottom),s.railh&&(s.railh.width=s.page.maxh>0?s.view.w-s.rail.width:s.view.w,s.scrollvaluemaxw=s.railh.width-s.cursorwidth-s.cursorh.wborder-(s.opt.railpadding.left+s.opt.railpadding.right)),s.ispage||s.updateScrollBar(s.view),s.scrollratio={x:s.page.maxw/s.scrollvaluemaxw,y:s.page.maxh/s.scrollvaluemax};var h=s.getScrollTop();return h>s.page.maxh?s.doScrollTop(s.page.maxh):(s.scroll.y=Math.round(s.getScrollTop()*(1/s.scrollratio.y)),s.scroll.x=Math.round(s.getScrollLeft()*(1/s.scrollratio.x)),s.cursoractive&&s.noticeCursor()),s.scroll.y&&0==s.getScrollTop()&&s.doScrollTo(Math.floor(s.scroll.y*s.scrollratio.y)),s},this.resize=s.onResize,this.lazyResize=function(a){return a=isNaN(a)?30:a,s.debounced("resize",s.resize,a),s},this.jqbind=function(a,b,c){s.events.push({e:a,n:b,f:c,q:!0}),i(a).bind(b,c)},this.bind=function(a,b,c,d){var e="jquery"in a?a[0]:a;if("mousewheel"==b)if("onwheel"in s.win)s._bind(e,"wheel",c,d||!1);else{var f="undefined"!=typeof document.onmousewheel?"mousewheel":"DOMMouseScroll";n(e,f,c,d||!1),"DOMMouseScroll"==f&&n(e,"MozMousePixelScroll",c,d||!1)}else if(e.addEventListener){if(v.cantouch&&/mouseup|mousedown|mousemove/.test(b)){var g="mousedown"==b?"touchstart":"mouseup"==b?"touchend":"touchmove";s._bind(e,g,function(a){if(a.touches){if(a.touches.length<2){var b=a.touches.length?a.touches[0]:a;b.original=a,c.call(this,b)}}else if(a.changedTouches){var b=a.changedTouches[0];b.original=a,c.call(this,b)}},d||!1)}s._bind(e,b,c,d||!1),v.cantouch&&"mouseup"==b&&s._bind(e,"touchcancel",c,d||!1)}else s._bind(e,b,function(a){return a=a||window.event||!1,a&&a.srcElement&&(a.target=a.srcElement),"pageY"in a||(a.pageX=a.clientX+document.documentElement.scrollLeft,a.pageY=a.clientY+document.documentElement.scrollTop),c.call(e,a)===!1||d===!1?s.cancelEvent(a):!0})},v.haseventlistener?(this._bind=function(a,b,c,d){s.events.push({e:a,n:b,f:c,b:d,q:!1}),a.addEventListener(b,c,d||!1)},this.cancelEvent=function(a){if(!a)return!1;var a=a.original?a.original:a;return a.preventDefault(),a.stopPropagation(),a.preventManipulation&&a.preventManipulation(),!1},this.stopPropagation=function(a){if(!a)return!1;var a=a.original?a.original:a;return a.stopPropagation(),!1},this._unbind=function(a,b,c,d){a.removeEventListener(b,c,d)}):(this._bind=function(a,b,c,d){s.events.push({e:a,n:b,f:c,b:d,q:!1}),a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},this.cancelEvent=function(a){var a=window.event||!1;return a?(a.cancelBubble=!0,a.cancel=!0,a.returnValue=!1,!1):!1},this.stopPropagation=function(a){var a=window.event||!1;return a?(a.cancelBubble=!0,!1):!1},this._unbind=function(a,b,c,d){a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=!1}),this.unbindAll=function(){for(var a=0;a<s.events.length;a++){var b=s.events[a];b.q?b.e.unbind(b.n,b.f):s._unbind(b.e,b.n,b.f,b.b)}},this.showRail=function(){return 0==s.page.maxh||!s.ispage&&"none"==s.win.css("display")||(s.visibility=!0,s.rail.visibility=!0,s.rail.css("display","block")),s},this.showRailHr=function(){return s.railh?(0==s.page.maxw||!s.ispage&&"none"==s.win.css("display")||(s.railh.visibility=!0,s.railh.css("display","block")),s):s},this.hideRail=function(){return s.visibility=!1,s.rail.visibility=!1,s.rail.css("display","none"),s},this.hideRailHr=function(){return s.railh?(s.railh.visibility=!1,s.railh.css("display","none"),s):s},this.show=function(){return s.hidden=!1,s.railslocked=!1,s.showRail().showRailHr()},this.hide=function(){return s.hidden=!0,s.railslocked=!0,s.hideRail().hideRailHr()},this.toggle=function(){return s.hidden?s.show():s.hide()},this.remove=function(){s.stop(),s.cursortimeout&&clearTimeout(s.cursortimeout),s.debouncedelayed&&clearTimeout(s.debouncedelayed),s.doZoomOut(),s.unbindAll(),v.isie9&&s.win[0].detachEvent("onpropertychange",s.onAttributeChange),s.observer!==!1&&s.observer.disconnect(),s.observerremover!==!1&&s.observerremover.disconnect(),s.observerbody!==!1&&s.observerbody.disconnect(),s.events=null,s.cursor&&s.cursor.remove(),s.cursorh&&s.cursorh.remove(),s.rail&&s.rail.remove(),s.railh&&s.railh.remove(),s.zoom&&s.zoom.remove();for(var a=0;a<s.saved.css.length;a++){var b=s.saved.css[a];b[0].css(b[1],"undefined"==typeof b[2]?"":b[2])}s.saved=!1,s.me.data("__nicescroll","");var c=i.nicescroll;c.each(function(a){if(this&&this.id===s.id){delete c[a];for(var b=++a;b<c.length;b++,a++)c[a]=c[b];c.length--,c.length&&delete c[c.length]}});for(var d in s)s[d]=null,delete s[d];s=null},this.scrollstart=function(a){return this.onscrollstart=a,s},this.scrollend=function(a){return this.onscrollend=a,s},this.scrollcancel=function(a){return this.onscrollcancel=a,s},this.zoomin=function(a){return this.onzoomin=a,s},this.zoomout=function(a){return this.onzoomout=a,s},this.isScrollable=function(a){var b=a.target?a.target:a;if("OPTION"==b.nodeName)return!0;for(;b&&1==b.nodeType&&!/^BODY|HTML/.test(b.nodeName);){var c=i(b),d=c.css("overflowY")||c.css("overflowX")||c.css("overflow")||"";if(/scroll|auto/.test(d))return b.clientHeight!=b.scrollHeight;b=b.parentNode?b.parentNode:!1}return!1},this.getViewport=function(a){for(var b=a&&a.parentNode?a.parentNode:!1;b&&1==b.nodeType&&!/^BODY|HTML/.test(b.nodeName);){var c=i(b);if(/fixed|absolute/.test(c.css("position")))return c;var d=c.css("overflowY")||c.css("overflowX")||c.css("overflow")||"";if(/scroll|auto/.test(d)&&b.clientHeight!=b.scrollHeight)return c;if(c.getNiceScroll().length>0)return c;b=b.parentNode?b.parentNode:!1}return!1},this.triggerScrollEnd=function(){if(s.onscrollend){var a=s.getScrollLeft(),b=s.getScrollTop(),c={type:"scrollend",current:{x:a,y:b},end:{x:a,y:b}};s.onscrollend.call(s,c)}},this.onmousewheel=function(a){if(!s.wheelprevented){if(s.railslocked)return s.debounced("checkunlock",s.resize,250),!0;if(s.rail.drag)return s.cancelEvent(a);if("auto"==s.opt.oneaxismousemode&&0!=a.deltaX&&(s.opt.oneaxismousemode=!1),s.opt.oneaxismousemode&&0==a.deltaX&&!s.rail.scrollable)return s.railh&&s.railh.scrollable?s.onmousewheelhr(a):!0;var b=+new Date,c=!1;if(s.opt.preservenativescrolling&&s.checkarea+600<b&&(s.nativescrollingarea=s.isScrollable(a),c=!0),s.checkarea=b,s.nativescrollingarea)return!0;var d=q(a,!1,c);return d&&(s.checkarea=0),d}},this.onmousewheelhr=function(a){if(!s.wheelprevented){if(s.railslocked||!s.railh.scrollable)return!0;if(s.rail.drag)return s.cancelEvent(a);var b=+new Date,c=!1;return s.opt.preservenativescrolling&&s.checkarea+600<b&&(s.nativescrollingarea=s.isScrollable(a),c=!0),s.checkarea=b,s.nativescrollingarea?!0:s.railslocked?s.cancelEvent(a):q(a,!0,c)}},this.stop=function(){return s.cancelScroll(),s.scrollmon&&s.scrollmon.stop(),s.cursorfreezed=!1,s.scroll.y=Math.round(s.getScrollTop()*(1/s.scrollratio.y)),s.noticeCursor(),s},this.getTransitionSpeed=function(a){var b=Math.round(10*s.opt.scrollspeed),c=Math.min(b,Math.round(a/20*s.opt.scrollspeed));return c>20?c:0},s.opt.smoothscroll?s.ishwscroll&&v.hastransition&&s.opt.usetransition&&s.opt.smoothscroll?(this.prepareTransition=function(a,b){var c=b?a>20?a:0:s.getTransitionSpeed(a),d=c?v.prefixstyle+"transform "+c+"ms ease-out":"";return s.lasttransitionstyle&&s.lasttransitionstyle==d||(s.lasttransitionstyle=d,s.doc.css(v.transitionstyle,d)),c},this.doScrollLeft=function(a,b){var c=s.scrollrunning?s.newscrolly:s.getScrollTop();s.doScrollPos(a,c,b)},this.doScrollTop=function(a,b){var c=s.scrollrunning?s.newscrollx:s.getScrollLeft();s.doScrollPos(c,a,b)},this.doScrollPos=function(a,b,c){var d=s.getScrollTop(),e=s.getScrollLeft();return((s.newscrolly-d)*(b-d)<0||(s.newscrollx-e)*(a-e)<0)&&s.cancelScroll(),0==s.opt.bouncescroll&&(0>b?b=0:b>s.page.maxh&&(b=s.page.maxh),0>a?a=0:a>s.page.maxw&&(a=s.page.maxw)),s.scrollrunning&&a==s.newscrollx&&b==s.newscrolly?!1:(s.newscrolly=b,s.newscrollx=a,s.newscrollspeed=c||!1,s.timer?!1:void(s.timer=setTimeout(function(){var c=s.getScrollTop(),d=s.getScrollLeft(),e={};e.x=a-d,e.y=b-c,e.px=d,e.py=c;var f=Math.round(Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))),g=s.newscrollspeed&&s.newscrollspeed>1?s.newscrollspeed:s.getTransitionSpeed(f);if(s.newscrollspeed&&s.newscrollspeed<=1&&(g*=s.newscrollspeed),s.prepareTransition(g,!0),s.timerscroll&&s.timerscroll.tm&&clearInterval(s.timerscroll.tm),g>0){if(!s.scrollrunning&&s.onscrollstart){var h={type:"scrollstart",current:{x:d,y:c},request:{x:a,y:b},end:{x:s.newscrollx,y:s.newscrolly},speed:g};s.onscrollstart.call(s,h)}v.transitionend?s.scrollendtrapped||(s.scrollendtrapped=!0,s.bind(s.doc,v.transitionend,s.onScrollTransitionEnd,!1)):(s.scrollendtrapped&&clearTimeout(s.scrollendtrapped),s.scrollendtrapped=setTimeout(s.onScrollTransitionEnd,g));var i=c,j=d;s.timerscroll={bz:new x(i,s.newscrolly,g,0,0,.58,1),bh:new x(j,s.newscrollx,g,0,0,.58,1)},s.cursorfreezed||(s.timerscroll.tm=setInterval(function(){s.showCursor(s.getScrollTop(),s.getScrollLeft())},60))}s.synched("doScroll-set",function(){s.timer=0,s.scrollendtrapped&&(s.scrollrunning=!0),s.setScrollTop(s.newscrolly),s.setScrollLeft(s.newscrollx),s.scrollendtrapped||s.onScrollTransitionEnd()})},50)))},this.cancelScroll=function(){if(!s.scrollendtrapped)return!0;var a=s.getScrollTop(),b=s.getScrollLeft();return s.scrollrunning=!1,v.transitionend||clearTimeout(v.transitionend),s.scrollendtrapped=!1,s._unbind(s.doc[0],v.transitionend,s.onScrollTransitionEnd),s.prepareTransition(0),s.setScrollTop(a),s.railh&&s.setScrollLeft(b),s.timerscroll&&s.timerscroll.tm&&clearInterval(s.timerscroll.tm),s.timerscroll=!1,s.cursorfreezed=!1,s.showCursor(a,b),s},this.onScrollTransitionEnd=function(){s.scrollendtrapped&&s._unbind(s.doc[0],v.transitionend,s.onScrollTransitionEnd),s.scrollendtrapped=!1,s.prepareTransition(0),s.timerscroll&&s.timerscroll.tm&&clearInterval(s.timerscroll.tm),s.timerscroll=!1;var a=s.getScrollTop(),b=s.getScrollLeft();return s.setScrollTop(a),s.railh&&s.setScrollLeft(b),s.noticeCursor(!1,a,b),s.cursorfreezed=!1,0>a?a=0:a>s.page.maxh&&(a=s.page.maxh),0>b?b=0:b>s.page.maxw&&(b=s.page.maxw),a!=s.newscrolly||b!=s.newscrollx?s.doScrollPos(b,a,s.opt.snapbackspeed):(s.onscrollend&&s.scrollrunning&&s.triggerScrollEnd(),void(s.scrollrunning=!1))}):(this.doScrollLeft=function(a,b){var c=s.scrollrunning?s.newscrolly:s.getScrollTop();s.doScrollPos(a,c,b)},this.doScrollTop=function(a,b){var c=s.scrollrunning?s.newscrollx:s.getScrollLeft();s.doScrollPos(c,a,b)},this.doScrollPos=function(a,b,c){function d(){if(s.cancelAnimationFrame)return!0;if(s.scrollrunning=!0,m=1-m)return s.timer=k(d)||1;var a,b,c=0,e=b=s.getScrollTop();if(s.dst.ay){e=s.bzscroll?s.dst.py+s.bzscroll.getNow()*s.dst.ay:s.newscrolly;var f=e-b;(0>f&&e<s.newscrolly||f>0&&e>s.newscrolly)&&(e=s.newscrolly),s.setScrollTop(e),e==s.newscrolly&&(c=1)}else c=1;var g=a=s.getScrollLeft();if(s.dst.ax){g=s.bzscroll?s.dst.px+s.bzscroll.getNow()*s.dst.ax:s.newscrollx;var f=g-a;(0>f&&g<s.newscrollx||f>0&&g>s.newscrollx)&&(g=s.newscrollx),s.setScrollLeft(g),g==s.newscrollx&&(c+=1)}else c+=1;2==c?(s.timer=0,s.cursorfreezed=!1,s.bzscroll=!1,s.scrollrunning=!1,0>e?e=0:e>s.page.maxh&&(e=s.page.maxh),0>g?g=0:g>s.page.maxw&&(g=s.page.maxw),g!=s.newscrollx||e!=s.newscrolly?s.doScrollPos(g,e):s.onscrollend&&s.triggerScrollEnd()):s.timer=k(d)||1}var b="undefined"==typeof b||b===!1?s.getScrollTop(!0):b;if(s.timer&&s.newscrolly==b&&s.newscrollx==a)return!0;s.timer&&l(s.timer),s.timer=0;var e=s.getScrollTop(),f=s.getScrollLeft();((s.newscrolly-e)*(b-e)<0||(s.newscrollx-f)*(a-f)<0)&&s.cancelScroll(),s.newscrolly=b,s.newscrollx=a,s.bouncescroll&&s.rail.visibility||(s.newscrolly<0?s.newscrolly=0:s.newscrolly>s.page.maxh&&(s.newscrolly=s.page.maxh)),s.bouncescroll&&s.railh.visibility||(s.newscrollx<0?s.newscrollx=0:s.newscrollx>s.page.maxw&&(s.newscrollx=s.page.maxw)),s.dst={},s.dst.x=a-f,s.dst.y=b-e,s.dst.px=f,s.dst.py=e;var g=Math.round(Math.sqrt(Math.pow(s.dst.x,2)+Math.pow(s.dst.y,2)));s.dst.ax=s.dst.x/g,s.dst.ay=s.dst.y/g;var h=0,i=g;0==s.dst.x?(h=e,i=b,s.dst.ay=1,s.dst.py=0):0==s.dst.y&&(h=f,i=a,s.dst.ax=1,s.dst.px=0);var j=s.getTransitionSpeed(g);if(c&&1>=c&&(j*=c),j>0?s.bzscroll=s.bzscroll?s.bzscroll.update(i,j):new x(h,i,j,0,1,0,1):s.bzscroll=!1,!s.timer){(e==s.page.maxh&&b>=s.page.maxh||f==s.page.maxw&&a>=s.page.maxw)&&s.checkContentSize();var m=1;if(s.cancelAnimationFrame=!1,s.timer=1,s.onscrollstart&&!s.scrollrunning){var n={type:"scrollstart",current:{x:f,y:e},request:{x:a,y:b},end:{x:s.newscrollx,y:s.newscrolly},speed:j};s.onscrollstart.call(s,n)}d(),(e==s.page.maxh&&b>=e||f==s.page.maxw&&a>=f)&&s.checkContentSize(),s.noticeCursor()}},this.cancelScroll=function(){return s.timer&&l(s.timer),s.timer=0,s.bzscroll=!1,s.scrollrunning=!1,s}):(this.doScrollLeft=function(a,b){var c=s.getScrollTop();s.doScrollPos(a,c,b)},this.doScrollTop=function(a,b){var c=s.getScrollLeft();s.doScrollPos(c,a,b)},this.doScrollPos=function(a,b,c){var d=a>s.page.maxw?s.page.maxw:a;0>d&&(d=0);var e=b>s.page.maxh?s.page.maxh:b;0>e&&(e=0),s.synched("scroll",function(){s.setScrollTop(e),s.setScrollLeft(d)})},this.cancelScroll=function(){}),this.doScrollBy=function(a,b){var c=0;if(b)c=Math.floor((s.scroll.y-a)*s.scrollratio.y);else{var d=s.timer?s.newscrolly:s.getScrollTop(!0);c=d-a}if(s.bouncescroll){var e=Math.round(s.view.h/2);-e>c?c=-e:c>s.page.maxh+e&&(c=s.page.maxh+e)}s.cursorfreezed=!1;var f=s.getScrollTop(!0);return 0>c&&0>=f?s.noticeCursor():c>s.page.maxh&&f>=s.page.maxh?(s.checkContentSize(),s.noticeCursor()):void s.doScrollTop(c)},this.doScrollLeftBy=function(a,b){var c=0;if(b)c=Math.floor((s.scroll.x-a)*s.scrollratio.x);else{var d=s.timer?s.newscrollx:s.getScrollLeft(!0);c=d-a}if(s.bouncescroll){var e=Math.round(s.view.w/2);-e>c?c=-e:c>s.page.maxw+e&&(c=s.page.maxw+e)}s.cursorfreezed=!1;var f=s.getScrollLeft(!0);return 0>c&&0>=f?s.noticeCursor():c>s.page.maxw&&f>=s.page.maxw?s.noticeCursor():void s.doScrollLeft(c)},this.doScrollTo=function(a,b){var c=b?Math.round(a*s.scrollratio.y):a;0>c?c=0:c>s.page.maxh&&(c=s.page.maxh),s.cursorfreezed=!1,s.doScrollTop(a)},this.checkContentSize=function(){var a=s.getContentSize();(a.h!=s.page.h||a.w!=s.page.w)&&s.resize(!1,a)},s.onscroll=function(a){s.rail.drag||s.cursorfreezed||s.synched("scroll",function(){s.scroll.y=Math.round(s.getScrollTop()*(1/s.scrollratio.y)),s.railh&&(s.scroll.x=Math.round(s.getScrollLeft()*(1/s.scrollratio.x))),s.noticeCursor()})},s.bind(s.docscroll,"scroll",s.onscroll),this.doZoomIn=function(a){if(!s.zoomactive){s.zoomactive=!0,s.zoomrestore={style:{}};var b=["position","top","left","zIndex","backgroundColor","marginTop","marginBottom","marginLeft","marginRight"],c=s.win[0].style;for(var d in b){var e=b[d];s.zoomrestore.style[e]="undefined"!=typeof c[e]?c[e]:""}s.zoomrestore.style.width=s.win.css("width"),s.zoomrestore.style.height=s.win.css("height"),s.zoomrestore.padding={w:s.win.outerWidth()-s.win.width(),h:s.win.outerHeight()-s.win.height()},v.isios4&&(s.zoomrestore.scrollTop=i(window).scrollTop(),i(window).scrollTop(0)),s.win.css({position:v.isios4?"absolute":"fixed",top:0,left:0,"z-index":h+100,margin:"0px"});var f=s.win.css("backgroundColor");return(""==f||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(f))&&s.win.css("backgroundColor","#fff"),s.rail.css({"z-index":h+101}),s.zoom.css({"z-index":h+102}),s.zoom.css("backgroundPosition","0px -18px"),s.resizeZoom(),s.onzoomin&&s.onzoomin.call(s),s.cancelEvent(a)}},this.doZoomOut=function(a){return s.zoomactive?(s.zoomactive=!1,s.win.css("margin",""),s.win.css(s.zoomrestore.style),v.isios4&&i(window).scrollTop(s.zoomrestore.scrollTop),s.rail.css({"z-index":s.zindex}),s.zoom.css({"z-index":s.zindex}),s.zoomrestore=!1,s.zoom.css("backgroundPosition","0px 0px"),s.onResize(),s.onzoomout&&s.onzoomout.call(s),s.cancelEvent(a)):void 0},this.doZoom=function(a){return s.zoomactive?s.doZoomOut(a):s.doZoomIn(a)},this.resizeZoom=function(){if(s.zoomactive){var a=s.getScrollTop();s.win.css({width:i(window).width()-s.zoomrestore.padding.w+"px",height:i(window).height()-s.zoomrestore.padding.h+"px"}),s.onResize(),s.setScrollTop(Math.min(s.page.maxh,a))}},this.init(),i.nicescroll.push(this)},t=function(a){var b=this;this.nc=a,this.lastx=0,this.lasty=0,this.speedx=0,this.speedy=0,this.lasttime=0,this.steptime=0,this.snapx=!1,this.snapy=!1,this.demulx=0,this.demuly=0,this.lastscrollx=-1,this.lastscrolly=-1,this.chkx=0,this.chky=0,this.timer=0,this.time=function(){return+new Date},this.reset=function(a,c){b.stop();var d=b.time();b.steptime=0,b.lasttime=d,b.speedx=0,b.speedy=0,b.lastx=a,b.lasty=c,b.lastscrollx=-1,b.lastscrolly=-1},this.update=function(a,c){var d=b.time();b.steptime=d-b.lasttime,b.lasttime=d;var e=c-b.lasty,f=a-b.lastx,g=b.nc.getScrollTop(),h=b.nc.getScrollLeft(),i=g+e,j=h+f;b.snapx=0>j||j>b.nc.page.maxw,b.snapy=0>i||i>b.nc.page.maxh,b.speedx=f,b.speedy=e,b.lastx=a,b.lasty=c},this.stop=function(){b.nc.unsynched("domomentum2d"),b.timer&&clearTimeout(b.timer),b.timer=0,b.lastscrollx=-1,b.lastscrolly=-1},this.doSnapy=function(a,c){var d=!1;0>c?(c=0,d=!0):c>b.nc.page.maxh&&(c=b.nc.page.maxh,d=!0),0>a?(a=0,d=!0):a>b.nc.page.maxw&&(a=b.nc.page.maxw,d=!0),d?b.nc.doScrollPos(a,c,b.nc.opt.snapbackspeed):b.nc.triggerScrollEnd()},this.doMomentum=function(a){var c=b.time(),d=a?c+a:b.lasttime,e=b.nc.getScrollLeft(),f=b.nc.getScrollTop(),g=b.nc.page.maxh,h=b.nc.page.maxw;b.speedx=h>0?Math.min(60,b.speedx):0,b.speedy=g>0?Math.min(60,b.speedy):0;var i=d&&60>=c-d;(0>f||f>g||0>e||e>h)&&(i=!1);var j=b.speedy&&i?b.speedy:!1,k=b.speedx&&i?b.speedx:!1;if(j||k){var l=Math.max(16,b.steptime);if(l>50){var m=l/50;b.speedx*=m,b.speedy*=m,l=50}b.demulxy=0,b.lastscrollx=b.nc.getScrollLeft(),b.chkx=b.lastscrollx,b.lastscrolly=b.nc.getScrollTop(),b.chky=b.lastscrolly;var n=b.lastscrollx,o=b.lastscrolly,p=function(){var a=b.time()-c>600?.04:.02;b.speedx&&(n=Math.floor(b.lastscrollx-b.speedx*(1-b.demulxy)),b.lastscrollx=n,(0>n||n>h)&&(a=.1)),b.speedy&&(o=Math.floor(b.lastscrolly-b.speedy*(1-b.demulxy)),b.lastscrolly=o,(0>o||o>g)&&(a=.1)),b.demulxy=Math.min(1,b.demulxy+a),b.nc.synched("domomentum2d",function(){if(b.speedx){var a=b.nc.getScrollLeft();a!=b.chkx&&b.stop(),b.chkx=n,b.nc.setScrollLeft(n)}if(b.speedy){var c=b.nc.getScrollTop();c!=b.chky&&b.stop(),b.chky=o,b.nc.setScrollTop(o)}b.timer||(b.nc.hideCursor(),b.doSnapy(n,o))}),b.demulxy<1?b.timer=setTimeout(p,l):(b.stop(),b.nc.hideCursor(),b.doSnapy(n,o))};p()}else b.doSnapy(b.nc.getScrollLeft(),b.nc.getScrollTop())}},u=a.fn.scrollTop;a.cssHooks.pageYOffset={get:function(a,b,c){var d=i.data(a,"__nicescroll")||!1;return d&&d.ishwscroll?d.getScrollTop():u.call(a)},set:function(a,b){var c=i.data(a,"__nicescroll")||!1;return c&&c.ishwscroll?c.setScrollTop(parseInt(b)):u.call(a,b),this}},a.fn.scrollTop=function(a){if("undefined"==typeof a){var b=this[0]?i.data(this[0],"__nicescroll")||!1:!1;return b&&b.ishwscroll?b.getScrollTop():u.call(this)}return this.each(function(){var b=i.data(this,"__nicescroll")||!1;b&&b.ishwscroll?b.setScrollTop(parseInt(a)):u.call(i(this),a)})};var v=a.fn.scrollLeft;i.cssHooks.pageXOffset={get:function(a,b,c){var d=i.data(a,"__nicescroll")||!1;return d&&d.ishwscroll?d.getScrollLeft():v.call(a)},set:function(a,b){var c=i.data(a,"__nicescroll")||!1;return c&&c.ishwscroll?c.setScrollLeft(parseInt(b)):v.call(a,b),this}},a.fn.scrollLeft=function(a){if("undefined"==typeof a){var b=this[0]?i.data(this[0],"__nicescroll")||!1:!1;return b&&b.ishwscroll?b.getScrollLeft():v.call(this)}return this.each(function(){var b=i.data(this,"__nicescroll")||!1;b&&b.ishwscroll?b.setScrollLeft(parseInt(a)):v.call(i(this),a)})};var w=function(a){var b=this;if(this.length=0,this.name="nicescrollarray",this.each=function(a){for(var c=0,d=0;c<b.length;c++)a.call(b[c],d++);return b},this.push=function(a){b[b.length]=a,b.length++},this.eq=function(a){return b[a]},a)for(var c=0;c<a.length;c++){var d=i.data(a[c],"__nicescroll")||!1;d&&(this[this.length]=d,this.length++)}return this};c(w.prototype,["show","hide","toggle","onResize","resize","remove","stop","doScrollPos"],function(a,b){a[b]=function(){var a=arguments;return this.each(function(){this[b].apply(this,a)})}}),a.fn.getNiceScroll=function(a){if("undefined"==typeof a)return new w(this);var b=this[a]&&i.data(this[a],"__nicescroll")||!1;return b},a.extend(a.expr[":"],{nicescroll:function(a){return i.data(a,"__nicescroll")?!0:!1}}),i.fn.niceScroll=function(a,b){"undefined"==typeof b&&("object"!=typeof a||"jquery"in a||(b=a,a=!1)),b=i.extend({},b);var c=new w;"undefined"==typeof b&&(b={}),a&&(b.doc=i(a),b.win=i(this));var d=!("doc"in b);return d||"win"in b||(b.win=i(this)),this.each(function(){var a=i(this).data("__nicescroll")||!1;a||(b.doc=d?i(this):b.doc,a=new s(b,i(this)),i(this).data("__nicescroll",a)),c.push(a)}),1==c.length?c[0]:c},window.NiceScroll={getjQuery:function(){return a}},i.nicescroll||(i.nicescroll=new w,i.nicescroll.options=p)}),function(a){"function"==typeof define&&define.amd?define("mousewheel",["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),define("DialogView",["jquery","config","quickblox","underscore","models/person","views/profile","views/change_password","views/fb_import","mCustomScrollbar","nicescroll","mousewheel"],function(a,b,c,d,e,f,g,h){function i(a){this.app=a,p=this.app.models.User,q=this.app.models.Dialog,r=this.app.models.Message,s=this.app.models.ContactList}function j(){a(".l-sidebar .scrollbar").mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:b.isMac||60,deltaFactor:-1},live:!0})}function k(a,b){var c,d=b.app.views.Message,e=a.parents(".l-chat").data("dialog"),f=a.find(".message").length;r.download(e,function(a){for(var b=0,e=a.length;e>b;b++)c=r.create(a[b]),d.addItem(c,!0)},f,"ajax")}function l(a){a.add(".popups").addClass("is-overlay")}function m(a,b){return b+=a&&"none"!==a.subscription?a&&a.status?'<span class="status status_online"></span>':'<span class="status"></span>':'<span class="status status_request"></span>'}function n(){a(".l-chat:visible .textarea").niceScroll({cursoropacitymax:.5,railpadding:{right:5},zindex:1,enablekeyboard:!1})}function o(b){0===b.contents().length&&b.parent().addClass("is-hidden"),0===a("#historyList ul").contents().length&&a("#historyList ul").parent().addClass("is-hidden"),a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")}var p,q,r,s,t,u,v,w,x={},y="Q-municate",z="favicon_counter.png",A="favicon.png";return i.prototype={chatCallbacksInit:function(){var b=this.app.views.ContactList,i=this.app.views.Message,j=this.app.views.VideoChat;c.chat.onMessageListener=i.onMessage,c.chat.onMessageTypingListener=i.onMessageTyping,c.chat.onContactListListener=b.onPresence,c.chat.onSubscribeListener=b.onSubscribe,c.chat.onConfirmSubscribeListener=b.onConfirm,c.chat.onRejectSubscribeListener=b.onReject,c.webrtc.onCallListener=j.onCall,c.webrtc.onAcceptCallListener=j.onAccept,
c.webrtc.onRejectCallListener=j.onReject,c.webrtc.onStopCallListener=j.onStop,c.webrtc.onUpdateCallListener=j.onUpdateCall,c.webrtc.onRemoteStreamListener=j.onRemoteStream,c.chat.onDisconnectingListener=function(){localStorage["QM.user"]&&(window.onLine=!1,a(".no-connection").removeClass("is-hidden"))},c.chat.onReconnectListener=function(){window.onLine=!0,a(".no-connection").addClass("is-hidden")},t=new e(d.clone(p.contact),{app:this.app,parse:!0}),u=new f({model:t}),v=new g({model:t}),w=new h,this.app.views.Profile=u,this.app.views.ChangePass=v,this.app.views.FBImport=w},createDataSpinner:function(b,c,d){var e;e=d?'<div class="message message_service"><div class="popup-elem spinner_bounce is-empty is-ajaxDownload">':c?'<div class="popup-elem spinner_bounce is-creating">':'<div class="popup-elem spinner_bounce is-empty">',e+='<div class="spinner_bounce-bounce1"></div>',e+='<div class="spinner_bounce-bounce2"></div>',e+='<div class="spinner_bounce-bounce3"></div>',e+="</div>",d&&(e+="</div>"),b?a(".l-chat:visible").find(".l-chat-content").append(e):c?(a("#popupContacts .btn_popup").addClass("is-hidden"),a("#popupContacts .popup-footer").append(e),a("#popupContacts .popup-footer").after('<div class="temp-box"></div>')):d?a(".l-chat:visible").find(".l-chat-content").prepend(e):a("#emptyList").after(e)},removeDataSpinner:function(){a(".spinner_bounce, .temp-box, div.message_service").remove()},prepareDownloading:function(a){b.debug&&console.log("QB SDK: Roster has been got",a),this.chatCallbacksInit(),this.createDataSpinner(),j(),s.saveRoster(a)},getUnreadCounter:function(b){var c;"undefined"==typeof x[b]&&(x[b]=!0,c=Object.keys(x).length,a("title").text("("+c+") "+y),a('link[rel="icon"]').remove(),a("head").append('<link rel="icon" href="'+z+'">'))},decUnreadCounter:function(b){var c;"undefined"!=typeof x[b]&&(delete x[b],c=Object.keys(x).length,c>0?a("title").text("("+c+") "+y):(a("title").text(y),a('link[rel="icon"]').remove(),a("head").append('<link rel="icon" href="'+A+'">')))},logoutWithClearData:function(){x={},a("title").text(y),a('link[rel="icon"]').remove(),a("head").append('<link rel="icon" href="'+A+'">'),a(".mediacall-remote-duration").text("connecting..."),a(".mediacall-info-duration").text("")},downloadDialogs:function(b,e){var f,g,h,i,j,k=this,m=this.app.views.ContactList,n=sessionStorage["QM.hiddenDialogs"]?JSON.parse(sessionStorage["QM.hiddenDialogs"]):{},o=Object.keys(b);q.download(function(p){k.removeDataSpinner(),p.length>0?(i=d.uniq(d.flatten(d.pluck(p,"occupants_ids"),!0)),s.add(i,null,function(){for(var d=0,e=p.length;e>d;d++)h=q.create(p[d]),s.dialogs[h.id]=h,localStorage["QM.dialog-"+h.id]||localStorage.setItem("QM.dialog-"+h.id,JSON.stringify({messages:[]})),j=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+h.id+'"]'),j[0]&&h.unread_count?(j.find(".unread").text(h.unread_count),k.getUnreadCounter(h.id)):(2===h.type&&c.chat.muc.join(h.room_jid),g=3===h.type?h.occupants_ids[0]:null,n[g]=h.id,s.saveHiddenDialogs(n),f=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{},g&&(!b[g]||b[g]&&"none"===b[g].subscription&&!b[g].ask&&f[g])||k.addDialogItem(h,!0));a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")})):a("#emptyList").removeClass("is-hidden"),e&&s.getFBFriends(e,function(b){l(a("#popupImport"));for(var c=0,d=b.length;d>c;c++)m.importFBFriend(b[c])}),k.getAllUsers(o)})},getAllUsers:function(b){var c=this.app.service,d=this.app.models.Contact,e=this.app.models.ContactList,f={filter:{field:"id",param:"in",value:b},per_page:100};c.listUsers(f,function(b){b.items.forEach(function(b){var c=b.user,f=d.create(c);e.contacts[f.id]=f,a('.profileUserName[data-id="'+f.id+'"]').text(f.full_name),a('.profileUserStatus[data-id="'+f.id+'"]').text(f.status),a('.profileUserPhone[data-id="'+f.id+'"]').html('<span class="userDetails-label">Phone:</span><span class="userDetails-phone">'+f.phone+"</span>"),a('.profileUserAvatar[data-id="'+f.id+'"]').css("background-image","url("+f.avatar_url+")"),localStorage.setItem("QM.contact-"+f.id,JSON.stringify(f))})})},hideDialogs:function(){a(".l-list").addClass("is-hidden"),a(".l-list ul").html("")},addDialogItem:function(c,d,e){var f,g,h,i,j,k,l=s.contacts,n=s.roster,o=this;f=3===c.type?c.occupants_ids[0]:null,g=f?l[f].avatar_url:c.room_photo||b.defAvatar.group_url,h=f?l[f].full_name:c.room_name,i=n[f]?n[f]:null,j='<li class="list-item dialog-item presence-listener" data-dialog="'+c.id+'" data-id="'+f+'">',j+='<a class="contact l-flexbox" href="#">',j+='<div class="l-flexbox_inline">',j+='<div class="contact-avatar avatar profileUserAvatar" style="background-image:url('+g+')" data-id="'+f+'"></div>',j+='<span class="name profileUserName" data-id="'+f+'">'+h+"</span>",j+="</div>",3===c.type?j=m(i,j):j+='<span class="status"></span>',j+='<span class="unread">'+c.unread_count+"</span>",j+="</a></li>",k=new Date,k.setHours(0,0,0,0),!c.last_message_date_sent||new Date(1e3*c.last_message_date_sent)>k||e?d?a("#recentList").removeClass("is-hidden").find("ul").append(j):a("#searchList").is(":visible")?a("#recentList").removeClass("is-hidden").find("ul").prepend(j):a("#recentList").removeClass("is-hidden").find("ul").prepend(j):a("#searchList").is(":visible")||a("#historyList").removeClass("is-hidden").find("ul").append(j),a("#emptyList").addClass("is-hidden"),c.unread_count&&o.getUnreadCounter(c.id)},htmlBuild:function(c){var d,e,f,g,h,i,j=this.app.views.Message,k=s.contacts,l=s.dialogs,o=s.roster,q=c.parent(),t=q.data("dialog"),u=q.data("id"),v=l[t],w=k[u],x=a('.l-chat[data-dialog="'+t+'"]'),y=this;if(e=v.room_jid||w.user_jid,f=u?w.avatar_url:v.room_photo||b.defAvatar.group_url,g=v.room_name||w.full_name,h=o[u]?o[u]:null,0===x.length){if(3===v.type?(d='<section class="l-workspace l-chat l-chat_private presence-listener" data-dialog="'+t+'" data-id="'+u+'" data-jid="'+e+'">',d+='<header class="l-chat-header l-flexbox l-flexbox_flexbetween">'):(d='<section class="l-workspace l-chat l-chat_group is-group" data-dialog="'+t+'" data-jid="'+e+'">',d+='<header class="l-chat-header l-flexbox l-flexbox_flexbetween groupTitle">'),d+='<div class="chat-title">',d+='<div class="l-flexbox_inline">',3===v.type?(d+='<div class="contact-avatar avatar avatar_chat profileUserAvatar" style="background-image:url('+f+')" data-id="'+u+'"></div>',d+='<h2 class="name name_chat profileUserName" title="'+g+'" data-id="'+u+'">'+g+"</h2>",d=m(h,d)):(d+='<div class="contact-avatar avatar avatar_chat" style="background-image:url('+f+')"></div>',d+='<span class="pencil_active avatar is-hidden"></span>',d+='<input class="avatar_file avatar is-hidden" type="file" accept="image/*">',d+='<h2 class="name name_chat" contenteditable="true" title="'+g+'">'+g+"</h2>",d+='<span class="pencil is-hidden"></span>',d+='<span class="triangle triangle_down"></span>',d+='<span class="triangle triangle_up is-hidden"></span>'),d+="</div></div>",d+='<div class="chat-controls">',3===v.type?(d+='<button class="btn_chat btn_chat_videocall videoCall"><img src="images/icon-videocall.svg" alt="videocall"></button>',d+='<button class="btn_chat btn_chat_audiocall audioCall"><img src="images/icon-audiocall.svg" alt="audiocall"></button>',d+='<button class="btn_chat btn_chat_add createGroupChat" data-ids="'+v.occupants_ids.join()+'" data-private="1"><img src="images/icon-add.svg" alt="add"></button>',d+='<button class="btn_chat btn_chat_profile userDetails" data-id="'+u+'"><img src="images/icon-profile.svg" alt="profile"></button>'):d+='<button class="btn_chat btn_chat_add addToGroupChat" data-ids="'+v.occupants_ids.join()+'" data-dialog="'+t+'"><img src="images/icon-add.svg" alt="add"></button>',d+=3===v.type?'<button class="btn_chat btn_chat_delete deleteContact"><img src="images/icon-delete.svg" alt="delete"></button>':'<button class="btn_chat btn_chat_delete leaveChat"><img src="images/icon-delete.svg" alt="delete"></button>',d+="</div></header>",2===v.type){d+='<div class="chat-occupants-wrap">',d+='<div class="chat-occupants">';for(var z,A=0,B=v.occupants_ids.length;B>A;A++)z=v.occupants_ids[A],z!=p.contact.id&&(d+='<a class="occupant l-flexbox_inline presence-listener" data-id="'+z+'" href="#">',d=m(o[z],d),d+='<span class="name name_occupant">'+k[z].full_name+"</span>",d+="</a>");d+="</div></div>"}d+='<section class="l-chat-content scrollbar_message"></section>',d+='<footer class="l-chat-footer">',d+='<form class="l-message" action="#">',d+='<div class="form-input-message textarea" contenteditable="true" placeholder="Type a message"></div>',d+='<button class="btn_message btn_message_smile"><img src="images/icon-smile.svg" alt="smile"></button>',d+='<button class="btn_message btn_message_attach"><img src="images/icon-attach.svg" alt="attach"></button>',d+='<input class="attachment" type="file">',d+="</form></footer>",d+="</section>",a(".l-workspace-wrap .l-workspace").addClass("is-hidden").parent().append(d),n(),3!==v.type||h&&"none"!==h.subscription||a(".l-chat:visible").addClass("is-request"),y.createDataSpinner(!0),r.download(t,function(a){y.removeDataSpinner();for(var b=0,c=a.length;c>b;b++)i=r.create(a[b]),j.addItem(i,null,null,i.recipient_id);y.messageScrollbar()})}else x.removeClass("is-hidden").siblings().addClass("is-hidden"),a(".l-chat:visible .scrollbar_message").mCustomScrollbar("destroy"),y.messageScrollbar(),"undefined"!=typeof v.messages&&(r.update(v.messages.join(),t),v.messages=[]);a(".is-selected").removeClass("is-selected"),q.addClass("is-selected").find(".unread").text(""),y.decUnreadCounter(v.id)},messageScrollbar:function(){var c=a(".l-chat:visible .scrollbar_message"),d=c[0].scrollHeight,e=this;c.mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:b.isMac||90,deltaFactor:-1},setTop:d+"px",callbacks:{onTotalScrollBack:function(){k(c,e)}},live:!0})},createGroupChat:function(b,c){for(var d,e=s.contacts,f=a("#popupContacts .is-chosen"),g=a("#popupContacts").data("existing_ids")||[],h=g.length>0?[p.contact.full_name,e[g[0]].full_name]:[p.contact.full_name],i=!b&&g.length>0?[e[g[0]].full_name]:[],j=this,k=[],l=(s.roster,a('.l-chat[data-dialog="'+c+'"]'),0),m=f.length;m>l;l++)d=a(f[l]).find(".name").text(),h.length<3&&h.push(d),i.push(d),g.push(a(f[l]).data("id").toString()),k.push(a(f[l]).data("id").toString());h=h.join(", "),i=i.join(", "),g=g.join(),j.createDataSpinner(null,!0),b?q.updateGroup(i,{dialog_id:c,occupants_ids:g,new_ids:k},function(b){j.removeDataSpinner();var c=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+b.id+'"]');c.length>0&&(copyDialogItem=c.clone(),c.remove(),a("#recentList ul").prepend(copyDialogItem),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),o(a("#recentList ul")))),a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay")}):q.createGroup(i,{name:h,occupants_ids:g,type:2},function(b){j.removeDataSpinner(),a(".is-overlay").removeClass("is-overlay"),a('.dialog-item[data-dialog="'+b.id+'"]').find(".contact").click()})},leaveGroupChat:function(b){var c=s.dialogs,d=b.data("dialog"),e=c[d],f=a('.dialog-item[data-dialog="'+d+'"]'),g=a('.l-chat[data-dialog="'+d+'"]'),h=f.parents("ul");q.leaveChat(e,function(){f.remove(),o(h),localStorage.removeItem("QM.dialog-"+d),g.length>0&&g.remove(),a("#capBox").removeClass("is-hidden"),delete c[d]})}},i}),function(a){"function"==typeof define&&define.amd?define("timeago",["jquery"],a):a("object"==typeof module&&"object"==typeof module.exports?require("jquery"):jQuery)}(function(a){function b(){if(!a.contains(document.documentElement,this))return a(this).timeago("dispose"),this;var b=c(this),g=f.settings;return isNaN(b.datetime)||(0==g.cutoff||Math.abs(e(b.datetime))<g.cutoff)&&a(this).text(d(b.datetime)),this}function c(b){if(b=a(b),!b.data("timeago")){b.data("timeago",{datetime:f.datetime(b)});var c=a.trim(b.text());f.settings.localeTitle?b.attr("title",b.data("timeago").datetime.toLocaleString()):!(c.length>0)||f.isTime(b)&&b.attr("title")||b.attr("title",c)}return b.data("timeago")}function d(a){return f.inWords(e(a))}function e(a){return(new Date).getTime()-a.getTime()}a.timeago=function(b){return d(b instanceof Date?b:"string"==typeof b?a.timeago.parse(b):"number"==typeof b?new Date(b):a.timeago.datetime(b))};var f=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6e4,allowPast:!0,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:"any moment now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function c(c,e){var f=a.isFunction(c)?c(e,b):c,g=d.numbers&&d.numbers[e]||e;return f.replace(/%d/i,g)}if(!this.settings.allowPast&&!this.settings.allowFuture)throw"timeago allowPast and allowFuture settings can not both be set to false.";var d=this.settings.strings,e=d.prefixAgo,f=d.suffixAgo;if(this.settings.allowFuture&&0>b&&(e=d.prefixFromNow,f=d.suffixFromNow),!this.settings.allowPast&&b>=0)return this.settings.strings.inPast;var g=Math.abs(b)/1e3,h=g/60,i=h/60,j=i/24,k=j/365,l=45>g&&c(d.seconds,Math.round(g))||90>g&&c(d.minute,1)||45>h&&c(d.minutes,Math.round(h))||90>h&&c(d.hour,1)||24>i&&c(d.hours,Math.round(i))||42>i&&c(d.day,1)||30>j&&c(d.days,Math.round(j))||45>j&&c(d.month,1)||365>j&&c(d.months,Math.round(j/30))||1.5>k&&c(d.year,1)||c(d.years,Math.round(k)),m=d.wordSeparator||"";return void 0===d.wordSeparator&&(m=" "),a.trim([e,l,f].join(m))},parse:function(b){var c=a.trim(b);return c=c.replace(/\.\d+/,""),c=c.replace(/-/,"/").replace(/-/,"/"),c=c.replace(/T/," ").replace(/Z/," UTC"),c=c.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),c=c.replace(/([\+\-]\d\d)$/," $100"),new Date(c)},datetime:function(b){var c=f.isTime(b)?a(b).attr("datetime"):a(b).attr("title");return f.parse(c)},isTime:function(b){return"time"===a(b).get(0).tagName.toLowerCase()}});var g={init:function(){var c=a.proxy(b,this);c();var d=f.settings;d.refreshMillis>0&&(this._timeagoInterval=setInterval(c,d.refreshMillis))},update:function(c){var d=f.parse(c);a(this).data("timeago",{datetime:d}),f.settings.localeTitle&&a(this).attr("title",d.toLocaleString()),b.apply(this)},updateFromDOM:function(){a(this).data("timeago",{datetime:f.parse(f.isTime(this)?a(this).attr("datetime"):a(this).attr("title"))}),b.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};a.fn.timeago=function(a,b){var c=a?g[a]:g.init;if(!c)throw new Error("Unknown function name '"+a+"' for timeago");return this.each(function(){c.call(this,b)}),this},document.createElement("abbr"),document.createElement("time")}),define("MessageView",["jquery","config","quickblox","underscore","minEmoji","timeago"],function(a,b,c,d,e){function f(a){this.app=a,m=this.app.models.User,p=this.app.models.Dialog,n=this.app.models.Message,o=this.app.models.ContactList,q=this}function g(a,b){return b+=a&&"none"!==a.subscription?a&&a.status?'<span class="status status_online"></span>':'<span class="status"></span>':'<span class="status status_request"></span>'}function h(a){return a>1048576?(a/1048576).toFixed(1)+" MB":(a/1024).toFixed(1)+"KB"}function i(a){var b=a.find(".l-chat-content .mCSB_container").height(),c=a.find(".l-chat-content").height(),d=a.find(".l-chat-content .mCSB_draggerContainer").height(),e=a.find(".l-chat-content .mCSB_dragger").height();a.find(".l-chat-content .mCSB_container").css({top:c-b+"px"}),a.find(".l-chat-content .mCSB_dragger").css({top:d-e+"px"})}function j(b){var c=new Date(1e3*b),d=new Date;return d.setHours(0,0,0,0),c>d?c.getHours()+":"+(1===c.getMinutes().toString().length?"0"+c.getMinutes():c.getMinutes()):c.getFullYear()===d.getFullYear()?a.timeago(c):c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()}function k(a){function b(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;")}var c,d,e=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi;return a=b(a),a=a.replace(/\n/g,"<br>"),a=a.replace(e,function(a){return c=/^[a-z]+:/i.test(a)?a:"http://"+a,d=a,'<a href="'+b(c)+'" target="_blank">'+b(d)+"</a>"})}function l(b){0===b.contents().length&&b.parent().addClass("is-hidden"),0===a("#historyList ul").contents().length&&a("#historyList ul").parent().addClass("is-hidden"),a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")}var m,n,o,p,q,r=[];return f.prototype={checkSenderId:function(a,b){a!==m.contact.id?o.add([a],null,function(){b()}):b()},addItem:function(b,c,f,g){var l,n,o,p=(this.app.views.Dialog,this.app.models.ContactList),q=a('.l-chat[data-dialog="'+b.dialog_id+'"]'),r=a('article.message[data-status="typing"]').length>0?!0:!1;return"undefined"!=typeof q[0]&&(b.notification_type||b.callType||b.attachment||b.body)?b.sessionID&&a('.message[data-session="'+b.sessionID+'"]')[0]?!0:void this.checkSenderId(b.sender_id,function(){var a,s,t=p.contacts,u=b.sender_id===m.contact.id?m.contact:t[b.sender_id],v=b.notification_type||b.callState&&(parseInt(b.callState)+7).toString()||"message",w=b.attachment&&b.attachment["content-type"],x=t[g]||null,y="";switch(v){case"1":for(a=d.without(b.occupants_ids.split(",").map(Number),u.id),l=0,n=a.length,o;n>l;l++)o=t[a[l]]&&t[a[l]].full_name,o?y=l+1===n?y.concat(o):y.concat(o).concat(", "):a[l]===m.contact.id&&(y=l+1===n?y.concat(m.contact.full_name):y.concat(m.contact.full_name).concat(", "));s='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',s+='<span class="message-avatar contact-avatar_message request-button_pending"></span>',s+='<div class="message-container-wrap">',s+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',s+='<div class="message-content">',s+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+u.full_name+"</span> has added "+y+" to the group chat</h4>",s+='</div><time class="message-time">'+j(b.date_sent)+"</time>",s+="</div></div></article>";break;case"2":if(s='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',s+='<span class="message-avatar contact-avatar_message request-button_pending"></span>',s+='<div class="message-container-wrap">',s+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',s+='<div class="message-content">',b.occupants_ids){for(a=b.occupants_ids.split(",").map(Number),l=0,n=a.length,o;n>l;l++)o=t[a[l]]&&t[a[l]].full_name,o?y=l+1===n?y.concat(o):y.concat(o).concat(", "):a[l]===m.contact.id&&(y=l+1===n?y.concat(m.contact.full_name):y.concat(m.contact.full_name).concat(", "));s+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+u.full_name+"</span> has added "+y+"</h4>"}b.deleted_id&&(s+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+u.full_name+"</span> has left</h4>"),b.room_name&&(s+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+u.full_name+'</span> has changed the chat name to "'+b.room_name+'"</h4>'),b.room_photo&&(s+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+u.full_name+"</span> has changed the chat picture</h4>"),s+='</div><time class="message-time">'+j(b.date_sent)+"</time>",s+="</div></div></article>";break;case"4":s='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',s+='<span class="message-avatar contact-avatar_message request-button_pending"></span>',s+='<div class="message-container-wrap">',s+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',s+='<div class="message-content">',s+=b.sender_id===m.contact.id?'<h4 class="message-author">Your request has been sent</h4>':'<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+u.full_name+"</span> has sent a request to you</h4>",s+='</div><time class="message-time">'+j(b.date_sent)+"</time>",s+="</div></div></article>";break;case"5":s='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',s+='<span class="message-avatar contact-avatar_message request-button_ok">&#10003;</span>',s+='<div class="message-container-wrap">',s+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',s+='<div class="message-content">',s+=b.sender_id===m.contact.id?'<h4 class="message-author">You have accepted a request</h4>':'<h4 class="message-author">Your request has been accepted</h4>',s+='</div><time class="message-time">'+j(b.date_sent)+"</time>",s+="</div></div></article>";break;case"6":s='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',s+='<span class="message-avatar contact-avatar_message request-button_cancel">&#10005;</span>',s+='<div class="message-container-wrap">',s+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',s+='<div class="message-content">',s+=b.sender_id===m.contact.id?'<h4 class="message-author">You have rejected a request':'<h4 class="message-author">Your request has been rejected <button class="btn btn_request_again"><img class="btn-icon btn-icon_request" src="images/icon-request.svg" alt="request">Send Request Again</button></h4>',s+='</div><time class="message-time">'+j(b.date_sent)+"</time>",s+="</div></div></article>";break;case"7":s='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',s+='<span class="message-avatar contact-avatar_message request-button_pending"></span>',s+='<div class="message-container-wrap">',s+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',s+='<div class="message-content">',s+=b.sender_id===m.contact.id?'<h4 class="message-author">You have deleted '+x.full_name+" from your contact list":'<h4 class="message-author">You have been deleted from the contact list <button class="btn btn_request_again btn_request_again_delete"><img class="btn-icon btn-icon_request" src="images/icon-request.svg" alt="request">Send Request Again</button></h4>',s+='</div><time class="message-time">'+j(b.date_sent)+"</time>",s+="</div></div></article>";break;case"8":b.caller&&(s='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'" data-session="'+b.sessionID+'">',s+=b.caller===m.contact.id?'<span class="message-avatar contact-avatar_message request-call '+("1"===b.callType?"request-video_outgoing":"request-audio_outgoing")+'"></span>':'<span class="message-avatar contact-avatar_message request-call '+("1"===b.callType?"request-video_incoming":"request-audio_incoming")+'"></span>',s+='<div class="message-container-wrap">',s+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',s+='<div class="message-content">',s+=b.caller===m.contact.id?'<h4 class="message-author">Call to '+t[b.callee].full_name+", duration "+b.duration:'<h4 class="message-author">Call from '+t[b.caller].full_name+", duration "+b.duration,s+='</div><time class="message-time">'+j(b.date_sent)+"</time>",s+="</div></div></article>");break;case"9":b.caller&&(s='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',s+=b.caller===m.contact.id?'<span class="message-avatar contact-avatar_message request-call '+("1"===b.callType?"request-video_ended":"request-audio_ended")+'"></span>':'<span class="message-avatar contact-avatar_message request-call '+("1"===b.callType?"request-video_missed":"request-audio_missed")+'"></span>',s+='<div class="message-container-wrap">',s+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',s+='<div class="message-content">',s+=b.caller===m.contact.id?'<h4 class="message-author">Call to '+t[b.callee].full_name+", no answer":'<h4 class="message-author">Missed call from '+t[b.caller].full_name,s+='</div><time class="message-time">'+j(b.date_sent)+"</time>",s+="</div></div></article>");break;case"10":b.caller&&(s='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',s+='<span class="message-avatar contact-avatar_message request-call '+("1"===b.callType?"request-video_ended":"request-audio_ended")+'"></span>',s+='<div class="message-container-wrap">',s+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',s+='<div class="message-content">',s+=b.caller===m.contact.id?'<h4 class="message-author">Call to '+t[b.callee].full_name+", busy":'<h4 class="message-author">Call from '+t[b.caller].full_name+", busy",s+='</div><time class="message-time">'+j(b.date_sent)+"</time>",s+="</div></div></article>");break;case"11":b.caller&&(s='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',s+='<span class="message-avatar contact-avatar_message request-call '+("1"===b.callType?"request-video_ended":"request-audio_ended")+'"></span>',s+='<div class="message-container-wrap">',s+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',s+='<div class="message-content">',s+=b.caller===m.contact.id?'<h4 class="message-author">'+t[b.callee].full_name+" doesn't have camera and/or microphone.":'<h4 class="message-author">Camera and/or microphone wasn\'t found.',s+='</div><time class="message-time">'+j(b.date_sent)+"</time>",s+="</div></div></article>");break;default:s=b.sender_id===m.contact.id?'<article class="message is-own l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">':'<article class="message l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',s+='<div class="message-avatar avatar contact-avatar_message profileUserAvatar" style="background-image:url('+u.avatar_url+')" data-id="'+b.sender_id+'"></div>',s+='<div class="message-container-wrap">',s+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',s+='<div class="message-content">',s+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+u.full_name+"</span></h4>",w&&w.indexOf("image")>-1?(s+='<div class="message-body">',s+='<div class="preview preview-photo" data-url="'+b.attachment.url+'" data-name="'+b.attachment.name+'">',s+='<img src="'+b.attachment.url+'" alt="attach">',s+="</div></div>",s+='</div><time class="message-time">'+j(b.date_sent)+"</time>"):w&&w.indexOf("audio")>-1?(s+='<div class="message-body">',s+=b.attachment.name+"<br><br>",s+='<audio src="'+b.attachment.url+'" controls></audio>',s+="</div>",s+='</div><time class="message-time">'+j(b.date_sent)+" ",s+='<a href="'+b.attachment.url+'" download="'+b.attachment.name+'">Download</a></time>'):w&&w.indexOf("video")>-1?(s+='<div class="message-body">',s+=b.attachment.name+"<br><br>",s+='<div class="preview preview-video" data-url="'+b.attachment.url+'" data-name="'+b.attachment.name+'"></div>',s+="</div>",s+='</div><time class="message-time">'+j(b.date_sent)+"</time>"):w?(s+='<div class="message-body">',s+='<a class="attach-file" href="'+b.attachment.url+'" download="'+b.attachment.name+'">'+b.attachment.name+"</a>",s+='<span class="attach-size">'+h(b.attachment.size)+"</span>",s+="</div>",s+='</div><time class="message-time">'+j(b.date_sent)+" ",s+='<a href="'+b.attachment.url+'" download="'+b.attachment.name+'">Download</a></time>'):(s+='<div class="message-body">'+e(k(b.body))+"</div>",s+='</div><time class="message-time">'+j(b.date_sent)+"</time>"),s+="</div></div></article>"}c?f?(r?q.find('article.message[data-status="typing"]').before(s):q.find(".l-chat-content .mCSB_container").append(s),i(q)):q.find(".l-chat-content .mCSB_container").prepend(s):q.find(".l-chat-content .mCSB_container")[0]?q.find(".l-chat-content .mCSB_container").prepend(s):q.find(".l-chat-content").prepend(s)}):!0},sendMessage:function(d){var e,f=d.parents(".l-chat").data("jid"),g=d.parents(".l-chat").data("id"),h=d.parents(".l-chat").data("dialog"),i=d.find(".textarea").html().trim(),j=Math.floor(Date.now()/1e3),k=d.parents(".l-chat").is(".is-group")?"groupchat":"chat",o=a("groupchat"===k?'.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+h+'"]':'.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+g+'"]');if(i.length>0){d.find(".textarea > span").length>0&&(d.find(".textarea > span").each(function(){a(this).after(a(this).find("span").data("unicode")).remove()}),i=d.find(".textarea").text().trim());var p={type:k,body:i,extension:{save_to_history:1,dialog_id:h,date_sent:j}};c.chat.send(f,p),message=n.create({chat_dialog_id:h,body:i,date_sent:j,sender_id:m.contact.id}),b.debug&&console.log(message),"chat"===k&&q.addItem(message,!0,!0),o.length>0&&(e=o.clone(),o.remove(),a("#recentList ul").prepend(e),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),l(a("#recentList ul"))))}},sendTypingStatus:function(a,b,d){var e=c.chat.helpers.getIdFromNode(b),f=c.chat.helpers.getRoomJid(b),g=f.split("/")[0],h="chat"===a?e:g;d?c.chat.sendIsTypingStatus(h):c.chat.sendIsStopTypingStatus(h)},claerTheListTyping:function(b){var c=a('.l-chat[data-dialog="'+b+'"]');r=[],c.find('article.message[data-status="typing"]').remove()},onMessage:function(e,f){if("error"===f.type)return!0;var h,i,j,k,r,s=q.app.views.Dialog,t=sessionStorage["QM.hiddenDialogs"]?JSON.parse(sessionStorage["QM.hiddenDialogs"]):{},u=o.dialogs,v=f.extension&&f.extension.notification_type,w=f.extension&&f.extension.dialog_id,x=f.extension&&f.extension.room_jid,y=f.extension&&f.extension.room_name,z=f.extension&&f.extension.room_photo,A=f.extension&&f.extension.deleted_id,B=f.extension&&f.extension.occupants_ids&&f.extension.occupants_ids.split(",").map(Number),C=a("groupchat"===f.type?'.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+w+'"]':'.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+e+'"]'),D=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+w+'"]'),E=a("groupchat"===f.type?'.l-chat[data-dialog="'+w+'"]':'.l-chat[data-id="'+e+'"]'),F=parseInt(C.length>0&&C.find(".unread").text().length>0?C.find(".unread").text():0),G=o.roster,H=a("#newMessageSignal")[0],I=f.delay,J=a("[data-dialog = "+w+"]").is(".is-selected");h=n.create(f),h.sender_id=e,A&&h.sender_id===m.contact.id||!E.is(":visible")?!E.is(":visible")&&E.length>0&&(r=u[w].messages||[],r.push(h.id),u[w].messages=r):n.update(h.id,w),J||E.is(":visible")||window.isQMAppActive||!(C.length>0)||"1"===v||I&&"groupchat"!==f.type||(F++,C.find(".unread").text(F),s.getUnreadCounter(w)),"1"===v&&"chat"===f.type&&0===D.length&&(j=p.create({_id:w,type:2,occupants_ids:B,name:y,xmpp_room_jid:x,unread_count:1}),o.dialogs[j.id]=j,b.debug&&console.log("Dialog",j),localStorage["QM.dialog-"+j.id]||localStorage.setItem("QM.dialog-"+j.id,JSON.stringify({messages:[]})),o.add(j.occupants_ids,null,function(){return(C=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+j.id+'"]')[0])?!0:(c.chat.muc.join(x),s.addDialogItem(j),F++,D=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+w+'"]'),D.find(".unread").text(F),void s.getUnreadCounter(w))})),"4"===v&&(t[e]=w,o.saveHiddenDialogs(t)),"2"===v&&(j=o.dialogs[w],B&&h.sender_id!==m.contact.id&&(j.occupants_ids=j.occupants_ids.concat(B)),
j&&A&&(j.occupants_ids=d.compact(j.occupants_ids.join().replace(A,"").split(",")).map(Number)),y&&(j.room_name=y),z&&(j.room_photo=z),j&&(o.dialogs[w]=j),B&&o.add(j.occupants_ids,null,function(){for(var a,b=E.find(".addToGroupChat").data("ids")?E.find(".addToGroupChat").data("ids").toString().split(",").map(Number):[],c=d.difference(j.occupants_ids,b),e=o.contacts,f=0,h=c.length;h>f;f++)a=c[f],a!==m.contact.id.toString()&&(k='<a class="occupant l-flexbox_inline presence-listener" data-id="'+a+'" href="#">',k=g(G[a],k),k+='<span class="name name_occupant">'+e[a].full_name+"</span></a>",E.find(".chat-occupants-wrap .mCSB_container").append(k));E.find(".addToGroupChat").data("ids",j.occupants_ids)}),A&&h.sender_id!==m.contact.id&&(E.find('.occupant[data-id="'+e+'"]').remove(),E.find(".addToGroupChat").data("ids",j.occupants_ids)),y&&(E.find(".name_chat").text(y).attr("title",y),C.find(".name").text(y)),z&&(E.find(".avatar_chat").css("background-image","url("+z+")"),C.find(".avatar").css("background-image","url("+z+")"))),"1"!==v&&C.length>0&&!I&&(i=C.clone(),C.remove(),a("#recentList ul").prepend(i),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),l(a("#recentList ul")))),b.debug&&console.log(h),q.addItem(h,!0,!0,e),E.is(":visible")&&window.isQMAppActive||"groupchat"===f.type&&h.sender_id===m.contact.id||H.play()},onMessageTyping:function(b,c,d){var e,f=q.app.models.ContactList,g=f.contacts,h=g[c],j=a(null===d?'.l-chat[data-id="'+c+'"]':'.l-chat[data-dialog="'+d+'"]'),k=a('article.message[data-status="typing"]').length>0?!0:!1,l=c!==m.contact.id?!0:!1,n=j.is(":visible")?!0:!1,o=r.indexOf(h.full_name);e='<article class="message l-flexbox l-flexbox_alignstretch" data-status="typing">',e+='<div class="message_typing"></div>',e+="<div> is typing</div>",e+='<div class="popup-elem spinner_bounce is-typing">',e+='<div class="spinner_bounce-bounce1"></div>',e+='<div class="spinner_bounce-bounce2"></div>',e+='<div class="spinner_bounce-bounce3"></div>',e+="</div></article>",l&&n&&(b?(r.unshift(h.full_name),a.unique(r),k?j.find('article.message[data-status="typing"] .message_typing').text(r.join(", ")):(j.find(".l-chat-content .mCSB_container").append(e),j.find('article.message[data-status="typing"] .message_typing').text(r.join(", ")),i(j))):(o=r.indexOf(h.full_name),r.splice(o,1),r.length<1?a('article.message[data-status="typing"]').remove():j.find('article.message[data-status="typing"] .message_typing').text(r.join(", "))))}},f}),ProgressBar.OPTION_NAME={},ProgressBar.OPTION_NAME.ITEM_ID="itemID",ProgressBar.OPTION_NAME.TYPE="type",ProgressBar.OPTION_NAME.PERCENT="percent",ProgressBar.OPTION_NAME.COLOR_ID="colorID",ProgressBar.OPTION_NAME.OPACITY="opacity",ProgressBar.OPTION_NAME.ALIGN="align",ProgressBar.OPTION_NAME.SPACE="space",ProgressBar.OPTION_NAME.POSITION="position",ProgressBar.OPTION_VALUE={},ProgressBar.OPTION_VALUE.COLOR_ID={},ProgressBar.OPTION_VALUE.COLOR_ID.BLUE="blue",ProgressBar.OPTION_VALUE.COLOR_ID.GREEN="green",ProgressBar.OPTION_VALUE.COLOR_ID.YELLOW="yellow",ProgressBar.OPTION_VALUE.COLOR_ID.ORANGE="orange",ProgressBar.OPTION_VALUE.COLOR_ID.RED="red",ProgressBar.OPTION_VALUE.COLOR_ID.WHITE="white",ProgressBar.OPTION_VALUE.COLOR_ID.BLACK="black",ProgressBar.OPTION_VALUE.TYPE={},ProgressBar.OPTION_VALUE.TYPE.BAR="bar",ProgressBar.OPTION_VALUE.TYPE.LINE="line",ProgressBar.OPTION_VALUE.TYPE.TEXT="text",ProgressBar.OPTION_VALUE.ALIGN={},ProgressBar.OPTION_VALUE.ALIGN.LEFT="left",ProgressBar.OPTION_VALUE.ALIGN.RIGHT="right",ProgressBar.OPTION_VALUE.POSITION={},ProgressBar.OPTION_VALUE.POSITION.ABSOLUTE="absolute",ProgressBar.OPTION_VALUE.POSITION.RELATIVE="relative",ProgressBar.DEFAULT_VALUE={},ProgressBar.DEFAULT_VALUE.WIDTH="100px",ProgressBar.DEFAULT_VALUE.HEIGHT="6px",ProgressBar.DEFAULT_VALUE.TYPE=ProgressBar.OPTION_VALUE.TYPE.BAR,ProgressBar.DEFAULT_VALUE.PERCENT=0,ProgressBar.DEFAULT_VALUE.COLOR_ID=ProgressBar.OPTION_VALUE.COLOR_ID.BLUE,ProgressBar.DEFAULT_VALUE.OPACITY=1,ProgressBar.DEFAULT_VALUE.ALIGN="left",ProgressBar.DEFAULT_VALUE.SPACE=0,ProgressBar.DEFAULT_VALUE.POSITION="relative",ProgressBar.DEFAULT_VALUE.LINE_COLOR_ID=ProgressBar.OPTION_VALUE.COLOR_ID.RED,ProgressBar.DEFAULT_VALUE.LINE_OPACITY=.5,ProgressBar.EVENT={},ProgressBar.EVENT.STARTING="starting",ProgressBar.EVENT.CHANGED="changed",ProgressBar.EVENT.COMPLETED="completed",ProgressBar.getVersion=function(){return"1.2"},define("progressbar",function(a){return function(){var b;return b||a.ProgressBar}}(this)),define("AttachView",["jquery","config","quickblox","underscore","progressbar"],function(a,b,c,d,e){function f(a){this.app=a,i=this.app.models.User,j=this.app.models.Message,k=this.app.models.Attach,l=this}function g(){var b=a(".l-chat:visible"),c=b.find(".l-chat-content .mCSB_container").height(),d=b.find(".l-chat-content").height(),e=b.find(".l-chat-content .mCSB_draggerContainer").height(),f=b.find(".l-chat-content .mCSB_dragger").height();b.find(".l-chat-content .mCSB_container").css({top:d-c+"px"}),b.find(".l-chat-content .mCSB_dragger").css({top:e-f+"px"})}function h(b){0===b.contents().length&&b.parent().addClass("is-hidden"),0===a("#historyList ul").contents().length&&a("#historyList ul").parent().addClass("is-hidden"),a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")}var i,j,k,l;return f.prototype={changeInput:function(c){var e,f,h=c[0].files[0]||null,i=a(".l-chat:visible .l-chat-content .mCSB_container"),j=d.uniqueId(),m=h.size,n=m>1048576?(m/1048576).toFixed(1):(m/1024).toFixed(1),o=m>1048576?"MB":"KB",p=1024*b.maxLimitFile*1024;if(h){if(h.name.length>100?e=b.errors.fileName:h.size>p&&(e=b.errors.fileSize),e)return f='<article class="message message_service l-flexbox l-flexbox_alignstretch">',f+='<span class="message-avatar contact-avatar_message request-button_pending"></span>',f+='<div class="message-container-wrap">',f+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',f+='<div class="message-content">',f+='<h4 class="message-author message-error">'+e+"</h4>",f+="</div>",f+="</div></div></article>",i.append(f),c.val(""),g(),!1;f=h.name.length<17?'<article class="message message_service message_attach message_attach_row l-flexbox l-flexbox_alignstretch">':'<article class="message message_service message_attach l-flexbox l-flexbox_alignstretch">',f+='<span class="message-avatar contact-avatar_message request-button_attach">',f+='<img src="images/icon-attach.svg" alt="attach"></span>',f+='<div class="message-container-wrap">',f+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',f+='<div class="message-content">',f+='<h4 class="message-author">',f+=h.name,f+='<div class="attach-upload">',f+='<div id="progress_'+j+'"></div>',f+='<span class="attach-size"><span class="attach-part attach-part_'+j+'"></span> of '+n+" "+o+"</span>",f+="</div></h4></div>",f+='<time class="message-time"><a class="attach-cancel" href="#">Cancel</a></time>',f+="</div></div></article>",i.append(f),c.val(""),g(),h.type.indexOf("image")>-1?k.crop(h,{w:1e3,h:1e3},function(a){l.createProgressBar(j,n,m,a)}):l.createProgressBar(j,n,m,h)}},createProgressBar:function(b,c,d,f){function g(){if(n)j.setPercent(100),h=c,a(".attach-part_"+b).text(h),setTimeout(function(){a(".attach-part_"+b).parents("article").remove()},50);else{if(j.setPercent(m),h=(c*m/100).toFixed(1),a(".attach-part_"+b).text(h),m+=5,m>90)return!1;setTimeout(g,i)}}var h,i,j=new e("progress_"+b),m=5,n=!1;102400>d?i=50:307200>d?i=200:409600>d?i=350:512e3>d?i=400:614400>d?i=450:716800>d?i=550:819200>d?i=600:921600>d?i=650:1048576>d?i=1e3:2097152>d?i=1400:3145728>d?i=2e3:4194304>d?i=2700:5242880>d?i=3700:6291456>d?i=4900:7340032>d?i=5400:8388608>d?i=6600:9437184>d?i=7500:10485760>d&&(i=9e3),g(),console.log(1111111,f),k.upload(f,function(c){console.log(2222222,c);var e;n=!0,a("#progress_"+b).length>0&&(e=a("#progress_"+b).parents(".l-chat"),g(),l.sendMessage(e,c,d))})},cancel:function(a){a.parents("article").remove()},sendMessage:function(d,e,f){var g,l=this.app.views.Message,m=k.create(e,f),n=d.data("jid"),o=d.data("id"),p=d.data("dialog"),q=Math.floor(Date.now()/1e3),r=d.is(".is-group")?"groupchat":"chat",s=a("groupchat"===r?'.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+p+'"]':'.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+o+'"]');c.chat.send(n,{type:r,body:"Attachment",extension:{save_to_history:1,date_sent:q,attachments:[m]}}),message=j.create({chat_dialog_id:p,date_sent:q,attachment:m,sender_id:i.contact.id}),b.debug&&console.log(message),"chat"===r&&l.addItem(message,!0,!0),s.length>0&&(g=s.clone(),s.remove(),a("#recentList ul").prepend(g),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),h(a("#recentList ul"))))}},f}),define("ContactListView",["jquery","config","quickblox","underscore","mCustomScrollbar","mousewheel"],function(a,b,c,d){function e(a){this.app=a,l=this.app.models.Dialog,m=this.app.models.Message,n=this.app.models.ContactList,o=this.app.models.User,g()}function f(a,b,c){a.add(".popups").addClass("is-overlay"),b?a.addClass(b).data("dialog",c):a.removeClass("add").data("dialog","")}function g(){a(".scrollbarContacts").mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:b.isMac||60,deltaFactor:-1},live:!0})}function h(a,c){a.mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:b.isMac||60,deltaFactor:-1},callbacks:{onTotalScroll:function(){i(a,c)}},live:!0})}function i(a,b){var c=parseInt(sessionStorage["QM.search.page"]),d=parseInt(sessionStorage["QM.search.allPages"]);d>=c&&(b.createDataSpinner(a),n.globalSearch(function(c){j(a,c,b)}))}function j(a,b,c){var d,e=n.roster,f=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{};b.length>0?b.forEach(function(b){var c=e[b.id];d='<li class="list-item" data-jid="'+b.user_jid+'">',d+='<a class="contact l-flexbox" href="#">',d+='<div class="l-flexbox_inline">',d+='<div class="contact-avatar avatar profileUserAvatar" style="background-image:url('+b.avatar_url+')" data-id="'+b.id+'"></div>',d+='<span class="name profileUserName" data-id="'+b.id+'">'+b.full_name+"</span>",d+="</div>",(!c||c&&"none"===c.subscription&&!c.ask&&!f[b.id])&&(d+='<button class="send-request"><img class="icon-normal" src="images/icon-request.svg" alt="request">',d+='<img class="icon-active" src="images/icon-request_active.svg" alt="request"></button>'),c&&"none"===c.subscription&&c.ask&&(d+='<span class="send-request l-flexbox">Request Sent</span>'),d+="</a></li>",a.find(".mCSB_container").append(d),a.removeClass("is-hidden").siblings(".popup-elem").addClass("is-hidden")}):a.parents(".popup_search").find(".note").removeClass("is-hidden").siblings(".popup-elem").addClass("is-hidden"),c.removeDataSpinner()}function k(b){0===b.contents().length&&b.parent().addClass("is-hidden"),0===a("#historyList ul").contents().length&&a("#historyList ul").parent().addClass("is-hidden"),a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")}var l,m,n,o;return e.prototype={createDataSpinner:function(a){var b='<div class="popup-elem spinner_bounce">';b+='<div class="spinner_bounce-bounce1"></div>',b+='<div class="spinner_bounce-bounce2"></div>',b+='<div class="spinner_bounce-bounce3"></div>',b+="</div>",a.after(b)},removeDataSpinner:function(){a(".popup:visible .spinner_bounce").remove(),a(".popup:visible input").prop("disabled",!1)},globalPopup:function(){var b=a("#popupSearch");f(b),b.find(".popup-elem").addClass("is-hidden").siblings("form").find("input").val(""),b.find(".mCSB_container").empty()},globalSearch:function(b){var c=this,d=b.parent(),e=d.find("ul:first"),f=b.find('input[type="search"]').val().trim();f.length>0&&(b.find("input").prop("disabled",!0).val(f),d.find(".popup-elem").addClass("is-hidden"),d.find(".mCSB_container").empty(),h(e,c),c.createDataSpinner(e),a(".popup:visible .spinner_bounce").removeClass("is-hidden").addClass("is-empty"),sessionStorage.setItem("QM.search.value",f),sessionStorage.setItem("QM.search.page",1),n.globalSearch(function(a){j(e,a,c)}))},addContactsToChat:function(c,e,g,h){var i,j,k,l,m=c.data("ids")?c.data("ids").toString().split(","):[],o=a("#popupContacts"),p=n.contacts,q=n.roster;if(f(o,e,g),o.addClass("not-selected").removeClass("is-addition"),o.find(".note").addClass("is-hidden").siblings("ul").removeClass("is-hidden"),o.find(".popup-nofriends").addClass("is-hidden").siblings().removeClass("is-hidden"),o.find("form")[0].reset(),o.find(".list_contacts").mCustomScrollbar("scrollTo","top"),o.find(".mCSB_container").empty(),o.find(".btn").removeClass("is-hidden"),j=d.pluck(d.sortBy(p,"full_name"),"id").map(String),k=d.filter(j,function(a){return q[a]&&"none"!==q[a].subscription}),b.debug&&console.log("Friends",k),0===k.length)return o.children(":not(.popup-header)").addClass("is-hidden"),o.find(".popup-nofriends").removeClass("is-hidden"),!0;k=d.difference(k,m);for(var r=0,s=k.length;s>r;r++)l=k[r],i="",i+='<li class="list-item" data-id="'+l+'">',i+='<a class="contact l-flexbox" href="#">',i+='<div class="l-flexbox_inline">',i+='<div class="contact-avatar avatar profileUserAvatar" style="background-image:url('+p[l].avatar_url+')" data-id="'+l+'"></div>',i+='<span class="name profileUserName" data-id="'+l+'">'+p[l].full_name+"</span>",i+='</div><input class="form-checkbox" type="checkbox">',i+="</a></li>",o.find(".mCSB_container").append(i);e||h?o.addClass("is-addition").data("existing_ids",m.length>0?m:null):o.data("existing_ids",null)},importFBFriend:function(a){var d=c.chat.helpers.getUserJid(a,b.qbAccount.appId),e=n.roster;c.chat.roster.add(d,function(){e[a]={subscription:"none",ask:"subscribe"},n.saveRoster(e),l.createPrivate(d)})},sendSubscribe:function(b,d){var e,f,g=this.app.views.Message,h=d?b.parents(".l-chat").data("jid"):b.parents("li").data("jid"),i=n.roster,j=c.chat.helpers.getIdFromNode(h),p=a('.dialog-item[data-id="'+j+'"]')[0],q=a('#requestsList .list-item[data-jid="'+h+'"]'),r=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{},s=Math.floor(Date.now()/1e3),t=this;d||(b.after('<span class="send-request l-flexbox">Request Sent</span>'),b.remove()),r[j]&&q[0]?t.sendConfirm(q):c.chat.roster.add(h,function(){i[j]={subscription:"none",ask:"subscribe"},n.saveRoster(i),p?(c.chat.send(h,{type:"chat",body:"Contact request",extension:{save_to_history:1,date_sent:s,notification_type:"4"}}),e=m.create({chat_dialog_id:p.getAttribute("data-dialog"),notification_type:"4",date_sent:s,sender_id:o.contact.id}),g.addItem(e,!0,!0)):l.createPrivate(h,!0),p=a('.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+j+'"]'),f=p.clone(),p.remove(),a("#recentList ul").prepend(f),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),k(a("#recentList ul")))})},sendConfirm:function(d){var e,f,g,h,i,j=this.app.views.Dialog,p=this.app.views.Message,q=d.data("jid")||d.parents("li").data("jid"),r=c.chat.helpers.getIdFromNode(q),s=d.parents("ul"),t=n.roster,u=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{},v=JSON.parse(sessionStorage["QM.hiddenDialogs"]),w=Math.floor(Date.now()/1e3);d.is(".request-button")?d.parents("li").remove():d.remove(),k(s),t[r]={subscription:"from",ask:"subscribe"},n.saveRoster(t),delete u[r],n.saveNotConfirmed(u),c.chat.roster.confirm(q,function(){c.chat.send(q,{type:"chat",body:"Contact request",extension:{save_to_history:1,date_sent:w,notification_type:"5"}}),g=m.create({chat_dialog_id:v[r],notification_type:"5",date_sent:w,sender_id:o.contact.id}),p.addItem(g,!0,!0),e=a('.dialog-item[data-id="'+r+'"]'),s=e.parents("ul"),e.remove(),k(s),f=l.create({_id:v[r],type:3,occupants_ids:[r],unread_count:""}),n.dialogs[f.id]=f,b.debug&&console.log("Dialog",f),localStorage["QM.dialog-"+f.id]||localStorage.setItem("QM.dialog-"+f.id,JSON.stringify({messages:[]})),j.addDialogItem(f),h=a('.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+r+'"]'),i=h.clone(),h.remove(),a("#recentList ul").prepend(i),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),k(a("#recentList ul"))),h=a('.presence-listener[data-id="'+r+'"]'),h.find(".status").removeClass("status_request")})},sendReject:function(a){var b=a.parents("li").data("jid"),d=c.chat.helpers.getIdFromNode(b),e=a.parents("ul"),f=n.roster,g=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{};JSON.parse(sessionStorage["QM.hiddenDialogs"]);a.parents("li").remove(),k(e),f[d]={subscription:"none",ask:null},n.saveRoster(f),delete g[d],n.saveNotConfirmed(g),c.chat.roster.reject(b,function(){c.chat.send(b,{type:"chat",body:"Contact request",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"6"}})})},sendDelete:function(d){var e=(n.contacts,n.dialogs),f=d.data("id"),g=c.chat.helpers.getUserJid(f,b.qbAccount.appId),h=a('.dialog-item[data-id="'+f+'"]'),i=a('.l-chat[data-id="'+f+'"]'),j=h.parents("ul"),l=h.data("dialog"),m=n.roster;delete m[f],n.saveRoster(m),localStorage.removeItem("QM.dialog-"+l),c.chat.send(g,{type:"chat",body:"Contact request",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"7"}}),c.chat.roster.remove(g,function(){h.remove(),k(j),i.length>0&&i.remove(),a("#capBox").removeClass("is-hidden"),delete e[l]})},onSubscribe:function(d){var e,f=n.contacts,g=c.chat.helpers.getUserJid(d,b.qbAccount.appId),h=a('#requestsList .list-item[data-jid="'+g+'"]'),i=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{};return h.length>0?!0:(i[d]=!0,n.saveNotConfirmed(i),void n.add([d],null,function(){e='<li class="list-item" data-jid="'+g+'">',e+='<a class="contact l-flexbox" href="#">',e+='<div class="l-flexbox_inline">',e+='<div class="contact-avatar avatar profileUserAvatar" style="background-image:url('+("undefined"!=typeof f[d]?f[d].avatar_url:"")+')" data-id="'+d+'"></div>',e+='<span class="name profileUserName" data-id="'+d+'">'+("undefined"!=typeof f[d]?f[d].full_name:"")+"</span>",e+='</div><div class="request-controls l-flexbox">',e+='<button class="request-button request-button_cancel">&#10005;</button>',e+='<button class="request-button request-button_ok">&#10003;</button>',e+="</div></a></li>",a("#requestsList").removeClass("is-hidden").find("ul").prepend(e),a("#emptyList").addClass("is-hidden")},"subscribe"))},onConfirm:function(b){var c=n.roster,d=a('.presence-listener[data-id="'+b+'"]');c[b]={subscription:"to",ask:null},n.saveRoster(c),d.find(".status").removeClass("status_request"),d.removeClass("is-request")},onReject:function(d){var e=a('.presence-listener[data-id="'+d+'"]'),f=c.chat.helpers.getUserJid(d,b.qbAccount.appId),g=a('#requestsList .list-item[data-jid="'+f+'"]'),h=g&&g.parents("ul"),i=n.roster,j=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{};i[d]={subscription:"none",ask:null},n.saveRoster(i),delete j[d],n.saveNotConfirmed(j),e.find(".status").removeClass("status_online").addClass("status_request"),e.is(".l-chat")&&e.addClass("is-request"),g.length>0&&c.chat.roster.remove(f,function(){g.remove(),k(h)}),e.addClass("is-request")},onPresence:function(b,c){var d=a('.presence-listener[data-id="'+b+'"]'),e=n.roster;return"undefined"==typeof e[b]?!0:(e[b].status=c?!1:!0,n.saveRoster(e),void(c?(d.find(".status").removeClass("status_online"),d.is(".popup_details")&&d.find(".status_text").text("Offline")):(d.find(".status").addClass("status_online"),d.is(".popup_details")&&d.find(".status_text").text("Online"))))}},e});var callTimer,win,videoStreamTime,maxHeight;define("VideoChatView",["jquery","quickblox"],function(a,b){function c(a){this.app=a,e=this,f=this.app.models.User,g=this.app.models.ContactList,h=this.app.models.VideoChat}function d(c){c.preventDefault();var d=a(c.target).data("id")?a(c.target):a(c.target).parent(),f=d.data("id"),g=d.data("dialog"),h=d.attr("class").match(/btn_camera_off/)?"video":"audio",i="video"===h?"Camera":"Mic";return e.type!==h&&"audio"===e.type?(d.addClass("off"),d.attr("title",i+" is off"),!0):void(d.is(".off")?(e.unmute(h),"video"===h&&b.webrtc.update(f,{dialog_id:g,unmute:h}),d.removeClass("off"),d.removeAttr("title")):(e.mute(h),"video"===h&&b.webrtc.update(f,{dialog_id:g,mute:h}),d.addClass("off"),d.attr("title",i+" is off")))}var e,f,g,h;return c.prototype.cancelCurrentCalls=function(){a(".mediacall").length>0&&a(".mediacall").find(".btn_hangup").click()},c.prototype.init=function(){var c=this.app.views.Dialog;a("body").on("click",".videoCall, .audioCall",function(b){b.preventDefault();var c=a(this).attr("class");e.cancelCurrentCalls(),e.startCall(c)}),a("#popupIncoming").on("click",".btn_decline",function(c){c.preventDefault();var d=a(this).parents(".incoming-call"),e=a(this).data("id"),f=a(this).data("dialog"),g=a(this).data("calltype"),i=a("#ringtoneSignal")[0];b.webrtc.reject(e,{dialog_id:f}),h.sendMessage(e,"3",null,f,g),d.remove(),0===a("#popupIncoming .mCSB_container").children().length&&(closePopup(),i.pause())}),a("#popupIncoming").on("click",".btn_accept",function(b){b.preventDefault(),e.cancelCurrentCalls();var d=a(this).data("id"),f=a('.dialog-item[data-id="'+d+'"]').find(".contact");c.htmlBuild(f);var g=(a(this).parents(".incoming-call"),a(this).data("id"),a(this).data("dialog")),i=a(this).data("session"),j=a(this).data("calltype"),k=a("#ringtoneSignal")[0],l=e.build(g),m=a('.l-chat[data-dialog="'+g+'"]');a(this).parents(".incoming-call").remove(),a("#popupIncoming .mCSB_container").children().each(function(){a(this).find(".btn_decline").click()}),closePopup(),k.pause(),l.isCallee=!0,h.getUserMedia(l,j,function(b,c){return b?(m.find(".mediacall .btn_hangup").data("errorMessage",1),m.find(".mediacall .btn_hangup").click(),fixScroll(),!0):("audio"===j?(e.type="audio",a(".btn_camera_off").click()):(e.type="video",e.unmute("video")),void(e.sessionID=i))})}),a("body").on("click",".btn_hangup",function(c){c.preventDefault();var d=a(this).parents(".l-chat"),f=a(this).data("id"),g=a(this).data("dialog"),i=a(this).parents(".mediacall").find(".mediacall-info-duration").text(),j=a("#callingSignal")[0],k=a("#endCallSignal")[0],l=a(this).data("errorMessage");j.pause(),k.play(),clearTimeout(callTimer),b.webrtc.stop(f,"manually",{dialog_id:g}),h.caller&&(l?a(this).removeAttr("data-errorMessage"):h.sendMessage(f,"1",i,g,null,null,e.sessionID),h.caller=null,h.callee=null),e.type=null,d.find(".mediacall").remove(),d.find(".l-chat-header").show(),d.find(".l-chat-content").css({height:"calc(100% - 75px - 90px)"})}),a("body").on("click",".btn_camera_off, .btn_mic_off",d),a("body").on("click",".btn_full-mode",function(){var b,c,f,h=a(this).data("id"),i=a(this).data("dialog"),j=a('.l-chat[data-dialog="'+i+'"]'),k=a(".mediacall").clone();g.contacts[h];win=enableFullScreenMode(),win.onload=function(){function g(){k=b.find(".mediacall").clone(),j.prepend(k),j.find(".l-chat-header").hide(),j.find(".l-chat-content").css({height:"calc(100% - "+maxHeight+" - 90px)"}),screen.height>768&&j.find(".mediacall-remote-user").css({position:"absolute",top:"16%",left:"10%",margin:0}),a('.dialog-item[data-dialog="'+i+'"]').find(".contact").click(),l(a(window.document.body),"normal")}function h(){j.find(".mediacall").remove(),j.find(".l-chat-header").show(),j.find(".l-chat-content").css({height:"calc(100% - 75px - 90px)"})}function l(a,b){"full"===b?(a.find(".mediacall").removeAttr("style"),a.find(".btn_full-mode img").attr("src","images/icon-full-mode-off.png")):(a.find(".mediacall").attr("style","max-height:"+maxHeight),a.find(".btn_full-mode img").attr("src","images/icon-full-mode-on.png")),a.find("#remoteStream")[0].play(),a.find("#localStream")[0].play(),a.find("#localStream")[0].muted=!0,"video"!==e.type||f||(c=a.find("#remoteStream")[0],c.currentTime=videoStreamTime,c.addEventListener("timeupdate",function(){if(videoStreamTime===c.currentTime)return!0;videoStreamTime=c.currentTime;var b=getTimer(Math.floor(c.currentTime));a.find(".mediacall-info-duration, .mediacall-remote-duration").text(b)})),f&&(a.find(".mediacall .btn_hangup").click(),videoStreamTime=null)}b=a(win.document.body),b.html(k),h(),l(b,"full"),win.onbeforeunload=g,b.find(".btn_full-mode").on("click",function(){win.close()}),b.find(".btn_camera_off, .btn_mic_off").on("click",d),b.find(".btn_hangup").on("click",function(){f=!0,win.close()})}})},c.prototype.onCall=function(b,c){var d,e=a("#ringtoneSignal")[0],f=a("#popupIncoming");d='<div class="incoming-call l-flexbox l-flexbox_column l-flexbox_flexbetween">',d+='<div class="incoming-call-info l-flexbox l-flexbox_column">',d+='<div class="message-avatar avatar contact-avatar_message info-avatar" style="background-image:url('+c.avatar+')"></div>',d+='<span class="info-notice">'+capitaliseFirstLetter(c.callType)+" Call from "+c.full_name+"</span>",d+="</div>",d+='<div class="incoming-call-controls l-flexbox l-flexbox_flexcenter">',d+='<button class="btn_decline" data-callType="'+c.callType+'" data-dialog="'+c.dialog_id+'" data-id="'+b+'">Decline</button>',d+='<button class="btn_accept" data-callType="'+c.callType+'" data-session="'+c.sessionID+'" data-dialog="'+c.dialog_id+'" data-id="'+b+'">Accept</button>',d+="</div></div>",f.find(".mCSB_container").prepend(d),openPopup(f),e.play()},c.prototype.onAccept=function(b,c){var d=a("#callingSignal")[0];a('.l-chat[data-dialog="'+c.dialog_id+'"]');d.pause(),e.sessionID=c.sessionID},c.prototype.onRemoteStream=function(c){var d=document.getElementById("remoteStream");b.webrtc.attachMediaStream("remoteStream",c),a(".mediacall .btn_full-mode").prop("disabled",!1),"video"===e.type?(d.addEventListener("timeupdate",function(){videoStreamTime=d.currentTime;var b=getTimer(Math.floor(d.currentTime));a(".mediacall-info-duration, .mediacall-remote-duration").text(b)}),a("#remoteUser").addClass("is-hidden"),a("#remoteStream").removeClass("is-hidden"),a(".mediacall-info-duration").removeClass("is-hidden"),a(".mediacall-remote-duration").addClass("is-hidden")):setTimeout(function(){setDuration(),a("#remoteStream").addClass("is-hidden"),a("#remoteUser").removeClass("is-hidden"),a(".mediacall-remote-duration").removeClass("is-hidden"),a(".mediacall-info-duration").addClass("is-hidden")},2700)},c.prototype.onReject=function(b,c){var d=a("#callingSignal")[0],f=a('.l-chat[data-dialog="'+c.dialog_id+'"]');h.caller=null,h.callee=null,e.type=null,d.pause(),f.find(".mediacall").remove(),f.find(".l-chat-header").show(),f.find(".l-chat-content").css({height:"calc(100% - 75px - 90px)"})},c.prototype.onStop=function(b,c){var d,f=a('.l-chat[data-dialog="'+c.dialog_id+'"]'),g=a('.btn_decline[data-dialog="'+c.dialog_id+'"]'),i=a("#callingSignal")[0],j=a("#endCallSignal")[0],k=a("#ringtoneSignal")[0];f[0]&&(f.find(".mediacall")[0]||win)?(win&&win.close(),i.pause(),j.play(),clearTimeout(callTimer),h.caller=null,h.callee=null,e.type=null,videoStreamTime=null,f.find(".mediacall").remove(),f.find(".l-chat-header").show(),f.find(".l-chat-content").css({height:"calc(100% - 75px - 90px)"})):g[0]&&(d=g.parents(".incoming-call"),d.remove(),0===a("#popupIncoming .mCSB_container").children().length&&(closePopup(),k.pause()))},c.prototype.onUpdateCall=function(b,c){var d=a('.l-chat[data-dialog="'+c.dialog_id+'"]'),e=a(win?win.document.body:window.document.body);d[0]&&(d.find(".mediacall")[0]||win)&&("video"===c.mute&&(e.find("#remoteStream").addClass("is-hidden"),e.find("#remoteUser").removeClass("is-hidden"),e.find(".mediacall-remote-duration").removeClass("is-hidden"),e.find(".mediacall-info-duration").addClass("is-hidden")),"video"===c.unmute&&(e.find("#remoteStream").removeClass("is-hidden"),e.find("#remoteUser").addClass("is-hidden"),e.find(".mediacall-info-duration").removeClass("is-hidden"),e.find(".mediacall-remote-duration").addClass("is-hidden")))},c.prototype.startCall=function(b){var c=a("#callingSignal")[0],d=e.build(),f=a(".l-chat:visible"),g=b.match(/audioCall/)?"audio":"video";h.getUserMedia(d,g,function(b,d){return b?(f.find(".mediacall .btn_hangup").click(),showError(f),fixScroll(),!0):(c.play(),void("audio"===g?(e.type="audio",a(".btn_camera_off").click()):(e.type="video",e.unmute("video"))))})},c.prototype.build=function(b){var c,d=a(b?'.l-chat[data-dialog="'+b+'"]':".l-chat:visible"),e=d.data("id"),h=d.data("dialog"),i=g.contacts[e];return maxHeight=screen.height>768?"420px":"550px",c='<div class="mediacall l-flexbox" style="max-height:'+maxHeight+'">',c+='<video id="remoteStream" class="mediacall-remote-stream is-hidden"></video>',c+='<video id="localStream" class="mediacall-local mediacall-local-stream is-hidden"></video>',c+='<img id="localUser" class="mediacall-local mediacall-local-avatar" src="'+f.contact.avatar_url+'" alt="avatar">',c+='<div id="remoteUser" class="mediacall-remote-user l-flexbox l-flexbox_column">',c+='<img class="mediacall-remote-avatar" src="'+i.avatar_url+'" alt="avatar">',c+='<span class="mediacall-remote-name">'+i.full_name+"</span>",c+='<span class="mediacall-remote-duration">connecting...</span>',c+="</div>",c+='<div class="mediacall-info l-flexbox l-flexbox_column l-flexbox_flexcenter">',c+='<img class="mediacall-info-logo" src="images/logo-qmunicate-transparent.svg" alt="Q-municate">',c+='<span class="mediacall-info-duration is-hidden"></span>',c+="</div>",c+='<div class="mediacall-controls l-flexbox l-flexbox_flexcenter">',c+='<button class="btn_mediacall btn_full-mode" data-id="'+e+'" data-dialog="'+h+'" disabled><img class="btn-icon_mediacall" src="images/icon-full-mode-on.png" alt="full mode"></button>',c+='<button class="btn_mediacall btn_camera_off" data-id="'+e+'" data-dialog="'+h+'"><img class="btn-icon_mediacall" src="images/icon-camera-off.svg" alt="camera"></button>',c+='<button class="btn_mediacall btn_mic_off" data-id="'+e+'" data-dialog="'+h+'"><img class="btn-icon_mediacall" src="images/icon-mic-off.svg" alt="mic"></button>',c+='<button class="btn_mediacall btn_hangup" data-id="'+e+'" data-dialog="'+h+'"><img class="btn-icon_mediacall" src="images/icon-hangup.svg" alt="hangup"></button>',c+="</div></div>",d.prepend(c),d.find(".l-chat-header").hide(),d.find(".l-chat-content").css({height:"calc(100% - "+maxHeight+" - 90px)"}),screen.height>768&&d.find(".mediacall-remote-user").css({position:"absolute",top:"16%",left:"10%",margin:0}),a('.dialog-item[data-dialog="'+h+'"]').find(".contact").click(),{opponentId:e,dialogId:h}},c.prototype.mute=function(c){b.webrtc.mute(c),"video"===c&&(a("#localStream").addClass("is-hidden"),win&&a(win.document.body).find("#localStream").addClass("is-hidden"),a("#localUser").removeClass("is-hidden"),win&&a(win.document.body).find("#localUser").removeClass("is-hidden"))},c.prototype.unmute=function(c){b.webrtc.unmute(c),"video"===c&&(a("#localStream").removeClass("is-hidden"),win&&a(win.document.body).find("#localStream").removeClass("is-hidden"),a("#localUser").addClass("is-hidden"),win&&a(win.document.body).find("#localUser").addClass("is-hidden"))},c}),define("Routes",["jquery","config","minEmoji","mCustomScrollbar","mousewheel"],function(a,b,c){function d(a){x=a,this.app=a,n=this.app.models.Dialog,o=this.app.views.User,p=this.app.views.ContactList,q=this.app.views.Dialog,r=this.app.views.Message,s=this.app.views.Attach,t=this.app.views.VideoChat}function e(){a(".chat-occupants, #popupIncoming").mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:b.isMac||28,deltaFactor:-1},live:!0})}function f(b){var c=a(b.target);return c.is("#profile, #profile *, .occupant, .occupant *, .btn_message_smile, .btn_message_smile *, .popover_smile, .popover_smile *")||3===b.which?!1:void h()}function g(a){var c=window.webkitURL||window.URL,d=a[0].files[0],e=d?c.createObjectURL(d):b.defAvatar.url,f=d?d.name:b.defAvatar.caption;a.prev().find(".avatar").css("background-image","url("+e+")").siblings("span").text(f)}function h(){
a(".is-contextmenu").removeClass("is-contextmenu"),a(".is-active").removeClass("is-active"),a(".btn_message_smile .is-hidden").removeClass("is-hidden").siblings().remove(),a(".popover:not(.popover_smile)").remove(),a(".popover_smile").hide()}function i(a,b,c,d){b&&(a.attr("data-id",b),a.find("#deleteConfirm").data("id",b)),c&&a.find("#leaveConfirm").data("dialog",c),d&&a.find(".popup-control-button_cancel").attr("data-isprofile",!0),a.add(".popups").addClass("is-overlay")}function j(a,b,c,d){"video"===d?a.find(".attach-video video").attr("src",c):a.find(".attach-photo").attr("src",c),a.find(".attach-name").text(b),a.find(".attach-download").attr("href",c).attr("download",b),a.add(".popups").addClass("is-overlay")}function k(){a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay"),a(".temp-box").remove(),a(".attach-video video")[0]&&a(".attach-video video")[0].pause()}function l(a){if(a.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var b=document.createRange();b.selectNodeContents(a.get(0)),b.collapse(!1);var c=window.getSelection();c.removeAllRanges(),c.addRange(b)}else if("undefined"!=typeof document.body.createTextRange){var d=document.body.createTextRange();d.moveToElementText(a.get(0)),d.collapse(!1),d.select()}}function m(){return window.onLine===!1?(alert("Sorry. You need to recover your Internet connection"),!1):!0}var n,o,p,q,r,s,t,u,v,w,x;return d.prototype={init:function(){window.isQMAppActive=!0,a(window).focus(function(){var b,c;window.isQMAppActive=!0,b=a(".l-list-wrap section:not(#searchList) .is-selected"),c=b[0]&&b.data("dialog"),c&&(b.find(".unread").text(""),q.decUnreadCounter(c))}),a(window).blur(function(){window.isQMAppActive=!1}),a(document).on("click",function(a){f(a)}),a(".popups").on("click",function(b){var c=a(b.target);c.is(".popups")&&!c.find(".popup.is-overlay").is(".is-open")&&k()}),a("#signup-avatar:file").on("change",function(){g(a(this))}),a("body").on("click",".userDetails",function(b){b.preventDefault(),h();var c=a(this).data("id");i(a("#popupDetails"),c),o.buildDetails(c)}),a("body").on("click","#userProfile",function(a){var b=x.views.Profile;a.preventDefault(),h(),b.render().openPopup()}),a("body").on("click",".btn_changePassword",function(a){var b=x.views.ChangePass,c=x.views.Profile;a.preventDefault(),c.$el.hide(),b.render().openPopup()}),a("body").on("click",".btn_popup_changepass",function(a){if(m()===!1)return!1;var b=(x.views.Profile,x.views.ChangePass);a.preventDefault(),b.submitForm()}),a("body").on("click",".btn_userProfile_connect",function(){if(m()===!1)return!1;var c=x.views.Profile,d=a(this);d.prop("disabled",!0),FB.login(function(a){b.debug&&console.log("FB authResponse",a),"connected"===a.status?c.addFBAccount(a.authResponse.userID):d.prop("disabled",!1)},{scope:b.fbAccount.scope})}),a(".smiles-tab").on("click",function(){var b=a(this).data("group");a(this).addClass("is-actived").siblings().removeClass("is-actived"),a(".smiles-group_"+b).removeClass("is-hidden").siblings().addClass("is-hidden"),l(a(".l-chat:visible .textarea"))}),a(".smiles-group").mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:b.isMac||30,deltaFactor:-1}}),a(".em-wrap").on("click",function(){var b=a(this).find(".em").data("unicode"),d=a(".l-chat:visible .textarea").html();a(".l-chat:visible .textarea").addClass("contenteditable").html(d+" "+c(b)+" "),l(a(".l-chat:visible .textarea"))}),a(".l-workspace-wrap").on("click",".btn_message_attach",function(){a(this).next().click()}),a(".l-workspace-wrap").on("change",".attachment",function(){s.changeInput(a(this))}),a(".l-workspace-wrap").on("click",".attach-cancel",function(b){b.preventDefault(),s.cancel(a(this))}),a(".l-workspace-wrap").on("click",".preview",function(){if(m()===!1)return!1;var b,c=a(this).data("name"),d=a(this).data("url");a(this).is(".preview-photo")?(a(".attach-photo").removeClass("is-hidden").siblings(".attach-video").addClass("is-hidden"),b="photo"):(a(".attach-video").removeClass("is-hidden").siblings(".attach-photo").addClass("is-hidden"),b="video"),j(a("#popupAttach"),c,d,b)}),a(".l-workspace-wrap").on("click",".groupTitle",function(){var b=a(".l-chat:visible");b.find(".triangle_up").is(".is-hidden")?(b.find(".triangle_up").removeClass("is-hidden").siblings(".triangle").addClass("is-hidden"),b.find(".chat-occupants-wrap").addClass("is-overlay"),b.find(".l-chat-content").addClass("l-chat-content_min")):(b.find(".triangle_down").removeClass("is-hidden").siblings(".triangle").addClass("is-hidden"),b.find(".chat-occupants-wrap").removeClass("is-overlay"),b.find(".l-chat-content").removeClass("l-chat-content_min"))}),a(".l-workspace-wrap").on("click",".groupTitle .addToGroupChat",function(c){c.stopPropagation();var d=a(this).data("dialog");b.debug&&console.log("add people to groupchat"),p.addContactsToChat(a(this),"add",d)}),a(".l-workspace-wrap").on("click",".groupTitle .leaveChat, .groupTitle .avatar",function(a){a.stopPropagation()}),a(".l-workspace-wrap").on("mouseenter focus",".groupTitle .name_chat",function(){var b=a(".l-chat:visible");b.find(".triangle:visible").addClass("is-hover").siblings(".pencil").removeClass("is-hidden")}),a(".l-workspace-wrap").on("mouseleave",".groupTitle .name_chat",function(){var b=a(".l-chat:visible");a(this).is(".is-focus")||b.find(".triangle.is-hover").removeClass("is-hover").siblings(".pencil").addClass("is-hidden")}),a(document.body).on("click",function(){var b=a(".l-chat:visible");b.find(".groupTitle .name_chat").is(".is-focus")&&(b.find(".groupTitle .name_chat").removeClass("is-focus"),b.find(".groupTitle .name_chat")[0].scrollLeft=0,b.find(".triangle.is-hover").removeClass("is-hover").siblings(".pencil").addClass("is-hidden"),v&&!v.name?b.find(".name_chat").text(u.name):v&&v.name!==u.name&&v.created_at>u.created_at?(b.find(".name_chat").text(v.name).attr("title",v.name),n.changeName(b.data("dialog"),v.name)):b.find(".name_chat").text(b.find(".name_chat").text().trim()))}),a("body").on("click",".groupTitle .name_chat",function(b){b.stopPropagation(),a(this).addClass("is-focus"),u={name:a(this).text().trim(),created_at:Date.now()},h()}),a("body").on("keyup",".groupTitle .name_chat",function(b){var c=b.keyCode;v={name:a(this).text().trim(),created_at:Date.now()},13===c?(a(document.body).click(),a(this).blur()):27===c&&(v=null,a(this).text(u.name),a(document.body).click(),a(this).blur())}),a(".l-workspace-wrap").on("mouseenter",".groupTitle .avatar",function(){var b=a(".l-chat:visible");b.find(".pencil_active").removeClass("is-hidden")}),a(".l-workspace-wrap").on("mouseleave",".groupTitle .avatar",function(){var b=a(".l-chat:visible");b.find(".pencil_active").addClass("is-hidden")}),a(".l-workspace-wrap").on("click",".groupTitle .pencil_active",function(){a(this).siblings("input:file").click(),h()}),a(".l-workspace-wrap").on("change",".groupTitle .avatar_file",function(){var b=a(".l-chat:visible");n.changeAvatar(b.data("dialog"),a(this),function(a){return a?void b.find(".avatar_chat").css("background-image","url("+a+")"):!1})}),e(),a("#signupFB, #loginFB").on("click",function(a){return m()===!1?!1:(b.debug&&console.log("connect with FB"),a.preventDefault(),void FB.login(function(a){b.debug&&console.log("FB authResponse",a),"connected"===a.status&&o.connectFB(a.authResponse.accessToken)},{scope:b.fbAccount.scope}))}),a("#signupQB").on("click",function(){b.debug&&console.log("signup with QB"),o.signupQB()}),a("#loginQB").on("click",function(a){b.debug&&console.log("login wih QB"),a.preventDefault(),o.loginQB()}),a(".back_to_welcome_page").on("click",function(){return m()===!1?!1:void o.logout()}),a(".back_to_login_page").on("click",function(){return m()===!1?!1:void o.loginQB()}),a("#signupForm").on("click submit",function(a){return m()===!1?!1:(b.debug&&console.log("create user"),a.preventDefault(),void o.signupForm())}),a("#forgot").on("click",function(a){b.debug&&console.log("forgot password"),a.preventDefault(),o.forgot()}),a("#loginForm").on("click submit",function(a){return m()===!1?!1:(b.debug&&console.log("authorize user"),a.preventDefault(),void o.loginForm())}),a("#forgotForm").on("click submit",function(a){return m()===!1?!1:(b.debug&&console.log("send letter"),a.preventDefault(),void o.forgotForm())}),a("#resetForm").on("click submit",function(a){return m()===!1?!1:(b.debug&&console.log("reset password"),a.preventDefault(),void o.resetForm())}),a("#profile").on("click",function(b){b.preventDefault(),h(),o.profilePopover(a(this))}),a(".list_contextmenu").on("contextmenu",".contact",function(b){b.preventDefault(),h(),o.contactPopover(a(this))}),a(".l-workspace-wrap").on("click",".occupant",function(b){b.preventDefault(),h(),o.occupantPopover(a(this),b)}),a(".l-workspace-wrap").on("click",".btn_message_smile",function(){var b=a(this).is(".is-active");h(),b===!1&&o.smilePopover(a(this)),l(a(".l-chat:visible .textarea"))}),a(".header-links-item").on("click","#logout",function(b){b.preventDefault(),i(a("#popupLogout"))}),a("body").on("click",".deleteContact",function(b){b.preventDefault(),k();var c=a(this).parents(".presence-listener"),d=c.data("id");c.is(".popup_details")?i(a("#popupDelete"),d,null,!0):i(a("#popupDelete"),d)}),a(".list, .l-workspace-wrap").on("click",".leaveChat",function(b){b.preventDefault();var c=a(this).parents(".presence-listener")[0]?a(this).parents(".presence-listener"):a(this).parents(".is-group"),d=c.data("dialog");i(a("#popupLeave"),null,d)}),a("#logoutConfirm").on("click",function(){return m()===!1?!1:void o.logout()}),a("#deleteConfirm").on("click",function(){return m()===!1?!1:(b.debug&&console.log("delete contact"),void p.sendDelete(a(this)))}),a("#leaveConfirm").on("click",function(){return m()===!1?!1:(b.debug&&console.log("leave chat"),void q.leaveGroupChat(a(this)))}),a(".popup-control-button, .btn_popup_private").on("click",function(b){b.preventDefault();var c=a(this).data("isprofile");a(this).is(".returnBackToPopup")||k(),c&&i(a("#popupDetails"))}),a(".search").on("click",function(){b.debug&&console.log("global search"),k(),p.globalPopup()}),a(".btn_search").on("click",function(b){b.preventDefault();var c=a("#searchContacts input"),d=a("#globalSearch input");d.val(c.val()),a("#globalSearch").submit()}),a("#mainPage").on("click",".createGroupChat",function(c){c.preventDefault(),b.debug&&console.log("add people to groupchat");var d=a(this).data("private");p.addContactsToChat(a(this),null,null,d)}),a(".l-sidebar").on("click",".addToGroupChat",function(c){c.preventDefault();var d=a(this).data("dialog");b.debug&&console.log("add people to groupchat"),p.addContactsToChat(a(this),"add",d)}),a("#globalSearch").on("submit",function(b){return m()===!1?!1:(b.preventDefault(),void p.globalSearch(a(this)))}),a(".localSearch").on("keyup search submit",function(b){b.preventDefault();var c=b.type,d=b.keyCode;("keyup"===c&&27!==d&&13!==d||"search"===c)&&("searchContacts"===this.id?o.localSearch(a(this)):o.friendsSearch(a(this)))}),a(".list_contacts").on("click","button.send-request",function(){return m()===!1?!1:(b.debug&&console.log("send subscribe"),void p.sendSubscribe(a(this)))}),a(".l-workspace-wrap").on("click",".btn_request_again",function(){return m()===!1?!1:(b.debug&&console.log("send subscribe"),void p.sendSubscribe(a(this),!0))}),a("body").on("click",".requestAction",function(c){return m()===!1?!1:(c.preventDefault(),b.debug&&console.log("send subscribe"),void p.sendSubscribe(a(this)))}),a(".list").on("click",".request-button_ok",function(){return m()===!1?!1:(b.debug&&console.log("send confirm"),void p.sendConfirm(a(this)))}),a(".list").on("click",".request-button_cancel",function(){return m()===!1?!1:(b.debug&&console.log("send reject"),void p.sendReject(a(this)))}),a(".list").on("click",".contact",function(a){"INPUT"!==a.target.tagName&&a.preventDefault()}),a("#popupContacts").on("click",".contact",function(){var b,c=a(this).parent(),d=c.parents(".popup");c.is(".is-chosen")?c.removeClass("is-chosen").find("input").prop("checked",!1):c.addClass("is-chosen").find("input").prop("checked",!0),b=c.parent().find("li.is-chosen").length,1!==b||d.is(".is-addition")?b>=1?(d.removeClass("not-selected"),d.is(".add")?d.find(".btn_popup_add").removeClass("is-hidden").siblings().addClass("is-hidden"):d.find(".btn_popup_group").removeClass("is-hidden").siblings().addClass("is-hidden"),c.is("li:last")&&d.find(".list_contacts").mCustomScrollbar("scrollTo","bottom")):d.addClass("not-selected"):(d.removeClass("not-selected"),d.find(".btn_popup_private").removeClass("is-hidden").siblings().addClass("is-hidden"),c.is("li:last")&&d.find(".list_contacts").mCustomScrollbar("scrollTo","bottom"))}),a(".list_contextmenu").on("click",".contact",function(){var b=a(".l-list .list-item.is-selected").attr("data-dialog");r.claerTheListTyping(b),q.htmlBuild(a(this))}),a("#popupContacts .btn_popup_private").on("click",function(){var b=a("#popupContacts .is-chosen").data("id"),c=a('.dialog-item[data-id="'+b+'"]').find(".contact");q.htmlBuild(c)}),a("body").on("click",".writeMessage",function(b){b.preventDefault();var c=a(this).data("id"),d=a('.dialog-item[data-id="'+c+'"]').find(".contact");k(),q.htmlBuild(d)}),a("#popupContacts .btn_popup_group").on("click",function(){return m()===!1?!1:void q.createGroupChat()}),a("#popupContacts .btn_popup_add").on("click",function(){if(m()===!1)return!1;var b=a(this).parents(".popup").data("dialog");q.createGroupChat("add",b)}),a(".l-workspace-wrap").on("keydown",".l-message",function(b){var c=(a(this).parents(".l-chat").data("jid"),a(this).parents(".l-chat").is(".is-group")?"groupchat":"chat",b.shiftKey),d=b.keyCode;a(".l-chat:visible .textarea").html().trim();13!==d||c||(r.sendMessage(a(this)),a(this).find(".textarea").empty(),h())}),a(".l-workspace-wrap").on("keyup",".l-message",function(b){function c(){clearTimeout(w),w=void 0,r.sendTypingStatus(e,d,!1)}var d=a(this).parents(".l-chat").data("jid"),e=a(this).parents(".l-chat").is(".is-group")?"groupchat":"chat",f=b.shiftKey,g=b.keyCode;13!==g||f?void 0===w?(r.sendTypingStatus(e,d,!0),w=setTimeout(c,3e3)):(clearTimeout(w),w=setTimeout(c,3e3)):c()}),a(".l-workspace-wrap").on("keyup",".l-message",function(){var b=a(".l-chat:visible .textarea").text().trim();b.length>0?a(".l-chat:visible .textarea").addClass("contenteditable"):a(".l-chat:visible .textarea").removeClass("contenteditable").empty()}),a(".l-workspace-wrap").on("submit",".l-message",function(a){a.preventDefault()}),a("body").on("paste",".l-message",function(a){a.preventDefault();var b=(a.originalEvent||a).clipboardData.getData("text/plain");document.execCommand("insertText",!1,b)}),a("#home").on("click",function(b){b.preventDefault(),a("#capBox").removeClass("is-hidden").siblings().addClass("is-hidden"),a(".is-selected").removeClass("is-selected")}),a("#share").on("click",function(a){return m()===!1?!1:void a.preventDefault()}),t.init()}},d}),define("QBApiCalls",["jquery","config","quickblox"],function(a,b,c){function d(a){this.app=a,f=this.app.models.Session,g=this.app.views.User,h=this.app.views.ContactList}function e(){i=setTimeout(function(){c.getSession(function(a,b){return a?console.log("recovery session error",a):(f.update({date:new Date}),void e())})},36e5)}var f,g,h,i;d.prototype={init:function(a){"undefined"==typeof a?c.init(b.qbAccount.appId,b.qbAccount.authKey,b.qbAccount.authSecret):(c.init(a),c.service.qbInst.session.application_id=b.qbAccount.appId,f.create(JSON.parse(localStorage["QM.session"]),!0),g.autologin())},checkSession:function(a){var b=this;(new Date).toISOString()>f.expirationTime?(b.init(),f.authParams.provider?g.getFBStatus(function(c){f.authParams.keys.token=c,b.createSession(f.authParams,a,f._remember)}):(b.createSession(f.decrypt(f.authParams),a,f._remember),f.encrypt(f.authParams))):a()},createSession:function(d,e,h){c.createSession(d,function(c,i){if(c){b.debug&&console.log(c.detail);var k,l=JSON.parse(c.detail);401===c.code?(k=b.errors.unauthorized,a("section:visible input:not(:checkbox)").addClass("is-error")):(k=l.errors.email?l.errors.email[0]:l.errors.base?l.errors.base[0]:l.errors[0],k.indexOf("Authentication")>=0?(k=b.errors.crashFBToken,g.getFBStatus()):k.indexOf("already")>=0?(k=b.errors.emailExists,g.getFBStatus()):k=b.errors.session),j(k)}else b.debug&&console.log("QB SDK: Session is created",i),f.token?f.update({token:i.token}):f.create({token:i.token,authParams:f.encrypt(d)},h),f.update({date:new Date}),e(i)})},loginUser:function(a,d){this.checkSession(function(e){c.login(a,function(c,e){c?b.debug&&console.log(c.detail):(b.debug&&console.log("QB SDK: User has logged",e),f.update({date:new Date,authParams:f.encrypt(a)}),d(e))})})},logoutUser:function(a){b.debug&&console.log("QB SDK: User has exited"),this.init(),clearTimeout(i),f.destroy(),a()},forgotPassword:function(a,d){this.checkSession(function(e){c.users.resetPassword(a,function(a){404===a.code?(b.debug&&console.log(a.message),l()):(b.debug&&console.log("QB SDK: Instructions have been sent"),f.destroy(),d())})})},listUsers:function(a,d){this.checkSession(function(e){c.users.listUsers(a,function(a,c){a?b.debug&&console.log(a.detail):(b.debug&&console.log("QB SDK: Users is found",c),f.update({date:new Date}),d(c))})})},getUser:function(a,d){this.checkSession(function(e){c.users.get(a,function(a,c){a&&404===a.code?(b.debug&&console.log(a.message),m()):(b.debug&&console.log("QB SDK: Users is found",c),f.update({date:new Date}),d(c))})})},createUser:function(a,d){this.checkSession(function(e){c.users.create(a,function(a,c){if(a){b.debug&&console.log(a.detail);var e=JSON.parse(a.detail).errors.email[0];k(e)}else b.debug&&console.log("QB SDK: User is created",c),f.update({date:new Date}),d(c)})})},updateUser:function(a,d,e){this.checkSession(function(g){c.users.update(a,d,function(a,c){if(a){b.debug&&console.log(a.detail);var d=JSON.parse(a.detail).errors.email;d?k(d[0]):e(null,a)}else b.debug&&console.log("QB SDK: User is updated",c),f.update({date:new Date}),e(c)})})},createBlob:function(a,d){this.checkSession(function(e){c.content.createAndUpload(a,function(a,c){a?b.debug&&console.log(a.detail):(b.debug&&console.log("QB SDK: Blob is uploaded",c),f.update({date:new Date}),d(c))})})},connectChat:function(a,d){this.checkSession(function(h){var i=f.token;c.chat.connect({jid:a,password:i},function(a,c){a?(b.debug&&console.log(a.detail),(a.detail.indexOf("Status.ERROR")>=0||a.detail.indexOf("Status.AUTHFAIL")>=0)&&(j(a.detail),g.logout(),window.location.reload())):(f.update({date:new Date}),e(),d(c))})})},listDialogs:function(a,d){this.checkSession(function(e){c.chat.dialog.list(a,function(a,c){a?b.debug&&console.log(a.detail):(b.debug&&console.log("QB SDK: Dialogs is found",c),f.update({date:new Date}),d(c.items))})})},createDialog:function(a,d){this.checkSession(function(e){c.chat.dialog.create(a,function(a,c){a?b.debug&&console.log(a.detail):(b.debug&&console.log("QB SDK: Dialog is created",c),f.update({date:new Date}),d(c))})})},updateDialog:function(a,d,e){this.checkSession(function(g){c.chat.dialog.update(a,d,function(a,c){a?b.debug&&console.log(a.detail):(b.debug&&console.log("QB SDK: Dialog is updated",c),f.update({date:new Date}),e(c))})})},listMessages:function(a,d){this.checkSession(function(e){c.chat.message.list(a,function(a,c){a?b.debug&&console.log(a.detail):(b.debug&&console.log("QB SDK: Messages is found",c),f.update({date:new Date}),d(c.items))})})},updateMessage:function(a,d,e){this.checkSession(function(g){c.chat.message.update(a,d,function(a){404===a.code?b.debug&&console.log(a.message):(b.debug&&console.log("QB SDK: Message is updated"),f.update({date:new Date}),e())})})},deleteMessage:function(a,d){this.checkSession(function(e){c.chat.message["delete"](a,function(a){404===a.code?b.debug&&console.log(a.message):(b.debug&&console.log("QB SDK: Message is deleted"),f.update({date:new Date}),d())})})}};var j=function(b){g.removeSpinner(),a("section:visible .text_error").addClass("is-error").text(b),a("section:visible input:password").val(""),a("section:visible .chroma-hash label").css("background-color","rgb(255, 255, 255)")},k=function(c){var d;c.indexOf("already")>=0?d=b.errors.emailExists:c.indexOf("look like")>=0&&(d=b.errors.invalidEmail),a('section:visible input[type="email"]').addClass("is-error"),j(d)},l=function(){var c=b.errors.notFoundEmail;a('section:visible input[type="email"]').addClass("is-error"),j(c)},m=function(){a(".popup:visible .note").removeClass("is-hidden").siblings(".popup-elem").addClass("is-hidden"),h.removeDataSpinner()};return d}),define("MainModule",["jquery","UserModule","SessionModule","ContactModule","DialogModule","MessageModule","AttachModule","ContactListModule","VideoChatModule","UserView","DialogView","MessageView","AttachView","ContactListView","VideoChatView","Routes","QBApiCalls","config","chromaHash"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(){this.models={User:new b(this),Session:new c(this),Contact:new d(this),Dialog:new e(this),Message:new f(this),Attach:new g(this),ContactList:new h(this),VideoChat:new i(this)},this.views={User:new j(this),Dialog:new k(this),Message:new l(this),Attach:new m(this),ContactList:new n(this),VideoChat:new o(this)},this.routes=new p(this),this.service=new q(this)}return s.prototype={init:function(){var a;this.chromaHash(),this.setHtml5Patterns(),this.preloader(),localStorage["QM.session"]&&localStorage["QM.user"]&&localStorage["QM.isReleaseQBAccount"]?(a=JSON.parse(localStorage["QM.session"]).token,this.service.init(a)):localStorage["QM.isReleaseQBAccount"]?this.service.init():(localStorage.clear(),localStorage.setItem("QM.isReleaseQBAccount","1"),this.service.init()),this.routes.init(),r.debug&&console.log("App init",this)},preloader:function(){var b=a("#welcomePage .l-spinner");b.addClass("is-hidden"),b.prevAll().removeClass("is-hidden")},chromaHash:function(){a("input:password").chromaHash({bars:4})},setHtml5Patterns:function(){a(".pattern-name").attr("pattern",r.patterns.name),a(".pattern-pass").attr("pattern",r.patterns.password)}},s}),requirejs.config({baseUrl:"scripts",shim:{handlebars:{exports:"Handlebars"},cryptojs:{exports:"CryptoJS"},progressbar:{exports:"ProgressBar"},minEmoji:{exports:"minEmoji"},chromaHash:["jquery"]},paths:{cryptojs:"https://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/aes",videojs:"//vjs.zencdn.net/4.6/video",jquery:"../bower_components/jquery/dist/jquery",underscore:"../bower_components/underscore/underscore",backbone:"../bower_components/backbone/backbone",handlebars:"../bower_components/handlebars/handlebars",quickblox:"../bower_components/quickblox/quickblox.min",progressbar:"../bower_components/progressbar.js/lib/control/progressbar",loadImage:"../bower_components/blueimp-load-image/js/load-image",canvasToBlob:"../bower_components/blueimp-canvas-to-blob/js/canvas-to-blob",mCustomScrollbar:"../bower_components/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar",nicescroll:"../bower_components/jquery.nicescroll/jquery.nicescroll",mousewheel:"../bower_components/jquery-mousewheel/jquery.mousewheel",timeago:"../bower_components/jquery-timeago/jquery.timeago",minEmoji:"../vendor/emoji/js/minEmoji",chromaHash:"../bower_components/Chroma-Hash/jquery.chroma-hash",config:"../config",MainModule:"app",UserModule:"models/user",SessionModule:"models/session",ContactModule:"models/contact",DialogModule:"models/dialog",MessageModule:"models/message",AttachModule:"models/attach",ContactListModule:"models/contact_list",VideoChatModule:"models/videochat",UserView:"views/user",DialogView:"views/dialog",MessageView:"views/message",AttachView:"views/attach",ContactListView:"views/contact_list",VideoChatView:"views/videochat",Routes:"routes",QBApiCalls:"qbApiCalls"}}),requirejs(["jquery","config","minEmoji","MainModule","backbone"],function(a,b,c,d,e){var f;a(document).ready(function(){a.ajaxSetup({cache:!0}),a.getScript("https://connect.facebook.net/en_US/sdk.js",function(){FB.init({appId:b.fbAccount.appId,version:"v2.1"}),b.debug&&console.log("FB init",FB),a(".smiles-group").each(function(){var b=a(this);b.html(c(b.text()))}),f=new d,f.init()})})}),define("main",function(){});